const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ExploreReelsViewer-DerXxexN-1765669972031.js","assets/index-DJmtuQok-1765669972031.js","assets/index-BaaCw0gW-1765669972031.css","assets/PixelIcons-CNgtYg2i-1765669972031.js","assets/CommentsSheet-DNW1jYF_-1765669972031.js","assets/useTranslation-D_d-cRft-1765669972031.js","assets/loader-circle-BFGaG1cN-1765669972031.js","assets/x-C9lmtDM5-1765669972031.js","assets/heart-Ci2qy3Fd-1765669972031.js","assets/trash-2-CODcAybk-1765669972031.js","assets/flag-C0NAALis-1765669972031.js","assets/play-wzUmNWA5-1765669972031.js","assets/arrow-left-CuXT1LnJ-1765669972031.js","assets/send-DV5I3t0z-1765669972031.js","assets/volume-2-D7V2cT6F-1765669972031.js"])))=>i.map(i=>d[i]);
import{r as a,z as Q,j as e,A as _,m as p,S as W,b as X,u as B,p as G,_ as J}from"./index-DJmtuQok-1765669972031.js";import{u as K}from"./useTranslation-D_d-cRft-1765669972031.js";import{X as Y}from"./x-C9lmtDM5-1765669972031.js";import{P as U}from"./play-wzUmNWA5-1765669972031.js";const Z=a.lazy(()=>J(()=>import("./ExploreReelsViewer-DerXxexN-1765669972031.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])));function q({video:i,onClick:h}){const[c,n]=a.useState(!1),[l,s]=a.useState(!1),o=a.useRef(null),d=!!i.media_thumbnail;return e.jsxs(p.div,{ref:o,className:"relative aspect-[9/16] bg-[#1a1a1a] cursor-pointer overflow-hidden",whileTap:{scale:.98},onClick:h,children:[d&&!l&&e.jsx("img",{src:i.media_thumbnail,alt:"",className:`w-full h-full object-cover transition-opacity duration-200 ${c?"opacity-100":"opacity-0"}`,onLoad:()=>n(!0),onError:()=>s(!0),loading:"lazy"}),(!d||l)&&i.media_url&&e.jsx(ee,{videoUrl:i.media_url}),!d&&!c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#1a1a1a]",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white/20 border-t-white/60 rounded-full animate-spin"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:e.jsx(U,{className:"w-8 h-8 text-white/80 fill-white/80"})}),e.jsxs("div",{className:"absolute bottom-2 left-2 flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3 text-white fill-white"}),e.jsx("span",{className:"text-xs text-white font-medium",children:i.likes_count||0})]})]})}function ee({videoUrl:i}){const[h,c]=a.useState(null),[n,l]=a.useState(!0);return a.useEffect(()=>{const s=document.createElement("video");s.crossOrigin="anonymous",s.preload="metadata",s.muted=!0,s.playsInline=!0;const o=document.createElement("canvas"),d=o.getContext("2d"),w=()=>{if(!d)return;o.width=s.videoWidth||320,o.height=s.videoHeight||568,d.drawImage(s,0,0,o.width,o.height);const b=o.toDataURL("image/jpeg",.7);c(b),l(!1),URL.revokeObjectURL(s.src)};s.onloadeddata=()=>{const b=Math.min(.5,s.duration*.1);s.currentTime=b},s.onseeked=w,s.onerror=()=>{l(!1),URL.revokeObjectURL(s.src)};const f=setTimeout(()=>{n&&l(!1)},5e3);return s.src=i,()=>{clearTimeout(f),s.src=""}},[i]),h?e.jsx("img",{src:h,alt:"",className:"w-full h-full object-cover"}):n?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#1a1a1a]",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white/20 border-t-white/60 rounded-full animate-spin"})}):e.jsx("div",{className:"w-full h-full bg-gradient-to-b from-gray-800 to-gray-900"})}function ie({user:i,onCreatorClick:h}){const{t:c}=K(),[n,l]=a.useState([]),[s,o]=a.useState(!0),[d,w]=a.useState(null),[f,b]=a.useState(!0),g=a.useRef(null),S=a.useRef(null),[x,P]=a.useState(!1),[v,R]=a.useState(""),[E,y]=a.useState([]),[N,T]=a.useState(!1),L=a.useRef(null),V=a.useRef(null);a.useEffect(()=>{F()},[i.telegram_id]);const F=async(t=0)=>{t===0&&o(!0);const r=await Q(i.telegram_id,30,t);l(t===0?r:u=>[...u,...r]),b(r.length===30),o(!1)},O=a.useCallback(()=>{!s&&f&&F(n.length)},[s,f,n.length]),z=t=>{R(t),V.current&&clearTimeout(V.current),t.trim().length>0?(T(!0),V.current=setTimeout(async()=>{const r=await X(t.trim());y(r),T(!1)},300)):(y([]),T(!1))},C=()=>{P(!1),R(""),y([]),L.current?.blur()},I=t=>{C(),h(t)};a.useEffect(()=>(g.current&&g.current.disconnect(),g.current=new IntersectionObserver(t=>{t[0].isIntersecting&&f&&!s&&O()},{threshold:.1}),S.current&&g.current.observe(S.current),()=>g.current?.disconnect()),[O,f,s]);const M=t=>{w(t)},A=()=>{w(null)},D=async t=>{const r=n.find(j=>j.id===t);if(!r)return;const u=r.liked;l(j=>j.map(m=>m.id===t?{...m,liked:!u,likes_count:(m.likes_count||0)+(u?-1:1)}:m)),(u?await B(i.telegram_id,t):await G(i.telegram_id,t))||l(j=>j.map(m=>m.id===t?{...m,liked:u,likes_count:(m.likes_count||0)+(u?1:-1)}:m))},[H,$]=a.useState(!0);return a.useEffect(()=>{const t=document.querySelector("main");if(!t)return;const r=()=>{x||$(t.scrollTop<100)};return t.addEventListener("scroll",r,{passive:!0}),()=>{t.removeEventListener("scroll",r)}},[x]),s&&n.length===0?e.jsx("div",{className:"min-h-full bg-black flex items-center justify-center",children:e.jsx("div",{className:"w-10 h-10 border-3 border-white border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"min-h-full bg-black pb-20",children:[e.jsx(_,{children:x&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 bg-black/60 backdrop-blur-sm",onClick:C})}),e.jsxs("header",{className:`fixed top-0 left-0 right-0 z-50 flex items-center justify-center transition-opacity duration-200 ${H||x?"opacity-100":"opacity-0 pointer-events-none"}`,style:{height:"44px",marginTop:"calc(env(safe-area-inset-top, 0px) + 54px)"},children:[e.jsxs("div",{className:"flex items-center gap-2 px-12",children:[e.jsx(p.div,{className:"relative",animate:{width:x?240:200},transition:{duration:.2,ease:"easeOut"},children:e.jsxs("div",{className:"relative flex items-center",children:[e.jsx(W,{className:"absolute left-3 w-4 h-4 text-gray-400 pointer-events-none"}),e.jsx("input",{ref:L,type:"text",placeholder:c("explore.title"),value:v,onChange:t=>z(t.target.value),onFocus:()=>P(!0),className:"w-full bg-neutral-900/90 backdrop-blur-md border border-white/10 rounded-full py-2 pl-9 pr-8 text-white placeholder-gray-400 text-sm outline-none focus:ring-1 focus:ring-white/20 transition-all shadow-lg"}),v&&e.jsx("button",{onClick:()=>{R(""),y([]),L.current?.focus()},className:"absolute right-2 p-0.5 bg-white/10 hover:bg-white/20 rounded-full transition-colors",children:e.jsx(Y,{className:"w-3 h-3 text-white/70"})})]})}),e.jsx(_,{children:x&&e.jsx(p.button,{initial:{opacity:0,x:10,width:0},animate:{opacity:1,x:0,width:"auto"},exit:{opacity:0,x:10,width:0},transition:{duration:.2,ease:"easeOut"},onClick:C,className:"text-white text-sm font-medium whitespace-nowrap overflow-hidden pl-2",children:c("explore.cancel")})})]}),e.jsx(_,{children:x&&e.jsxs(p.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.15},className:"absolute left-4 right-4 top-full mt-2 bg-neutral-900/95 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl max-h-[60vh] overflow-y-auto",children:[N&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"})}),!N&&v&&E.length===0&&e.jsx("div",{className:"py-8 text-center text-gray-500 text-sm",children:c("explore.noResults")}),!N&&E.length>0&&e.jsx("div",{className:"py-2",children:E.map(t=>e.jsxs(p.button,{whileTap:{backgroundColor:"rgba(255,255,255,0.1)"},onClick:()=>I(t),className:"w-full flex items-center gap-3 px-4 py-2 hover:bg-white/5 transition-colors",children:[e.jsx("img",{src:t.avatar_url||"/default-avatar.png",alt:t.first_name||t.username||"User",className:"w-10 h-10 rounded-full object-cover bg-gray-800"}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"text-white font-medium text-sm",children:t.username||"user"}),e.jsxs("div",{className:"text-gray-400 text-xs",children:[t.first_name,t.last_name?` ${t.last_name}`:""]})]})]},t.telegram_id))}),!N&&!v&&e.jsx("div",{className:"py-8 text-center text-gray-500 text-sm",children:c("explore.searchPeople")})]})})]}),e.jsx("div",{style:{height:"calc(110px + env(safe-area-inset-top, 0px))"}}),e.jsx("div",{className:"grid grid-cols-3 gap-0.5 p-0.5",children:n.map((t,r)=>e.jsx("div",{ref:r===n.length-1?S:null,children:e.jsx(q,{video:t,onClick:()=>M(r)})},t.id))}),s&&n.length>0&&e.jsx("div",{className:"py-6 flex justify-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})}),!s&&n.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 px-4",children:[e.jsx(U,{className:"w-16 h-16 text-gray-600 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:c("explore.noVideos")}),e.jsx("p",{className:"text-gray-400 text-center",children:c("explore.beFirst")})]}),e.jsx(_,{children:d!==null&&e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50",children:e.jsx("div",{className:"w-10 h-10 border-3 border-white border-t-transparent rounded-full animate-spin"})}),children:e.jsx(Z,{videos:n,initialIndex:d,onClose:A,onLike:D,onCreatorClick:h,user:i,onCommentCountUpdate:(t,r)=>{l(u=>u.map(k=>k.id===t?{...k,comments_count:r}:k))}})})})]})}export{ie as default};
