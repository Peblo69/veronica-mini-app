import{c as $,r as a,a5 as ve,a6 as Ne,a7 as ye,a8 as Se,a9 as ke,j as e,m as v,A as _e,aa as Ce,ab as Pe,ac as Re,ad as $e}from"./index-B56mREC6-1765538923505.js";import{g as Fe,P as Le}from"./PostDetail-Caw-f-8h-1765538923505.js";import{G as Te,F as Ee,u as Ue,a as Ie}from"./useConnectionQuality-CjnNA-tx-1765538923505.js";import{u as Ve}from"./useInViewport-Cmeb_FWD-1765538923505.js";import{g as De,S as Me,c as Ae}from"./storyApi-CV643Fpv-1765538923505.js";import{u as Oe}from"./useTranslation-CXktbNtw-1765538923505.js";import{U as We}from"./user-plus-DjNE75QW-1765538923505.js";import{S as Ge}from"./star-Cr7KsdcF-1765538923505.js";import{S as qe}from"./settings-dfjYDUzw-1765538923505.js";import{C as ze}from"./chevron-down-LOWmyb9z-1765538923505.js";import{L as N}from"./lock-Btx1WNjN-1765538923505.js";import{R as X}from"./repeat-2-C75MvlwM-1765538923505.js";import{H as Be}from"./heart-Clhi8IR7-1765538923505.js";import{V as He}from"./video-DCVEI9Vj-1765538923505.js";import{I as Xe}from"./image-A5NBidsA-1765538923505.js";import{P as Ye}from"./play-3wAJm86l-1765538923505.js";import"./PixelIcons-DCylnFEx-1765538923505.js";import"./CommentsSheet-B2i2_RH9-1765538923505.js";import"./loader-circle-BCZQwj3v-1765538923505.js";import"./arrow-left-HyNuCRZa-1765538923505.js";import"./trash-2-BKDUdkzy-1765538923505.js";import"./volume-2-DBbDUTNA-1765538923505.js";import"./chevron-left-CC1ZHlDv-1765538923505.js";import"./chevron-right-Bkw3Yto5-1765538923505.js";const Ke=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],Y=$("bookmark",Ke);const Qe=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],Je=$("menu",Qe);const Ze=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],et=$("share-2",Ze);function S(s){return s>=1e6?(s/1e6).toFixed(1).replace(/\.0$/,"")+"M":s>=1e3?(s/1e3).toFixed(1).replace(/\.0$/,"")+"K":s.toString()}function Ct({user:s,setUser:n,onSettingsClick:f,onViewProfile:k}){const{t:o}=Oe(),[l,c]=a.useState("posts"),[x,h]=a.useState([]),[d,w]=a.useState([]),[p,K]=a.useState([]),[F,L]=a.useState(!0),[_,T]=a.useState(!1),[C,Q]=a.useState(!1),[E,U]=a.useState(!1),[I,J]=a.useState(!1),[b,u]=a.useState(null),[Z,ee]=a.useState(null),[te,V]=a.useState(!1),D=a.useRef(null),se=a.useRef(null),[,M]=a.useState(!1),[,A]=a.useState(!1),[ae,P]=a.useState(!1),[le,O]=a.useState("followers"),[re,j]=a.useState(s.followers_count||0),[ie,oe]=a.useState(s.following_count||0),[ce,ne]=a.useState(s.subscribers_count||0),[g,de]=a.useState([]),[me,R]=a.useState(!1);a.useEffect(()=>{pe(),xe(),q()},[s.telegram_id]);const xe=async()=>{const t=await ve(s.telegram_id);j(t.followers),oe(t.following)};a.useEffect(()=>{const t=Ne(s.telegram_id,{onNewFollower:()=>j(i=>i+1),onUnfollow:()=>j(i=>Math.max(0,i-1))}),r=ye(s.telegram_id,i=>{j(i.followers_count||0),ne(i.subscribers_count||0)});return()=>{t(),r()}},[s.telegram_id]),a.useEffect(()=>{l==="saved"&&(!C&&!_&&W(),!Z&&!te&&he())},[l]);const he=async()=>{V(!0);try{const t=await Fe(s.telegram_id);t.wallet&&ee(t.wallet)}catch(t){console.error("Failed to load wallet data:",t)}V(!1)},pe=async()=>{L(!0);const r=(await Se(s.telegram_id,s.telegram_id))?.posts??[];h(r),L(!1)},W=async()=>{if(!(C||_)){T(!0);try{const t=await ke();w(t?.posts||[]),Q(!0)}catch(t){console.error("[Profile] Failed to load saved posts:",t)}T(!1)}},ue=async()=>{if(!(I||E)){U(!0);try{const t=await Ce(s.telegram_id);K(t),J(!0)}catch(t){console.error("[Profile] Failed to load reposts:",t)}U(!1)}},fe=()=>{b&&(h(x.filter(t=>t.id!==b.id)),w(d.filter(t=>t.id!==b.id)),u(null),s.is_creator&&n({...s,posts_count:Math.max(0,(s.posts_count||1)-1)}))},we=t=>{h(x.map(r=>r.id===t.id?{...t,can_view:!0}:r)),w(d.map(r=>r.id===t.id?{...t,can_view:!0}:r))},be=()=>{D.current?.click()},ge=async()=>{const t=`${window.location.origin}/profile/${s.username||s.telegram_id}`;try{if(navigator.share){await navigator.share({url:t,title:s.username||o("profile.title")});return}}catch{}try{await navigator.clipboard.writeText(t),alert(o("profile.share.copied"))}catch{alert(o("profile.share.copyError"))}},G=(t,r)=>{const i=t.target.files?.[0];if(!i){t.target.value="";return}if(r==="profile"){(async()=>{A(!0);const m=await Pe(i,s.telegram_id);m.error||!m.url?alert(o("profile.upload.error")):await Re(s.telegram_id,{avatar_url:m.url})?(n({...s,avatar_url:m.url}),alert(o("profile.upload.avatarSuccess"))):alert(o("profile.upload.error")),A(!1),t.target.value=""})();return}(async()=>{M(!0);const m=await $e(i,s.telegram_id);if(m.error||!m.url)alert(o("profile.upload.error"));else{const H=i.type.startsWith("video/")?"video":"image",{error:je}=await Ae(s.telegram_id,m.url,H);je?alert(o("profile.upload.error")):(alert(o("profile.upload.storySuccess")),q())}M(!1),t.target.value=""})()},q=async()=>{try{const{stories:t}=await De(),r=(t||[]).filter(i=>i.user_id===s.telegram_id);de(r)}catch(t){console.error("[Profile] loadStories failed",t)}},z=x.filter(t=>t.visibility==="public"),B=x.filter(t=>t.visibility!=="public");return e.jsxs("div",{className:"bg-black min-h-screen text-white pb-20",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsx("button",{className:"p-1.5",children:e.jsx(We,{className:"w-5 h-5 text-white"})}),g.length>0?e.jsxs("button",{onClick:()=>R(!0),className:"absolute left-1/2 -translate-x-1/2 top-16 bg-white text-black text-[11px] px-2.5 py-1 rounded-full font-medium shadow-lg",style:{transform:"translateX(-50%) translateY(-100%)"},children:["View Stories",e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-full w-0 h-0 border-l-[5px] border-l-transparent border-r-[5px] border-r-transparent border-t-[5px] border-t-white"})]}):null,e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"p-1.5",children:e.jsx(Ge,{className:"w-5 h-5 text-white"})}),e.jsx("button",{className:"p-1.5",onClick:ge,children:e.jsx(et,{className:"w-5 h-5 text-white"})}),e.jsx("button",{className:"p-1.5",onClick:f,children:e.jsx(Je,{className:"w-5 h-5 text-white"})})]})]}),e.jsxs("div",{className:"flex flex-col items-center px-4 pt-1 pb-3",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("div",{className:`w-18 h-18 rounded-full ${g.length>0?"p-[2px] bg-gradient-to-tr from-pink-500 via-red-500 to-yellow-500":""}`,style:{width:"72px",height:"72px"},children:e.jsx("div",{className:`w-full h-full rounded-full ${g.length>0?"p-[2px] bg-black":""}`,children:e.jsx("img",{src:s.avatar_url||`https://i.pravatar.cc/150?u=${s.telegram_id}`,alt:s.first_name,className:"w-full h-full rounded-full object-cover",onClick:()=>g.length>0&&R(!0)})})}),e.jsx("button",{onClick:be,className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-5 h-5 bg-[#00D4FF] rounded-full flex items-center justify-center border-2 border-black",children:e.jsx("span",{className:"text-black text-sm font-bold leading-none",children:"+"})})]}),e.jsx("input",{ref:D,type:"file",accept:"image/*",className:"hidden",onChange:t=>G(t,"profile")}),e.jsx("input",{ref:se,type:"file",accept:"image/*,video/*",className:"hidden",onChange:t=>G(t,"story")}),e.jsx("div",{className:"w-full flex justify-center mb-0.5",children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"text-base font-bold tracking-wide",children:s.first_name?.toUpperCase()||"USER"}),e.jsx("button",{onClick:f,className:"absolute -right-6 top-1/2 -translate-y-1/2 p-0.5",children:e.jsx(qe,{className:"w-4 h-4 text-white/70"})})]})}),e.jsxs("span",{className:"text-[12px] text-white/50 mb-3",children:["@",s.username||`user${s.telegram_id}`]}),e.jsxs("div",{className:"flex items-center justify-center gap-0 mb-3",children:[e.jsxs("button",{onClick:()=>{O("following"),P(!0)},className:"flex flex-col items-center px-4",children:[e.jsx("span",{className:"text-base font-bold",children:S(ie)}),e.jsx("span",{className:"text-[11px] text-white/50",children:"Following"})]}),e.jsx("div",{className:"w-[1px] h-6 bg-white/10"}),e.jsxs("button",{onClick:()=>{O("followers"),P(!0)},className:"flex flex-col items-center px-4",children:[e.jsx("span",{className:"text-base font-bold",children:S(re)}),e.jsx("span",{className:"text-[11px] text-white/50",children:"Followers"})]}),e.jsx("div",{className:"w-[1px] h-6 bg-white/10"}),e.jsxs("div",{className:"flex flex-col items-center px-4",children:[e.jsx("span",{className:"text-base font-bold",children:S(ce)}),e.jsx("span",{className:"text-[11px] text-white/50",children:"Subscribers"})]})]}),e.jsx("div",{className:"text-center px-6 mb-2",children:e.jsx("p",{className:"text-[13px] text-white/90 whitespace-pre-wrap",children:s.bio||"No bio yet"})})]}),e.jsxs("div",{className:"flex border-b border-white/10",children:[e.jsxs("button",{className:`flex-1 py-3 flex items-center justify-center gap-1 ${l==="posts"?"border-b-2 border-white":""}`,onClick:()=>c("posts"),children:[e.jsx(Te,{className:`w-5 h-5 ${l==="posts"?"text-white":"text-white/40"}`}),e.jsx(ze,{className:`w-3 h-3 ${l==="posts"?"text-white":"text-white/40"}`})]}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${l==="locked"?"border-b-2 border-white":""}`,onClick:()=>c("locked"),children:e.jsx(N,{className:`w-5 h-5 ${l==="locked"?"text-white":"text-white/40"}`})}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${l==="reposts"?"border-b-2 border-white":""}`,onClick:()=>{c("reposts"),ue()},children:e.jsx(X,{className:`w-5 h-5 ${l==="reposts"?"text-white":"text-white/40"}`})}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${l==="saved"?"border-b-2 border-white":""}`,onClick:()=>{c("saved"),W()},children:e.jsx(Y,{className:`w-5 h-5 ${l==="saved"?"text-white":"text-white/40"}`})}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${l==="liked"?"border-b-2 border-white":""}`,onClick:()=>c("liked"),children:e.jsx(Be,{className:`w-5 h-5 ${l==="liked"?"text-white":"text-white/40"}`})})]}),e.jsxs("div",{className:"pb-20",children:[l==="posts"&&(F?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3,4,5,6].map(t=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},t))}):z.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(He,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-sm text-white/50",children:"Your posts will appear here"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:z.map(t=>e.jsx(v.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>u(t),children:e.jsx(y,{post:t})},t.id))})),l==="locked"&&(F?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3].map(t=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},t))}):B.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(N,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No locked content"}),e.jsx("p",{className:"text-sm text-white/50",children:"Private content will appear here"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:B.map(t=>e.jsxs(v.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>u(t),children:[e.jsx(y,{post:t}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(N,{className:"w-4 h-4 text-white drop-shadow"})})]},t.id))})),l==="reposts"&&(E||!I&&!p.length?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3,4,5,6].map(t=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},t))}):p.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(X,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No reposts yet"}),e.jsx("p",{className:"text-sm text-white/50",children:"Content you repost will appear here"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:p.map(t=>e.jsx(v.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>u(t),children:e.jsx(y,{post:t})},t.id))})),l==="saved"&&(_||!C&&!d.length?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3,4,5,6].map(t=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},t))}):d.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(Y,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No saved posts"}),e.jsx("p",{className:"text-sm text-white/50 max-w-xs mx-auto",children:"Save posts to view them later"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:d.map(t=>e.jsx(v.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>u(t),children:e.jsx(y,{post:t})},t.id))})),l==="liked"&&e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(N,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Liked posts are private"}),e.jsx("p",{className:"text-sm text-white/50 max-w-xs mx-auto",children:"Only you can see what you've liked"})]})]}),e.jsx(_e,{children:b&&e.jsx(Le,{post:b,user:s,onBack:()=>u(null),onDeleted:fe,onUpdated:we})}),me&&e.jsx(Me,{stories:g,startIndex:0,onClose:()=>R(!1)}),e.jsx(Ee,{isOpen:ae,onClose:()=>P(!1),userId:s.telegram_id,currentUserId:s.telegram_id,type:le,onUserClick:k})]})}const tt=/\.(mp4|webm|mov|m4v)(\?|$)/i;function st(s){return s.media_url?s.media_type&&s.media_type.toLowerCase().includes("video")?!0:tt.test(s.media_url):!1}function y({post:s}){const n=a.useRef(null),[f,k]=a.useState(!1),[o,l]=a.useState(!1),[c,x]=a.useState(!1),h=Ve(n,{minimumRatio:.25}),d=s.media_thumbnail||s.media_url,{isDataSaver:w}=Ue();Ie(w?null:d);const p=st(s);return a.useEffect(()=>{h&&k(!0)},[h]),s.media_url?o?e.jsx("div",{ref:n,className:"w-full h-full flex items-center justify-center bg-[#1a1a1a]",children:e.jsx(Xe,{className:"w-8 h-8 text-white/20"})}):e.jsxs("div",{ref:n,className:"w-full h-full relative",children:[(!f||!c)&&e.jsx("div",{className:"absolute inset-0 bg-[#1a1a1a] animate-pulse"}),f&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:d||s.media_url,alt:"",className:`w-full h-full object-cover transition-opacity duration-200 ${c?"opacity-100":"opacity-0"}`,loading:"lazy",onLoad:()=>x(!0),onError:()=>l(!0)}),c&&p&&e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-12 bg-gradient-to-t from-black/60 to-transparent"}),c&&p&&e.jsxs("div",{className:"absolute bottom-1.5 left-1.5 flex items-center gap-0.5",children:[e.jsx(Ye,{className:"w-3 h-3 text-white fill-white"}),e.jsx("span",{className:"text-white text-[11px] font-medium",children:S(s.view_count||0)})]}),c&&s.media_urls&&s.media_urls.length>1&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"bg-black/50 rounded px-1.5 py-0.5",children:e.jsx("span",{className:"text-[11px] text-white font-medium",children:s.media_urls.length})})})]})]}):e.jsx("div",{ref:n,className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-purple-900/50 to-pink-900/50 p-4",children:e.jsx("p",{className:"text-[13px] text-white text-center line-clamp-5",children:s.content})})}export{Ct as default};
