import{c as W,r as i,s as q,t as p,j as e,P as de,A as X,m as L,N as pe,u as me,p as xe,O as ue,Q as he,l as fe,x as we,M as be}from"./index-D5smcESI-1765667763423.js";import{a as ge}from"./moderation-Cyx-wVK9-1765667763423.js";import{C as ve,E as _e}from"./CommentsSheet-9CGH4xA0-1765667763423.js";import{u as Y}from"./useTranslation-ABSghmty-1765667763423.js";import{A as je}from"./arrow-left-g3_wipLn-1765667763423.js";import{L as Q}from"./loader-circle-DYft1nGi-1765667763423.js";import{C as Ne}from"./chart-column-BLpplveY-1765667763423.js";import{M as ye}from"./message-circle-question-mark-CqJDCzLs-1765667763423.js";import{P as ke}from"./palette-C3EoLjIO-1765667763423.js";import{T as Ce}from"./trash-2-DC8iwjUC-1765667763423.js";import{C as Pe}from"./check-BhXOtOFG-1765667763423.js";import{H as $e}from"./heart-Byjzij43-1765667763423.js";import{R as Se}from"./repeat-2-BU79ohlz-1765667763423.js";import"./x-BAf2ViMf-1765667763423.js";import"./flag-BUuuLjGs-1765667763423.js";const Me=[["path",{d:"M5 12h14",key:"1ays0h"}]],Oe=W("minus",Me);const Te=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],Ee=W("type",Te),I={none:{name:"None",value:"",preview:"bg-transparent border border-white/10"},midnight:{name:"Midnight",value:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",preview:"bg-gradient-to-br from-[#1a1a2e] via-[#16213e] to-[#0f3460]"},ember:{name:"Ember",value:"linear-gradient(135deg, #2d1f1f 0%, #4a2020 50%, #6b2020 100%)",preview:"bg-gradient-to-br from-[#2d1f1f] via-[#4a2020] to-[#6b2020]"},aurora:{name:"Aurora",value:"linear-gradient(135deg, #1a2f1a 0%, #1a3a2a 50%, #0f4a3a 100%)",preview:"bg-gradient-to-br from-[#1a2f1a] via-[#1a3a2a] to-[#0f4a3a]"},twilight:{name:"Twilight",value:"linear-gradient(135deg, #2d1f3d 0%, #3d2050 50%, #4a1f6a 100%)",preview:"bg-gradient-to-br from-[#2d1f3d] via-[#3d2050] to-[#4a1f6a]"},ocean:{name:"Ocean",value:"linear-gradient(135deg, #0d1b2a 0%, #1b263b 50%, #274060 100%)",preview:"bg-gradient-to-br from-[#0d1b2a] via-[#1b263b] to-[#274060]"}};function K(t){const w=Math.floor((Date.now()-new Date(t).getTime())/1e3);if(w<60)return`${w}s`;const b=Math.floor(w/60);if(b<60)return`${b}m`;const f=Math.floor(b/60);if(f<24)return`${f}h`;const l=Math.floor(f/24);return l<7?`${l}d`:new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"})}function z(t){return t>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t.toString()}function Ye({user:t,onBack:w,onViewProfile:b,onSheetStateChange:f}){const{t:l}=Y(),[k,x]=i.useState([]),[T,C]=i.useState(!0),[_,g]=i.useState(!1),[E,D]=i.useState(null),[j,N]=i.useState(void 0),[h,P]=i.useState(null);i.useEffect(()=>{f?.(_||h!==null)},[_,h,f]);const[n,$]=i.useState(""),[d,v]=i.useState("thought"),[m,S]=i.useState(["",""]),[V,B]=i.useState(24),[M,G]=i.useState("none"),[J,R]=i.useState(!1),[Z]=i.useState("public"),[O,A]=i.useState(!1),y=i.useRef(null),U=500,ee=t.is_creator;i.useEffect(()=>{F()},[]);const F=async()=>{C(!0);try{const{data:s,error:r}=await q.from("posts").select(`
          *,
          creator:users!posts_creator_id_fkey(*)
        `).in("post_type",["thought","poll","question"]).is("media_url",null).eq("is_hidden",!1).order("created_at",{ascending:!1}).limit(50);if(r)throw r;const o=(s||[]).map(u=>u.id),[a,c]=await Promise.all([q.from("likes").select("post_id").eq("user_id",t.telegram_id).in("post_id",o),q.from("reposts").select("post_id").eq("user_id",t.telegram_id).in("post_id",o)]),ie=new Set((a.data||[]).map(u=>u.post_id)),ne=new Set((c.data||[]).map(u=>u.post_id)),ce=(s||[]).map(u=>({...u,liked:ie.has(u.id),reposted:ne.has(u.id),creator:u.creator||{telegram_id:u.creator_id,first_name:"User",username:"user"}}));x(ce)}catch(s){console.error("Failed to load thoughts:",s),p.error("Failed to load")}C(!1)};i.useEffect(()=>{y.current&&(y.current.style.height="auto",y.current.style.height=Math.min(y.current.scrollHeight,120)+"px")},[n]);const te=async()=>{if(!O){if(d==="poll"){if(m.filter(r=>r.trim().length>0).length<2){p.error("Add at least 2 poll options");return}if(!n.trim()){p.error("Add a question for your poll");return}}else if(!n.trim())return;A(!0);try{if(n.trim()&&(await ge(n.trim()))?.flagged){p.error("Content blocked by moderation"),A(!1);return}const s={content:n.trim(),visibility:ee?Z:"public",is_nsfw:!1,unlock_price:0,post_type:d,background_gradient:M!=="none"?M:void 0};d==="poll"&&(s.poll_options=m.filter(o=>o.trim().length>0),s.poll_duration_hours=V);const{error:r}=await pe(t.telegram_id,s);r?p.error("Failed to post"):(p.success("Posted!"),$(""),v("thought"),S(["",""]),G("none"),F())}catch(s){console.error("Post error:",s),p.error("Something went wrong")}A(!1)}},se=async s=>{const r=s.liked;x(o=>o.map(a=>a.id===s.id?{...a,liked:!r,likes_count:(a.likes_count||0)+(r?-1:1)}:a));try{r?await me(t.telegram_id,s.id):await xe(t.telegram_id,s.id)}catch{x(o=>o.map(a=>a.id===s.id?{...a,liked:r,likes_count:(a.likes_count||0)+(r?1:-1)}:a))}},re=s=>{D(s.id),N(s.creator_id),g(!0)},ae=async s=>{const r=s.reposted;x(o=>o.map(a=>a.id===s.id?{...a,reposted:!r,reposts_count:(a.reposts_count||0)+(r?-1:1)}:a));try{if(r){const o=await ue(t.telegram_id,s.id);if(!o.success)throw new Error(o.error)}else{const o=await he(t.telegram_id,s.id);if(!o.success)throw new Error(o.error);p.success("Reposted!")}}catch{x(o=>o.map(a=>a.id===s.id?{...a,reposted:r,reposts_count:(a.reposts_count||0)+(r?1:-1)}:a)),p.error("Failed to repost")}},oe=async s=>{if(s.creator_id!==t.telegram_id){p.error("You can only delete your own posts");return}P(null),x(r=>r.filter(o=>o.id!==s.id));try{const r=await fe(s.id,t.telegram_id);if(!r.success)throw new Error(r.error?.message||"Failed to delete");p.success("Deleted")}catch{F(),p.error("Failed to delete")}},le=async(s,r)=>{if(s.poll_user_vote===void 0){x(o=>o.map(a=>{if(a.id!==s.id)return a;const c=[...a.poll_votes||[]];return c[r]=(c[r]||0)+1,{...a,poll_user_vote:r,poll_votes:c,poll_total_votes:(a.poll_total_votes||0)+1}}));try{const o=await we(s.id,r,t.telegram_id);if(o.error)throw new Error(o.error.message);x(a=>a.map(c=>c.id!==s.id?c:{...c,poll_votes:o.data?.poll_votes||c.poll_votes,poll_total_votes:o.data?.poll_total_votes||c.poll_total_votes,poll_user_vote:o.data?.poll_user_vote??r})),p.success("Vote recorded!")}catch{x(o=>o.map(a=>{if(a.id!==s.id)return a;const c=[...a.poll_votes||[]];return c[r]=Math.max(0,(c[r]||1)-1),{...a,poll_user_vote:void 0,poll_votes:c,poll_total_votes:Math.max(0,(a.poll_total_votes||1)-1)}})),p.error("Failed to vote")}}},H=d==="poll"?n.trim().length>0&&m.filter(s=>s.trim().length>0).length>=2:n.trim().length>0;return e.jsxs("div",{className:"min-h-screen bg-black text-white flex flex-col relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-blue-900/10 rounded-full blur-[100px]"}),e.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-purple-900/10 rounded-full blur-[100px]"})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between px-4 py-3 relative z-10",style:{marginTop:"calc(env(safe-area-inset-top) + 10px)"},children:[e.jsx("button",{onClick:w,className:"w-10 h-10 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center border border-white/10 hover:bg-white/20 transition-colors",children:e.jsx(je,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"font-bold text-lg tracking-tight",children:l("thoughts.title")}),e.jsx("button",{onClick:te,disabled:!H||O,className:`px-5 py-2 rounded-full text-sm font-bold shadow-lg transition-all ${H&&!O?"bg-white text-black hover:scale-105 active:scale-95":"bg-white/5 text-white/20 cursor-not-allowed"}`,children:O?e.jsx(Q,{className:"w-4 h-4 animate-spin"}):l("thoughts.post")})]}),e.jsx("div",{className:"flex-shrink-0 px-3 pb-4 relative z-10",children:e.jsxs("div",{className:"p-4 rounded-2xl bg-white/5 backdrop-blur-md border border-white/10",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:t.avatar_url||`https://i.pravatar.cc/150?u=${t.telegram_id}`,alt:"",className:"w-10 h-10 rounded-full object-cover flex-shrink-0 ring-2 ring-white/10"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("textarea",{ref:y,value:n,onChange:s=>$(s.target.value.slice(0,U)),placeholder:l(d==="poll"?"thoughts.askQuestion":d==="question"?"thoughts.whatToAsk":"thoughts.placeholder"),className:"w-full bg-transparent text-white text-[15px] placeholder-white/30 resize-none focus:outline-none leading-relaxed min-h-[40px]",rows:1})})]}),d==="poll"&&e.jsxs("div",{className:"mt-4 ml-[52px] space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/40 text-xs font-medium uppercase tracking-wider",children:l("thoughts.pollOptions")}),e.jsxs("select",{value:V,onChange:s=>B(Number(s.target.value)),className:"bg-black/40 border border-white/10 rounded-lg px-2 py-1 text-xs text-white focus:outline-none",children:[e.jsx("option",{value:1,children:l("thoughts.duration.1hour")}),e.jsx("option",{value:8,children:l("thoughts.duration.8hours")}),e.jsx("option",{value:24,children:l("thoughts.duration.24hours")})]})]}),m.map((s,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:o=>{const a=[...m];a[r]=o.target.value.slice(0,50),S(a)},placeholder:l("thoughts.optionN",{n:r+1}),className:"flex-1 bg-black/20 border border-white/10 rounded-xl px-3 py-2.5 text-sm text-white placeholder-white/20 focus:outline-none focus:border-white/30 transition-colors"}),m.length>2&&e.jsx("button",{onClick:()=>S(m.filter((o,a)=>a!==r)),className:"w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-white/40 hover:text-red-400 hover:bg-white/10 transition-colors",children:e.jsx(Oe,{className:"w-4 h-4"})})]},r)),m.length<4&&e.jsxs("button",{onClick:()=>S([...m,""]),className:"w-full py-2.5 rounded-xl border border-dashed border-white/10 text-white/40 text-xs font-medium flex items-center justify-center gap-1.5 hover:bg-white/5 transition-colors",children:[e.jsx(de,{className:"w-3.5 h-3.5"}),l("thoughts.addOption")]})]}),e.jsxs("div",{className:"mt-4 ml-[52px] flex items-center gap-2 overflow-x-auto scrollbar-hide",children:[e.jsxs("button",{onClick:()=>v("thought"),className:`px-3 py-1.5 rounded-full text-xs font-medium flex items-center gap-1.5 transition-all ${d==="thought"?"bg-white text-black shadow-lg":"bg-white/5 text-white/60 hover:bg-white/10"}`,children:[e.jsx(Ee,{className:"w-3.5 h-3.5"}),l("thoughts.text")]}),e.jsxs("button",{onClick:()=>v("poll"),className:`px-3 py-1.5 rounded-full text-xs font-medium flex items-center gap-1.5 transition-all ${d==="poll"?"bg-white text-black shadow-lg":"bg-white/5 text-white/60 hover:bg-white/10"}`,children:[e.jsx(Ne,{className:"w-3.5 h-3.5"}),l("thoughts.poll")]}),e.jsxs("button",{onClick:()=>v("question"),className:`px-3 py-1.5 rounded-full text-xs font-medium flex items-center gap-1.5 transition-all ${d==="question"?"bg-white text-black shadow-lg":"bg-white/5 text-white/60 hover:bg-white/10"}`,children:[e.jsx(ye,{className:"w-3.5 h-3.5"}),l("thoughts.qna")]}),d!=="poll"&&e.jsxs("button",{onClick:()=>R(!0),className:`px-3 py-1.5 rounded-full text-xs font-medium flex items-center gap-1.5 transition-all ${M!=="none"?"bg-white/20 text-white border border-white/20":"bg-white/5 text-white/60 hover:bg-white/10"}`,children:[e.jsx(ke,{className:"w-3.5 h-3.5"}),l("thoughts.style")]}),e.jsx("div",{className:"flex-1"}),e.jsxs("span",{className:`text-[10px] font-medium ${n.length>450?"text-orange-400":"text-white/20"}`,children:[n.length,"/",U]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 relative z-10 space-y-3 pb-6",children:T?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(Q,{className:"w-8 h-8 text-white/20 animate-spin"})}):k.length===0?e.jsx("div",{className:"py-20 text-center px-6",children:e.jsx("p",{className:"text-white/30 text-sm font-medium",children:l("thoughts.empty")})}):e.jsx(e.Fragment,{children:k.map(s=>e.jsx(De,{thought:s,currentUserId:t.telegram_id,onLike:()=>se(s),onComment:()=>re(s),onRepost:()=>ae(s),onDelete:()=>oe(s),onVote:r=>le(s,r),menuOpen:h===s.id,onMenuToggle:()=>P(h===s.id?null:s.id),onViewProfile:b},s.id))})}),e.jsx(X,{children:J&&e.jsxs(e.Fragment,{children:[e.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40",onClick:()=>R(!1)}),e.jsxs(L.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},className:"fixed bottom-0 left-0 right-0 bg-[#1c1c1e] border-t border-white/10 rounded-t-[32px] z-50 p-6 pb-[calc(env(safe-area-inset-bottom)+24px)]",children:[e.jsx("div",{className:"w-12 h-1.5 bg-white/10 rounded-full mx-auto mb-6"}),e.jsx("h3",{className:"text-white text-lg font-bold text-center mb-6",children:l("thoughts.backgroundStyle")}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:Object.entries(I).map(([s,r])=>e.jsx("button",{onClick:()=>{G(s),R(!1)},className:`aspect-square rounded-2xl ${r.preview} ${M===s?"ring-2 ring-white scale-105":"opacity-80 hover:opacity-100"} transition-all relative overflow-hidden`,children:e.jsx("span",{className:"absolute bottom-2 left-0 right-0 text-center text-white/80 text-[10px] font-medium bg-black/20 backdrop-blur-sm py-1",children:r.name})},s))})]})]})}),e.jsx(ve,{isOpen:_,onClose:()=>g(!1),postId:E,postCreatorId:j,user:t})]})}function De({thought:t,currentUserId:w,onLike:b,onComment:f,onRepost:l,onDelete:k,onVote:x,menuOpen:T,onMenuToggle:C,onViewProfile:_}){const{t:g}=Y(),E=t.creator_id===w,D=t.background_gradient&&I[t.background_gradient]?.value?{background:I[t.background_gradient].value}:{};return e.jsxs("div",{className:"p-5 rounded-2xl bg-white/5 backdrop-blur-md border border-white/5 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-white/0 group-hover:bg-white/[0.02] transition-colors pointer-events-none"}),e.jsxs("div",{className:"flex gap-3 relative z-10",children:[e.jsx("button",{onClick:()=>_?.(t.creator),className:"flex-shrink-0",children:e.jsx("img",{src:t.creator.avatar_url||`https://i.pravatar.cc/150?u=${t.creator.telegram_id}`,alt:"",className:"w-11 h-11 rounded-full object-cover ring-2 ring-white/5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("button",{onClick:()=>_?.(t.creator),className:"font-bold text-[15px] truncate text-white",children:t.creator.first_name||"User"}),e.jsxs("span",{className:"text-white/30 text-xs",children:["@",t.creator.username||`user${t.creator.telegram_id}`]}),e.jsx("span",{className:"text-white/20 text-xs",children:"â€¢"}),e.jsx("span",{className:"text-white/30 text-xs",children:K(t.created_at)}),E&&e.jsxs("div",{className:"ml-auto relative",children:[e.jsx("button",{onClick:C,className:"p-1.5 -mr-2 text-white/20 hover:text-white/60 transition-colors rounded-full hover:bg-white/5",children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx(X,{children:T&&e.jsx(L.div,{initial:{opacity:0,scale:.9,y:0},animate:{opacity:1,scale:1,y:5},exit:{opacity:0,scale:.9,y:0},transition:{duration:.15},className:"absolute right-0 top-full z-30 min-w-[140px] rounded-xl overflow-hidden shadow-2xl",style:{background:"#1c1c1e",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs("button",{onClick:k,className:"w-full px-4 py-3 flex items-center gap-3 text-red-400 hover:bg-white/5 transition-colors",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:g("common.delete")})]})})})]})]}),e.jsx("div",{className:`text-[15px] leading-relaxed text-white/90 ${t.background_gradient?"p-4 rounded-xl shadow-lg border border-white/10":""}`,style:D,children:e.jsx("p",{className:"whitespace-pre-wrap break-words",children:t.content})}),t.post_type==="poll"&&t.poll_options&&e.jsxs("div",{className:"mt-4 space-y-2",children:[(()=>{const j=t.poll_user_vote!==void 0,N=t.poll_ends_at&&new Date(t.poll_ends_at)<new Date,h=!j&&!N;return t.poll_options.map((P,n)=>{const $=t.poll_votes?.[n]||0,d=t.poll_total_votes||0,v=d>0?Math.round($/d*100):0,m=t.poll_user_vote===n;return e.jsxs("button",{className:`relative w-full text-left transition-all ${h?"active:scale-[0.98]":""}`,onClick:()=>h&&x(n),disabled:!h,children:[e.jsx("div",{className:"absolute inset-0 rounded-xl bg-white/5 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 ease-out ${m?"bg-blue-500/20":"bg-white/10"}`,style:{width:j||N?`${v}%`:"0%"}})}),e.jsxs("div",{className:`relative px-4 py-3 rounded-xl border text-sm flex justify-between items-center ${m?"border-blue-500/50 text-blue-100":h?"border-white/10 hover:border-white/20 text-white/90":"border-transparent text-white/60"}`,children:[e.jsxs("span",{className:"flex items-center gap-2 font-medium",children:[P,m&&e.jsx(Pe,{className:"w-3.5 h-3.5 text-blue-400"})]}),(j||N)&&e.jsxs("span",{className:"font-bold text-xs",children:[v,"%"]})]})]},n)})})(),e.jsxs("div",{className:"flex items-center justify-between text-white/30 text-[11px] font-medium px-1",children:[e.jsx("span",{children:g("thoughts.votes",{count:t.poll_total_votes||0})}),t.poll_ends_at&&e.jsx("span",{children:new Date(t.poll_ends_at)>new Date?g("thoughts.endsIn",{time:K(t.poll_ends_at)}):g("thoughts.pollEnded")})]})]}),e.jsx("div",{className:"flex items-center justify-between mt-4 pr-2",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("button",{onClick:b,className:`group flex items-center gap-1.5 text-xs font-medium transition-all active:scale-95 ${t.liked?"text-pink-500":"text-white/40 hover:text-white/70"}`,children:[e.jsx("div",{className:`p-1.5 rounded-full transition-colors ${t.liked?"bg-pink-500/10":"group-hover:bg-white/10"}`,children:e.jsx($e,{className:`w-4 h-4 ${t.liked?"fill-current":""}`})}),e.jsx("span",{children:z(t.likes_count||0)})]}),e.jsxs("button",{onClick:f,className:"group flex items-center gap-1.5 text-xs font-medium text-white/40 hover:text-white/70 transition-colors active:scale-95",children:[e.jsx("div",{className:"p-1.5 rounded-full group-hover:bg-white/10 transition-colors",children:e.jsx(be,{className:"w-4 h-4"})}),e.jsx("span",{children:z(t.comments_count||0)})]}),e.jsxs("button",{onClick:l,className:`group flex items-center gap-1.5 text-xs font-medium transition-all active:scale-95 ${t.reposted?"text-green-500":"text-white/40 hover:text-green-400"}`,children:[e.jsx("div",{className:`p-1.5 rounded-full transition-colors ${t.reposted?"bg-green-500/10":"group-hover:bg-white/10"}`,children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsx("span",{children:z(t.reposts_count||0)})]})]})})]})]})]})}export{Ye as default};
