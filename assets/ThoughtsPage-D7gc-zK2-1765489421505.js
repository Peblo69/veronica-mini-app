import{r as l,s as D,B as p,j as e,P as X,A as J,m as E,z as Y,u as Z,l as ee,M as te}from"./index-6hI245a3-1765489421505.js";import{a as se}from"./moderation-DkMdF02t-1765489421505.js";import{C as ae}from"./CommentsSheet-BgfMRNEQ-1765489421505.js";import{A as ie}from"./arrow-left-PCJdDOJL-1765489421505.js";import{L as F}from"./loader-circle-DzxBXhJs-1765489421505.js";import{M as re,T as le}from"./type-d0KEgxOw-1765489421505.js";import{C as ne}from"./chart-column-BXgV8Imq-1765489421505.js";import{M as oe}from"./message-circle-question-mark-CGUeJzOB-1765489421505.js";import{P as ce}from"./palette-DSRNeMWM-1765489421505.js";import{H as de}from"./heart-DFM5RX4Q-1765489421505.js";import{R as me}from"./repeat-2-CeIepzSW-1765489421505.js";const M={none:{name:"None",value:"",preview:"bg-transparent border border-white/10"},midnight:{name:"Midnight",value:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",preview:"bg-gradient-to-br from-[#1a1a2e] via-[#16213e] to-[#0f3460]"},ember:{name:"Ember",value:"linear-gradient(135deg, #2d1f1f 0%, #4a2020 50%, #6b2020 100%)",preview:"bg-gradient-to-br from-[#2d1f1f] via-[#4a2020] to-[#6b2020]"},aurora:{name:"Aurora",value:"linear-gradient(135deg, #1a2f1a 0%, #1a3a2a 50%, #0f4a3a 100%)",preview:"bg-gradient-to-br from-[#1a2f1a] via-[#1a3a2a] to-[#0f4a3a]"},twilight:{name:"Twilight",value:"linear-gradient(135deg, #2d1f3d 0%, #3d2050 50%, #4a1f6a 100%)",preview:"bg-gradient-to-br from-[#2d1f3d] via-[#3d2050] to-[#4a1f6a]"},ocean:{name:"Ocean",value:"linear-gradient(135deg, #0d1b2a 0%, #1b263b 50%, #274060 100%)",preview:"bg-gradient-to-br from-[#0d1b2a] via-[#1b263b] to-[#274060]"}};function xe(t){const h=Math.floor((Date.now()-new Date(t).getTime())/1e3);if(h<60)return`${h}s`;const u=Math.floor(h/60);if(u<60)return`${u}m`;const m=Math.floor(u/60);if(m<24)return`${m}h`;const c=Math.floor(m/24);return c<7?`${c}d`:new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"})}function $(t){return t>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t.toString()}function _e({user:t,onBack:h,onViewProfile:u}){const[m,c]=l.useState([]),[C,w]=l.useState(!0),[f,b]=l.useState(!1),[j,v]=l.useState(null),[n,T]=l.useState(""),[o,N]=l.useState("thought"),[d,y]=l.useState(["",""]),[A,G]=l.useState(24),[k,O]=l.useState("none"),[I,P]=l.useState(!1),[z]=l.useState("public"),[_,S]=l.useState(!1),g=l.useRef(null),L=500,H=t.is_creator;l.useEffect(()=>{q()},[]);const q=async()=>{w(!0);try{const{data:s,error:a}=await D.from("posts").select(`
          *,
          creator:users!posts_creator_id_fkey(*)
        `).in("post_type",["thought","poll","question"]).is("media_url",null).eq("is_hidden",!1).order("created_at",{ascending:!1}).limit(50);if(a)throw a;const i=(s||[]).map(x=>x.id),{data:r}=await D.from("likes").select("post_id").eq("user_id",t.telegram_id).in("post_id",i),K=new Set((r||[]).map(x=>x.post_id)),V=(s||[]).map(x=>({...x,liked:K.has(x.id),creator:x.creator||{telegram_id:x.creator_id,first_name:"User",username:"user"}}));c(V)}catch(s){console.error("Failed to load thoughts:",s),p.error("Failed to load")}w(!1)};l.useEffect(()=>{g.current&&(g.current.style.height="auto",g.current.style.height=Math.min(g.current.scrollHeight,120)+"px")},[n]);const U=async()=>{if(!_){if(o==="poll"){if(d.filter(a=>a.trim().length>0).length<2){p.error("Add at least 2 poll options");return}if(!n.trim()){p.error("Add a question for your poll");return}}else if(!n.trim())return;S(!0);try{if(n.trim()&&(await se(n.trim()))?.flagged){p.error("Content blocked by moderation"),S(!1);return}const s={content:n.trim(),visibility:H?z:"public",is_nsfw:!1,unlock_price:0,post_type:o,background_gradient:k!=="none"?k:void 0};o==="poll"&&(s.poll_options=d.filter(i=>i.trim().length>0),s.poll_duration_hours=A);const{error:a}=await Y(t.telegram_id,s);a?p.error("Failed to post"):(p.success("Posted!"),T(""),N("thought"),y(["",""]),O("none"),q())}catch(s){console.error("Post error:",s),p.error("Something went wrong")}S(!1)}},B=async s=>{const a=s.liked;c(i=>i.map(r=>r.id===s.id?{...r,liked:!a,likes_count:(r.likes_count||0)+(a?-1:1)}:r));try{a?await Z(t.telegram_id,s.id):await ee(t.telegram_id,s.id)}catch{c(i=>i.map(r=>r.id===s.id?{...r,liked:a,likes_count:(r.likes_count||0)+(a?1:-1)}:r))}},W=s=>{v(s),b(!0)},Q=async s=>{p.success("Reposted to your followers!"),c(a=>a.map(i=>i.id===s.id?{...i,reposts_count:(i.reposts_count||0)+1}:i))},R=o==="poll"?n.trim().length>0&&d.filter(s=>s.trim().length>0).length>=2:n.trim().length>0;return e.jsxs("div",{className:"min-h-screen bg-black text-white flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between px-4 py-3 border-b border-white/10",children:[e.jsx("button",{onClick:h,className:"p-1 -ml-1",children:e.jsx(ie,{className:"w-6 h-6"})}),e.jsx("span",{className:"font-semibold",children:"Thoughts"}),e.jsx("button",{onClick:U,disabled:!R||_,className:`px-4 py-1.5 rounded-full text-sm font-semibold transition-all ${R&&!_?"bg-white text-black":"bg-white/10 text-white/30"}`,children:_?e.jsx(F,{className:"w-4 h-4 animate-spin"}):"Post"})]}),e.jsx("div",{className:"flex-shrink-0 border-b border-white/10",children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:t.avatar_url||`https://i.pravatar.cc/150?u=${t.telegram_id}`,alt:"",className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("textarea",{ref:g,value:n,onChange:s=>T(s.target.value.slice(0,L)),placeholder:o==="poll"?"Ask your question...":o==="question"?"What would you like to ask?":"What's on your mind?",className:"w-full bg-transparent text-white text-[15px] placeholder-white/40 resize-none focus:outline-none leading-relaxed",rows:2})})]}),o==="poll"&&e.jsxs("div",{className:"mt-3 ml-[52px] space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/40 text-xs",children:"Poll options"}),e.jsxs("select",{value:A,onChange:s=>G(Number(s.target.value)),className:"bg-white/5 border border-white/10 rounded px-2 py-1 text-xs text-white focus:outline-none",children:[e.jsx("option",{value:24,children:"24h"}),e.jsx("option",{value:48,children:"48h"}),e.jsx("option",{value:72,children:"72h"})]})]}),d.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:i=>{const r=[...d];r[a]=i.target.value.slice(0,50),y(r)},placeholder:`Option ${a+1}`,className:"flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm text-white placeholder-white/30 focus:outline-none"}),d.length>2&&e.jsx("button",{onClick:()=>y(d.filter((i,r)=>r!==a)),className:"w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-white/40",children:e.jsx(re,{className:"w-4 h-4"})})]},a)),d.length<4&&e.jsxs("button",{onClick:()=>y([...d,""]),className:"w-full py-2 rounded-lg border border-dashed border-white/20 text-white/40 text-xs flex items-center justify-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"}),"Add option"]})]}),e.jsxs("div",{className:"mt-3 ml-[52px] flex items-center gap-1",children:[e.jsxs("button",{onClick:()=>N("thought"),className:`px-2 py-1 rounded-full text-[11px] font-medium flex items-center gap-1 ${o==="thought"?"bg-white text-black":"bg-white/5 text-white/50"}`,children:[e.jsx(le,{className:"w-3 h-3"}),"Text"]}),e.jsxs("button",{onClick:()=>N("poll"),className:`px-2 py-1 rounded-full text-[11px] font-medium flex items-center gap-1 ${o==="poll"?"bg-white text-black":"bg-white/5 text-white/50"}`,children:[e.jsx(ne,{className:"w-3 h-3"}),"Poll"]}),e.jsxs("button",{onClick:()=>N("question"),className:`px-2 py-1 rounded-full text-[11px] font-medium flex items-center gap-1 ${o==="question"?"bg-white text-black":"bg-white/5 text-white/50"}`,children:[e.jsx(oe,{className:"w-3 h-3"}),"Q&A"]}),o!=="poll"&&e.jsxs("button",{onClick:()=>P(!0),className:`px-2 py-1 rounded-full text-[11px] font-medium flex items-center gap-1 ${k!=="none"?"bg-white/20 text-white":"bg-white/5 text-white/50"}`,children:[e.jsx(ce,{className:"w-3 h-3"}),"Style"]}),e.jsxs("span",{className:`ml-auto text-[10px] ${n.length>450?"text-orange-400":"text-white/30"}`,children:[n.length,"/",L]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:C?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(F,{className:"w-6 h-6 text-white/40 animate-spin"})}):m.length===0?e.jsx("div",{className:"py-20 text-center px-6",children:e.jsx("p",{className:"text-white/40 text-sm",children:"No thoughts yet. Be the first!"})}):e.jsx("div",{className:"divide-y divide-white/5",children:m.map(s=>e.jsx(pe,{thought:s,onLike:()=>B(s),onComment:()=>W(s.id),onRepost:()=>Q(s),onViewProfile:u},s.id))})}),e.jsx(J,{children:I&&e.jsxs(e.Fragment,{children:[e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 z-40",onClick:()=>P(!1)}),e.jsxs(E.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},className:"fixed bottom-0 left-0 right-0 bg-[#1c1c1e] rounded-t-2xl z-50 p-4",children:[e.jsx("div",{className:"w-10 h-1 bg-white/20 rounded-full mx-auto mb-4"}),e.jsx("h3",{className:"text-white text-lg font-semibold text-center mb-4",children:"Background Style"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Object.entries(M).map(([s,a])=>e.jsx("button",{onClick:()=>{O(s),P(!1)},className:`aspect-square rounded-xl ${a.preview} ${k===s?"ring-2 ring-white":""}`,children:e.jsx("span",{className:"text-white/60 text-xs",children:a.name})},s))})]})]})}),e.jsx(ae,{isOpen:f,onClose:()=>b(!1),postId:j,user:t})]})}function pe({thought:t,onLike:h,onComment:u,onRepost:m,onViewProfile:c}){const C=t.background_gradient&&M[t.background_gradient]?.value?{background:M[t.background_gradient].value}:{};return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>c?.(t.creator),className:"flex-shrink-0",children:e.jsx("img",{src:t.creator.avatar_url||`https://i.pravatar.cc/150?u=${t.creator.telegram_id}`,alt:"",className:"w-10 h-10 rounded-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("button",{onClick:()=>c?.(t.creator),className:"font-semibold text-sm truncate",children:t.creator.first_name||"User"}),e.jsxs("span",{className:"text-white/40 text-xs",children:["@",t.creator.username||`user${t.creator.telegram_id}`]}),e.jsx("span",{className:"text-white/30 text-xs",children:"Â·"}),e.jsx("span",{className:"text-white/40 text-xs",children:xe(t.created_at)})]}),e.jsx("div",{className:`text-[15px] leading-relaxed ${t.background_gradient?"p-3 rounded-xl":""}`,style:C,children:e.jsx("p",{className:"whitespace-pre-wrap break-words",children:t.content})}),t.post_type==="poll"&&t.poll_options&&e.jsxs("div",{className:"mt-3 space-y-2",children:[t.poll_options.map((w,f)=>{const b=t.poll_votes?.[f]||0,j=t.poll_total_votes||0,v=j>0?Math.round(b/j*100):0,n=t.poll_user_vote===f;return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 rounded-lg",style:{width:`${v}%`}}),e.jsxs("div",{className:`relative px-3 py-2 rounded-lg border text-sm flex justify-between ${n?"border-white/30":"border-white/10"}`,children:[e.jsx("span",{children:w}),e.jsxs("span",{className:"text-white/50",children:[v,"%"]})]})]},f)}),e.jsxs("p",{className:"text-white/40 text-xs",children:[t.poll_total_votes||0," votes"]})]}),e.jsxs("div",{className:"flex items-center gap-6 mt-3",children:[e.jsxs("button",{onClick:h,className:`flex items-center gap-1.5 text-sm transition-colors active:scale-95 ${t.liked?"text-pink-500":"text-white/50 hover:text-white/70"}`,children:[e.jsx(de,{className:`w-[18px] h-[18px] ${t.liked?"fill-current":""}`}),e.jsx("span",{children:$(t.likes_count||0)})]}),e.jsxs("button",{onClick:u,className:"flex items-center gap-1.5 text-sm text-white/50 hover:text-white/70 transition-colors active:scale-95",children:[e.jsx(te,{className:"w-[18px] h-[18px]"}),e.jsx("span",{children:$(t.comments_count||0)})]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-1.5 text-sm text-white/50 hover:text-green-400 transition-colors active:scale-95",children:[e.jsx(me,{className:"w-[18px] h-[18px]"}),e.jsx("span",{children:$(t.reposts_count||0)})]})]})]})]})})}export{_e as default};
