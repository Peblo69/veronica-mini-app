import{c as T,r as a,W as ce,Y as de,Z as me,$ as xe,j as e,m as C,A as fe,a0 as he,a1 as pe,a2 as ue}from"./index-DX-cIEfI-1765325718110.js";import{g as we,P as be}from"./PostDetail-Bf-AWxkv-1765325718110.js";import{G as ge,B as W,F as je}from"./FollowersSheet-BBNaUhOx-1765325718110.js";import{u as ve}from"./useInViewport-BYyRM4NM-1765325718110.js";import{g as ye,S as Ne,c as ke}from"./storyApi-BH1nqIs4-1765325718110.js";import{u as Se}from"./useTranslation-BctIeelU-1765325718110.js";import{U as _e}from"./user-plus-BeQIibU9-1765325718110.js";import{S as Ce}from"./star-BgJ_eRw4-1765325718110.js";import{S as Pe}from"./settings-BSfVEIai-1765325718110.js";import{C as Te}from"./chevron-down-C-1Nu7pJ-1765325718110.js";import{L as y}from"./lock-CycanJhx-1765325718110.js";import{H as $e}from"./heart-bsEAVng6-1765325718110.js";import{V as Ie}from"./video-C7M6u2Sl-1765325718110.js";import{I as Fe}from"./image-De0n6s_5-1765325718110.js";import{P as De}from"./play-CXfURy9x-1765325718110.js";import"./CommentsSheet-ljVQXxEX-1765325718110.js";import"./loader-circle-CVAhG9xm-1765325718110.js";import"./arrow-left-BjUpboTQ-1765325718110.js";import"./ellipsis-CK7if8g3-1765325718110.js";import"./trash-2-BeosKuUo-1765325718110.js";import"./volume-2-Baj2Qre3-1765325718110.js";import"./chevron-right-o_pnNnKO-1765325718110.js";const Ee=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],Le=T("menu",Ee);const Re=[["path",{d:"m2 9 3-3 3 3",key:"1ltn5i"}],["path",{d:"M13 18H7a2 2 0 0 1-2-2V6",key:"1r6tfw"}],["path",{d:"m22 15-3 3-3-3",key:"4rnwn2"}],["path",{d:"M11 6h6a2 2 0 0 1 2 2v10",key:"2f72bc"}]],q=T("repeat-2",Re);const Me=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Ue=T("share-2",Me);function Ve(t){a.useEffect(()=>{if(typeof window>"u"||!t)return;const n=typeof window.requestIdleCallback=="function"?window.requestIdleCallback.bind(window):void 0,c=typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback.bind(window):void 0;let m=!1,l=null,i=null;const o=()=>{if(m)return;const d=new Image;d.src=t};return n?l=n(()=>o()):i=window.setTimeout(o,250),()=>{m=!0,l!==null&&c&&c(l),i!==null&&window.clearTimeout(i)}},[t])}const w={effectiveType:"4g",saveData:!1,downlink:10};function Ae(){const[t,n]=a.useState(()=>{if(typeof navigator>"u")return w;const l=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return l?{effectiveType:l.effectiveType||w.effectiveType,saveData:l.saveData||!1,downlink:l.downlink||w.downlink}:w});a.useEffect(()=>{const l=navigator?.connection||navigator?.mozConnection||navigator?.webkitConnection;if(!l)return;const i=()=>{n({effectiveType:l.effectiveType||w.effectiveType,saveData:!!l.saveData,downlink:l.downlink||w.downlink})};return l.addEventListener?.("change",i),()=>l.removeEventListener?.("change",i)},[]);const c=t.effectiveType==="slow-2g"||t.effectiveType==="2g",m=t.saveData;return{...t,isSlow:c,isDataSaver:m}}function N(t){return t>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t.toString()}function mt({user:t,setUser:n,onSettingsClick:c,onViewProfile:m}){const{t:l}=Se(),[i,o]=a.useState("posts"),[d,p]=a.useState([]),[h,b]=a.useState([]),[u,$]=a.useState(!0),[g,j]=a.useState(null),[H,O]=a.useState(null),[B,I]=a.useState(!1),F=a.useRef(null),z=a.useRef(null),[,D]=a.useState(!1),[,E]=a.useState(!1),[G,k]=a.useState(!1),[Y,L]=a.useState("followers"),[X,S]=a.useState(t.followers_count||0),[K,Q]=a.useState(t.following_count||0),[v,Z]=a.useState([]),[J,_]=a.useState(!1);a.useEffect(()=>{se(),ee(),M()},[t.telegram_id]);const ee=async()=>{const s=await ce(t.telegram_id);S(s.followers),Q(s.following)};a.useEffect(()=>{const s=de(t.telegram_id,{onNewFollower:()=>S(r=>r+1),onUnfollow:()=>S(r=>Math.max(0,r-1))});return()=>s()},[t.telegram_id]),a.useEffect(()=>{i==="saved"&&!H&&!B&&te()},[i]);const te=async()=>{I(!0);try{const s=await we(t.telegram_id);s.wallet&&O(s.wallet)}catch(s){console.error("Failed to load wallet data:",s)}I(!1)},se=async()=>{$(!0);const[s,r]=await Promise.all([me(t.telegram_id,t.telegram_id),xe(t.telegram_id)]),x=s?.posts??[];p(x),b(r),$(!1)},ae=()=>{g&&(p(d.filter(s=>s.id!==g.id)),b(h.filter(s=>s.id!==g.id)),j(null),t.is_creator&&n({...t,posts_count:Math.max(0,(t.posts_count||1)-1)}))},le=s=>{p(d.map(r=>r.id===s.id?{...s,can_view:!0}:r)),b(h.map(r=>r.id===s.id?{...s,can_view:!0}:r))},ie=()=>{F.current?.click()},re=async()=>{const s=`${window.location.origin}/profile/${t.username||t.telegram_id}`;try{if(navigator.share){await navigator.share({url:s,title:t.username||l("profile.title")});return}}catch{}try{await navigator.clipboard.writeText(s),alert(l("profile.share.copied"))}catch{alert(l("profile.share.copyError"))}},R=(s,r)=>{const x=s.target.files?.[0];if(!x){s.target.value="";return}if(r==="profile"){(async()=>{E(!0);const f=await he(x,t.telegram_id);f.error||!f.url?alert(l("profile.upload.error")):await pe(t.telegram_id,{avatar_url:f.url})?(n({...t,avatar_url:f.url}),alert(l("profile.upload.avatarSuccess"))):alert(l("profile.upload.error")),E(!1),s.target.value=""})();return}(async()=>{D(!0);const f=await ue(x,t.telegram_id);if(f.error||!f.url)alert(l("profile.upload.error"));else{const A=x.type.startsWith("video/")?"video":"image",{error:ne}=await ke(t.telegram_id,f.url,A);ne?alert(l("profile.upload.error")):(alert(l("profile.upload.storySuccess")),M())}D(!1),s.target.value=""})()},M=async()=>{try{const{stories:s}=await ye(),r=(s||[]).filter(x=>x.user_id===t.telegram_id);Z(r)}catch(s){console.error("[Profile] loadStories failed",s)}},oe=t.likes_received||d.reduce((s,r)=>s+(r.likes_count||0),0),U=d.filter(s=>s.visibility==="public"),V=d.filter(s=>s.visibility!=="public");return e.jsxs("div",{className:"bg-black min-h-screen text-white pb-20",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsx("button",{className:"p-1.5",children:e.jsx(_e,{className:"w-5 h-5 text-white"})}),v.length>0?e.jsxs("button",{onClick:()=>_(!0),className:"absolute left-1/2 -translate-x-1/2 top-16 bg-white text-black text-[11px] px-2.5 py-1 rounded-full font-medium shadow-lg",style:{transform:"translateX(-50%) translateY(-100%)"},children:["View Stories",e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-full w-0 h-0 border-l-[5px] border-l-transparent border-r-[5px] border-r-transparent border-t-[5px] border-t-white"})]}):null,e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"p-1.5",children:e.jsx(Ce,{className:"w-5 h-5 text-white"})}),e.jsx("button",{className:"p-1.5",onClick:re,children:e.jsx(Ue,{className:"w-5 h-5 text-white"})}),e.jsx("button",{className:"p-1.5",onClick:c,children:e.jsx(Le,{className:"w-5 h-5 text-white"})})]})]}),e.jsxs("div",{className:"flex flex-col items-center px-4 pt-1 pb-3",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("div",{className:`w-18 h-18 rounded-full ${v.length>0?"p-[2px] bg-gradient-to-tr from-pink-500 via-red-500 to-yellow-500":""}`,style:{width:"72px",height:"72px"},children:e.jsx("div",{className:`w-full h-full rounded-full ${v.length>0?"p-[2px] bg-black":""}`,children:e.jsx("img",{src:t.avatar_url||`https://i.pravatar.cc/150?u=${t.telegram_id}`,alt:t.first_name,className:"w-full h-full rounded-full object-cover",onClick:()=>v.length>0&&_(!0)})})}),e.jsx("button",{onClick:ie,className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-5 h-5 bg-[#00D4FF] rounded-full flex items-center justify-center border-2 border-black",children:e.jsx("span",{className:"text-black text-sm font-bold leading-none",children:"+"})})]}),e.jsx("input",{ref:F,type:"file",accept:"image/*",className:"hidden",onChange:s=>R(s,"profile")}),e.jsx("input",{ref:z,type:"file",accept:"image/*,video/*",className:"hidden",onChange:s=>R(s,"story")}),e.jsx("div",{className:"w-full flex justify-center mb-0.5",children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"text-base font-bold tracking-wide",children:t.first_name?.toUpperCase()||"USER"}),e.jsx("button",{onClick:c,className:"absolute -right-6 top-1/2 -translate-y-1/2 p-0.5",children:e.jsx(Pe,{className:"w-4 h-4 text-white/70"})})]})}),e.jsxs("span",{className:"text-[12px] text-white/50 mb-3",children:["@",t.username||`user${t.telegram_id}`]}),e.jsxs("div",{className:"flex items-center justify-center gap-0 mb-3",children:[e.jsxs("button",{onClick:()=>{L("following"),k(!0)},className:"flex flex-col items-center px-4",children:[e.jsx("span",{className:"text-base font-bold",children:N(K)}),e.jsx("span",{className:"text-[11px] text-white/50",children:"Following"})]}),e.jsx("div",{className:"w-[1px] h-6 bg-white/10"}),e.jsxs("button",{onClick:()=>{L("followers"),k(!0)},className:"flex flex-col items-center px-4",children:[e.jsx("span",{className:"text-base font-bold",children:N(X)}),e.jsx("span",{className:"text-[11px] text-white/50",children:"Followers"})]}),e.jsx("div",{className:"w-[1px] h-6 bg-white/10"}),e.jsxs("div",{className:"flex flex-col items-center px-4",children:[e.jsx("span",{className:"text-base font-bold",children:N(oe)}),e.jsx("span",{className:"text-[11px] text-white/50",children:"Likes"})]})]}),e.jsx("div",{className:"text-center px-6 mb-2",children:e.jsx("p",{className:"text-[13px] text-white/90 whitespace-pre-wrap",children:t.bio||"No bio yet"})})]}),e.jsxs("div",{className:"flex border-b border-white/10",children:[e.jsxs("button",{className:`flex-1 py-3 flex items-center justify-center gap-1 ${i==="posts"?"border-b-2 border-white":""}`,onClick:()=>o("posts"),children:[e.jsx(ge,{className:`w-5 h-5 ${i==="posts"?"text-white":"text-white/40"}`}),e.jsx(Te,{className:`w-3 h-3 ${i==="posts"?"text-white":"text-white/40"}`})]}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${i==="locked"?"border-b-2 border-white":""}`,onClick:()=>o("locked"),children:e.jsx(y,{className:`w-5 h-5 ${i==="locked"?"text-white":"text-white/40"}`})}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${i==="reposts"?"border-b-2 border-white":""}`,onClick:()=>o("reposts"),children:e.jsx(q,{className:`w-5 h-5 ${i==="reposts"?"text-white":"text-white/40"}`})}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${i==="saved"?"border-b-2 border-white":""}`,onClick:()=>o("saved"),children:e.jsx(W,{className:`w-5 h-5 ${i==="saved"?"text-white":"text-white/40"}`})}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${i==="liked"?"border-b-2 border-white":""}`,onClick:()=>o("liked"),children:e.jsx($e,{className:`w-5 h-5 ${i==="liked"?"text-white":"text-white/40"}`})})]}),e.jsxs("div",{className:"pb-20",children:[i==="posts"&&(u?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},s))}):U.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(Ie,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-sm text-white/50",children:"Your posts will appear here"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:U.map(s=>e.jsx(C.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>j(s),children:e.jsx(P,{post:s})},s.id))})),i==="locked"&&(u?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3].map(s=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},s))}):V.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(y,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No locked content"}),e.jsx("p",{className:"text-sm text-white/50",children:"Private content will appear here"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:V.map(s=>e.jsxs(C.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>j(s),children:[e.jsx(P,{post:s}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(y,{className:"w-4 h-4 text-white drop-shadow"})})]},s.id))})),i==="reposts"&&e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(q,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No reposts yet"}),e.jsx("p",{className:"text-sm text-white/50",children:"Content you repost will appear here"})]}),i==="saved"&&(u?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},s))}):h.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(W,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No saved posts"}),e.jsx("p",{className:"text-sm text-white/50 max-w-xs mx-auto",children:"Save posts to view them later"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:h.map(s=>e.jsx(C.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>j(s),children:e.jsx(P,{post:s})},s.id))})),i==="liked"&&e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(y,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Liked posts are private"}),e.jsx("p",{className:"text-sm text-white/50 max-w-xs mx-auto",children:"Only you can see what you've liked"})]})]}),e.jsx(fe,{children:g&&e.jsx(be,{post:g,user:t,onBack:()=>j(null),onDeleted:ae,onUpdated:le})}),J&&e.jsx(Ne,{stories:v,startIndex:0,onClose:()=>_(!1)}),e.jsx(je,{isOpen:G,onClose:()=>k(!1),userId:t.telegram_id,currentUserId:t.telegram_id,type:Y,onUserClick:m})]})}const We=/\.(mp4|webm|mov|m4v)(\?|$)/i;function qe(t){return t.media_url?t.media_type&&t.media_type.toLowerCase().includes("video")?!0:We.test(t.media_url):!1}function P({post:t}){const n=a.useRef(null),[c,m]=a.useState(!1),[l,i]=a.useState(!1),[o,d]=a.useState(!1),p=ve(n,{minimumRatio:.25}),h=t.media_thumbnail||t.media_url,{isDataSaver:b}=Ae();Ve(b?null:h);const u=qe(t);return a.useEffect(()=>{p&&m(!0)},[p]),t.media_url?l?e.jsx("div",{ref:n,className:"w-full h-full flex items-center justify-center bg-[#1a1a1a]",children:e.jsx(Fe,{className:"w-8 h-8 text-white/20"})}):e.jsxs("div",{ref:n,className:"w-full h-full relative",children:[(!c||!o)&&e.jsx("div",{className:"absolute inset-0 bg-[#1a1a1a] animate-pulse"}),c&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:h||t.media_url,alt:"",className:`w-full h-full object-cover transition-opacity duration-200 ${o?"opacity-100":"opacity-0"}`,loading:"lazy",onLoad:()=>d(!0),onError:()=>i(!0)}),o&&u&&e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-12 bg-gradient-to-t from-black/60 to-transparent"}),o&&u&&e.jsxs("div",{className:"absolute bottom-1.5 left-1.5 flex items-center gap-0.5",children:[e.jsx(De,{className:"w-3 h-3 text-white fill-white"}),e.jsx("span",{className:"text-white text-[11px] font-medium",children:N(t.view_count||0)})]}),o&&t.media_urls&&t.media_urls.length>1&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"bg-black/50 rounded px-1.5 py-0.5",children:e.jsx("span",{className:"text-[11px] text-white font-medium",children:t.media_urls.length})})})]})]}):e.jsx("div",{ref:n,className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-purple-900/50 to-pink-900/50 p-4",children:e.jsx("p",{className:"text-[13px] text-white text-center line-clamp-5",children:t.content})})}export{mt as default};
