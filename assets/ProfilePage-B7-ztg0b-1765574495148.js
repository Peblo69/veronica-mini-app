import{c as B,d as w,r as o,j as e,m as y,M as G,a1 as Te,a2 as Ee,a3 as Fe,a4 as Ae,a5 as Ve,A as ie,a6 as Me,a7 as Ue,a8 as qe,a9 as Ie}from"./index-D-tk-Ixz-1765574495148.js";import{g as Oe,P as We}from"./PostDetail-UgbxNvqM-1765574495148.js";import{G as Ge,F as Be,u as ze,a as He}from"./useConnectionQuality-D0MNa7MJ-1765574495148.js";import{u as Ke}from"./useInViewport-sYID_3kW-1765574495148.js";import{g as Qe,S as Xe,c as Ye}from"./storyApi-gYEffwpQ-1765574495148.js";import{A as Ze}from"./arrow-left-Vw4_3FKb-1765574495148.js";import{R as Je,T as et,S as tt}from"./trending-up-CBYKbtEw-1765574495148.js";import{E as ne}from"./eye-ChOFo21V-1765574495148.js";import{U as st}from"./users-fHIYWVx4-1765574495148.js";import{D as at}from"./dollar-sign-veuwn24c-1765574495148.js";import{H as z}from"./heart-Dmnht5vF-1765574495148.js";import{U as ce}from"./user-plus-D9vm_R0e-1765574495148.js";import{u as lt}from"./useTranslation-DTe9Ce0b-1765574495148.js";import{S as it}from"./star-BwGR9oO5-1765574495148.js";import{C as rt}from"./chevron-down-DNDkCgX7-1765574495148.js";import{L as A}from"./lock-CBLPV5Sp-1765574495148.js";import{R as re}from"./repeat-2-Dtf14lFQ-1765574495148.js";import{C as ot}from"./chart-column-CicG0Ifr-1765574495148.js";import{V as nt}from"./video-8ZrMGarE-1765574495148.js";import{I as ct}from"./image-tN7MB4Xb-1765574495148.js";import{P as dt}from"./play-C5ceZAsG-1765574495148.js";import"./PixelIcons-DJKRab-J-1765574495148.js";import"./CommentsSheet-DTp0Qjt5-1765574495148.js";import"./loader-circle-CZVe8_6f-1765574495148.js";import"./x-DeX-aRt7-1765574495148.js";import"./trash-2-D3KSHBB8-1765574495148.js";import"./flag-DS0FkdZ5-1765574495148.js";import"./volume-2-5nbK1YpE-1765574495148.js";import"./chevron-left-D13Tfj4X-1765574495148.js";const mt=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],oe=B("bookmark",mt);const xt=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],ht=B("menu",xt);const ut=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],de=B("share-2",ut);async function pt(t){try{const{count:a}=await w.from("follows").select("*",{count:"exact",head:!0}).eq("following_id",t),{data:i}=await w.from("posts").select("like_count, comment_count, repost_count, view_count").eq("creator_id",t),l=i?.reduce((b,j)=>b+(j.like_count||0),0)||0,n=i?.reduce((b,j)=>b+(j.comment_count||0),0)||0,r=i?.reduce((b,j)=>b+(j.repost_count||0),0)||0,{count:d}=await w.from("subscriptions").select("*",{count:"exact",head:!0}).eq("creator_id",t).eq("status","active");let x=0,g=0,m=0;try{const{count:b}=await w.from("profile_views").select("*",{count:"exact",head:!0}).eq("profile_id",t);x=b||0;const j=new Date().toISOString().split("T")[0],{count:C}=await w.from("profile_views").select("*",{count:"exact",head:!0}).eq("profile_id",t).gte("viewed_at",j);g=C||0;const N=new Date(Date.now()-10080*60*1e3).toISOString(),{count:P}=await w.from("profile_views").select("*",{count:"exact",head:!0}).eq("profile_id",t).gte("viewed_at",N);m=P||0}catch{}const u=new Date(Date.now()-10080*60*1e3).toISOString(),{count:v}=await w.from("follows").select("*",{count:"exact",head:!0}).eq("following_id",t).gte("created_at",u);return{total_followers:a||0,total_subscribers:d||0,total_posts:i?.length||0,total_likes:l,total_comments:n,total_shares:r,total_profile_views:x,views_today:g,views_this_week:m,views_this_month:m,followers_today:0,followers_this_week:v||0,total_earnings:0}}catch(a){return console.error("[Analytics] Exception:",a),null}}async function ft(t,a=7){try{const i=new Date(Date.now()-a*24*60*60*1e3).toISOString(),{data:l,error:n}=await w.from("profile_views").select("viewed_at").eq("profile_id",t).gte("viewed_at",i);if(n)return console.warn("[Analytics] profile_views table not found, using fallback"),[];const r={};for(let d=0;d<a;d++){const x=new Date(Date.now()-(a-1-d)*24*60*60*1e3);r[x.toISOString().split("T")[0]]=0}return l?.forEach(d=>{const x=new Date(d.viewed_at).toISOString().split("T")[0];r[x]!==void 0&&r[x]++}),Object.entries(r).map(([d,x])=>({date:d,views:x}))}catch(i){return console.error("[Analytics] Exception:",i),[]}}async function wt(t,a=10){try{const{data:i,error:l}=await w.from("profile_views").select(`
        viewer_id,
        viewed_at,
        source,
        viewer:users!profile_views_viewer_id_fkey(
          username,
          first_name,
          avatar_url,
          is_verified
        )
      `).eq("profile_id",t).not("viewer_id","is",null).neq("viewer_id",t).order("viewed_at",{ascending:!1}).limit(a);return l?(console.warn("[Analytics] Could not fetch visitors:",l.message),[]):(i||[]).map(n=>({viewer_id:n.viewer_id,username:n.viewer?.username||null,first_name:n.viewer?.first_name||null,avatar_url:n.viewer?.avatar_url||null,is_verified:n.viewer?.is_verified||!1,viewed_at:n.viewed_at,source:n.source||"feed"}))}catch(i){return console.error("[Analytics] Exception:",i),[]}}async function bt(t,a=5){try{const{data:i,error:l}=await w.from("posts").select("id, content, media_url, media_type, like_count, comment_count, repost_count, view_count, created_at").eq("creator_id",t).order("like_count",{ascending:!1}).limit(a);return l?(console.error("[Analytics] Error fetching top posts:",l),[]):(i||[]).map(n=>({...n,engagement_score:(n.like_count||0)+(n.comment_count||0)*2+(n.repost_count||0)*3}))}catch(i){return console.error("[Analytics] Exception:",i),[]}}function gt(t,a){const i=w.channel(`profile_views_${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"profile_views",filter:`profile_id=eq.${t}`},()=>a("view")).subscribe(),l=w.channel(`follows_${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"follows",filter:`following_id=eq.${t}`},()=>a("follow")).subscribe(),n=w.channel(`likes_${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"likes"},()=>a("like")).subscribe();return()=>{w.removeChannel(i),w.removeChannel(l),w.removeChannel(n)}}function jt(t,a,i,l){if(l===0)return 0;const n=t+a*2+i*3;return Math.min(100,n/l*100)}function S(t){return t>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t.toString()}function vt(t){return t>=1e3?"$"+(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":"$"+t.toFixed(2)}const Nt=({data:t,height:a=60})=>{if(!t.length)return null;const i=Math.max(...t,1),l=Math.min(...t,0),n=i-l||1,r=100,d=t.map((m,u)=>{const v=u/(t.length-1||1)*r,b=a-(m-l)/n*(a-8)-4;return{x:v,y:b,value:m}}),x=d.map((m,u)=>`${u===0?"M":"L"} ${m.x} ${m.y}`).join(" "),g=`${x} L ${r} ${a} L 0 ${a} Z`;return e.jsxs("svg",{viewBox:`0 0 ${r} ${a}`,className:"w-full",style:{height:a},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"chartGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"white",stopOpacity:"0.15"}),e.jsx("stop",{offset:"100%",stopColor:"white",stopOpacity:"0"})]})}),e.jsx(y.path,{d:g,fill:"url(#chartGradient)",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5}}),e.jsx(y.path,{d:x,fill:"none",stroke:"rgba(255,255,255,0.4)",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.8,ease:"easeOut"}}),d.map((m,u)=>e.jsx(y.circle,{cx:m.x,cy:m.y,r:"2",fill:"white",initial:{scale:0},animate:{scale:1},transition:{delay:.1*u,duration:.2}},u))]})},yt=({data:t})=>{if(!t.length)return null;const a=Math.max(...t.map(i=>i.value),1);return e.jsx("div",{className:"flex items-end gap-[3px] h-10",children:t.map((i,l)=>e.jsxs(y.div,{className:"flex-1 flex flex-col items-center",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:l*.05},children:[e.jsx(y.div,{className:"w-full bg-white/30 rounded-[2px]",initial:{height:0},animate:{height:`${i.value/a*100}%`},transition:{delay:l*.05,duration:.3},style:{minHeight:i.value>0?2:0}}),e.jsx("span",{className:"text-[7px] text-white/30 mt-1",children:i.label})]},l))})},V=({icon:t,label:a,value:i,sub:l})=>e.jsxs("div",{className:"bg-white/[0.03] rounded-lg p-2.5 border border-white/[0.04]",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx(t,{className:"w-3 h-3 text-white/30"}),e.jsx("span",{className:"text-white/40 text-[10px]",children:a})]}),e.jsx("p",{className:"text-white text-base font-semibold leading-none",children:i}),l&&e.jsx("p",{className:"text-white/25 text-[9px] mt-0.5",children:l})]}),M=({icon:t,label:a,value:i})=>e.jsxs("div",{className:"flex items-center justify-between py-1.5 border-b border-white/[0.03] last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"w-3 h-3 text-white/25"}),e.jsx("span",{className:"text-white/50 text-[11px]",children:a})]}),e.jsx("span",{className:"text-white/80 text-[11px] font-medium",children:i})]}),_t=({visitor:t,onClick:a})=>e.jsxs("button",{onClick:a,className:"flex items-center gap-2 py-1.5 w-full text-left",children:[e.jsx("img",{src:t.avatar_url||`https://ui-avatars.com/api/?name=${t.first_name||"U"}&background=222&color=666&size=24`,alt:"",className:"w-6 h-6 rounded-full object-cover"}),e.jsx("span",{className:"text-white/60 text-[11px] truncate flex-1",children:t.first_name||t.username||"User"}),e.jsx("span",{className:"text-white/25 text-[9px]",children:new Date(t.viewed_at).toLocaleDateString("en",{month:"short",day:"numeric"})})]}),kt=({post:t,rank:a})=>e.jsxs("div",{className:"flex items-center gap-2 py-1.5",children:[e.jsx("span",{className:"text-white/20 text-[10px] w-3",children:a}),e.jsx("div",{className:"w-7 h-7 rounded bg-white/5 overflow-hidden flex-shrink-0",children:t.media_url?e.jsx("img",{src:t.media_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(G,{className:"w-3 h-3 text-white/15"})})}),e.jsxs("div",{className:"flex-1 flex gap-3 text-[10px]",children:[e.jsxs("span",{className:"text-white/50",children:[e.jsx(z,{className:"w-2.5 h-2.5 inline mr-0.5"}),S(t.like_count)]}),e.jsxs("span",{className:"text-white/50",children:[e.jsx(G,{className:"w-2.5 h-2.5 inline mr-0.5"}),S(t.comment_count)]}),e.jsxs("span",{className:"text-white/50",children:[e.jsx(ne,{className:"w-2.5 h-2.5 inline mr-0.5"}),S(t.view_count||0)]})]})]});function St({user:t,onClose:a,onCreatorClick:i}){const[l,n]=o.useState(null),[r,d]=o.useState([]),[x,g]=o.useState([]),[m,u]=o.useState([]),[v,b]=o.useState(!0),[j,C]=o.useState(!1),N=o.useCallback(async(c=!1)=>{c?C(!0):b(!0);try{const[p,D,_,I]=await Promise.all([pt(t.telegram_id),ft(t.telegram_id,7),wt(t.telegram_id,5),bt(t.telegram_id,3)]);p&&n(p),d(D),g(_),u(I)}catch(p){console.error("Failed to load analytics:",p)}finally{b(!1),C(!1)}},[t.telegram_id]);o.useEffect(()=>(N(),gt(t.telegram_id,()=>N(!0))),[N,t.telegram_id]);const P=l?jt(l.total_likes,l.total_comments,l.total_shares,l.total_followers):0,$=[12,19,8,25,14,30,22],R=["M","T","W","T","F","S","S"],T=r.length>0?r.map(c=>c.views):$,E=r.length>0?r.map(c=>({label:new Date(c.date).toLocaleDateString("en",{weekday:"narrow"}),value:c.views})):R.map((c,p)=>({label:c,value:$[p]}));return e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-[#080808] z-50 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 pt-14 pb-3",children:[e.jsx("button",{onClick:a,className:"w-8 h-8 rounded-full bg-white/5 flex items-center justify-center",children:e.jsx(Ze,{className:"w-4 h-4 text-white/50"})}),e.jsx("span",{className:"text-white/80 text-sm font-medium",children:"Analytics"}),e.jsx("button",{onClick:()=>N(!0),disabled:j,className:"w-8 h-8 rounded-full bg-white/5 flex items-center justify-center",children:e.jsx(Je,{className:`w-3.5 h-3.5 text-white/50 ${j?"animate-spin":""}`})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 pb-6",children:v?e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx("div",{className:"w-5 h-5 border-2 border-white/10 border-t-white/40 rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(V,{icon:ne,label:"Views",value:S(l?.total_profile_views||0),sub:`+${l?.views_today||0} today`}),e.jsx(V,{icon:st,label:"Followers",value:S(l?.total_followers||0),sub:`+${l?.followers_this_week||0} week`}),e.jsx(V,{icon:et,label:"Engagement",value:`${P.toFixed(1)}%`,sub:"avg rate"}),e.jsx(V,{icon:at,label:"Earnings",value:vt(l?.total_earnings||0),sub:"lifetime"})]}),e.jsxs("div",{className:"bg-white/[0.03] rounded-lg p-3 border border-white/[0.04]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/50 text-[11px]",children:"Profile Views"}),e.jsx("span",{className:"text-white/30 text-[10px]",children:"7 days"})]}),e.jsx(Nt,{data:T,height:50}),e.jsx("div",{className:"flex justify-between mt-1",children:(r.length>0?r.map(c=>new Date(c.date).toLocaleDateString("en",{weekday:"narrow"})):R).map((c,p)=>e.jsx("span",{className:"text-[8px] text-white/20",children:c},p))})]}),e.jsxs("div",{className:"bg-white/[0.03] rounded-lg p-3 border border-white/[0.04]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/50 text-[11px]",children:"Daily Views"}),e.jsxs("span",{className:"text-white/30 text-[10px]",children:[r.length>0?r.reduce((c,p)=>c+p.views,0):$.reduce((c,p)=>c+p,0)," total"]})]}),e.jsx(yt,{data:E})]}),e.jsxs("div",{className:"bg-white/[0.03] rounded-lg p-2.5 border border-white/[0.04]",children:[e.jsx("span",{className:"text-white/40 text-[10px] font-medium",children:"Overview"}),e.jsxs("div",{className:"mt-1",children:[e.jsx(M,{icon:z,label:"Likes",value:S(l?.total_likes||0)}),e.jsx(M,{icon:G,label:"Comments",value:S(l?.total_comments||0)}),e.jsx(M,{icon:de,label:"Shares",value:S(l?.total_shares||0)}),e.jsx(M,{icon:ce,label:"Subscribers",value:l?.total_subscribers||0})]})]}),x.length>0&&e.jsxs("div",{className:"bg-white/[0.03] rounded-lg p-2.5 border border-white/[0.04]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-white/40 text-[10px] font-medium",children:"Recent Visitors"}),e.jsx("span",{className:"text-white/20 text-[9px]",children:x.length})]}),x.slice(0,4).map(c=>e.jsx(_t,{visitor:c,onClick:()=>i?.({telegram_id:c.viewer_id})},c.viewer_id))]}),m.length>0&&e.jsxs("div",{className:"bg-white/[0.03] rounded-lg p-2.5 border border-white/[0.04]",children:[e.jsx("span",{className:"text-white/40 text-[10px] font-medium",children:"Top Posts"}),e.jsx("div",{className:"mt-1",children:m.map((c,p)=>e.jsx(kt,{post:c,rank:p+1},c.id))})]})]})})]})}function q(t){return t>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t.toString()}function ls({user:t,setUser:a,onSettingsClick:i,onViewProfile:l}){const{t:n}=lt(),[r,d]=o.useState("posts"),[x,g]=o.useState([]),[m,u]=o.useState([]),[v,b]=o.useState([]),[j,C]=o.useState(!0),[N,P]=o.useState(!1),[$,R]=o.useState(!1),[T,E]=o.useState(!1),[c,p]=o.useState(!1),[D,_]=o.useState(null),[I,me]=o.useState(null),[xe,H]=o.useState(!1),K=o.useRef(null),he=o.useRef(null),[,Q]=o.useState(!1),[,X]=o.useState(!1),[ue,O]=o.useState(!1),[pe,Y]=o.useState("followers"),[fe,F]=o.useState(t.followers_count||0),[we,be]=o.useState(t.following_count||0),[ge,je]=o.useState(t.subscribers_count||0),[L,ve]=o.useState([]),[Ne,W]=o.useState(!1),[ye,Z]=o.useState(!1);o.useEffect(()=>{Se(),_e(),te()},[t.telegram_id]);const _e=async()=>{const s=await Te(t.telegram_id);F(s.followers),be(s.following)};o.useEffect(()=>{const s=Ee(t.telegram_id,{onNewFollower:()=>F(f=>f+1),onUnfollow:()=>F(f=>Math.max(0,f-1))}),h=Fe(t.telegram_id,f=>{F(f.followers_count||0),je(f.subscribers_count||0)});return()=>{s(),h()}},[t.telegram_id]),o.useEffect(()=>{r==="saved"&&(!$&&!N&&J(),!I&&!xe&&ke())},[r]);const ke=async()=>{H(!0);try{const s=await Oe(t.telegram_id);s.wallet&&me(s.wallet)}catch(s){console.error("Failed to load wallet data:",s)}H(!1)},Se=async()=>{C(!0);const h=(await Ae(t.telegram_id,t.telegram_id))?.posts??[];g(h),C(!1)},J=async()=>{if(!($||N)){P(!0);try{const s=await Ve();u(s?.posts||[]),R(!0)}catch(s){console.error("[Profile] Failed to load saved posts:",s)}P(!1)}},Ce=async()=>{if(!(c||T)){E(!0);try{const s=await Me(t.telegram_id);b(s),p(!0)}catch(s){console.error("[Profile] Failed to load reposts:",s)}E(!1)}},$e=()=>{D&&(g(x.filter(s=>s.id!==D.id)),u(m.filter(s=>s.id!==D.id)),_(null),t.is_creator&&a({...t,posts_count:Math.max(0,(t.posts_count||1)-1)}))},De=s=>{g(x.map(h=>h.id===s.id?{...s,can_view:!0}:h)),u(m.map(h=>h.id===s.id?{...s,can_view:!0}:h))},Pe=()=>{K.current?.click()},Le=async()=>{const s=t.first_name||t.username||"User",h=t.username||`user_${t.telegram_id}`;try{const f=window.Telegram?.WebApp;if(f?.switchInlineQuery){f.switchInlineQuery(`@${h}`,["users","groups","channels"]);return}if(navigator.share){await navigator.share({title:`${s}'s Profile`,text:`Check out @${h} on Veronica!`});return}}catch{}try{await navigator.clipboard.writeText(`@${h}`),alert(n("profile.share.copied"))}catch{alert(n("profile.share.copyError"))}},ee=(s,h)=>{const f=s.target.files?.[0];if(!f){s.target.value="";return}if(h==="profile"){(async()=>{X(!0);const k=await Ue(f,t.telegram_id);k.error||!k.url?alert(n("profile.upload.error")):await qe(t.telegram_id,{avatar_url:k.url})?(a({...t,avatar_url:k.url}),alert(n("profile.upload.avatarSuccess"))):alert(n("profile.upload.error")),X(!1),s.target.value=""})();return}(async()=>{Q(!0);const k=await Ie(f,t.telegram_id);if(k.error||!k.url)alert(n("profile.upload.error"));else{const le=f.type.startsWith("video/")?"video":"image",{error:Re}=await Ye(t.telegram_id,k.url,le);Re?alert(n("profile.upload.error")):(alert(n("profile.upload.storySuccess")),te())}Q(!1),s.target.value=""})()},te=async()=>{try{const{stories:s}=await Qe(),h=(s||[]).filter(f=>f.user_id===t.telegram_id);ve(h)}catch(s){console.error("[Profile] loadStories failed",s)}},se=x.filter(s=>s.visibility==="public"),ae=x.filter(s=>s.visibility!=="public");return e.jsxs("div",{className:"bg-black min-h-screen text-white pb-20",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsx("button",{className:"p-1.5",children:e.jsx(ce,{className:"w-5 h-5 text-white"})}),L.length>0?e.jsxs("button",{onClick:()=>W(!0),className:"absolute left-1/2 -translate-x-1/2 top-16 bg-white text-black text-[11px] px-2.5 py-1 rounded-full font-medium shadow-lg",style:{transform:"translateX(-50%) translateY(-100%)"},children:["View Stories",e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-full w-0 h-0 border-l-[5px] border-l-transparent border-r-[5px] border-r-transparent border-t-[5px] border-t-white"})]}):null,e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"p-1.5",children:e.jsx(it,{className:"w-5 h-5 text-white"})}),e.jsx("button",{className:"p-1.5",onClick:Le,children:e.jsx(de,{className:"w-5 h-5 text-white"})}),e.jsx("button",{className:"p-1.5",onClick:i,children:e.jsx(ht,{className:"w-5 h-5 text-white"})})]})]}),e.jsxs("div",{className:"flex flex-col items-center px-4 pt-1 pb-3",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("div",{className:`w-18 h-18 rounded-full ${L.length>0?"p-[2px] bg-gradient-to-tr from-pink-500 via-red-500 to-yellow-500":""}`,style:{width:"72px",height:"72px"},children:e.jsx("div",{className:`w-full h-full rounded-full ${L.length>0?"p-[2px] bg-black":""}`,children:e.jsx("img",{src:t.avatar_url||`https://i.pravatar.cc/150?u=${t.telegram_id}`,alt:t.first_name,className:"w-full h-full rounded-full object-cover",onClick:()=>L.length>0&&W(!0)})})}),e.jsx("button",{onClick:Pe,className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-5 h-5 bg-[#00D4FF] rounded-full flex items-center justify-center border-2 border-black",children:e.jsx("span",{className:"text-black text-sm font-bold leading-none",children:"+"})})]}),e.jsx("input",{ref:K,type:"file",accept:"image/*",className:"hidden",onChange:s=>ee(s,"profile")}),e.jsx("input",{ref:he,type:"file",accept:"image/*,video/*",className:"hidden",onChange:s=>ee(s,"story")}),e.jsx("div",{className:"w-full flex justify-center mb-0.5",children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"text-base font-bold tracking-wide",children:t.first_name?.toUpperCase()||"USER"}),e.jsx("button",{onClick:i,className:"absolute -right-6 top-1/2 -translate-y-1/2 p-0.5",children:e.jsx(tt,{className:"w-4 h-4 text-white/70"})})]})}),e.jsxs("span",{className:"text-[12px] text-white/50 mb-3",children:["@",t.username||`user${t.telegram_id}`]}),e.jsxs("div",{className:"flex items-center justify-center gap-0 mb-3",children:[e.jsxs("button",{onClick:()=>{Y("following"),O(!0)},className:"flex flex-col items-center px-4",children:[e.jsx("span",{className:"text-base font-bold",children:q(we)}),e.jsx("span",{className:"text-[11px] text-white/50",children:"Following"})]}),e.jsx("div",{className:"w-[1px] h-6 bg-white/10"}),e.jsxs("button",{onClick:()=>{Y("followers"),O(!0)},className:"flex flex-col items-center px-4",children:[e.jsx("span",{className:"text-base font-bold",children:q(fe)}),e.jsx("span",{className:"text-[11px] text-white/50",children:"Followers"})]}),e.jsx("div",{className:"w-[1px] h-6 bg-white/10"}),e.jsxs("div",{className:"flex flex-col items-center px-4",children:[e.jsx("span",{className:"text-base font-bold",children:q(ge)}),e.jsx("span",{className:"text-[11px] text-white/50",children:"Subscribers"})]})]}),e.jsx("div",{className:"text-center px-6 mb-2",children:e.jsx("p",{className:"text-[13px] text-white/90 whitespace-pre-wrap",children:t.bio||"No bio yet"})})]}),e.jsxs("div",{className:"flex border-b border-white/10",children:[e.jsxs("button",{className:`flex-1 py-3 flex items-center justify-center gap-1 ${r==="posts"?"border-b-2 border-white":""}`,onClick:()=>d("posts"),children:[e.jsx(Ge,{className:`w-5 h-5 ${r==="posts"?"text-white":"text-white/40"}`}),e.jsx(rt,{className:`w-3 h-3 ${r==="posts"?"text-white":"text-white/40"}`})]}),t.is_creator&&e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${r==="locked"?"border-b-2 border-white":""}`,onClick:()=>d("locked"),children:e.jsx(A,{className:`w-5 h-5 ${r==="locked"?"text-white":"text-white/40"}`})}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${r==="reposts"?"border-b-2 border-white":""}`,onClick:()=>{d("reposts"),Ce()},children:e.jsx(re,{className:`w-5 h-5 ${r==="reposts"?"text-white":"text-white/40"}`})}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${r==="saved"?"border-b-2 border-white":""}`,onClick:()=>{d("saved"),J()},children:e.jsx(oe,{className:`w-5 h-5 ${r==="saved"?"text-white":"text-white/40"}`})}),t.is_creator?e.jsx("button",{className:"flex-1 py-3 flex items-center justify-center",onClick:()=>Z(!0),children:e.jsx(ot,{className:"w-5 h-5 text-white/40 hover:text-purple-400 transition-colors"})}):e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${r==="liked"?"border-b-2 border-white":""}`,onClick:()=>d("liked"),children:e.jsx(z,{className:`w-5 h-5 ${r==="liked"?"text-white":"text-white/40"}`})})]}),e.jsxs("div",{className:"pb-20",children:[r==="posts"&&(j?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},s))}):se.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(nt,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-sm text-white/50",children:"Your posts will appear here"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:se.map(s=>e.jsx(y.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>_(s),children:e.jsx(U,{post:s})},s.id))})),r==="locked"&&t.is_creator&&(j?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3].map(s=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},s))}):ae.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(A,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No locked content"}),e.jsx("p",{className:"text-sm text-white/50",children:"Private content will appear here"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:ae.map(s=>e.jsxs(y.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>_(s),children:[e.jsx(U,{post:s}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(A,{className:"w-4 h-4 text-white drop-shadow"})})]},s.id))})),r==="reposts"&&(T||!c&&!v.length?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},s))}):v.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(re,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No reposts yet"}),e.jsx("p",{className:"text-sm text-white/50",children:"Content you repost will appear here"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:v.map(s=>e.jsx(y.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>_(s),children:e.jsx(U,{post:s})},s.id))})),r==="saved"&&(N||!$&&!m.length?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},s))}):m.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(oe,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No saved posts"}),e.jsx("p",{className:"text-sm text-white/50 max-w-xs mx-auto",children:"Save posts to view them later"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:m.map(s=>e.jsx(y.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>_(s),children:e.jsx(U,{post:s})},s.id))})),r==="liked"&&e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(A,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Liked posts are private"}),e.jsx("p",{className:"text-sm text-white/50 max-w-xs mx-auto",children:"Only you can see what you've liked"})]})]}),e.jsx(ie,{children:D&&e.jsx(We,{post:D,user:t,onBack:()=>_(null),onDeleted:$e,onUpdated:De})}),Ne&&e.jsx(Xe,{stories:L,startIndex:0,onClose:()=>W(!1)}),e.jsx(ie,{children:ye&&e.jsx(St,{user:t,onClose:()=>Z(!1),onCreatorClick:l})}),e.jsx(Be,{isOpen:ue,onClose:()=>O(!1),userId:t.telegram_id,currentUserId:t.telegram_id,type:pe,onUserClick:l})]})}const Ct=/\.(mp4|webm|mov|m4v)(\?|$)/i;function $t(t){return t.media_url?t.media_type&&t.media_type.toLowerCase().includes("video")?!0:Ct.test(t.media_url):!1}function U({post:t}){const a=o.useRef(null),[i,l]=o.useState(!1),[n,r]=o.useState(!1),[d,x]=o.useState(!1),g=Ke(a,{minimumRatio:.25}),m=t.media_thumbnail||t.media_url,{isDataSaver:u}=ze();He(u?null:m);const v=$t(t);return o.useEffect(()=>{g&&l(!0)},[g]),t.media_url?n?e.jsx("div",{ref:a,className:"w-full h-full flex items-center justify-center bg-[#1a1a1a]",children:e.jsx(ct,{className:"w-8 h-8 text-white/20"})}):e.jsxs("div",{ref:a,className:"w-full h-full relative",children:[(!i||!d)&&e.jsx("div",{className:"absolute inset-0 bg-[#1a1a1a] animate-pulse"}),i&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:m||t.media_url,alt:"",className:`w-full h-full object-cover transition-opacity duration-200 ${d?"opacity-100":"opacity-0"}`,loading:"lazy",onLoad:()=>x(!0),onError:()=>r(!0)}),d&&v&&e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-12 bg-gradient-to-t from-black/60 to-transparent"}),d&&v&&e.jsxs("div",{className:"absolute bottom-1.5 left-1.5 flex items-center gap-0.5",children:[e.jsx(dt,{className:"w-3 h-3 text-white fill-white"}),e.jsx("span",{className:"text-white text-[11px] font-medium",children:q(t.view_count||0)})]}),d&&t.media_urls&&t.media_urls.length>1&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"bg-black/50 rounded px-1.5 py-0.5",children:e.jsx("span",{className:"text-[11px] text-white font-medium",children:t.media_urls.length})})})]})]}):e.jsx("div",{ref:a,className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-purple-900/50 to-pink-900/50 p-4",children:e.jsx("p",{className:"text-[13px] text-white text-center line-clamp-5",children:t.content})})}export{ls as default};
