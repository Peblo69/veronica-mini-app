import{c as W,r as i,d as L,t as m,j as e,P as de,A as X,m as I,K as me,u as pe,o as xe,L as ue,M as he,k as fe,w as we,N as be}from"./index-JKPX0IOu-1765638421370.js";import{a as ge}from"./moderation-Cyx-wVK9-1765638421370.js";import{C as ve,E as _e}from"./CommentsSheet-BPGBznnk-1765638421370.js";import{u as Y}from"./useTranslation-B3UCU5VP-1765638421370.js";import{A as je}from"./arrow-left-B2HkPLH1-1765638421370.js";import{L as K}from"./loader-circle-BfG5k7GN-1765638421370.js";import{C as Ne}from"./chart-column-UkyQmCB4-1765638421370.js";import{M as ye}from"./message-circle-question-mark-CFZWJIG1-1765638421370.js";import{P as ke}from"./palette-CxUWS6UI-1765638421370.js";import{T as Ce}from"./trash-2-CPK4Imja-1765638421370.js";import{H as Pe}from"./heart-CDJIAKRj-1765638421370.js";import{R as $e}from"./repeat-2--T5T9r8P-1765638421370.js";import"./x-uomIxq9o-1765638421370.js";import"./flag-fbu9cq4U-1765638421370.js";const Se=[["path",{d:"M5 12h14",key:"1ays0h"}]],Me=W("minus",Se);const Oe=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],Te=W("type",Oe),V={none:{name:"None",value:"",preview:"bg-transparent border border-white/10"},midnight:{name:"Midnight",value:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",preview:"bg-gradient-to-br from-[#1a1a2e] via-[#16213e] to-[#0f3460]"},ember:{name:"Ember",value:"linear-gradient(135deg, #2d1f1f 0%, #4a2020 50%, #6b2020 100%)",preview:"bg-gradient-to-br from-[#2d1f1f] via-[#4a2020] to-[#6b2020]"},aurora:{name:"Aurora",value:"linear-gradient(135deg, #1a2f1a 0%, #1a3a2a 50%, #0f4a3a 100%)",preview:"bg-gradient-to-br from-[#1a2f1a] via-[#1a3a2a] to-[#0f4a3a]"},twilight:{name:"Twilight",value:"linear-gradient(135deg, #2d1f3d 0%, #3d2050 50%, #4a1f6a 100%)",preview:"bg-gradient-to-br from-[#2d1f3d] via-[#3d2050] to-[#4a1f6a]"},ocean:{name:"Ocean",value:"linear-gradient(135deg, #0d1b2a 0%, #1b263b 50%, #274060 100%)",preview:"bg-gradient-to-br from-[#0d1b2a] via-[#1b263b] to-[#274060]"}};function Q(s){const w=Math.floor((Date.now()-new Date(s).getTime())/1e3);if(w<60)return`${w}s`;const b=Math.floor(w/60);if(b<60)return`${b}m`;const f=Math.floor(b/60);if(f<24)return`${f}h`;const l=Math.floor(f/24);return l<7?`${l}d`:new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"})}function q(s){return s>=1e6?(s/1e6).toFixed(1).replace(/\.0$/,"")+"M":s>=1e3?(s/1e3).toFixed(1).replace(/\.0$/,"")+"K":s.toString()}function We({user:s,onBack:w,onViewProfile:b,onSheetStateChange:f}){const{t:l}=Y(),[k,x]=i.useState([]),[T,C]=i.useState(!0),[_,g]=i.useState(!1),[E,D]=i.useState(null),[j,N]=i.useState(void 0),[h,P]=i.useState(null);i.useEffect(()=>{f?.(_||h!==null)},[_,h,f]);const[n,$]=i.useState(""),[d,v]=i.useState("thought"),[p,S]=i.useState(["",""]),[z,B]=i.useState(24),[M,G]=i.useState("none"),[J,R]=i.useState(!1),[Z]=i.useState("public"),[O,A]=i.useState(!1),y=i.useRef(null),U=500,ee=s.is_creator;i.useEffect(()=>{F()},[]);const F=async()=>{C(!0);try{const{data:t,error:a}=await L.from("posts").select(`
          *,
          creator:users!posts_creator_id_fkey(*)
        `).in("post_type",["thought","poll","question"]).is("media_url",null).eq("is_hidden",!1).order("created_at",{ascending:!1}).limit(50);if(a)throw a;const o=(t||[]).map(u=>u.id),[r,c]=await Promise.all([L.from("likes").select("post_id").eq("user_id",s.telegram_id).in("post_id",o),L.from("reposts").select("post_id").eq("user_id",s.telegram_id).in("post_id",o)]),ie=new Set((r.data||[]).map(u=>u.post_id)),ne=new Set((c.data||[]).map(u=>u.post_id)),ce=(t||[]).map(u=>({...u,liked:ie.has(u.id),reposted:ne.has(u.id),creator:u.creator||{telegram_id:u.creator_id,first_name:"User",username:"user"}}));x(ce)}catch(t){console.error("Failed to load thoughts:",t),m.error("Failed to load")}C(!1)};i.useEffect(()=>{y.current&&(y.current.style.height="auto",y.current.style.height=Math.min(y.current.scrollHeight,120)+"px")},[n]);const te=async()=>{if(!O){if(d==="poll"){if(p.filter(a=>a.trim().length>0).length<2){m.error("Add at least 2 poll options");return}if(!n.trim()){m.error("Add a question for your poll");return}}else if(!n.trim())return;A(!0);try{if(n.trim()&&(await ge(n.trim()))?.flagged){m.error("Content blocked by moderation"),A(!1);return}const t={content:n.trim(),visibility:ee?Z:"public",is_nsfw:!1,unlock_price:0,post_type:d,background_gradient:M!=="none"?M:void 0};d==="poll"&&(t.poll_options=p.filter(o=>o.trim().length>0),t.poll_duration_hours=z);const{error:a}=await me(s.telegram_id,t);a?m.error("Failed to post"):(m.success("Posted!"),$(""),v("thought"),S(["",""]),G("none"),F())}catch(t){console.error("Post error:",t),m.error("Something went wrong")}A(!1)}},se=async t=>{const a=t.liked;x(o=>o.map(r=>r.id===t.id?{...r,liked:!a,likes_count:(r.likes_count||0)+(a?-1:1)}:r));try{a?await pe(s.telegram_id,t.id):await xe(s.telegram_id,t.id)}catch{x(o=>o.map(r=>r.id===t.id?{...r,liked:a,likes_count:(r.likes_count||0)+(a?1:-1)}:r))}},ae=t=>{D(t.id),N(t.creator_id),g(!0)},re=async t=>{const a=t.reposted;x(o=>o.map(r=>r.id===t.id?{...r,reposted:!a,reposts_count:(r.reposts_count||0)+(a?-1:1)}:r));try{if(a){const o=await ue(s.telegram_id,t.id);if(!o.success)throw new Error(o.error)}else{const o=await he(s.telegram_id,t.id);if(!o.success)throw new Error(o.error);m.success("Reposted!")}}catch{x(o=>o.map(r=>r.id===t.id?{...r,reposted:a,reposts_count:(r.reposts_count||0)+(a?1:-1)}:r)),m.error("Failed to repost")}},oe=async t=>{if(t.creator_id!==s.telegram_id){m.error("You can only delete your own posts");return}P(null),x(a=>a.filter(o=>o.id!==t.id));try{const a=await fe(t.id,s.telegram_id);if(!a.success)throw new Error(a.error?.message||"Failed to delete");m.success("Deleted")}catch{F(),m.error("Failed to delete")}},le=async(t,a)=>{if(t.poll_user_vote===void 0){x(o=>o.map(r=>{if(r.id!==t.id)return r;const c=[...r.poll_votes||[]];return c[a]=(c[a]||0)+1,{...r,poll_user_vote:a,poll_votes:c,poll_total_votes:(r.poll_total_votes||0)+1}}));try{const o=await we(t.id,a,s.telegram_id);if(o.error)throw new Error(o.error.message);x(r=>r.map(c=>c.id!==t.id?c:{...c,poll_votes:o.data?.poll_votes||c.poll_votes,poll_total_votes:o.data?.poll_total_votes||c.poll_total_votes,poll_user_vote:o.data?.poll_user_vote??a})),m.success("Vote recorded!")}catch{x(o=>o.map(r=>{if(r.id!==t.id)return r;const c=[...r.poll_votes||[]];return c[a]=Math.max(0,(c[a]||1)-1),{...r,poll_user_vote:void 0,poll_votes:c,poll_total_votes:Math.max(0,(r.poll_total_votes||1)-1)}})),m.error("Failed to vote")}}},H=d==="poll"?n.trim().length>0&&p.filter(t=>t.trim().length>0).length>=2:n.trim().length>0;return e.jsxs("div",{className:"min-h-screen bg-black text-white flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between px-4 py-3 border-b border-white/10",children:[e.jsx("button",{onClick:w,className:"p-1 -ml-1",children:e.jsx(je,{className:"w-6 h-6"})}),e.jsx("span",{className:"font-semibold",children:l("thoughts.title")}),e.jsx("button",{onClick:te,disabled:!H||O,className:`px-4 py-1.5 rounded-full text-sm font-semibold transition-all ${H&&!O?"bg-white text-black":"bg-white/10 text-white/30"}`,children:O?e.jsx(K,{className:"w-4 h-4 animate-spin"}):l("thoughts.post")})]}),e.jsx("div",{className:"flex-shrink-0 border-b border-white/10",children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:s.avatar_url||`https://i.pravatar.cc/150?u=${s.telegram_id}`,alt:"",className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("textarea",{ref:y,value:n,onChange:t=>$(t.target.value.slice(0,U)),placeholder:l(d==="poll"?"thoughts.askQuestion":d==="question"?"thoughts.whatToAsk":"thoughts.placeholder"),className:"w-full bg-transparent text-white text-[15px] placeholder-white/40 resize-none focus:outline-none leading-relaxed",rows:2})})]}),d==="poll"&&e.jsxs("div",{className:"mt-3 ml-[52px] space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/40 text-xs",children:l("thoughts.pollOptions")}),e.jsxs("select",{value:z,onChange:t=>B(Number(t.target.value)),className:"bg-white/5 border border-white/10 rounded px-2 py-1 text-xs text-white focus:outline-none",children:[e.jsx("option",{value:1,children:l("thoughts.duration.1hour")}),e.jsx("option",{value:8,children:l("thoughts.duration.8hours")}),e.jsx("option",{value:24,children:l("thoughts.duration.24hours")})]})]}),p.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:t,onChange:o=>{const r=[...p];r[a]=o.target.value.slice(0,50),S(r)},placeholder:l("thoughts.optionN",{n:a+1}),className:"flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm text-white placeholder-white/30 focus:outline-none"}),p.length>2&&e.jsx("button",{onClick:()=>S(p.filter((o,r)=>r!==a)),className:"w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-white/40",children:e.jsx(Me,{className:"w-4 h-4"})})]},a)),p.length<4&&e.jsxs("button",{onClick:()=>S([...p,""]),className:"w-full py-2 rounded-lg border border-dashed border-white/20 text-white/40 text-xs flex items-center justify-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),l("thoughts.addOption")]})]}),e.jsxs("div",{className:"mt-3 ml-[52px] flex items-center gap-1",children:[e.jsxs("button",{onClick:()=>v("thought"),className:`px-2 py-1 rounded-full text-[11px] font-medium flex items-center gap-1 ${d==="thought"?"bg-white text-black":"bg-white/5 text-white/50"}`,children:[e.jsx(Te,{className:"w-3 h-3"}),l("thoughts.text")]}),e.jsxs("button",{onClick:()=>v("poll"),className:`px-2 py-1 rounded-full text-[11px] font-medium flex items-center gap-1 ${d==="poll"?"bg-white text-black":"bg-white/5 text-white/50"}`,children:[e.jsx(Ne,{className:"w-3 h-3"}),l("thoughts.poll")]}),e.jsxs("button",{onClick:()=>v("question"),className:`px-2 py-1 rounded-full text-[11px] font-medium flex items-center gap-1 ${d==="question"?"bg-white text-black":"bg-white/5 text-white/50"}`,children:[e.jsx(ye,{className:"w-3 h-3"}),l("thoughts.qna")]}),d!=="poll"&&e.jsxs("button",{onClick:()=>R(!0),className:`px-2 py-1 rounded-full text-[11px] font-medium flex items-center gap-1 ${M!=="none"?"bg-white/20 text-white":"bg-white/5 text-white/50"}`,children:[e.jsx(ke,{className:"w-3 h-3"}),l("thoughts.style")]}),e.jsxs("span",{className:`ml-auto text-[10px] ${n.length>450?"text-orange-400":"text-white/30"}`,children:[n.length,"/",U]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:T?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(K,{className:"w-6 h-6 text-white/40 animate-spin"})}):k.length===0?e.jsx("div",{className:"py-20 text-center px-6",children:e.jsx("p",{className:"text-white/40 text-sm",children:l("thoughts.empty")})}):e.jsx("div",{className:"divide-y divide-white/5",children:k.map(t=>e.jsx(Ee,{thought:t,currentUserId:s.telegram_id,onLike:()=>se(t),onComment:()=>ae(t),onRepost:()=>re(t),onDelete:()=>oe(t),onVote:a=>le(t,a),menuOpen:h===t.id,onMenuToggle:()=>P(h===t.id?null:t.id),onViewProfile:b},t.id))})}),e.jsx(X,{children:J&&e.jsxs(e.Fragment,{children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 z-40",onClick:()=>R(!1)}),e.jsxs(I.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},className:"fixed bottom-0 left-0 right-0 bg-[#1c1c1e] rounded-t-2xl z-50 p-4",children:[e.jsx("div",{className:"w-10 h-1 bg-white/20 rounded-full mx-auto mb-4"}),e.jsx("h3",{className:"text-white text-lg font-semibold text-center mb-4",children:l("thoughts.backgroundStyle")}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Object.entries(V).map(([t,a])=>e.jsx("button",{onClick:()=>{G(t),R(!1)},className:`aspect-square rounded-xl ${a.preview} ${M===t?"ring-2 ring-white":""}`,children:e.jsx("span",{className:"text-white/60 text-xs",children:a.name})},t))})]})]})}),e.jsx(ve,{isOpen:_,onClose:()=>g(!1),postId:E,postCreatorId:j,user:s})]})}function Ee({thought:s,currentUserId:w,onLike:b,onComment:f,onRepost:l,onDelete:k,onVote:x,menuOpen:T,onMenuToggle:C,onViewProfile:_}){const{t:g}=Y(),E=s.creator_id===w,D=s.background_gradient&&V[s.background_gradient]?.value?{background:V[s.background_gradient].value}:{};return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>_?.(s.creator),className:"flex-shrink-0",children:e.jsx("img",{src:s.creator.avatar_url||`https://i.pravatar.cc/150?u=${s.creator.telegram_id}`,alt:"",className:"w-10 h-10 rounded-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("button",{onClick:()=>_?.(s.creator),className:"font-semibold text-sm truncate",children:s.creator.first_name||"User"}),e.jsxs("span",{className:"text-white/40 text-xs",children:["@",s.creator.username||`user${s.creator.telegram_id}`]}),e.jsx("span",{className:"text-white/30 text-xs",children:"·"}),e.jsx("span",{className:"text-white/40 text-xs flex-1",children:Q(s.created_at)}),E&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:C,className:"p-1 -mr-1 text-white/40 hover:text-white/70 transition-colors",children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx(X,{children:T&&e.jsx(I.div,{initial:{opacity:0,scale:.95,y:-5},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-5},transition:{duration:.1},className:"absolute right-0 top-6 z-20 min-w-[140px] rounded-xl overflow-hidden",style:{background:"rgba(40, 40, 40, 0.98)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs("button",{onClick:k,className:"w-full px-4 py-3 flex items-center gap-3 text-red-400 hover:bg-white/5 transition-colors",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:g("common.delete")})]})})})]})]}),e.jsx("div",{className:`text-[15px] leading-relaxed ${s.background_gradient?"p-3 rounded-xl":""}`,style:D,children:e.jsx("p",{className:"whitespace-pre-wrap break-words",children:s.content})}),s.post_type==="poll"&&s.poll_options&&e.jsxs("div",{className:"mt-3 space-y-2",children:[(()=>{const j=s.poll_user_vote!==void 0,N=s.poll_ends_at&&new Date(s.poll_ends_at)<new Date,h=!j&&!N;return s.poll_options.map((P,n)=>{const $=s.poll_votes?.[n]||0,d=s.poll_total_votes||0,v=d>0?Math.round($/d*100):0,p=s.poll_user_vote===n;return e.jsxs("button",{className:`relative w-full text-left transition-all ${h?"active:scale-[0.98]":""}`,onClick:()=>h&&x(n),disabled:!h,children:[e.jsx("div",{className:`absolute inset-0 rounded-lg transition-all ${p?"bg-blue-500/30":"bg-white/10"}`,style:{width:j||N?`${v}%`:"0%"}}),e.jsxs("div",{className:`relative px-3 py-2.5 rounded-lg border text-sm flex justify-between items-center ${p?"border-blue-400/50 font-medium":h?"border-white/20 hover:border-white/40":"border-white/10"}`,children:[e.jsxs("span",{className:"flex items-center gap-2",children:[P,p&&e.jsx("span",{className:"text-blue-400 text-xs",children:"✓"})]}),(j||N)&&e.jsxs("span",{className:"text-white/50",children:[v,"%"]})]})]},n)})})(),e.jsxs("div",{className:"flex items-center justify-between text-white/40 text-xs",children:[e.jsx("span",{children:g("thoughts.votes",{count:s.poll_total_votes||0})}),s.poll_ends_at&&e.jsx("span",{children:new Date(s.poll_ends_at)>new Date?g("thoughts.endsIn",{time:Q(s.poll_ends_at)}):g("thoughts.pollEnded")})]})]}),e.jsxs("div",{className:"flex items-center gap-6 mt-3",children:[e.jsxs("button",{onClick:b,className:`flex items-center gap-1.5 text-sm transition-colors active:scale-95 ${s.liked?"text-pink-500":"text-white/50 hover:text-white/70"}`,children:[e.jsx(Pe,{className:`w-[18px] h-[18px] ${s.liked?"fill-current":""}`}),e.jsx("span",{children:q(s.likes_count||0)})]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-1.5 text-sm text-white/50 hover:text-white/70 transition-colors active:scale-95",children:[e.jsx(be,{className:"w-[18px] h-[18px]"}),e.jsx("span",{children:q(s.comments_count||0)})]}),e.jsxs("button",{onClick:l,className:`flex items-center gap-1.5 text-sm transition-colors active:scale-95 ${s.reposted?"text-green-500":"text-white/50 hover:text-green-400"}`,children:[e.jsx($e,{className:"w-[18px] h-[18px]"}),e.jsx("span",{children:q(s.reposts_count||0)})]})]})]})]})})}export{We as default};
