import{c as f,r as c,j as e,A as x,m as w,X as b,s as u}from"./index-CDW6Jhyp-1765322654012.js";import{C as p}from"./chevron-right-2MccWCg2-1765322654012.js";const g=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],j=f("chevron-left",g);function N({stories:s,startIndex:r,onClose:l}){const[i,n]=c.useState(r),a=c.useRef(null),d=c.useRef(null);c.useEffect(()=>{n(r)},[r]);const t=s[i];c.useEffect(()=>{if(t)return a.current&&clearTimeout(a.current),t.media_type==="image"?a.current=setTimeout(()=>o(),5e3):a.current=setTimeout(()=>o(),12e3),()=>{a.current&&clearTimeout(a.current)}},[t?.id]);const o=()=>{i<s.length-1?n(i+1):l()},m=()=>{i>0?n(i-1):l()};if(!t)return null;const h=t.user?.first_name||t.user?.username||`@user${t.user_id}`;return e.jsx(x,{children:e.jsxs(w.div,{className:"fixed inset-0 bg-black/90 backdrop-blur-sm z-[90] flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 p-2 bg-white/10 rounded-full text-white z-[95]",children:e.jsx(b,{className:"w-5 h-5"})}),e.jsx("button",{onClick:m,className:"absolute left-2 top-1/2 -translate-y-1/2 p-2 rounded-full bg-white/10 text-white hover:bg-white/20",children:e.jsx(j,{className:"w-5 h-5"})}),e.jsx("button",{onClick:o,className:"absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-full bg-white/10 text-white hover:bg-white/20",children:e.jsx(p,{className:"w-5 h-5"})}),e.jsxs("div",{className:"w-full max-w-md aspect-[9/16] bg-black rounded-3xl overflow-hidden border border-white/10 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-white/20",children:e.jsx("div",{className:"h-full bg-white transition-all",style:{width:`${(i+1)/s.length*100}%`}})}),e.jsxs("div",{className:"absolute top-3 left-3 right-3 flex items-center justify-between z-20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:t.user?.avatar_url||`https://i.pravatar.cc/120?u=${t.user_id}`,className:"w-9 h-9 rounded-full border border-white/30",alt:""}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-semibold text-sm leading-tight",children:h}),e.jsx("p",{className:"text-white/70 text-[11px]",children:"Story"})]})]}),e.jsxs("span",{className:"text-white/60 text-xs",children:[i+1,"/",s.length]})]}),e.jsx("div",{className:"w-full h-full relative flex items-center justify-center bg-black",children:t.media_type==="video"?e.jsx("video",{ref:d,src:t.media_url,className:"w-full h-full object-contain",autoPlay:!0,playsInline:!0,muted:!0,onEnded:o},t.id):e.jsx("img",{src:t.media_url,alt:"",className:"w-full h-full object-contain"},t.id)})]})]})})}async function _(s,r,l,i){const{error:n,data:a}=await u.from("stories").insert({user_id:s,media_url:r,media_type:l,expires_at:i}).select().single();return{story:a,error:n}}async function S(){try{const{data:s,error:r}=await u.from("stories").select("*, user:users!user_id(*)").gt("expires_at",new Date().toISOString()).order("created_at",{ascending:!1});return r?(console.warn("Stories table may not exist:",r.message),{stories:[],error:r}):{stories:s||[],error:null}}catch(s){return console.warn("Failed to load stories:",s),{stories:[],error:s}}}export{N as S,_ as c,S as g};
