import{c as W,j as e,A as O,m as y,X as ce,C as B,s as Re,r as i,a as Fe,g as Ve,b as Ae,d as Oe,e as $e,l as De,u as He,f as ze,h as Ue,i as Be}from"./index-CdOqJoX2-1765314917368.js";import{C as We,P as Xe,a as qe,b as Ye,c as Je,d as Ke,V as Qe}from"./CommentsSheet-2qttTPHa-1765314917368.js";import{P as Ze,u as Ge}from"./PostDetail-D_usM4M7-1765314917368.js";import{s as et,g as tt}from"./livestreamApi-CwKwdOc2-1765314917368.js";import{u as st}from"./useInViewport-CpYrQAYv-1765314917368.js";import{g as at,S as lt}from"./storyApi-C9OAkRNn-1765314917368.js";import{u as it}from"./useTranslation-BUiFTkkq-1765314917368.js";import{U as rt}from"./users-DjTPvDuT-1765314917368.js";import{S as U}from"./star-B61s9OB1-1765314917368.js";import{E as nt}from"./ellipsis-B8pQz2uu-1765314917368.js";import{P as ct}from"./pen-line-Bx0a2ISs-1765314917368.js";import{T as ot}from"./trash-2-DJQpbbMc-1765314917368.js";import{L as dt}from"./lock-BoW6lHzi-1765314917368.js";import{E as mt}from"./eye-BB30ZqiS-1765314917368.js";import{H as ut}from"./heart-LVZ2ChWq-1765314917368.js";import{P as xt}from"./play-BytsTGNw-1765314917368.js";import{V as ft}from"./volume-2-kdFIvSgs-1765314917368.js";import{I as ht}from"./image-BnWvQYor-1765314917368.js";import"./loader-circle-lrfYvust-1765314917368.js";import"./arrow-left-KFRRHvig-1765314917368.js";import"./chevron-right-DmuVvmeD-1765314917368.js";const bt=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],pt=W("copy",bt);const wt=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],gt=W("eye-off",wt);const jt=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],vt=W("flag",jt);const yt=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Nt=W("user-x",yt);function kt({isOpen:n,onClose:m,title:h,users:f,loading:p,onUserClick:s}){return e.jsx(O,{mode:"sync",children:n&&e.jsxs(e.Fragment,{children:[e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeOut"},className:"fixed inset-0 bg-black/70 z-[9998]",onClick:m}),e.jsx(y.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"tween",duration:.3,ease:[.32,.72,0,1]},className:"fixed bottom-0 left-0 right-0 z-[9999] will-change-transform",style:{height:"55%"},children:e.jsxs("div",{className:"h-full bg-[#262626] rounded-t-[12px] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-9 h-1 bg-[#555] rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-[#363636]",children:[e.jsx("h3",{className:"text-base font-semibold text-white",children:h}),e.jsx("button",{onClick:m,className:"p-1.5 rounded-full bg-[#363636] active:bg-[#444]",children:e.jsx(ce,{className:"w-4 h-4 text-gray-400"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-[#262626]",children:p?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx("div",{className:"w-6 h-6 border-2 border-gray-600 border-t-white rounded-full animate-spin"})}):f.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center py-10 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No one yet"})}):e.jsx("div",{className:"py-1",children:f.map(c=>e.jsxs("button",{onClick:()=>s?.(c),className:"w-full flex items-center gap-3 px-4 py-3 active:bg-white/5",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("img",{src:c.avatar_url||`https://i.pravatar.cc/150?u=${c.telegram_id}`,alt:"",className:"w-11 h-11 rounded-full object-cover bg-[#333]"}),c.is_verified&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 bg-[#262626] rounded-full p-0.5",children:e.jsx(B,{className:"w-3.5 h-3.5 text-[#0095f6] fill-[#0095f6]"})})]}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("span",{className:"font-semibold text-[15px] text-white truncate block",children:c.username||c.first_name||"User"}),c.first_name&&c.username&&e.jsxs("p",{className:"text-[13px] text-gray-500 truncate",children:[c.first_name," ",c.last_name||""]})]}),c.is_creator&&e.jsx("span",{className:"text-[11px] font-semibold text-[#0095f6] bg-[#0095f6]/10 px-2.5 py-1 rounded-full",children:"Creator"})]},c.telegram_id))})})]})})]})})}async function _t(n){const{reporterId:m,reportedId:h,reportedType:f,reason:p,description:s}=n,{error:c}=await Re.from("reports").insert({reporter_id:m,reported_id:h,reported_type:f,reason:p,description:s,status:"pending"});return c?(console.error("Failed to submit report:",c),{success:!1,error:c.message}):{success:!0}}async function St(n,m,h,f){return _t({reporterId:n,reportedId:m.toString(),reportedType:"post",reason:h,description:f})}const re=n=>n.filter(m=>m.status==="live"&&!!m.started_at&&!!m.agora_channel&&(m.viewer_count||0)>0),ne=5,Pt=3,G=new Set;function Z(n){G.forEach(m=>{m!==n&&!m.paused&&m.pause()})}function Ct({url:n}){const[m,h]=i.useState(!1),[f,p]=i.useState(!1);return m?e.jsx("div",{className:"w-full flex items-center justify-center bg-white/5",style:{aspectRatio:"4/5"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(ht,{className:"w-10 h-10 text-white/30 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-white/40",children:"Failed to load image"})]})}):e.jsxs("div",{className:"relative w-full",style:{aspectRatio:"4/5"},children:[!f&&e.jsx("div",{className:"absolute inset-0 bg-white/5 animate-pulse"}),e.jsx("img",{src:n,alt:"",loading:"lazy",className:`w-full h-full object-contain bg-black select-none transition-opacity duration-200 ${f?"opacity-100":"opacity-0"}`,onLoad:()=>p(!0),onError:()=>h(!0)})]})}function Mt({src:n,muted:m=!0,shouldPlay:h=!1,onMuteChange:f}){const p=i.useRef(null),s=i.useRef(null),c=st(p,{minimumRatio:.5}),u=i.useRef(null),[w,C]=i.useState(!0),[M,S]=i.useState(!1),[E,L]=i.useState(!1);i.useEffect(()=>{const l=s.current;if(l)return G.add(l),()=>{G.delete(l)}},[]),i.useEffect(()=>{C(m)},[m]),i.useEffect(()=>{const l=s.current;if(!l)return;const x=h&&c;x&&l.paused?(Z(l),l.play().catch(()=>{})):!x&&!l.paused&&l.pause()},[h,c]),i.useEffect(()=>{const l=s.current;if(!l)return;const x=()=>{S(!0),Z(l)},k=()=>S(!1),P=()=>L(!0),j=()=>L(!1),I=()=>L(!1);return l.addEventListener("play",x),l.addEventListener("pause",k),l.addEventListener("waiting",P),l.addEventListener("playing",j),l.addEventListener("canplay",I),()=>{l.removeEventListener("play",x),l.removeEventListener("pause",k),l.removeEventListener("waiting",P),l.removeEventListener("playing",j),l.removeEventListener("canplay",I)}},[]);const b=()=>{const l=s.current;l&&(l.paused?(Z(l),l.play().catch(()=>{})):l.pause())},g=l=>{const x=l.touches[0];u.current={x:x.clientX,y:x.clientY,time:Date.now()}},N=l=>{if(!u.current)return;const x=l.changedTouches[0],k=Math.abs(x.clientX-u.current.x),P=Math.abs(x.clientY-u.current.y),j=Date.now()-u.current.time;k<15&&P<15&&j<300&&(l.preventDefault(),b()),u.current=null},F=l=>{l.stopPropagation(),l.preventDefault();const x=!w;C(x),f?.(x),s.current&&(s.current.muted=x)};return e.jsxs("div",{ref:p,className:"relative w-full bg-gray-900 overflow-hidden",style:{aspectRatio:"4/5"},onTouchStart:g,onTouchEnd:N,onClick:b,children:[e.jsx("video",{ref:s,src:n,className:"w-full h-full object-cover",playsInline:!0,loop:!0,muted:w,preload:"auto",poster:""}),E&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-10",children:e.jsx("div",{className:"w-10 h-10 border-2 border-white/40 border-t-white rounded-full animate-spin"})}),!M&&!E&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-10",children:e.jsx("div",{className:"w-14 h-14 bg-black/50 rounded-full flex items-center justify-center",children:e.jsx(xt,{className:"w-7 h-7 text-white fill-white ml-0.5"})})}),e.jsx("button",{onClick:F,onTouchEnd:l=>{l.stopPropagation(),u.current=null},className:"absolute bottom-4 left-4 w-9 h-9 bg-black/70 rounded-full flex items-center justify-center z-[999] active:scale-90 transition-transform backdrop-blur-sm",style:{touchAction:"manipulation"},children:w?e.jsx(Qe,{className:"w-4 h-4 text-white"}):e.jsx(ft,{className:"w-4 h-4 text-white"})})]})}function Lt({urls:n,canView:m,muted:h,onMuteChange:f,shouldPlay:p,onDoubleTap:s}){const[c,u]=i.useState(0),w=i.useRef(null),[C,M]=i.useState(!1),S=i.useRef(0),E=()=>{if(!w.current)return;const b=w.current.scrollLeft,g=w.current.offsetWidth,N=Math.round(b/g);N!==c&&u(N)},L=()=>{const b=Date.now();b-S.current<300&&(s?.(),M(!0),setTimeout(()=>M(!1),650)),S.current=b};return!m||n.length===0?null:e.jsxs("div",{className:"relative w-full bg-black rounded-2xl overflow-hidden",children:[e.jsx("div",{ref:w,className:"flex w-full h-full overflow-x-auto snap-x snap-mandatory scrollbar-hide",onScroll:E,style:{scrollbarWidth:"none",msOverflowStyle:"none"},onClick:L,children:n.map((b,g)=>e.jsx("div",{className:"flex-none w-full snap-center",children:b.match(/\.(mp4|webm|mov|m4v)(\?|$)/i)?e.jsx(Mt,{src:b,muted:h,onMuteChange:f,shouldPlay:p&&c===g}):e.jsx(Ct,{url:b})},g))}),e.jsx(O,{children:C&&e.jsx(y.div,{className:"absolute inset-0 flex items-center justify-center pointer-events-none",initial:{scale:.6,opacity:0},animate:{scale:1.1,opacity:.9},exit:{scale:.8,opacity:0},transition:{duration:.4},children:e.jsx(ut,{className:"w-24 h-24 text-white fill-white drop-shadow-[0_8px_24px_rgba(0,0,0,0.35)]"})})}),n.length>1&&e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5 z-10",children:n.map((b,g)=>e.jsx("div",{className:`w-1.5 h-1.5 rounded-full transition-all ${g===c?"bg-white w-2.5":"bg-white/50"}`},g))}),n.length>1&&e.jsxs("div",{className:"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full z-10",children:[c+1,"/",n.length]})]})}function Gt({user:n,onCreatorClick:m,onLivestreamClick:h,onGoLive:f,onSheetStateChange:p}){const{t:s}=it(),[c,u]=i.useState([]),[w,C]=i.useState([]),[M,S]=i.useState([]),[E,L]=i.useState(!0),[b,g]=i.useState(!0),[N,F]=i.useState(null),[l,x]=i.useState(null),[k,P]=i.useState(!1),[j,I]=i.useState(null),[$,_]=i.useState(null),[V,X]=i.useState(ne),ee=i.useRef(null),D=i.useRef(new Map),q=i.useRef(null),[Y,J]=i.useState(!1),[oe,de]=i.useState([]),[me,te]=i.useState(!1),[K,se]=i.useState(!1),[ue,xe]=i.useState(null),[H,fe]=i.useState([]),[he,ae]=i.useState(!1),[be,pe]=i.useState(0);i.useEffect(()=>{p?.(K||Y||!!l||$!==null||!!j)},[K,Y,l,$,j,p]),i.useEffect(()=>{we(),ge()},[]),i.useEffect(()=>{const t=Fe({onNewPost:a=>{u(r=>[{...a,liked:!1,saved:!1,can_view:!0},...r]),X(r=>r+1)},onPostUpdated:a=>{u(r=>r.map(o=>o.id===a.id?{...o,...a}:o))},onPostDeleted:a=>{u(r=>r.filter(o=>o.id!==a))},onLikeAdded:(a,r)=>{r!==n.telegram_id&&u(o=>o.map(d=>d.id===a?{...d,likes_count:(d.likes_count||0)+1}:d))},onLikeRemoved:(a,r)=>{r!==n.telegram_id&&u(o=>o.map(d=>d.id===a?{...d,likes_count:Math.max(0,(d.likes_count||0)-1)}:d))},onCommentAdded:(a,r)=>{u(o=>o.map(d=>d.id===a?{...d,comments_count:r}:d))}});return()=>t()},[n.telegram_id]),i.useEffect(()=>{const t=et(a=>S(re(a)));return()=>{t()}},[]);const we=async()=>{try{const[t,a,r]=await Promise.all([Ve(n.telegram_id),Ae(6,n.telegram_id),tt()]);u(t),X(Math.min(t.length,ne)),C(a),S(re(r))}catch(t){console.error("[Home] loadData failed",t)}finally{L(!1)}},ge=async()=>{try{const{stories:t}=await at();fe(t||[])}catch(t){console.error("[Home] loadStories failed",t)}},le=async t=>{if(!t.can_view)return;const a=!t.liked,r=a?1:-1;u(o=>o.map(d=>d.id===t.id?{...d,liked:a,likes_count:Math.max(0,(d.likes_count||0)+r)}:d));try{a?await De(n.telegram_id,t.id):await He(n.telegram_id,t.id)}catch(o){u(d=>d.map(v=>v.id===t.id?{...v,liked:!a,likes_count:Math.max(0,(v.likes_count||0)-r)}:v)),console.warn("Like action failed",o)}},je=async t=>{const a=!t.saved;u(r=>r.map(o=>o.id===t.id?{...o,saved:a}:o));try{a?await ze(n.telegram_id,t.id):await Ue(n.telegram_id,t.id)}catch(r){u(o=>o.map(d=>d.id===t.id?{...d,saved:!a}:d)),console.warn("Save action failed",r)}},ve=async t=>{if((t.likes_count||0)===0)return;J(!0),te(!0);const a=await Be(t.id);de(a),te(!1)},Q=async t=>{xe(t.id),se(!0)},ye=async t=>{P(!0),await Ge(n.telegram_id,t.id,()=>{u(c.map(a=>a.id===t.id?{...a,can_view:!0,is_purchased:!0}:a)),x(null),P(!1)},a=>{console.error("Payment failed:",a),P(!1)})},Ne=()=>{j&&(u(c.filter(t=>t.id!==j.id)),I(null))},ke=t=>{u(c.map(a=>a.id===t.id?t:a))},_e=async t=>{if(!window.confirm(s("feed.confirm.deletePost")))return;(await Oe(t.id,t.creator_id)).success?u(c.filter(r=>r.id!==t.id)):alert(s("feed.errors.deleteFailed")),_(null)},Se=t=>{u(c.filter(a=>a.id!==t.id)),_(null)},Pe=async t=>{const r=window.prompt(s("feed.report.promptReason"),s("feed.report.defaultReason"))?.trim();if(!r){_(null);return}const o=window.prompt(s("feed.report.promptDescription"))?.trim(),d=await St(n.telegram_id,t.id,r,o||void 0);d.success?alert(s("feed.report.success")):alert(s("feed.report.error",{error:d.error||s("feed.errors.tryAgain")})),_(null)},Ce=t=>{const a=`${window.location.origin}/post/${t.id}`;navigator.clipboard.writeText(a),alert(s("feed.linkCopied")),_(null)},Me=async t=>{if(!window.confirm(s("feed.confirm.blockUser",{user:t.creator?.username||s("feed.userFallback")})))return;await $e(n.telegram_id,t.creator_id)?(u(r=>r.filter(o=>o.creator_id!==t.creator_id)),C(r=>r.filter(o=>o.telegram_id!==t.creator_id)),alert(s("feed.blockedSuccess"))):alert(s("feed.errors.blockFailed")),_(null)};i.useEffect(()=>{const t=ee.current;if(!t||V>=c.length)return;const a=new IntersectionObserver(r=>{r[0]?.isIntersecting&&X(o=>o>=c.length?o:Math.min(c.length,o+Pt))},{rootMargin:"240px 0px"});return a.observe(t),()=>a.disconnect()},[V,c.length]);const A=i.useMemo(()=>c.slice(0,V),[c,V]);i.useEffect(()=>{if(q.current&&q.current.disconnect(),N===null&&A.length>0){const o=A.find(d=>d.media_url?.match(/\.(mp4|webm|mov|m4v)(\?|$)/i)||d.media_urls?.some(v=>v.match(/\.(mp4|webm|mov|m4v)(\?|$)/i)));F(o?o.id:A[0].id)}const t=document.querySelector("main"),a=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],r=new IntersectionObserver(o=>{let d=null,v=0;D.current.forEach((T,z)=>{const R=T.getBoundingClientRect(),Te=window.innerHeight,ie=Math.max(0,Math.min(R.bottom,Te)-Math.max(R.top,0))/R.height;ie>v&&(v=ie,d=z)});for(const T of o){const z=T.target.dataset.postId,R=z?Number(z):null;R&&T.isIntersecting&&T.intersectionRatio>v&&(v=T.intersectionRatio,d=R)}d!==null&&d!==N&&F(d)},{root:t||void 0,threshold:a,rootMargin:"-10% 0px -10% 0px"});return D.current.forEach(o=>r.observe(o)),q.current=r,()=>{r.disconnect()}},[A,N]);const Le=t=>{const a=Date.now()-new Date(t).getTime(),r=Math.floor(a/36e5);return r<1?s("feed.time.justNow"):r<24?s("feed.time.hours",{count:r}):s("feed.time.days",{count:Math.floor(r/24)})},Ee=t=>e.jsxs("div",{className:"bg-black pb-4 mb-2 border-b-4 border-gray-800/80",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsxs("button",{className:"flex items-center gap-3",onClick:()=>t.creator&&m(t.creator),children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden border border-gray-700",children:e.jsx("img",{src:t.creator?.avatar_url||"https://i.pravatar.cc/150?u="+t.creator_id,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold text-sm text-white",children:t.creator?.username||s("feed.userFallback")}),t.creator?.is_verified&&e.jsx(B,{className:"w-3.5 h-3.5 text-blue-500 fill-blue-500"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),_($===t.id?null:t.id)},className:"p-2 text-white",children:e.jsx(nt,{className:"w-5 h-5"})}),e.jsx(O,{children:$===t.id&&e.jsxs(e.Fragment,{children:[e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40",onClick:()=>_(null)}),e.jsxs(y.div,{initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},className:"absolute right-0 top-full mt-1 bg-[#262626] rounded-lg py-1 z-50 min-w-[160px] shadow-xl",onClick:a=>a.stopPropagation(),children:[Number(t.creator_id)===Number(n.telegram_id)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{I(t),_(null)},className:"w-full px-4 py-2.5 text-left text-sm text-white hover:bg-white/10 flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4"})," ",s("feed.actions.edit")]}),e.jsxs("button",{onClick:()=>_e(t),className:"w-full px-4 py-2.5 text-left text-sm text-red-500 hover:bg-white/10 flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4"})," ",s("feed.actions.delete")]}),e.jsx("div",{className:"h-px bg-gray-100 mx-4 my-1"})]}),e.jsxs("button",{onClick:()=>Ce(t),className:"w-full px-5 py-3 text-left text-[14px] font-semibold text-gray-700 hover:bg-gray-900 flex items-center gap-3",children:[e.jsx(pt,{className:"w-4 h-4"})," ",s("feed.actions.copyLink")]}),e.jsxs("button",{onClick:()=>Se(t),className:"w-full px-5 py-3 text-left text-[14px] font-semibold text-gray-700 hover:bg-gray-900 flex items-center gap-3",children:[e.jsx(gt,{className:"w-4 h-4"})," ",s("feed.actions.notInterested")]}),Number(t.creator_id)!==Number(n.telegram_id)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-px bg-gray-100 mx-4 my-1"}),e.jsxs("button",{onClick:()=>Me(t),className:"w-full px-4 py-2.5 text-left text-sm text-white hover:bg-white/10 flex items-center gap-2",children:[e.jsx(Nt,{className:"w-4 h-4"})," ",s("feed.actions.block")]}),e.jsxs("button",{onClick:()=>Pe(t),className:"w-full px-4 py-2.5 text-left text-sm text-red-500 hover:bg-white/10 flex items-center gap-2",children:[e.jsx(vt,{className:"w-4 h-4"})," ",s("feed.actions.report")]})]})]})]})})]})]}),t.media_url&&t.can_view?e.jsx("div",{className:"w-full bg-black rounded-2xl overflow-hidden border border-white/5","data-post-id":t.id,ref:a=>{a?D.current.set(t.id,a):D.current.delete(t.id)},children:e.jsx(Lt,{urls:t.media_urls&&t.media_urls.length>0?t.media_urls:[t.media_url],canView:t.can_view,muted:b,onMuteChange:g,shouldPlay:N===t.id,onDoubleTap:()=>le(t)})}):t.media_url?e.jsxs("div",{className:"relative bg-gray-900 text-white aspect-[4/5] flex flex-col items-center justify-center text-center overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-900/40 via-gray-900 to-gray-900"}),e.jsxs("div",{className:"relative z-10 p-8 w-full max-w-md mx-auto",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-3xl bg-white/5 border border-white/10 flex items-center justify-center mb-6 backdrop-blur-xl shadow-2xl shadow-purple-500/10 rotate-3 hover:rotate-0 transition-transform duration-500",children:e.jsx(dt,{className:"w-8 h-8 text-white/90 drop-shadow-lg"})}),e.jsx("h3",{className:"text-2xl font-bold mb-3 tracking-tight",children:Ie(t)}),e.jsx("p",{className:"text-white/60 mb-8 leading-relaxed",children:s("feed.lock.subtitle",{name:t.creator?.first_name})}),t.unlock_price>0?e.jsxs(y.button,{className:"w-full py-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-black rounded-2xl font-bold text-[15px] shadow-[0_0_30px_-5px_rgba(251,191,36,0.4)] flex items-center justify-center gap-2 hover:opacity-90 transition-opacity relative overflow-hidden group",whileTap:{scale:.98},onClick:()=>x(t),children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000"}),e.jsx(U,{className:"w-5 h-5 fill-current"}),s("feed.lock.unlockFor",{amount:Math.ceil(t.unlock_price)})]}):e.jsx(y.button,{className:"w-full py-4 bg-white text-white rounded-2xl font-bold text-[15px] shadow-[0_0_30px_-5px_rgba(255,255,255,0.3)] flex items-center justify-center gap-2 hover:bg-gray-900 transition-colors",whileTap:{scale:.98},onClick:()=>t.creator&&m(t.creator),children:t.visibility==="followers"?e.jsxs(e.Fragment,{children:[e.jsx(mt,{className:"w-5 h-5"})," ",s("feed.lock.followToView")]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-5 h-5"})," ",s("feed.lock.subscribeToView")]})})]})]}):null,e.jsxs("div",{className:"px-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("button",{className:"active:scale-90 transition-transform",onClick:()=>le(t),children:e.jsx(Xe,{className:`w-7 h-7 ${t.liked?"text-red-500":"text-white"}`,filled:t.liked})}),e.jsx("button",{className:"active:scale-90 transition-transform",onClick:()=>Q(t),children:e.jsx(qe,{className:"w-7 h-7 text-white"})}),e.jsx("button",{className:"active:scale-90 transition-transform",children:e.jsx(Ye,{className:"w-7 h-7 text-white"})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>je(t),className:"active:scale-90 transition-transform",children:e.jsx(Je,{className:"w-7 h-7 text-white",filled:t.saved})}),e.jsxs("button",{className:"flex flex-col items-center active:scale-90 transition-transform",onClick:()=>{},children:[e.jsx(Ke,{className:`w-7 h-7 ${(t.gifts_count||0)>0?"text-sky-400":"text-yellow-400"}`,filled:(t.gifts_count||0)>0}),(t.gifts_count||0)>0&&e.jsx("span",{className:"text-[10px] font-bold text-sky-400 -mt-0.5",children:t.gifts_count})]})]})]}),(t.likes_count||0)>0&&e.jsx("button",{className:"block mt-2",onClick:()=>ve(t),children:e.jsx("span",{className:"text-sm font-semibold text-white",children:s("feed.likesCount",{count:t.likes_count||0})})}),t.content&&e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"text-sm text-white",children:[e.jsx("span",{className:"font-semibold mr-1",children:t.creator?.username||s("feed.userFallback")}),t.content]})}),t.comments_count>0&&e.jsx("button",{className:"block mt-2",onClick:()=>Q(t),children:e.jsx("span",{className:"text-sm text-gray-400",children:s("feed.viewComments",{count:t.comments_count})})}),e.jsxs("button",{className:"flex items-center gap-2 mt-2 w-full",onClick:()=>Q(t),children:[e.jsx("img",{src:n.avatar_url||"https://i.pravatar.cc/150?u="+n.telegram_id,className:"w-6 h-6 rounded-full object-cover",alt:""}),e.jsx("span",{className:"text-sm text-gray-500",children:s("feed.addComment")})]}),e.jsx("div",{className:"mt-1 mb-2",children:e.jsx("span",{className:"text-[11px] text-gray-500 uppercase",children:Le(t.created_at)})})]})]},t.id),Ie=t=>t.unlock_price>0&&!t.is_purchased?s("feed.lock.unlockFor",{amount:Math.ceil(t.unlock_price)}):t.is_nsfw&&!t.is_subscribed?s("feed.lock.nsfw"):t.visibility==="subscribers"&&!t.is_subscribed?s("feed.lock.subscribers"):t.visibility==="followers"&&!t.is_following&&!t.is_subscribed?s("feed.lock.followers"):s("feed.lock.default");return E?e.jsx("div",{className:"bg-black min-h-screen p-4 space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"rounded-2xl border border-white/5 bg-[#0a0b0f] p-4 animate-pulse shadow-[0_14px_40px_rgba(0,0,0,0.35)]",children:[e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/10 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-24 mb-2"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-16"})]})]}),e.jsx("div",{className:"h-48 bg-white/10 rounded-xl"})]},t))}):e.jsxs("div",{className:"bg-black max-w-lg mx-auto relative pb-20",children:[e.jsxs("div",{className:"border-b border-gray-800 py-3 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-[13px] font-semibold text-white",children:s("feed.live.title")})]}),f&&e.jsx("button",{onClick:f,className:"text-[13px] font-semibold text-blue-500",children:s("feed.live.goLive")})]}),M.length>0?e.jsx("div",{className:"flex gap-4 overflow-x-auto no-scrollbar",children:M.map(t=>e.jsxs("button",{className:"flex flex-col items-center min-w-[66px]",onClick:()=>h?.(t.id),children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-[62px] h-[62px] rounded-full p-[3px] bg-gradient-to-tr from-red-500 via-pink-500 to-orange-500",children:e.jsx("div",{className:"w-full h-full rounded-full p-[2px] bg-white",children:e.jsx("img",{src:t.creator?.avatar_url||`https://i.pravatar.cc/150?u=${t.creator_id}`,alt:"",className:"w-full h-full rounded-full object-cover"})})}),e.jsx("div",{className:"absolute -bottom-0.5 left-1/2 -translate-x-1/2 bg-red-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded border-2 border-white",children:s("feed.live.badge")})]}),e.jsx("span",{className:"text-[11px] text-white mt-1.5 truncate w-full text-center",children:t.creator?.first_name})]},t.id))}):e.jsx("p",{className:"text-[13px] text-gray-400 text-center py-4",children:s("feed.live.none")})]}),H.length>0&&e.jsxs("div",{className:"border-b border-gray-800 py-3 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-[13px] font-semibold text-white",children:s("feed.stories.title")}),e.jsx("span",{className:"text-[12px] text-white/60",children:H.length})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-1",children:H.map((t,a)=>e.jsxs("button",{onClick:()=>{pe(a),ae(!0)},className:"flex flex-col items-center min-w-[64px] gap-1 focus:outline-none",children:[e.jsx("div",{className:"w-[62px] h-[62px] rounded-full p-[2px] bg-gradient-to-tr from-blue-500 via-purple-500 to-pink-500",children:e.jsx("div",{className:"w-full h-full rounded-full p-[2px] bg-black",children:e.jsx("img",{src:t.user?.avatar_url||`https://i.pravatar.cc/150?u=${t.user_id}`,alt:"",className:"w-full h-full rounded-full object-cover"})})}),e.jsx("span",{className:"text-[11px] text-white/80 truncate max-w-[68px]",children:t.user?.first_name||t.user?.username||`@user${t.user_id}`})]},t.id))})]}),w.length>0&&e.jsxs("div",{className:"border-b border-gray-800 py-4 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-[14px] font-semibold text-gray-500",children:s("feed.suggested.title")}),e.jsx("button",{className:"text-[13px] font-semibold text-white",children:s("feed.suggested.seeAll")})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto no-scrollbar pb-1",children:w.map(t=>e.jsxs("div",{className:"min-w-[100px] flex flex-col items-center",children:[e.jsxs("button",{onClick:()=>m(t),className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("img",{src:t.avatar_url||`https://i.pravatar.cc/150?u=${t.telegram_id}`,className:"w-16 h-16 rounded-full object-cover border-2 border-white/10",alt:t.first_name}),t.is_verified&&e.jsx("div",{className:"absolute bottom-0 right-0 bg-black rounded-full p-[2px]",children:e.jsx(B,{className:"w-3.5 h-3.5 text-blue-500 fill-blue-500"})})]}),e.jsx("span",{className:"text-[12px] font-medium text-white truncate w-full text-center max-w-[90px]",children:t.username||t.first_name})]}),e.jsx("button",{onClick:()=>m(t),className:"mt-2 px-4 py-1 bg-blue-500 text-white text-[11px] font-semibold rounded-md",children:s("feed.actions.follow")})]},t.telegram_id))})]}),e.jsx("div",{className:"bg-black",children:c.length===0?e.jsxs("div",{className:"px-4 py-16 text-center",children:[e.jsx("div",{className:"w-16 h-16 border-2 border-white rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(rt,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:s("feed.empty.title")}),e.jsx("p",{className:"text-sm text-gray-400",children:s("feed.empty.subtitle")})]}):e.jsxs("div",{children:[A.map(t=>Ee(t)),V<c.length&&e.jsx("div",{ref:ee,className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})})]})}),e.jsx(O,{children:l&&e.jsx(y.div,{className:"fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center z-[60] p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>!k&&x(null),children:e.jsxs(y.div,{className:"bg-[#1c1c1e] rounded-[2rem] p-6 max-w-sm w-full shadow-2xl border border-white/10",initial:{scale:.9,y:30,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:30,opacity:0},transition:{type:"spring",duration:.5},onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:s("feed.purchase.title")}),e.jsx("button",{onClick:()=>!k&&x(null),className:"p-1 rounded-full hover:bg-white/10 transition-colors",children:e.jsx(ce,{className:"w-6 h-6 text-gray-400"})})]}),e.jsxs("div",{className:"text-center mb-8 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-yellow-500/20 blur-3xl rounded-full"}),e.jsx("div",{className:"relative w-20 h-20 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx(U,{className:"w-10 h-10 text-white fill-white"})}),e.jsx("p",{className:"text-gray-400 text-sm font-medium mb-2",children:s("feed.purchase.payWithStars")}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(U,{className:"w-6 h-6 text-yellow-400 fill-yellow-400"}),e.jsx("span",{className:"text-4xl font-bold text-white tracking-tight",children:Math.ceil(l.unlock_price)})]})]}),e.jsx("div",{className:"bg-white/5 rounded-2xl p-4 mb-6 border border-white/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:l.creator?.avatar_url||`https://i.pravatar.cc/150?u=${l.creator_id}`,className:"w-10 h-10 rounded-full object-cover",alt:""}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-medium",children:l.creator?.first_name||l.creator?.username}),e.jsx("p",{className:"text-gray-500 text-sm",children:s("feed.purchase.creatorShare")})]})]})}),e.jsx(y.button,{className:"w-full py-4 rounded-2xl font-bold text-[15px] flex items-center justify-center gap-2 shadow-lg transition-all bg-gradient-to-r from-yellow-400 to-orange-500 text-black",whileHover:{scale:1.02,y:-1},whileTap:{scale:.98},onClick:()=>ye(l),disabled:k,children:k?e.jsx("div",{className:"w-5 h-5 border-2 border-black/30 border-t-black rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-5 h-5 fill-current"}),s("feed.purchase.payAmount",{amount:Math.ceil(l.unlock_price)})]})}),e.jsx("p",{className:"text-center text-gray-500 text-xs mt-4",children:s("feed.purchase.poweredBy")})]})})}),e.jsx(O,{children:j&&e.jsx(Ze,{post:j,user:n,onBack:()=>I(null),onDeleted:Ne,onUpdated:ke})}),he&&e.jsx(lt,{stories:H,startIndex:be,onClose:()=>ae(!1)}),e.jsx(kt,{isOpen:Y,onClose:()=>J(!1),title:s("feed.likesTitle"),users:oe,loading:me,onUserClick:t=>{J(!1),m(t)}}),e.jsx(We,{isOpen:K,onClose:()=>se(!1),postId:ue,user:n})]})}export{Gt as default};
