import{c as P,d as j,r as l,j as e,m as k,X as Me,A as W,M as ae,a5 as De,a6 as Ve,a7 as Ie,a8 as Ue,a9 as ze,aa as Oe,ab as We,ac as qe,ad as Ge}from"./index-DKmagv3U-1765561925010.js";import{g as Ke,P as Xe}from"./PostDetail-Cg6Y2CSj-1765561925010.js";import{G as Be,F as He,u as Ye,a as Qe}from"./useConnectionQuality-CopuRNop-1765561925010.js";import{u as Ze}from"./useInViewport-BQK02jKD-1765561925010.js";import{g as Je,S as et,c as tt}from"./storyApi-0inAii4g-1765561925010.js";import{C as ce}from"./chart-column-BWpRpvLZ-1765561925010.js";import{R as st,A as at,T as ne,S as lt}from"./trending-up-BspBKbM8-1765561925010.js";import{U as le}from"./users-BkrOZ51s-1765561925010.js";import{E as de,C as it}from"./eye-Dk5akFs4-1765561925010.js";import{H as q}from"./heart-Cg1GnOw2-1765561925010.js";import{D as rt}from"./dollar-sign-BO0KtoIJ-1765561925010.js";import{C as ie}from"./crown-DIYq6U2U-1765561925010.js";import{C as ot}from"./clock-Br-A-ln--1765561925010.js";import{U as xe}from"./user-plus-CKQD7CdU-1765561925010.js";import{S as me}from"./sparkles-CWtNqitG-1765561925010.js";import{u as ct}from"./useTranslation-ChlqvJpy-1765561925010.js";import{S as nt}from"./star-DKWJdChp-1765561925010.js";import{C as dt}from"./chevron-down-DO1rMdTR-1765561925010.js";import{L as M}from"./lock-C60MwNEi-1765561925010.js";import{R as re}from"./repeat-2-Jm4HqhvR-1765561925010.js";import{V as xt}from"./video-BwXGBmlH-1765561925010.js";import{I as mt}from"./image-BwvkNcBO-1765561925010.js";import{P as ht}from"./play-CYtdGqCd-1765561925010.js";import"./PixelIcons-CZzDL1PY-1765561925010.js";import"./CommentsSheet-B7adOal--1765561925010.js";import"./loader-circle-AOkl2cqJ-1765561925010.js";import"./arrow-left-ClaMfHj3-1765561925010.js";import"./trash-2-C2_MlHgu-1765561925010.js";import"./volume-2-C03eucwF-1765561925010.js";import"./chevron-left-CKP7G_dH-1765561925010.js";const pt=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],oe=P("bookmark",pt);const ut=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],ft=P("menu",ut);const wt=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],bt=P("share-2",wt);const jt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],gt=P("target",jt);const Nt=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],vt=P("trending-down",Nt);const yt=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],_t=P("zap",yt);async function kt(t){try{const{data:i,error:r}=await j.rpc("get_creator_analytics",{p_user_id:t});return r?(console.error("[Analytics] Error fetching analytics:",r),null):i}catch(i){return console.error("[Analytics] Exception:",i),null}}async function St(t,i=7){try{const{data:r,error:a}=await j.rpc("get_profile_views_chart",{p_user_id:t,p_days:i});return a?(console.error("[Analytics] Error fetching chart data:",a),[]):r||[]}catch(r){return console.error("[Analytics] Exception:",r),[]}}async function Ct(t,i=10){try{const{data:r,error:a}=await j.rpc("get_recent_visitors",{p_user_id:t,p_limit:i});return a?(console.error("[Analytics] Error fetching visitors:",a),[]):r||[]}catch(r){return console.error("[Analytics] Exception:",r),[]}}async function Pt(t,i=5){try{const{data:r,error:a}=await j.rpc("get_top_posts_analytics",{p_user_id:t,p_limit:i});return a?(console.error("[Analytics] Error fetching top posts:",a),[]):r||[]}catch(r){return console.error("[Analytics] Exception:",r),[]}}function $t(t,i){const r=j.channel(`profile_views_${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"profile_views",filter:`profile_id=eq.${t}`},()=>i("view")).subscribe(),a=j.channel(`follows_${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"follows",filter:`following_id=eq.${t}`},()=>i("follow")).subscribe(),c=j.channel(`likes_${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"likes"},()=>i("like")).subscribe();return()=>{j.removeChannel(r),j.removeChannel(a),j.removeChannel(c)}}function Tt(t,i,r,a){if(a===0)return 0;const c=t+i*2+r*3;return Math.min(100,c/a*100)}function f(t){return t>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t.toString()}function Rt(t){return t>=1e3?"$"+(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":"$"+t.toFixed(2)}const Et=({data:t,color:i="#22c55e"})=>{if(!t.length)return null;const r=Math.max(...t,1),a=Math.min(...t,0),c=r-a||1,o=60,n=24,p=t.map((w,x)=>{const g=x/(t.length-1||1)*o,b=n-(w-a)/c*n;return`${g},${b}`}).join(" ");return e.jsx("svg",{width:o,height:n,className:"opacity-60",children:e.jsx("polyline",{fill:"none",stroke:i,strokeWidth:"1.5",points:p})})},C=({icon:t,label:i,value:r,subValue:a,trend:c,color:o="white",chartData:n})=>e.jsxs("div",{className:"bg-white/5 rounded-xl p-3 border border-white/5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("div",{className:`w-7 h-7 rounded-lg bg-${o}/10 flex items-center justify-center`,children:e.jsx(t,{className:`w-3.5 h-3.5 text-${o}`,style:{color:o}})}),n&&e.jsx(Et,{data:n,color:o}),c!==void 0&&!n&&e.jsxs("div",{className:`flex items-center gap-0.5 text-[10px] ${c>=0?"text-green-400":"text-red-400"}`,children:[c>=0?e.jsx(ne,{className:"w-3 h-3"}):e.jsx(vt,{className:"w-3 h-3"}),Math.abs(c),"%"]})]}),e.jsx("p",{className:"text-white text-lg font-bold leading-tight",children:r}),e.jsx("p",{className:"text-white/40 text-[10px] mt-0.5",children:i}),a&&e.jsx("p",{className:"text-white/30 text-[9px]",children:a})]}),Ft=({visitor:t,onClick:i})=>e.jsxs("button",{onClick:i,className:"flex flex-col items-center gap-1 min-w-[52px]",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500/30 to-pink-500/30 p-[1.5px]",children:e.jsx("img",{src:t.avatar_url||`https://ui-avatars.com/api/?name=${t.first_name||"U"}&background=1a1a2e&color=fff&size=40`,alt:"",className:"w-full h-full rounded-full object-cover"})}),t.is_verified&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(me,{className:"w-2.5 h-2.5 text-white"})})]}),e.jsx("span",{className:"text-[9px] text-white/60 truncate max-w-[52px]",children:t.first_name||t.username||"User"})]}),Lt=({post:t,rank:i})=>e.jsxs("div",{className:"flex items-center gap-3 py-2",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-white/5 flex items-center justify-center text-[10px] font-bold text-white/40",children:i}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-white/5 overflow-hidden flex-shrink-0",children:t.media_url?e.jsx("img",{src:t.media_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/20",children:e.jsx(ae,{className:"w-4 h-4"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-white/80 text-xs truncate",children:[t.content?.slice(0,40)||"Media post",t.content&&t.content.length>40?"...":""]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-white/40 flex items-center gap-0.5",children:[e.jsx(q,{className:"w-2.5 h-2.5"})," ",f(t.like_count)]}),e.jsxs("span",{className:"text-[10px] text-white/40 flex items-center gap-0.5",children:[e.jsx(ae,{className:"w-2.5 h-2.5"})," ",f(t.comment_count)]}),e.jsxs("span",{className:"text-[10px] text-white/40 flex items-center gap-0.5",children:[e.jsx(de,{className:"w-2.5 h-2.5"})," ",f(t.view_count||0)]})]})]}),e.jsx(it,{className:"w-4 h-4 text-white/20"})]});function At({user:t,onClose:i,onCreatorClick:r}){const[a,c]=l.useState(null),[o,n]=l.useState([]),[p,w]=l.useState([]),[x,g]=l.useState([]),[b,E]=l.useState(!0),[$,T]=l.useState(!1),[N,F]=l.useState("overview"),v=l.useCallback(async(d=!1)=>{d?T(!0):E(!0);try{const[u,U,S,y]=await Promise.all([kt(t.telegram_id),St(t.telegram_id,7),Ct(t.telegram_id,10),Pt(t.telegram_id,5)]);u&&c(u),n(U),w(S),g(y)}catch(u){console.error("Failed to load analytics:",u)}finally{E(!1),T(!1)}},[t.telegram_id]);l.useEffect(()=>(v(),$t(t.telegram_id,u=>{console.log("[Insights] Real-time update:",u),v(!0)})),[v,t.telegram_id]);const I=a?Tt(a.total_likes,a.total_comments,a.total_shares,a.total_followers):0,L=o.map(d=>d.views);return e.jsxs(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black z-50 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/10",children:[e.jsx("button",{onClick:i,className:"w-8 h-8 flex items-center justify-center",children:e.jsx(Me,{className:"w-5 h-5 text-white/60"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-white font-semibold text-[15px]",children:"Creator Insights"})]}),e.jsx("button",{onClick:()=>v(!0),disabled:$,className:"w-8 h-8 flex items-center justify-center",children:e.jsx(st,{className:`w-4 h-4 text-white/60 ${$?"animate-spin":""}`})})]}),e.jsx("div",{className:"flex border-b border-white/10",children:[{id:"overview",label:"Overview",icon:at},{id:"audience",label:"Audience",icon:le},{id:"content",label:"Content",icon:_t}].map(d=>e.jsxs("button",{onClick:()=>F(d.id),className:`flex-1 py-2.5 flex items-center justify-center gap-1.5 text-xs font-medium transition-colors ${N===d.id?"text-white border-b-2 border-purple-500":"text-white/40"}`,children:[e.jsx(d.icon,{className:"w-3.5 h-3.5"}),d.label]},d.id))}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:b?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-8 h-8 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"})}):e.jsxs(W,{mode:"wait",children:[N==="overview"&&e.jsxs(k.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(C,{icon:de,label:"Profile Views",value:f(a?.total_profile_views||0),subValue:`${a?.views_today||0} today`,chartData:L,color:"#a855f7"}),e.jsx(C,{icon:le,label:"Followers",value:f(a?.total_followers||0),subValue:`+${a?.followers_this_week||0} this week`,trend:a?.followers_today?12:0,color:"#3b82f6"}),e.jsx(C,{icon:q,label:"Total Likes",value:f(a?.total_likes||0),color:"#ef4444"}),e.jsx(C,{icon:gt,label:"Engagement",value:`${I.toFixed(1)}%`,color:"#22c55e"})]}),e.jsx("div",{className:"bg-gradient-to-br from-amber-500/20 to-orange-500/20 rounded-xl p-4 border border-amber-500/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-500/20 flex items-center justify-center",children:e.jsx(rt,{className:"w-4 h-4 text-amber-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/40 text-[10px]",children:"Total Earnings"}),e.jsx("p",{className:"text-amber-400 text-xl font-bold",children:Rt(a?.total_earnings||0)})]})]}),e.jsx(ie,{className:"w-6 h-6 text-amber-400/40"})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"bg-white/5 rounded-xl p-2.5 text-center",children:[e.jsx("p",{className:"text-white font-bold text-sm",children:f(a?.total_posts||0)}),e.jsx("p",{className:"text-white/40 text-[9px]",children:"Posts"})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-2.5 text-center",children:[e.jsx("p",{className:"text-white font-bold text-sm",children:f(a?.total_comments||0)}),e.jsx("p",{className:"text-white/40 text-[9px]",children:"Comments"})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-2.5 text-center",children:[e.jsx("p",{className:"text-white font-bold text-sm",children:f(a?.total_subscribers||0)}),e.jsx("p",{className:"text-white/40 text-[9px]",children:"Subscribers"})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-3",children:[e.jsx("p",{className:"text-white/60 text-[11px] font-medium mb-2",children:"Views breakdown"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/40 text-xs",children:"Today"}),e.jsx("span",{className:"text-white text-xs font-medium",children:a?.views_today||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/40 text-xs",children:"This week"}),e.jsx("span",{className:"text-white text-xs font-medium",children:a?.views_this_week||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/40 text-xs",children:"This month"}),e.jsx("span",{className:"text-white text-xs font-medium",children:a?.views_this_month||0})]})]})]})]},"overview"),N==="audience"&&e.jsxs(k.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white/5 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("p",{className:"text-white/80 text-xs font-medium flex items-center gap-1.5",children:[e.jsx(ot,{className:"w-3 h-3 text-purple-400"}),"Recent Profile Visitors"]}),e.jsxs("span",{className:"text-white/30 text-[10px]",children:[p.length," visitors"]})]}),p.length>0?e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 -mx-1 px-1",children:p.map(d=>e.jsx(Ft,{visitor:d,onClick:()=>r?.({telegram_id:d.viewer_id})},d.viewer_id))}):e.jsx("p",{className:"text-white/30 text-xs text-center py-4",children:"No recent visitors yet"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(C,{icon:xe,label:"New Followers",value:a?.followers_this_week||0,subValue:"This week",color:"#22c55e"}),e.jsx(C,{icon:ie,label:"Subscribers",value:a?.total_subscribers||0,subValue:"Paying fans",color:"#f59e0b"})]}),e.jsx("div",{className:"bg-white/5 rounded-xl p-4 border border-dashed border-white/10",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{className:"w-6 h-6 text-white/20 mx-auto mb-2"}),e.jsx("p",{className:"text-white/40 text-xs",children:"Detailed audience insights"}),e.jsx("p",{className:"text-white/20 text-[10px]",children:"Coming soon"})]})})]},"audience"),N==="content"&&e.jsxs(k.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"bg-white/5 rounded-xl p-2.5 text-center",children:[e.jsx("p",{className:"text-white font-bold text-sm",children:a?.total_posts||0}),e.jsx("p",{className:"text-white/40 text-[9px]",children:"Total Posts"})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-2.5 text-center",children:[e.jsx("p",{className:"text-white font-bold text-sm",children:f(a?.total_likes||0)}),e.jsx("p",{className:"text-white/40 text-[9px]",children:"Total Likes"})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-2.5 text-center",children:[e.jsx("p",{className:"text-white font-bold text-sm",children:f(a?.total_shares||0)}),e.jsx("p",{className:"text-white/40 text-[9px]",children:"Total Shares"})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-3",children:[e.jsxs("p",{className:"text-white/80 text-xs font-medium mb-2 flex items-center gap-1.5",children:[e.jsx(me,{className:"w-3 h-3 text-amber-400"}),"Top Performing Posts"]}),x.length>0?e.jsx("div",{className:"divide-y divide-white/5",children:x.map((d,u)=>e.jsx(Lt,{post:d,rank:u+1},d.id))}):e.jsx("p",{className:"text-white/30 text-xs text-center py-4",children:"No posts yet"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-pink-500/10 rounded-xl p-3 border border-purple-500/20",children:[e.jsx("p",{className:"text-purple-300 text-[11px] font-medium mb-1",children:"Pro tip"}),e.jsx("p",{className:"text-white/60 text-[10px]",children:"Posts with images get 2x more engagement. Try posting during peak hours (6-9 PM) for best results."})]})]},"content")]})}),e.jsx("div",{className:"h-6"})]})}function V(t){return t>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t.toString()}function ps({user:t,setUser:i,onSettingsClick:r,onViewProfile:a}){const{t:c}=ct(),[o,n]=l.useState("posts"),[p,w]=l.useState([]),[x,g]=l.useState([]),[b,E]=l.useState([]),[$,T]=l.useState(!0),[N,F]=l.useState(!1),[v,I]=l.useState(!1),[L,d]=l.useState(!1),[u,U]=l.useState(!1),[S,y]=l.useState(null),[he,pe]=l.useState(null),[ue,G]=l.useState(!1),K=l.useRef(null),fe=l.useRef(null),[,X]=l.useState(!1),[,B]=l.useState(!1),[we,z]=l.useState(!1),[be,H]=l.useState("followers"),[je,A]=l.useState(t.followers_count||0),[ge,Ne]=l.useState(t.following_count||0),[ve,ye]=l.useState(t.subscribers_count||0),[R,_e]=l.useState([]),[ke,O]=l.useState(!1),[Se,Y]=l.useState(!1);l.useEffect(()=>{$e(),Ce(),J()},[t.telegram_id]);const Ce=async()=>{const s=await De(t.telegram_id);A(s.followers),Ne(s.following)};l.useEffect(()=>{const s=Ve(t.telegram_id,{onNewFollower:()=>A(h=>h+1),onUnfollow:()=>A(h=>Math.max(0,h-1))}),m=Ie(t.telegram_id,h=>{A(h.followers_count||0),ye(h.subscribers_count||0)});return()=>{s(),m()}},[t.telegram_id]),l.useEffect(()=>{o==="saved"&&(!v&&!N&&Q(),!he&&!ue&&Pe())},[o]);const Pe=async()=>{G(!0);try{const s=await Ke(t.telegram_id);s.wallet&&pe(s.wallet)}catch(s){console.error("Failed to load wallet data:",s)}G(!1)},$e=async()=>{T(!0);const m=(await Ue(t.telegram_id,t.telegram_id))?.posts??[];w(m),T(!1)},Q=async()=>{if(!(v||N)){F(!0);try{const s=await ze();g(s?.posts||[]),I(!0)}catch(s){console.error("[Profile] Failed to load saved posts:",s)}F(!1)}},Te=async()=>{if(!(u||L)){d(!0);try{const s=await Oe(t.telegram_id);E(s),U(!0)}catch(s){console.error("[Profile] Failed to load reposts:",s)}d(!1)}},Re=()=>{S&&(w(p.filter(s=>s.id!==S.id)),g(x.filter(s=>s.id!==S.id)),y(null),t.is_creator&&i({...t,posts_count:Math.max(0,(t.posts_count||1)-1)}))},Ee=s=>{w(p.map(m=>m.id===s.id?{...s,can_view:!0}:m)),g(x.map(m=>m.id===s.id?{...s,can_view:!0}:m))},Fe=()=>{K.current?.click()},Le=async()=>{const s=`${window.location.origin}/profile/${t.username||t.telegram_id}`;try{if(navigator.share){await navigator.share({url:s,title:t.username||c("profile.title")});return}}catch{}try{await navigator.clipboard.writeText(s),alert(c("profile.share.copied"))}catch{alert(c("profile.share.copyError"))}},Z=(s,m)=>{const h=s.target.files?.[0];if(!h){s.target.value="";return}if(m==="profile"){(async()=>{B(!0);const _=await We(h,t.telegram_id);_.error||!_.url?alert(c("profile.upload.error")):await qe(t.telegram_id,{avatar_url:_.url})?(i({...t,avatar_url:_.url}),alert(c("profile.upload.avatarSuccess"))):alert(c("profile.upload.error")),B(!1),s.target.value=""})();return}(async()=>{X(!0);const _=await Ge(h,t.telegram_id);if(_.error||!_.url)alert(c("profile.upload.error"));else{const se=h.type.startsWith("video/")?"video":"image",{error:Ae}=await tt(t.telegram_id,_.url,se);Ae?alert(c("profile.upload.error")):(alert(c("profile.upload.storySuccess")),J())}X(!1),s.target.value=""})()},J=async()=>{try{const{stories:s}=await Je(),m=(s||[]).filter(h=>h.user_id===t.telegram_id);_e(m)}catch(s){console.error("[Profile] loadStories failed",s)}},ee=p.filter(s=>s.visibility==="public"),te=p.filter(s=>s.visibility!=="public");return e.jsxs("div",{className:"bg-black min-h-screen text-white pb-20",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsx("button",{className:"p-1.5",children:e.jsx(xe,{className:"w-5 h-5 text-white"})}),R.length>0?e.jsxs("button",{onClick:()=>O(!0),className:"absolute left-1/2 -translate-x-1/2 top-16 bg-white text-black text-[11px] px-2.5 py-1 rounded-full font-medium shadow-lg",style:{transform:"translateX(-50%) translateY(-100%)"},children:["View Stories",e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-full w-0 h-0 border-l-[5px] border-l-transparent border-r-[5px] border-r-transparent border-t-[5px] border-t-white"})]}):null,e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"p-1.5",children:e.jsx(nt,{className:"w-5 h-5 text-white"})}),e.jsx("button",{className:"p-1.5",onClick:Le,children:e.jsx(bt,{className:"w-5 h-5 text-white"})}),e.jsx("button",{className:"p-1.5",onClick:r,children:e.jsx(ft,{className:"w-5 h-5 text-white"})})]})]}),e.jsxs("div",{className:"flex flex-col items-center px-4 pt-1 pb-3",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("div",{className:`w-18 h-18 rounded-full ${R.length>0?"p-[2px] bg-gradient-to-tr from-pink-500 via-red-500 to-yellow-500":""}`,style:{width:"72px",height:"72px"},children:e.jsx("div",{className:`w-full h-full rounded-full ${R.length>0?"p-[2px] bg-black":""}`,children:e.jsx("img",{src:t.avatar_url||`https://i.pravatar.cc/150?u=${t.telegram_id}`,alt:t.first_name,className:"w-full h-full rounded-full object-cover",onClick:()=>R.length>0&&O(!0)})})}),e.jsx("button",{onClick:Fe,className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-5 h-5 bg-[#00D4FF] rounded-full flex items-center justify-center border-2 border-black",children:e.jsx("span",{className:"text-black text-sm font-bold leading-none",children:"+"})})]}),e.jsx("input",{ref:K,type:"file",accept:"image/*",className:"hidden",onChange:s=>Z(s,"profile")}),e.jsx("input",{ref:fe,type:"file",accept:"image/*,video/*",className:"hidden",onChange:s=>Z(s,"story")}),e.jsx("div",{className:"w-full flex justify-center mb-0.5",children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"text-base font-bold tracking-wide",children:t.first_name?.toUpperCase()||"USER"}),e.jsx("button",{onClick:r,className:"absolute -right-6 top-1/2 -translate-y-1/2 p-0.5",children:e.jsx(lt,{className:"w-4 h-4 text-white/70"})})]})}),e.jsxs("span",{className:"text-[12px] text-white/50 mb-3",children:["@",t.username||`user${t.telegram_id}`]}),e.jsxs("div",{className:"flex items-center justify-center gap-0 mb-3",children:[e.jsxs("button",{onClick:()=>{H("following"),z(!0)},className:"flex flex-col items-center px-4",children:[e.jsx("span",{className:"text-base font-bold",children:V(ge)}),e.jsx("span",{className:"text-[11px] text-white/50",children:"Following"})]}),e.jsx("div",{className:"w-[1px] h-6 bg-white/10"}),e.jsxs("button",{onClick:()=>{H("followers"),z(!0)},className:"flex flex-col items-center px-4",children:[e.jsx("span",{className:"text-base font-bold",children:V(je)}),e.jsx("span",{className:"text-[11px] text-white/50",children:"Followers"})]}),e.jsx("div",{className:"w-[1px] h-6 bg-white/10"}),e.jsxs("div",{className:"flex flex-col items-center px-4",children:[e.jsx("span",{className:"text-base font-bold",children:V(ve)}),e.jsx("span",{className:"text-[11px] text-white/50",children:"Subscribers"})]})]}),e.jsx("div",{className:"text-center px-6 mb-2",children:e.jsx("p",{className:"text-[13px] text-white/90 whitespace-pre-wrap",children:t.bio||"No bio yet"})})]}),e.jsxs("div",{className:"flex border-b border-white/10",children:[e.jsxs("button",{className:`flex-1 py-3 flex items-center justify-center gap-1 ${o==="posts"?"border-b-2 border-white":""}`,onClick:()=>n("posts"),children:[e.jsx(Be,{className:`w-5 h-5 ${o==="posts"?"text-white":"text-white/40"}`}),e.jsx(dt,{className:`w-3 h-3 ${o==="posts"?"text-white":"text-white/40"}`})]}),t.is_creator&&e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${o==="locked"?"border-b-2 border-white":""}`,onClick:()=>n("locked"),children:e.jsx(M,{className:`w-5 h-5 ${o==="locked"?"text-white":"text-white/40"}`})}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${o==="reposts"?"border-b-2 border-white":""}`,onClick:()=>{n("reposts"),Te()},children:e.jsx(re,{className:`w-5 h-5 ${o==="reposts"?"text-white":"text-white/40"}`})}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${o==="saved"?"border-b-2 border-white":""}`,onClick:()=>{n("saved"),Q()},children:e.jsx(oe,{className:`w-5 h-5 ${o==="saved"?"text-white":"text-white/40"}`})}),t.is_creator?e.jsx("button",{className:"flex-1 py-3 flex items-center justify-center",onClick:()=>Y(!0),children:e.jsx(ce,{className:"w-5 h-5 text-white/40 hover:text-purple-400 transition-colors"})}):e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${o==="liked"?"border-b-2 border-white":""}`,onClick:()=>n("liked"),children:e.jsx(q,{className:`w-5 h-5 ${o==="liked"?"text-white":"text-white/40"}`})})]}),e.jsxs("div",{className:"pb-20",children:[o==="posts"&&($?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},s))}):ee.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(xt,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-sm text-white/50",children:"Your posts will appear here"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:ee.map(s=>e.jsx(k.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>y(s),children:e.jsx(D,{post:s})},s.id))})),o==="locked"&&t.is_creator&&($?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3].map(s=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},s))}):te.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(M,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No locked content"}),e.jsx("p",{className:"text-sm text-white/50",children:"Private content will appear here"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:te.map(s=>e.jsxs(k.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>y(s),children:[e.jsx(D,{post:s}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(M,{className:"w-4 h-4 text-white drop-shadow"})})]},s.id))})),o==="reposts"&&(L||!u&&!b.length?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},s))}):b.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(re,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No reposts yet"}),e.jsx("p",{className:"text-sm text-white/50",children:"Content you repost will appear here"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:b.map(s=>e.jsx(k.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>y(s),children:e.jsx(D,{post:s})},s.id))})),o==="saved"&&(N||!v&&!x.length?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},s))}):x.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(oe,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No saved posts"}),e.jsx("p",{className:"text-sm text-white/50 max-w-xs mx-auto",children:"Save posts to view them later"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:x.map(s=>e.jsx(k.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>y(s),children:e.jsx(D,{post:s})},s.id))})),o==="liked"&&e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(M,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Liked posts are private"}),e.jsx("p",{className:"text-sm text-white/50 max-w-xs mx-auto",children:"Only you can see what you've liked"})]})]}),e.jsx(W,{children:S&&e.jsx(Xe,{post:S,user:t,onBack:()=>y(null),onDeleted:Re,onUpdated:Ee})}),ke&&e.jsx(et,{stories:R,startIndex:0,onClose:()=>O(!1)}),e.jsx(W,{children:Se&&e.jsx(At,{user:t,onClose:()=>Y(!1),onCreatorClick:a})}),e.jsx(He,{isOpen:we,onClose:()=>z(!1),userId:t.telegram_id,currentUserId:t.telegram_id,type:be,onUserClick:a})]})}const Mt=/\.(mp4|webm|mov|m4v)(\?|$)/i;function Dt(t){return t.media_url?t.media_type&&t.media_type.toLowerCase().includes("video")?!0:Mt.test(t.media_url):!1}function D({post:t}){const i=l.useRef(null),[r,a]=l.useState(!1),[c,o]=l.useState(!1),[n,p]=l.useState(!1),w=Ze(i,{minimumRatio:.25}),x=t.media_thumbnail||t.media_url,{isDataSaver:g}=Ye();Qe(g?null:x);const b=Dt(t);return l.useEffect(()=>{w&&a(!0)},[w]),t.media_url?c?e.jsx("div",{ref:i,className:"w-full h-full flex items-center justify-center bg-[#1a1a1a]",children:e.jsx(mt,{className:"w-8 h-8 text-white/20"})}):e.jsxs("div",{ref:i,className:"w-full h-full relative",children:[(!r||!n)&&e.jsx("div",{className:"absolute inset-0 bg-[#1a1a1a] animate-pulse"}),r&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:x||t.media_url,alt:"",className:`w-full h-full object-cover transition-opacity duration-200 ${n?"opacity-100":"opacity-0"}`,loading:"lazy",onLoad:()=>p(!0),onError:()=>o(!0)}),n&&b&&e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-12 bg-gradient-to-t from-black/60 to-transparent"}),n&&b&&e.jsxs("div",{className:"absolute bottom-1.5 left-1.5 flex items-center gap-0.5",children:[e.jsx(ht,{className:"w-3 h-3 text-white fill-white"}),e.jsx("span",{className:"text-white text-[11px] font-medium",children:V(t.view_count||0)})]}),n&&t.media_urls&&t.media_urls.length>1&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"bg-black/50 rounded px-1.5 py-0.5",children:e.jsx("span",{className:"text-[11px] text-white font-medium",children:t.media_urls.length})})})]})]}):e.jsx("div",{ref:i,className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-purple-900/50 to-pink-900/50 p-4",children:e.jsx("p",{className:"text-[13px] text-white text-center line-clamp-5",children:t.content})})}export{ps as default};
