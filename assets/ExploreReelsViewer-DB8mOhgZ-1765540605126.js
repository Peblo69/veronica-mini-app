import{r as a,j as t,aH as J}from"./index-CJXEs7Ca-1765540605126.js";import{P as K,a as Q,d as Z,V as ee}from"./PixelIcons-BDzdqzNJ-1765540605126.js";import{E as te,C as se}from"./CommentsSheet-BreBg4Gj-1765540605126.js";import{P as ae}from"./play-CKHM7aGc-1765540605126.js";import{A as ne}from"./arrow-left-Cy5qTzbN-1765540605126.js";import{S as oe}from"./send-D8PQQGsL-1765540605126.js";import{V as le}from"./volume-2-BO7brCtu-1765540605126.js";import"./loader-circle-CETeay92-1765540605126.js";import"./heart-BcOkUFuJ-1765540605126.js";let g=null;const C=new Set,re=n=>(C.add(n),()=>C.delete(n)),L=()=>g,V=n=>{g!==n&&(g=n,C.forEach(i=>i()))};function ce(n){const i=a.useSyncExternalStore(re,L,L),j=!1,y=a.useCallback(x=>{x&&V(x)},[]),v=a.useCallback(()=>{g===n&&V(null)},[n]);return{activeId:i,isActive:j,requestPlay:y,clearActive:v}}function je({videos:n,initialIndex:i,onClose:j,onLike:y,onCreatorClick:v,user:x,onCommentCountUpdate:ie}){const[l,I]=a.useState(i),[d,T]=a.useState(!0),[b,m]=a.useState(!1),[R,A]=a.useState(new Set),[S,P]=a.useState(new Set),[M,$]=a.useState(new Set),[z,E]=a.useState(!1),c=a.useRef(new Map),N=a.useRef(null),f=a.useCallback(e=>`reel-${e}-${n[e]?.id??e}`,[n]),{activeId:k,requestPlay:w,clearActive:W}=ce(),p=a.useRef(null),o=n[l];a.useEffect(()=>{const e=N.current;e&&i>0&&setTimeout(()=>{const s=i*window.innerWidth;e.scrollLeft=s},0)},[i]),a.useEffect(()=>{const e=N.current;if(!e)return;const s=()=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{const u=e.scrollLeft,h=window.innerWidth,r=Math.round(u/h);r!==l&&r>=0&&r<n.length&&(I(r),m(!1))},50)};return e.addEventListener("scroll",s,{passive:!0}),()=>{e.removeEventListener("scroll",s),p.current&&clearTimeout(p.current)}},[l,n.length]),a.useEffect(()=>()=>{c.current.forEach(e=>{e.pause(),e.src=""}),c.current.clear()},[]),a.useEffect(()=>{c.current.forEach((e,s)=>{const u=f(s);if(!(s===l&&!b)){e.paused||e.pause();return}if(w(u),k!==u){e.paused||e.pause();return}e.currentTime=0,e.muted=d,e.play().then(()=>{P(r=>new Set(r).add(s))}).catch(()=>{e.muted=!0,e.play().then(()=>{P(r=>new Set(r).add(s))}).catch(()=>{})})})},[k,l,b,d,w,f]);const B=a.useCallback((e,s)=>{if(!s){c.current.delete(e);return}c.current.set(e,s)},[]),_=e=>{A(s=>new Set(s).add(e))},O=e=>{$(s=>new Set(s).add(e))},D=e=>{if(e.target.closest("button"))return;const s=c.current.get(l);s&&(s.paused?(s.play().catch(()=>{}),m(!1),w(f(l))):(s.pause(),m(!0),k===f(l)&&W()))},q=e=>{e.stopPropagation();const s=!d;T(s),c.current.forEach(u=>{u.muted=s})},F=e=>{e.stopPropagation(),o&&y(o.id)},H=e=>{e.stopPropagation(),o?.creator&&v(o.creator)},U=e=>{e.stopPropagation(),j()},X=e=>{e.stopPropagation(),E(!0);const s=c.current.get(l);s&&!s.paused&&(s.pause(),m(!0))},Y=t.jsxs("div",{ref:N,className:"reels-viewer",onClick:D,style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:100,backgroundColor:"#000",overflowX:"scroll",overflowY:"hidden",WebkitOverflowScrolling:"touch",scrollSnapType:"x mandatory",overscrollBehavior:"none",display:"flex",flexDirection:"row",paddingTop:"max(56px, calc(env(safe-area-inset-top, 0px) + 48px))"},children:[n.map((e,s)=>{const u=s===l,h=Math.abs(s-l)<=1,r=!S.has(s)&&e.media_thumbnail;return t.jsxs("div",{style:{height:"100%",width:"100vw",minWidth:"100vw",position:"relative",backgroundColor:"#000",display:"flex",alignItems:"center",justifyContent:"center",scrollSnapAlign:"start",scrollSnapStop:"always",flexShrink:0},children:[t.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[e.media_thumbnail&&t.jsx("img",{src:e.media_thumbnail,alt:"",className:`max-w-full max-h-full w-auto h-full object-contain transition-opacity duration-300 ${r?"opacity-100":"opacity-0"}`,style:{aspectRatio:"9/16"},onLoad:()=>O(s),draggable:!1}),!R.has(s)&&!M.has(s)&&h&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10",children:t.jsx("div",{className:"w-10 h-10 border-3 border-white/20 border-t-white rounded-full animate-spin"})}),h&&t.jsx("video",{ref:G=>B(s,G),src:e.media_url,className:`absolute max-w-full max-h-full w-auto h-full object-contain transition-opacity duration-150 ${S.has(s)?"opacity-100":"opacity-0"}`,style:{aspectRatio:"9/16"},loop:!0,playsInline:!0,muted:d,preload:"auto",poster:e.media_thumbnail||void 0,onLoadedData:()=>_(s),onCanPlay:()=>_(s)})]}),b&&u&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-20",children:t.jsx("div",{className:"w-16 h-16 bg-black/50 rounded-full flex items-center justify-center backdrop-blur-sm",children:t.jsx(ae,{className:"w-8 h-8 text-white fill-white ml-1"})})})]},e.id)}),t.jsxs("div",{style:{position:"fixed",inset:0,pointerEvents:"none",zIndex:50},children:[t.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-[200px] bg-gradient-to-t from-black via-black/50 to-transparent"}),t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 flex gap-1.5",style:{bottom:"calc(8px + env(safe-area-inset-bottom, 0px))",pointerEvents:"none"},children:n.length<=15&&n.map((e,s)=>t.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${s===l?"w-5 bg-white":"w-1.5 bg-white/40"}`},s))}),t.jsxs("button",{onClick:U,className:"absolute left-1/2 -translate-x-1/2 flex items-center gap-1.5 px-3 py-1.5 bg-black/50 backdrop-blur-sm rounded-full border border-white/20",style:{pointerEvents:"auto",top:"max(60px, calc(env(safe-area-inset-top, 0px) + 52px))"},children:[t.jsx(ne,{className:"w-4 h-4 text-white"}),t.jsx("span",{className:"text-sm font-medium text-white",children:"Back"})]}),t.jsxs("div",{className:"absolute right-3 flex flex-col items-center gap-4",style:{bottom:"calc(100px + env(safe-area-inset-bottom, 0px))",pointerEvents:"auto"},children:[t.jsxs("button",{onClick:F,className:"flex flex-col items-center gap-0.5 active:scale-90 transition-transform",children:[t.jsx(K,{className:`w-7 h-7 ${o?.liked?"text-red-500":"text-white"}`,filled:o?.liked}),t.jsx("span",{className:"text-white text-[10px] font-semibold",children:o?.likes_count||0})]}),t.jsxs("button",{onClick:X,className:"flex flex-col items-center gap-0.5 active:scale-90 transition-transform",children:[t.jsx(Q,{className:"w-7 h-7 text-white"}),t.jsx("span",{className:"text-white text-[10px] font-semibold",children:o?.comments_count||0})]}),t.jsx("button",{className:"flex flex-col items-center gap-0.5 active:scale-90 transition-transform",children:t.jsx(oe,{className:"w-6 h-6 text-white rotate-12"})}),t.jsxs("button",{className:"flex flex-col items-center gap-0.5 active:scale-90 transition-transform",onClick:()=>{},children:[t.jsx(Z,{className:`w-7 h-7 ${(o?.gifts_count||0)>0?"text-sky-400":"text-yellow-400"}`,filled:(o?.gifts_count||0)>0}),(o?.gifts_count||0)>0&&t.jsx("span",{className:"text-sky-400 text-[10px] font-semibold",children:o?.gifts_count})]}),t.jsx("button",{className:"flex flex-col items-center gap-0.5 active:scale-90 transition-transform",children:t.jsx(te,{className:"w-7 h-7 text-white"})}),t.jsx("button",{onClick:q,className:"flex flex-col items-center gap-0.5 active:scale-90 transition-transform",children:d?t.jsx(ee,{className:"w-7 h-7 text-white"}):t.jsx(le,{className:"w-7 h-7 text-white"})})]}),t.jsx("div",{className:"absolute left-3 right-14",style:{bottom:"calc(24px + env(safe-area-inset-bottom, 0px))",pointerEvents:"auto"},children:t.jsxs("button",{onClick:H,className:"flex items-center gap-2",children:[t.jsx("img",{src:o?.creator?.avatar_url||`https://i.pravatar.cc/150?u=${o?.creator_id}`,alt:"",className:"w-9 h-9 rounded-full border-2 border-white object-cover bg-gray-800"}),t.jsxs("span",{className:"text-white font-bold text-[14px] drop-shadow-[0_1px_3px_rgba(0,0,0,0.9)]",children:["@",o?.creator?.username||"user"]}),o?.creator?.is_verified&&t.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center",children:t.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"})})})]})})]})]});return J.createPortal(t.jsxs(t.Fragment,{children:[Y,t.jsx(se,{isOpen:z,onClose:()=>{if(E(!1),b){const e=c.current.get(l);e&&(e.play().catch(()=>{}),m(!1),w(f(l)))}},postId:o?.id??null,user:x})]}),document.body)}export{je as default};
