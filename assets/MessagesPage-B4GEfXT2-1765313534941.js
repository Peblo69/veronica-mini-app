import{c as A,r as l,j as e,m as h,A as L,X as se,y as Ct,z as ze,B as St,D as Tt,E as Rt,F as je,G as Mt,H as Ft,C as ve,I as De,P as Et,S as Ut,M as $t,J as Le,K as zt,L as Dt,N as Lt,p as At,O as Pt,Q as Ot,R as Ae,U as Vt,V as qt,W as Ht}from"./index-BNIw4U_K-1765313534941.js";import{M as It}from"./mic--UCaQpBN-1765313534941.js";import{L as U}from"./loader-circle-CMyo9YM1-1765313534941.js";import{S as Be}from"./send-BB-nZLgM-1765313534941.js";import{u as Gt}from"./useInViewport-D09fBv35-1765313534941.js";import{t as Wt}from"./moderation-DCKijx72-1765313534941.js";import{u as Bt}from"./useTranslation-CqUhk1i2-1765313534941.js";import{A as Kt}from"./arrow-left-BDP4KbSs-1765313534941.js";import{D as Pe}from"./dollar-sign-CLcz8mVj-1765313534941.js";import{V as Jt}from"./volume-2-jmxy0QZi-1765313534941.js";import{L as Qt}from"./lock-BJWSgDTZ-1765313534941.js";import{T as Oe}from"./trash-2-HfBji9tH-1765313534941.js";import{G as Xt}from"./globe-CyxiKs3w-1765313534941.js";import{I as Yt}from"./image-DXZsA-qS-1765313534941.js";import{V as Zt}from"./video-Dds6F04w-1765313534941.js";import{G as Ve}from"./gift-_FtABHjT-1765313534941.js";import{E as es,U as ts,F as ss}from"./user-x-rfnYTckc-1765313534941.js";const as=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],is=A("bell-off",as);const rs=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],qe=A("check-check",rs);const ns=[["path",{d:"M20 20v-7a4 4 0 0 0-4-4H4",key:"1nkjon"}],["path",{d:"M9 14 4 9l5-5",key:"102s5s"}]],ls=A("corner-up-left",ns);const os=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],cs=A("ellipsis-vertical",os);const ds=[["path",{d:"m15 17 5-5-5-5",key:"nf172w"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]],xs=A("forward",ds);const us=[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]],He=A("languages",us);const ms=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Ie=A("sparkles",ms);const ps=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],hs=A("square",ps);function fs({onSend:d,onCancel:u,disabled:w}){const[f,g]=l.useState(!1),[B,i]=l.useState(0),[$,z]=l.useState(null),[c,P]=l.useState(!1),T=l.useRef(null),m=l.useRef([]),_=l.useRef(null),H=l.useRef(null);l.useEffect(()=>()=>{_.current&&clearInterval(_.current),H.current&&H.current.getTracks().forEach(p=>p.stop())},[]);const ae=async()=>{try{const p=await navigator.mediaDevices.getUserMedia({audio:!0});H.current=p;const C=new MediaRecorder(p,{mimeType:"audio/webm;codecs=opus"});T.current=C,m.current=[],C.ondataavailable=y=>{y.data.size>0&&m.current.push(y.data)},C.onstop=()=>{const y=new Blob(m.current,{type:"audio/webm"});z(y),p.getTracks().forEach(ie=>ie.stop())},C.start(100),g(!0),i(0),_.current=setInterval(()=>{i(y=>y+1)},1e3)}catch(p){console.error("Failed to start recording:",p),alert("Could not access microphone. Please allow microphone access.")}},K=()=>{T.current&&f&&(T.current.stop(),g(!1),_.current&&(clearInterval(_.current),_.current=null))},k=()=>{K(),z(null),i(0),m.current=[],u?.()},S=async()=>{if(!(!$||c)){P(!0);try{await d($,B),z(null),i(0)}catch(p){console.error("Failed to send voice:",p)}P(!1)}},O=p=>{const C=Math.floor(p/60),y=p%60;return`${C}:${y.toString().padStart(2,"0")}`};return!f&&!$?e.jsx(h.button,{onClick:ae,disabled:w,className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 disabled:opacity-50 text-gray-500",whileTap:{scale:.9},children:e.jsx(It,{className:"w-5 h-5"})}):e.jsxs(L,{children:[e.jsx("div",{className:"fixed inset-0 z-[80] bg-black/20 backdrop-blur-sm",onClick:k}),e.jsx(h.div,{initial:{opacity:0,y:20,scale:.9,x:"-50%"},animate:{opacity:1,y:0,scale:1,x:"-50%"},exit:{opacity:0,y:20,scale:.9,x:"-50%"},className:"fixed bottom-40 left-1/2 z-[90] flex flex-col items-center gap-4 w-full max-w-[280px]",children:e.jsxs("div",{className:"bg-white rounded-[2rem] p-4 shadow-[0_8px_30px_rgb(0,0,0,0.12)] border border-gray-100 w-full flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between w-full px-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${f?"bg-red-500 animate-pulse":"bg-gray-300"}`}),e.jsx("span",{className:"text-lg font-bold font-mono text-gray-800",children:O(B)})]}),f&&e.jsx("div",{className:"flex items-center gap-1 h-8",children:[...Array(12)].map((p,C)=>e.jsx(h.div,{className:"w-1 bg-red-400 rounded-full",animate:{height:[8,12+Math.random()*16,8],opacity:[.5,1,.5]},transition:{repeat:1/0,duration:.5,delay:C*.05}},C))})]}),e.jsxs("div",{className:"flex items-center justify-between w-full gap-4",children:[e.jsx("button",{onClick:k,className:"p-3 rounded-full bg-gray-100 text-gray-500 hover:bg-gray-200 hover:text-gray-700 transition-colors",children:e.jsx(se,{className:"w-6 h-6"})}),f?e.jsx("button",{onClick:K,className:"p-4 bg-red-500 rounded-full text-white shadow-lg shadow-red-500/30 hover:scale-105 transition-transform",children:e.jsx(hs,{className:"w-6 h-6 fill-white"})}):e.jsx("button",{onClick:S,disabled:c,className:"p-4 bg-of-blue rounded-full text-white shadow-lg shadow-blue-500/30 hover:scale-105 transition-transform disabled:opacity-50",children:c?e.jsx(U,{className:"w-6 h-6 animate-spin"}):e.jsx(Be,{className:"w-6 h-6 ml-0.5"})})]}),e.jsx("p",{className:"text-xs text-gray-400 font-medium",children:f?"Recording...":"Review your message"})]})})]})}class gs{cache;accessOrder;maxMessages;constructor(u=500){this.cache=new Map,this.accessOrder=[],this.maxMessages=u}get(u,w){const f=this.cache.get(u);if(!f)return;const g=this.accessOrder.indexOf(u);return g>-1&&(this.accessOrder.splice(g,1),this.accessOrder.push(u)),f.get(w)}set(u,w,f){if(this.cache.has(u)){const g=this.accessOrder.indexOf(u);g>-1&&(this.accessOrder.splice(g,1),this.accessOrder.push(u))}else{for(;this.cache.size>=this.maxMessages&&this.accessOrder.length>0;){const g=this.accessOrder.shift();g&&this.cache.delete(g)}this.cache.set(u,new Map),this.accessOrder.push(u)}this.cache.get(u).set(w,f)}has(u,w){return this.cache.has(u)?w===void 0?!0:this.cache.get(u).has(w):!1}clear(){this.cache.clear(),this.accessOrder=[]}get size(){return this.cache.size}}const Ge=new gs(500),Ne="chat-translation-prefs",We=()=>e.jsx("div",{className:"fixed inset-0 bg-[#0a0a0a] pointer-events-none",style:{zIndex:0}});function bs({containerClassName:d,...u}){const w=l.useRef(null),f=l.useRef(null),g=Gt(w,{minimumRatio:.35});l.useEffect(()=>{const i=f.current;i&&!g&&!i.paused&&i.pause()},[g]);const B={...u,preload:u.preload??"metadata"};return e.jsx("div",{ref:w,className:d,children:e.jsx("video",{ref:f,...B})})}const ws=["â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ˜¡","ðŸ‘"];function As({user:d,selectedConversationId:u,onConversationOpened:w,onChatStateChange:f,onProfileClick:g,scrollElement:B}){const{t:i}=Bt(),[$,z]=l.useState([]),[c,P]=l.useState(null),[T,m]=l.useState([]),[_,H]=l.useState(""),[ae,K]=l.useState(!0),[k,S]=l.useState(!1),[O,p]=l.useState(!1),[C,y]=l.useState(!1),[ie,X]=l.useState(!1),[I,re]=l.useState(""),[Ke,Je]=l.useState([]),[ne,Qe]=l.useState(""),[Xe,_e]=l.useState(0),[Y,Ye]=l.useState("primary"),[V,R]=l.useState(null),[Ze,M]=l.useState(!1),[v,le]=l.useState(null),[et,oe]=l.useState(new Map),[tt,ke]=l.useState(!1),[N,ce]=l.useState(!1),[F,de]=l.useState("en"),[st,xe]=l.useState(!1),[ue,D]=l.useState(null),at=l.useRef(null),j=l.useRef(null),me=l.useRef(null),J=l.useRef(new Set),q=l.useRef(new Map),pe=l.useRef(null),it=l.useRef(null),Z=l.useRef(!1),ee=l.useRef(null),Q=l.useRef(null),he=l.useRef(new Map),fe=l.useRef(new Set),Ce=t=>{J.current.add(t)},rt=t=>{t&&J.current.has(t)&&(URL.revokeObjectURL(t),J.current.delete(t))},Se=t=>{if(!(typeof window>"u"||!t))try{const s=localStorage.getItem(Ne);if(!s)return;const r=JSON.parse(s)[t];r?(ce(r.enabled),de(r.target||"en")):(ce(!1),de("en"))}catch(s){console.warn("[Translation] load prefs failed",s)}},nt=(t,s,a)=>{if(!(typeof window>"u"||!t))try{const r=localStorage.getItem(Ne),n=r?JSON.parse(r):{};n[t]={enabled:s,target:a},localStorage.setItem(Ne,JSON.stringify(n))}catch(r){console.warn("[Translation] save prefs failed",r)}},E=(t,s,a)=>{let r;m(n=>n.map(o=>o._localId===t?s?(r=o.preview_url,s):{...o,_status:"failed",error:a||o.error||i("messages.errors.sendFailed")}:o)),s&&r&&(rt(r),q.current.delete(t))},Te=l.useCallback(async(t,s,a)=>{const r=Ge.get(t,a);if(r){m(n=>n.map(o=>o.id===t?{...o,_translatedContent:r,_isTranslating:!1}:o));return}m(n=>n.map(o=>o.id===t?{...o,_isTranslating:!0,_translationError:null}:o));try{console.log("[Translation] Starting for message:",t,s.slice(0,30));const n=await Wt(s,a);console.log("[Translation] Result:",n),n?(Ge.set(t,a,n),m(o=>o.map(x=>x.id===t?{...x,_translatedContent:n,_isTranslating:!1}:x))):(console.warn("[Translation] No result returned for message:",t),m(o=>o.map(x=>x.id===t?{...x,_isTranslating:!1,_translationError:i("messages.errors.translationNoResult")}:x)))}catch(n){console.error("[Translation] Error:",n),m(o=>o.map(x=>x.id===t?{...x,_isTranslating:!1,_translationError:n?.message||i("messages.errors.translationFailed")}:x))}},[]);l.useEffect(()=>{if(!N||!F)return;T.filter(a=>a.sender_id!==d.telegram_id&&a.message_type==="text"&&a.content&&!a._translatedContent&&!a._isTranslating&&!a._translationError&&!a.id.startsWith("temp-")).slice(0,5).forEach(a=>{a.content&&Te(a.id,a.content,F)})},[N,F,T,d.telegram_id,Te]),l.useEffect(()=>{c?.id&&nt(c.id,N,F)},[c?.id,N,F]),l.useEffect(()=>{if(!c)return;let t=window.visualViewport?.height??window.innerHeight;const s=()=>{const a=window.visualViewport?.height??window.innerHeight;a-t>50&&j.current&&(j.current.scrollTop=j.current.scrollHeight),t=a};return window.visualViewport?.addEventListener("resize",s),()=>window.visualViewport?.removeEventListener("resize",s)},[c]),l.useEffect(()=>{lt(),ot(),Se(c?.id??null);const t=Ct(d.telegram_id,s=>{z(a=>{const r=a.findIndex(n=>n.id===s.id);if(r>=0){const n=[...a];return n[r]=s,n.sort((o,x)=>new Date(x.last_message_at).getTime()-new Date(o.last_message_at).getTime()),n}else return[s,...a]})});return()=>t()},[d.telegram_id]),l.useEffect(()=>()=>{J.current.forEach(t=>URL.revokeObjectURL(t)),J.current.clear()},[]),l.useEffect(()=>{if(u&&$.length>0){const t=$.find(s=>s.id===u);t&&(P(t),w?.())}},[u,$]),l.useEffect(()=>{if(f?.(!!c),c){Se(c.id),Re(c.id),ze(c.id,d.telegram_id);const t=St(c.id,s=>{m(a=>{const r=s.client_message_id;if(r){const n=a.findIndex(o=>o._localId&&o._localId===r);if(n>=0){const o=[...a];return o[n]=s,o}}return a.some(n=>n.id===s.id)?a:[...a,s]}),requestAnimationFrame(()=>{j.current&&(j.current.scrollTop=j.current.scrollHeight)}),s.sender_id!==d.telegram_id&&ze(c.id,d.telegram_id)},(s,a)=>{m(r=>r.map(n=>n.id===s?{...n,...a}:n))});return()=>t()}return()=>{f?.(!1)}},[c]);const lt=async()=>{K(!0);const t=await Tt(d.telegram_id);z(t),K(!1)},Re=async t=>{ke(!1);const s=await Rt(t);if(m(s),s.length>0){const a=s.map(n=>n.id),r=await je(a);oe(r)}requestAnimationFrame(()=>{j.current&&(j.current.scrollTop=j.current.scrollHeight),requestAnimationFrame(()=>{ke(!0)})})},ot=async()=>{const t=await Mt();Je(t)},ge=async(t,s,a)=>{_e(r=>r+1);try{if(s.mediaType==="voice"){const r=await Ot(s.file,d.telegram_id,s.duration||0);if(r.error||!r.url)throw new Error(r.error||i("messages.errors.voiceUploadFailed"));const n=await Ae(a,d.telegram_id,r.url,"voice",void 0,t);if(n)E(t,n);else throw new Error(i("messages.errors.voiceUploadFailed"))}else{const r=await Vt(s.file,d.telegram_id);if(r.error||!r.url)throw new Error(r.error||i("messages.errors.mediaUploadFailed"));const n=await Ae(a,d.telegram_id,r.url,s.mediaType,void 0,t);if(n)E(t,n);else throw new Error(i("messages.errors.mediaUploadFailed"))}q.current.delete(t)}catch(r){console.error("[Chat] Media upload error:",r);const n=r instanceof Error?r.message:i("messages.errors.mediaUploadFailed");E(t,void 0,n),alert(n)}finally{_e(r=>Math.max(0,r-1))}},be=async()=>{if(Z.current||!_.trim()||!c||k)return;Z.current=!0;let t=_.trim();const s=`temp-text-${Date.now()}`,a=v?.id?.startsWith("temp-")?void 0:v?.id,r=v,n={id:s,_localId:s,_status:"sending",conversation_id:c.id,sender_id:d.telegram_id,content:t,message_type:"text",media_url:null,media_thumbnail:null,is_ppv:!1,ppv_price:0,ppv_unlocked_by:[],gift_id:null,tip_amount:null,is_read:!1,is_deleted:!1,created_at:new Date().toISOString(),client_message_id:s,reply_to_id:a,reply_to:r};H(""),le(null),pe.current&&(pe.current.style.height="40px"),S(!0),m(o=>[...o,n]),requestAnimationFrame(()=>{j.current&&(j.current.scrollTop=j.current.scrollHeight)});try{const o=await Le(c.id,d.telegram_id,t,s,a);o?(r&&!r.id.startsWith("temp-")&&(o.reply_to=r),E(s,o)):E(s,void 0,i("messages.errors.sendMessageFailed"))}catch(o){console.error("[Chat] Send message error:",o);const x=o instanceof Error?o.message:i("messages.errors.sendMessageFailed");E(s,void 0,x),alert(x)}finally{S(!1),Z.current=!1}},ct=async t=>{if(!c||k)return;S(!0);const{message:s,error:a}=await zt(c.id,d.telegram_id,t.id,t.price);a?alert(a):s&&m(r=>[...r,s]),y(!1),S(!1)},dt=async()=>{const t=parseFloat(I);if(!t||!c||k)return;S(!0);const{message:s,error:a}=await Dt(c.id,d.telegram_id,t);a?alert(a):s&&m(r=>[...r,s]),X(!1),re(""),S(!1)},xt=async t=>{const{success:s,error:a}=await Lt(t,d.telegram_id);a?alert(a):s&&Re(c.id)},ut=async t=>{const s=t.target.files;if(p(!1),!s?.length||!c){t.target.value="";return}for(const[a,r]of Array.from(s).entries()){const n=At(r);if(n==="unknown"||n==="audio"){alert(i("messages.errors.selectMedia"));continue}const o=`temp-media-${Date.now()}-${a}`,x=URL.createObjectURL(r);Ce(x);const G={id:o,_localId:o,_status:"uploading",preview_url:x,conversation_id:c.id,sender_id:d.telegram_id,content:null,message_type:n,media_url:x,media_thumbnail:null,is_ppv:!1,ppv_price:0,ppv_unlocked_by:[],gift_id:null,tip_amount:null,is_read:!1,is_deleted:!1,created_at:new Date().toISOString(),client_message_id:o};m(we=>[...we,G]),q.current.set(o,{file:r,mediaType:n}),ge(o,q.current.get(o),c.id)}t.target.value=""},mt=async(t,s)=>{if(!c)return;const a=`temp-voice-${Date.now()}`,r=URL.createObjectURL(t);Ce(r);const n={id:a,_localId:a,_status:"uploading",preview_url:r,conversation_id:c.id,sender_id:d.telegram_id,content:null,message_type:"voice",media_url:r,media_thumbnail:null,is_ppv:!1,ppv_price:0,ppv_unlocked_by:[],gift_id:null,tip_amount:null,is_read:!1,is_deleted:!1,created_at:new Date().toISOString(),client_message_id:a};m(o=>[...o,n]),q.current.set(a,{file:t,mediaType:"voice",duration:s}),ge(a,q.current.get(a),c.id)},pt=async t=>{if(!c||t._status!=="failed")return;const s=t._localId||t.id;if(t.message_type==="text"&&t.content){m(r=>r.map(n=>n._localId===s?{...n,_status:"sending",error:void 0,created_at:new Date().toISOString()}:n)),S(!0);try{const r=await Le(c.id,d.telegram_id,t.content,s);r?E(s,r):E(s,void 0,i("messages.errors.sendMessageFailed"))}catch(r){const n=r instanceof Error?r.message:i("messages.errors.sendMessageFailed");E(s,void 0,n),alert(n)}S(!1);return}const a=q.current.get(s);if(!a){alert(i("messages.errors.mediaMissing"));return}m(r=>r.map(n=>n._localId===s?{...n,_status:"uploading",error:void 0}:n)),ge(s,a,c.id)},ht=l.useCallback(t=>{ee.current=setTimeout(()=>{R(t),M(!0)},500)},[]),Me=l.useCallback(()=>{ee.current&&(clearTimeout(ee.current),ee.current=null)},[]),ft=l.useCallback(t=>{const s=Date.now();Q.current&&Q.current.messageId===t.id&&s-Q.current.time<300?(Fe(t.id,"â¤ï¸"),Q.current=null):Q.current={time:s,messageId:t.id}},[]),Fe=async(t,s)=>{const a=`${t}:${s}`;if(fe.current.has(a)){M(!1),R(null);return}if(t.startsWith("temp-")){M(!1),R(null);return}fe.current.add(a),M(!1),R(null);try{await Ft(t,d.telegram_id,s);const r=await je([t]);oe(n=>{const o=new Map(n);return o.set(t,r.get(t)||[]),o})}catch(r){console.error("[Reaction] Error:",r);try{const n=await je([t]);oe(o=>{const x=new Map(o);return x.set(t,n.get(t)||[]),x})}catch(n){console.error("[Reaction] Failed to refresh:",n)}}finally{fe.current.delete(a)}},gt=()=>{V&&(le(V),M(!1),R(null))},bt=async()=>{if(!V)return;const t=V.id;if(M(!1),R(null),t.startsWith("temp-")){m(s=>s.filter(a=>a.id!==t));return}m(s=>s.filter(a=>a.id!==t));try{await Pt(t,d.telegram_id)}catch(s){console.error("[Delete] Backend error:",s)}},wt=l.useCallback(t=>{const s=he.current.get(t);s&&(s.scrollIntoView({behavior:"instant",block:"center"}),s.classList.add("animate-pulse"),s.style.backgroundColor="rgba(59, 130, 246, 0.25)",s.style.borderRadius="16px",s.style.transition="background-color 0.3s ease-out",setTimeout(()=>{s.style.backgroundColor="rgba(59, 130, 246, 0.15)"},200),setTimeout(()=>{s.style.backgroundColor="rgba(59, 130, 246, 0.25)"},400),setTimeout(()=>{s.style.backgroundColor="rgba(59, 130, 246, 0.1)"},600),setTimeout(()=>{s.classList.remove("animate-pulse"),s.style.backgroundColor="",s.style.borderRadius=""},1500))},[]),Ee=t=>{const s=new Date(t),r=new Date().getTime()-s.getTime();return r<6e4?i("messages.time.now"):r<36e5?i("messages.time.minutes",{count:Math.floor(r/6e4)}):r<864e5?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s.toLocaleDateString([],{month:"short",day:"numeric"})},Ue=(()=>{let t=$.filter(s=>s.other_user?.username?.toLowerCase().includes(ne.toLowerCase())||s.other_user?.first_name?.toLowerCase().includes(ne.toLowerCase()));switch(Y){case"primary":return t.filter(s=>!s.is_request);case"general":return t.filter(s=>!s.is_request);case"requests":return t.filter(s=>s.is_request);default:return t}})(),yt=[{id:"primary",label:i("messages.categories.primary")},{id:"general",label:i("messages.categories.general")},{id:"requests",label:i("messages.categories.requests")}],jt=async(t,s)=>{t.stopPropagation(),(await qt(s.id,d.telegram_id)).success&&z(r=>r.map(n=>n.id===s.id?{...n,is_request:!1,pending_approval_from:null}:n))},vt=async(t,s)=>{t.stopPropagation(),(await Ht(s.id,d.telegram_id)).success&&(z(r=>r.filter(n=>n.id!==s.id)),c?.id===s.id&&P(null))},Nt=t=>e.jsxs("div",{className:"group w-full flex items-center gap-3 p-3 rounded-2xl transition-all duration-200",style:{background:t.is_request?"rgba(255, 200, 50, 0.05)":"rgba(255, 255, 255, 0.03)",border:t.is_request?"1px solid rgba(255, 200, 50, 0.15)":"1px solid rgba(255, 255, 255, 0.06)"},children:[e.jsxs("button",{className:"flex items-center gap-3 flex-1 min-w-0 active:scale-[0.98] transition-transform",onClick:()=>P(t),children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx("div",{className:"w-14 h-14 rounded-full overflow-hidden ring-2 ring-white/10",children:e.jsx("img",{src:t.other_user?.avatar_url||`https://i.pravatar.cc/150?u=${t.other_user?.telegram_id}`,alt:"",loading:"lazy",className:"w-full h-full object-cover"})}),(t.unread_count||0)>0&&e.jsx("div",{className:"absolute -top-1 -right-1 min-w-[20px] h-[20px] px-1.5 rounded-full flex items-center justify-center",style:{background:"linear-gradient(135deg, #FF3B30 0%, #FF2D55 100%)",boxShadow:"0 2px 8px rgba(255, 59, 48, 0.4)"},children:e.jsx("span",{className:"text-[11px] font-bold text-white leading-none",children:t.unread_count})})]}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col gap-1 text-left",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"font-semibold text-[15px] text-white truncate",children:t.other_user?.first_name||t.other_user?.username||i("messages.userFallback")}),t.other_user?.is_verified&&e.jsx(ve,{className:"w-4 h-4 text-blue-400 fill-blue-400/20"}),t.is_request&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-amber-500/20 text-amber-400 rounded-full font-medium",children:i("messages.request")})]}),e.jsx("span",{className:"text-[12px] text-white/40 font-medium whitespace-nowrap",children:Ee(t.last_message_at)})]}),e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsx("p",{className:`text-[14px] truncate leading-snug ${(t.unread_count||0)>0?"text-white/80 font-medium":"text-white/40"}`,children:t.last_message_preview||i("messages.lastMessageFallback")})})]})]}),e.jsxs("div",{className:"relative shrink-0",children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),D(ue===t.id?null:t.id)},className:"w-8 h-8 flex items-center justify-center hover:bg-white/10 rounded-full transition-colors",children:e.jsx(cs,{className:"w-5 h-5 text-white/60"})}),e.jsx(L,{children:ue===t.id&&e.jsxs(h.div,{initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-10},transition:{duration:.15},className:"absolute right-0 top-full mt-1 z-50 min-w-[180px] py-1.5 rounded-xl overflow-hidden",style:{background:"rgba(30, 30, 30, 0.98)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},children:[t.is_request&&e.jsxs("button",{onClick:s=>{jt(s,t),D(null)},className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-white/10 transition-colors text-left",children:[e.jsx(ve,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-[14px] text-white",children:i("messages.approve")})]}),e.jsxs("button",{onClick:s=>{s.stopPropagation(),D(null)},className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-white/10 transition-colors text-left",children:[e.jsx(is,{className:"w-4 h-4 text-white/70"}),e.jsx("span",{className:"text-[14px] text-white",children:i("messages.mute")})]}),e.jsxs("button",{onClick:s=>{s.stopPropagation(),D(null)},className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-white/10 transition-colors text-left",children:[e.jsx(es,{className:"w-4 h-4 text-white/70"}),e.jsx("span",{className:"text-[14px] text-white",children:i("messages.hide")})]}),e.jsxs("button",{onClick:s=>{s.stopPropagation(),D(null)},className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-white/10 transition-colors text-left",children:[e.jsx(ts,{className:"w-4 h-4 text-white/70"}),e.jsx("span",{className:"text-[14px] text-white",children:i("messages.block")})]}),e.jsxs("button",{onClick:s=>{s.stopPropagation(),D(null)},className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-white/10 transition-colors text-left",children:[e.jsx(ss,{className:"w-4 h-4 text-white/70"}),e.jsx("span",{className:"text-[14px] text-white",children:i("messages.report")})]}),e.jsx("div",{className:"h-px bg-white/10 my-1"}),e.jsxs("button",{onClick:s=>{vt(s,t),D(null)},className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-red-500/20 transition-colors text-left",children:[e.jsx(Oe,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"text-[14px] text-red-400",children:i("messages.delete")})]})]})})]})]},t.id);return c?e.jsxs("div",{ref:it,className:"fixed inset-0 z-[100] flex flex-col bg-[#050505]",style:{height:"100%",position:"fixed",top:0,left:0,right:0,bottom:0},children:[e.jsx(We,{}),e.jsx("input",{type:"file",ref:me,accept:"image/*,video/*",multiple:!0,className:"hidden",onChange:ut}),e.jsx("div",{className:"shrink-0 relative z-50",style:{background:"linear-gradient(to bottom, rgba(0,0,0,0.95) 0%, rgba(10,10,10,0.9) 100%)",paddingTop:"calc(env(safe-area-inset-top, 0px) + 44px)"},children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-white/10",children:[e.jsx("button",{onClick:()=>{P(null),f?.(!1)},className:"w-8 h-8 flex items-center justify-center hover:bg-white/10 rounded-full transition-all active:scale-95",children:e.jsx(Kt,{className:"w-4 h-4 text-white"})}),e.jsxs("button",{onClick:()=>{c.other_user&&g?.(c.other_user)},className:"flex items-center gap-3 flex-1 min-w-0 active:opacity-70 transition-opacity text-left",children:[e.jsx("div",{className:"relative shrink-0",children:e.jsx("img",{src:c.other_user?.avatar_url||`https://i.pravatar.cc/150?u=${c.other_user?.telegram_id}`,alt:"",loading:"lazy",className:"w-9 h-9 rounded-full object-cover ring-2 ring-white/10"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold text-[14px] text-white truncate",children:c.other_user?.first_name||c.other_user?.username}),c.other_user?.is_verified&&e.jsx(ve,{className:"w-3.5 h-3.5 text-blue-400 fill-blue-400/20"})]}),c.other_user?.username&&e.jsxs("p",{className:"text-[11px] text-white/50 font-medium",children:["@",c.other_user.username]})]})]}),e.jsx("button",{onClick:()=>xe(!0),className:`w-8 h-8 flex items-center justify-center rounded-full transition-all active:scale-95 ${N?"bg-blue-500/20 text-blue-400":"hover:bg-white/10 text-white/70"}`,children:e.jsx(He,{className:"w-4 h-4"})})]})}),e.jsxs("div",{ref:j,className:"flex-1 overflow-y-auto px-3 pt-3 overscroll-none relative z-10",style:{display:"flex",flexDirection:"column",overflowAnchor:"none",paddingBottom:"calc(90px + env(safe-area-inset-bottom, 0px))",opacity:tt?1:0},children:[e.jsx("div",{style:{flexGrow:1,minHeight:0}}),e.jsxs("div",{style:{overflowAnchor:"auto"},children:[T.map((t,s)=>{if(t._hidden)return null;const a=t.sender_id===d.telegram_id,r=t.is_ppv&&!t.ppv_unlocked_by?.includes(d.telegram_id)&&!a,n=!a&&(s===T.length-1||T[s+1]?.sender_id!==t.sender_id),o=t._status==="sending"||t._status==="uploading",x=t._status==="failed",G=t.media_url||t.preview_url||void 0,we=Ee(t.created_at),ye=et.get(t.id)||[],_t=()=>a?o?e.jsx(U,{className:"w-3 h-3 text-white/70 animate-spin"}):t.is_read?e.jsx(qe,{className:"w-3.5 h-3.5 text-blue-200"}):e.jsx(qe,{className:"w-3.5 h-3.5 text-white/50"}):null,te=t.message_type==="gift"||!!t.tip_amount;return e.jsxs("div",{ref:b=>{b?he.current.set(t.id,b):he.current.delete(t.id)},style:{marginBottom:ye.length>0?"16px":"4px"},className:`flex flex-col ${a?"items-end":"items-start"}`,children:[t.reply_to&&e.jsx("button",{onClick:b=>{b.stopPropagation(),wt(t.reply_to.id)},className:`flex items-start gap-2 text-xs px-3 py-2 rounded-xl mb-1.5 max-w-[85%] backdrop-blur-md ${a?"bg-blue-500/30 text-white ml-auto border-l-2 border-white/50":"bg-white/10 text-white border-l-2 border-slate-400"}`,children:e.jsxs("div",{className:"flex flex-col items-start min-w-0 flex-1",children:[e.jsx("span",{className:`text-[11px] font-semibold mb-0.5 ${a?"text-white/90":"text-slate-300"}`,children:t.reply_to.sender_id===d.telegram_id?i("messages.you"):c.other_user?.first_name||i("messages.userFallback")}),e.jsx("span",{className:`truncate w-full text-[13px] ${a?"text-white/80":"text-gray-300"}`,children:t.reply_to.content?t.reply_to.content.slice(0,50)+(t.reply_to.content.length>50?"...":""):t.reply_to.message_type==="image"?i("messages.typePhoto"):t.reply_to.message_type==="video"?i("messages.typeVideo"):t.reply_to.message_type==="voice"?i("messages.typeVoice"):t.reply_to.message_type==="gift"?i("messages.typeGift"):i("messages.typeMedia")})]})}),e.jsxs("div",{className:`flex items-end gap-2 w-full ${a?"justify-end":"justify-start"}`,children:[!a&&e.jsx("div",{className:"w-7 shrink-0 pb-0.5",children:n&&e.jsx("img",{src:c.other_user?.avatar_url||`https://i.pravatar.cc/150?u=${c.other_user?.telegram_id}`,alt:"",loading:"lazy",className:"w-7 h-7 rounded-full object-cover"})}),e.jsxs("div",{className:`relative max-w-[75%] ${te||t.message_type==="image"||t.message_type==="video"?"p-0 bg-transparent":a?"px-3.5 py-2 text-white rounded-[18px] rounded-br-[4px]":"px-3.5 py-2 text-white rounded-[18px] rounded-bl-[4px]"} ${x?"ring-2 ring-red-500/50":""}`,style:{userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",minHeight:t.message_type==="text"&&!te?"36px":void 0,...t.message_type==="text"&&!te?{background:a?"linear-gradient(135deg, #0A84FF 0%, #0066CC 100%)":"linear-gradient(135deg, #2C2C2E 0%, #1C1C1E 100%)",boxShadow:a?"0 1px 8px rgba(10, 132, 255, 0.25)":"0 1px 6px rgba(0, 0, 0, 0.25)"}:{}},onTouchStart:()=>ht(t),onTouchEnd:Me,onTouchCancel:Me,onContextMenu:b=>b.preventDefault(),onClick:()=>ft(t),children:[o&&t.message_type!=="text"&&e.jsx("div",{className:"absolute inset-0 rounded-2xl bg-black/40 flex items-center justify-center z-10",children:e.jsx(U,{className:"w-8 h-8 text-white animate-spin"})}),t.message_type==="gift"&&t.gift&&e.jsxs("div",{className:"text-center relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-pink-500/30 to-purple-500/30 blur-xl rounded-full"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx(h.div,{animate:{rotate:[0,5,-5,0],scale:[1,1.05,1]},transition:{duration:2,repeat:1/0,repeatDelay:3},className:"w-20 h-20 mb-2 drop-shadow-2xl",children:e.jsx("img",{src:"/gift-box-3d.png",onError:b=>b.currentTarget.src="https://cdn-icons-png.flaticon.com/512/4213/4213958.png",className:"w-full h-full object-contain",alt:"gift"})}),e.jsx("p",{className:"font-bold text-white text-lg drop-shadow-md",children:t.gift.name}),e.jsxs("p",{className:"text-sm text-pink-300 font-medium drop-shadow-md",children:[t.gift.price," ",i("messages.tokensLabel")]})]})]}),t.tip_amount&&e.jsxs("div",{className:"text-center relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-green-500/30 to-emerald-500/30 blur-xl rounded-full"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-emerald-400 to-green-600 rounded-full flex items-center justify-center shadow-lg mb-2 border-2 border-white/20",children:e.jsx(Pe,{className:"w-8 h-8 text-white",strokeWidth:3})}),e.jsxs("p",{className:"font-bold text-white text-lg drop-shadow-md",children:["$",t.tip_amount.toFixed(2)]}),e.jsx("p",{className:"text-sm text-emerald-300 font-medium drop-shadow-md",children:i("messages.tipSent")})]})]}),t.message_type==="voice"&&e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 rounded-2xl min-w-[200px]",style:{background:a?"linear-gradient(135deg, #0A84FF 0%, #0066CC 100%)":"linear-gradient(135deg, #2C2C2E 0%, #1C1C1E 100%)",boxShadow:a?"0 2px 12px rgba(10, 132, 255, 0.3)":"0 2px 8px rgba(0, 0, 0, 0.3)"},children:[o?e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:"rgba(255, 255, 255, 0.15)"},children:e.jsx(U,{className:"w-5 h-5 animate-spin text-white"})}):e.jsx("button",{className:"w-10 h-10 rounded-full flex items-center justify-center active:scale-90 transition-transform",style:{background:"rgba(255, 255, 255, 0.2)"},onClick:b=>{b.stopPropagation(),new Audio(G).play().catch($e=>console.error("Failed to play voice",$e))},children:e.jsx(Jt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-0.5 h-6",children:Array.from({length:20}).map((b,W)=>{const kt=20+((t.id.charCodeAt(W%t.id.length)||0)+W*7)%80;return e.jsx("div",{className:"w-1 rounded-full",style:{height:`${kt}%`,minHeight:"4px",background:"rgba(255, 255, 255, 0.6)"}},W)})}),e.jsx("p",{className:"text-[11px] mt-1 text-white/60 font-medium",children:i("messages.typeVoice")})]})]}),(t.message_type==="image"||t.message_type==="video")&&G&&e.jsxs("div",{className:"relative overflow-hidden max-w-[75vw]",style:{borderRadius:"20px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)"},children:[t.message_type==="image"?e.jsx("img",{src:G,alt:"",className:"w-full h-auto max-h-[60vh] object-cover",loading:"lazy",style:{display:"block"}}):e.jsx(bs,{src:G,controls:!0,playsInline:!0,loop:!0,muted:!a,className:"max-h-[60vh] max-w-[75vw] object-contain",containerClassName:"max-h-[60vh] max-w-[75vw]",style:{background:"#000",display:"block"}}),o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{background:"rgba(0, 0, 0, 0.5)"},children:e.jsx(U,{className:"w-10 h-10 text-white animate-spin"})})]}),r&&e.jsxs("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-md rounded-3xl flex flex-col items-center justify-center text-white text-center p-4",children:[e.jsx(Qt,{className:"w-8 h-8 mb-3 text-white/80"}),e.jsx("p",{className:"font-bold mb-1 text-lg",children:i("messages.lockedTitle")}),e.jsxs("p",{className:"text-sm text-white/70 mb-4",children:[t.ppv_price," ",i("messages.tokensLabel")]}),e.jsx("button",{onClick:()=>xt(t.id),className:"px-6 py-2.5 bg-white text-black rounded-full font-bold text-sm active:scale-95 transition-transform",children:i("messages.unlock")})]}),t.message_type==="text"&&t.content&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-[15px] leading-snug whitespace-pre-wrap break-words",style:{wordBreak:"break-word"},children:N&&!a&&t._translatedContent?t._translatedContent:t.content}),!a&&N&&e.jsxs("div",{className:"mt-1 flex items-center gap-1",children:[t._isTranslating&&e.jsxs("span",{className:"text-[10px] text-white/40 flex items-center gap-1",children:[e.jsx(U,{className:"w-2.5 h-2.5 animate-spin"}),i("messages.translation.statusTranslating")]}),t._translatedContent&&e.jsx("span",{className:"text-[10px] text-blue-400/70",children:i("messages.translation.statusTranslated",{lang:F.toUpperCase()})}),t._translationError&&e.jsx("span",{className:"text-[10px] text-red-400/70",children:i("messages.translation.statusFailed")})]})]}),x&&e.jsxs("div",{className:"mt-1 text-xs text-red-200 flex items-center gap-1",children:[e.jsx(De,{className:"w-3 h-3"}),e.jsx("span",{children:i("messages.errors.sendFailed")})]}),ye.length>0&&e.jsx("div",{className:"absolute -bottom-2.5 right-1 flex items-center gap-0.5 bg-[#1c1c1e] rounded-full shadow-lg px-1.5 py-0.5 border border-white/10 z-20",children:ye.map((b,W)=>e.jsx("span",{className:"text-xs leading-none",children:b.emoji},`${b.emoji}-${W}`))})]}),x&&e.jsxs("button",{onClick:()=>pt(t),className:"flex items-center gap-1 text-xs text-red-500 hover:underline",children:[e.jsx(De,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:i("messages.retry")})]})]}),!te&&e.jsxs("div",{className:`flex items-center gap-1.5 mt-1.5 ${a?"justify-end mr-1":"justify-start ml-9"}`,children:[e.jsx("span",{className:"text-[11px] text-white/40 font-medium",children:we}),a&&_t()]})]},t.id)}),e.jsx("div",{ref:at})]})]}),e.jsx(L,{children:Ze&&V&&e.jsxs(e.Fragment,{children:[e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[200]",style:{background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(8px)"},onClick:()=>{M(!1),R(null)}}),e.jsxs(h.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},transition:{type:"spring",damping:25,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-[201] safe-area-bottom overflow-hidden",style:{background:"linear-gradient(to bottom, rgba(40, 40, 40, 0.98) 0%, rgba(30, 30, 30, 0.98) 100%)",borderTopLeftRadius:"24px",borderTopRightRadius:"24px",boxShadow:"0 -4px 30px rgba(0, 0, 0, 0.5)",userSelect:"none",WebkitUserSelect:"none"},onContextMenu:t=>t.preventDefault(),children:[e.jsx("div",{className:"flex justify-center py-3",children:e.jsx("div",{className:"w-10 h-1 rounded-full bg-white/20"})}),e.jsx("div",{className:"flex justify-center gap-2 px-4 pb-4",children:ws.map(t=>e.jsx(h.button,{whileTap:{scale:.85},onClick:()=>Fe(V.id,t),onContextMenu:s=>s.preventDefault(),className:"w-12 h-12 rounded-full flex items-center justify-center text-2xl",style:{background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.1)",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none"},children:t},t))}),e.jsx("div",{className:"mx-4 h-px bg-white/10"}),e.jsxs("div",{className:"py-2",children:[e.jsxs("button",{onClick:gt,onContextMenu:t=>t.preventDefault(),className:"w-full flex items-center gap-4 px-5 py-4 active:bg-white/5 transition-colors",style:{userSelect:"none",WebkitUserSelect:"none"},children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center",children:e.jsx(ls,{className:"w-5 h-5 text-blue-400"})}),e.jsx("span",{className:"font-medium text-white text-[16px]",children:i("messages.actions.reply")})]}),e.jsxs("button",{onClick:()=>{M(!1),R(null)},onContextMenu:t=>t.preventDefault(),className:"w-full flex items-center gap-4 px-5 py-4 active:bg-white/5 transition-colors",style:{userSelect:"none",WebkitUserSelect:"none"},children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center",children:e.jsx(xs,{className:"w-5 h-5 text-purple-400"})}),e.jsx("span",{className:"font-medium text-white text-[16px]",children:i("messages.actions.forward")})]}),V.sender_id===d.telegram_id&&e.jsxs("button",{onClick:bt,onContextMenu:t=>t.preventDefault(),className:"w-full flex items-center gap-4 px-5 py-4 active:bg-white/5 transition-colors",style:{userSelect:"none",WebkitUserSelect:"none"},children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx(Oe,{className:"w-5 h-5 text-red-400"})}),e.jsx("span",{className:"font-medium text-red-400 text-[16px]",children:i("messages.actions.delete")})]})]}),e.jsx("div",{className:"px-4 pb-6 pt-2",children:e.jsx("button",{onClick:()=>{M(!1),R(null)},onContextMenu:t=>t.preventDefault(),className:"w-full py-4 rounded-2xl font-semibold text-white text-[16px] active:scale-[0.98] transition-transform",style:{background:"rgba(255, 255, 255, 0.1)",userSelect:"none",WebkitUserSelect:"none"},children:i("messages.actions.cancel")})})]})]})}),e.jsx(L,{children:st&&e.jsxs(e.Fragment,{children:[e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[200]",style:{background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(8px)"},onClick:()=>xe(!1)}),e.jsxs(h.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},transition:{type:"spring",damping:25,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-[201] safe-area-bottom overflow-hidden",style:{background:"linear-gradient(to bottom, rgba(28, 28, 30, 0.98) 0%, rgba(18, 18, 20, 0.98) 100%)",borderTopLeftRadius:"24px",borderTopRightRadius:"24px",boxShadow:"0 -4px 30px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{className:"flex justify-center py-3",children:e.jsx("div",{className:"w-10 h-1 rounded-full bg-white/20"})}),e.jsx("div",{className:"px-5 pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-blue-500/20 to-purple-500/20 flex items-center justify-center",children:e.jsx(He,{className:"w-6 h-6 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:i("messages.translation.title")}),e.jsx("p",{className:"text-xs text-white/50",children:i("messages.translation.subtitle")})]})]})}),e.jsx("div",{className:"mx-5 h-px bg-white/10"}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl",style:{background:"rgba(255, 255, 255, 0.05)"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ie,{className:`w-5 h-5 ${N?"text-blue-400":"text-white/40"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white text-[15px]",children:i("messages.translation.autoTitle")}),e.jsx("p",{className:"text-xs text-white/40",children:i("messages.translation.autoSubtitle")})]})]}),e.jsx("button",{onClick:()=>ce(!N),className:`w-12 h-7 rounded-full transition-all duration-200 relative ${N?"bg-blue-500":"bg-white/20"}`,children:e.jsx("div",{className:`absolute top-1 w-5 h-5 rounded-full bg-white shadow transition-all duration-200 ${N?"left-6":"left-1"}`})})]}),e.jsxs("div",{className:"p-4 rounded-2xl",style:{background:"rgba(255, 255, 255, 0.05)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Xt,{className:"w-5 h-5 text-white/40"}),e.jsx("p",{className:"font-medium text-white text-[15px]",children:i("messages.translation.translateTo")})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-64 overflow-y-auto",children:[{code:"en",name:"English",flag:"ðŸ‡¬ðŸ‡§"},{code:"es",name:"Spanish",flag:"ðŸ‡ªðŸ‡¸"},{code:"ru",name:"Russian",flag:"ðŸ‡·ðŸ‡º"},{code:"fr",name:"French",flag:"ðŸ‡«ðŸ‡·"},{code:"de",name:"German",flag:"ðŸ‡©ðŸ‡ª"},{code:"tr",name:"Turkish",flag:"ðŸ‡¹ðŸ‡·"},{code:"bg",name:"Bulgarian",flag:"ðŸ‡§ðŸ‡¬"},{code:"zh",name:"Chinese",flag:"ðŸ‡¨ðŸ‡³"},{code:"ja",name:"Japanese",flag:"ðŸ‡¯ðŸ‡µ"},{code:"ko",name:"Korean",flag:"ðŸ‡°ðŸ‡·"},{code:"pt",name:"Portuguese",flag:"ðŸ‡µðŸ‡¹"},{code:"it",name:"Italian",flag:"ðŸ‡®ðŸ‡¹"},{code:"ar",name:"Arabic",flag:"ðŸ‡¸ðŸ‡¦"},{code:"hi",name:"Hindi",flag:"ðŸ‡®ðŸ‡³"},{code:"nl",name:"Dutch",flag:"ðŸ‡³ðŸ‡±"},{code:"pl",name:"Polish",flag:"ðŸ‡µðŸ‡±"},{code:"uk",name:"Ukrainian",flag:"ðŸ‡ºðŸ‡¦"},{code:"cs",name:"Czech",flag:"ðŸ‡¨ðŸ‡¿"},{code:"sv",name:"Swedish",flag:"ðŸ‡¸ðŸ‡ª"},{code:"da",name:"Danish",flag:"ðŸ‡©ðŸ‡°"},{code:"fi",name:"Finnish",flag:"ðŸ‡«ðŸ‡®"},{code:"no",name:"Norwegian",flag:"ðŸ‡³ðŸ‡´"},{code:"el",name:"Greek",flag:"ðŸ‡¬ðŸ‡·"},{code:"he",name:"Hebrew",flag:"ðŸ‡®ðŸ‡±"},{code:"th",name:"Thai",flag:"ðŸ‡¹ðŸ‡­"},{code:"vi",name:"Vietnamese",flag:"ðŸ‡»ðŸ‡³"},{code:"id",name:"Indonesian",flag:"ðŸ‡®ðŸ‡©"},{code:"ms",name:"Malay",flag:"ðŸ‡²ðŸ‡¾"},{code:"ro",name:"Romanian",flag:"ðŸ‡·ðŸ‡´"},{code:"hu",name:"Hungarian",flag:"ðŸ‡­ðŸ‡º"},{code:"sk",name:"Slovak",flag:"ðŸ‡¸ðŸ‡°"},{code:"hr",name:"Croatian",flag:"ðŸ‡­ðŸ‡·"},{code:"sr",name:"Serbian",flag:"ðŸ‡·ðŸ‡¸"},{code:"sl",name:"Slovenian",flag:"ðŸ‡¸ðŸ‡®"}].map(t=>e.jsxs("button",{onClick:()=>de(t.code),className:`flex items-center gap-2 p-3 rounded-xl transition-all ${F===t.code?"bg-blue-500/20 border border-blue-500/50":"bg-white/5 border border-transparent"}`,children:[e.jsx("span",{className:"text-lg",children:t.flag}),e.jsx("span",{className:`text-sm font-medium ${F===t.code?"text-blue-400":"text-white/70"}`,children:t.code.toUpperCase()})]},t.code))})]}),N&&e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-xl bg-blue-500/10 border border-blue-500/20",children:[e.jsx(Ie,{className:"w-4 h-4 text-blue-400 shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-blue-300/80",children:i("messages.translation.info",{name:c?.other_user?.first_name||i("messages.thisUserFallback"),lang:F.toUpperCase()})})]})]}),e.jsx("div",{className:"p-5 pt-0",children:e.jsx("button",{onClick:()=>xe(!1),className:"w-full py-4 rounded-2xl font-semibold text-white text-[16px] active:scale-[0.98] transition-transform",style:{background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)"},children:i("messages.translation.done")})})]})]})}),e.jsx(L,{children:O&&e.jsxs(e.Fragment,{children:[e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[101]",onClick:()=>p(!1)}),e.jsxs(h.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"absolute bottom-20 left-3 z-[102] flex flex-col gap-1 w-52 p-2",style:{background:"linear-gradient(135deg, rgba(40, 40, 40, 0.95) 0%, rgba(30, 30, 30, 0.95) 100%)",borderRadius:"20px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)"},children:[e.jsxs("button",{onClick:()=>{me.current?.click(),p(!1)},className:"flex items-center gap-3 px-3 py-3 rounded-2xl transition-colors w-full text-left active:bg-white/10",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:"rgba(59, 130, 246, 0.2)"},children:e.jsx(Yt,{className:"w-5 h-5 text-blue-400"})}),e.jsx("span",{className:"font-medium text-white text-[15px]",children:i("messages.actions.photo")})]}),e.jsxs("button",{onClick:()=>{me.current?.click(),p(!1)},className:"flex items-center gap-3 px-3 py-3 rounded-2xl transition-colors w-full text-left active:bg-white/10",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:"rgba(168, 85, 247, 0.2)"},children:e.jsx(Zt,{className:"w-5 h-5 text-purple-400"})}),e.jsx("span",{className:"font-medium text-white text-[15px]",children:i("messages.actions.video")})]}),e.jsxs("button",{onClick:()=>{y(!0),p(!1)},className:"flex items-center gap-3 px-3 py-3 rounded-2xl transition-colors w-full text-left active:bg-white/10",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:"rgba(236, 72, 153, 0.2)"},children:e.jsx(Ve,{className:"w-5 h-5 text-pink-400"})}),e.jsx("span",{className:"font-medium text-white text-[15px]",children:i("messages.actions.gift")})]}),e.jsxs("button",{onClick:()=>{X(!0),p(!1)},className:"flex items-center gap-3 px-3 py-3 rounded-2xl transition-colors w-full text-left active:bg-white/10",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{background:"rgba(34, 197, 94, 0.2)"},children:e.jsx(Pe,{className:"w-5 h-5 text-green-400"})}),e.jsx("span",{className:"font-medium text-white text-[15px]",children:i("messages.actions.tip")})]})]})]})}),e.jsx(L,{children:C&&e.jsxs(e.Fragment,{children:[e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[149]",style:{background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(8px)"},onClick:()=>y(!1)}),e.jsxs(h.div,{initial:{opacity:0,y:"100%"},animate:{opacity:1,y:0},exit:{opacity:0,y:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed bottom-0 left-0 right-0 z-[150] max-h-[70vh] overflow-hidden flex flex-col",style:{background:"linear-gradient(to bottom, rgba(35, 35, 35, 0.98) 0%, rgba(25, 25, 25, 0.98) 100%)",borderTopLeftRadius:"28px",borderTopRightRadius:"28px",boxShadow:"0 -4px 30px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{className:"flex justify-center py-3",children:e.jsx("div",{className:"w-10 h-1 rounded-full bg-white/20"})}),e.jsxs("div",{className:"px-6 pb-4 flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-white text-xl",children:i("messages.gift.title")}),e.jsx("button",{onClick:()=>y(!1),className:"w-10 h-10 rounded-full flex items-center justify-center active:scale-90 transition-transform",style:{background:"rgba(255, 255, 255, 0.1)"},children:e.jsx(se,{className:"w-5 h-5 text-white/70"})})]}),e.jsx("div",{className:"px-4 pb-8 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Ke.map(t=>e.jsxs(h.button,{whileTap:{scale:.95},onClick:()=>ct(t),className:"flex flex-col items-center p-4 rounded-2xl transition-all active:opacity-80",style:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.08)"},children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center mb-2",style:{background:"linear-gradient(135deg, rgba(236, 72, 153, 0.3) 0%, rgba(168, 85, 247, 0.3) 100%)"},children:e.jsx(Ve,{className:"w-7 h-7 text-pink-400"})}),e.jsx("span",{className:"text-sm font-semibold text-white mb-1",children:t.name}),e.jsxs("span",{className:"text-xs font-medium text-pink-400 px-2 py-0.5 rounded-full",style:{background:"rgba(236, 72, 153, 0.2)"},children:[t.price," ",i("messages.tokensLabel")]})]},t.id))})})]})]})}),e.jsx(L,{children:ie&&e.jsxs(e.Fragment,{children:[e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[149]",style:{background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(8px)"},onClick:()=>X(!1)}),e.jsxs(h.div,{initial:{opacity:0,y:"100%"},animate:{opacity:1,y:0},exit:{opacity:0,y:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed bottom-0 left-0 right-0 z-[150] p-6",style:{background:"linear-gradient(to bottom, rgba(35, 35, 35, 0.98) 0%, rgba(25, 25, 25, 0.98) 100%)",borderTopLeftRadius:"28px",borderTopRightRadius:"28px",boxShadow:"0 -4px 30px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{className:"flex justify-center pb-4 -mt-2",children:e.jsx("div",{className:"w-10 h-1 rounded-full bg-white/20"})}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-bold text-white text-xl",children:i("messages.tip.title")}),e.jsx("button",{onClick:()=>X(!1),className:"w-10 h-10 rounded-full flex items-center justify-center active:scale-90 transition-transform",style:{background:"rgba(255, 255, 255, 0.1)"},children:e.jsx(se,{className:"w-5 h-5 text-white/70"})})]}),e.jsx("div",{className:"flex gap-3 mb-5",children:[5,10,25,50].map(t=>e.jsxs(h.button,{whileTap:{scale:.95},onClick:()=>re(String(t)),className:"flex-1 py-3.5 rounded-xl font-bold text-[16px] transition-all",style:{background:I===String(t)?"linear-gradient(135deg, #22C55E 0%, #16A34A 100%)":"rgba(255, 255, 255, 0.08)",color:I===String(t)?"#fff":"rgba(255, 255, 255, 0.7)",boxShadow:I===String(t)?"0 4px 15px rgba(34, 197, 94, 0.3)":"none"},children:["$",t]},t))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/50 font-bold text-lg",children:"$"}),e.jsx("input",{type:"number",value:I,onChange:t=>re(t.target.value),placeholder:i("messages.tip.customPlaceholder"),className:"w-full pl-9 pr-4 py-4 rounded-xl font-semibold text-white text-lg focus:outline-none placeholder:text-white/40",style:{background:"rgba(255, 255, 255, 0.08)",border:"1px solid rgba(255, 255, 255, 0.1)"}})]}),e.jsx(h.button,{whileTap:{scale:.95},onClick:dt,disabled:!I||k,className:"px-8 py-4 rounded-xl font-bold text-lg text-white disabled:opacity-50 transition-all",style:{background:"linear-gradient(135deg, #22C55E 0%, #16A34A 100%)",boxShadow:"0 4px 15px rgba(34, 197, 94, 0.3)"},children:k?e.jsx(U,{className:"w-6 h-6 animate-spin"}):i("messages.tip.send")})]})]})]})}),e.jsxs("div",{className:"fixed left-0 right-0 z-20",style:{bottom:0,paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 8px)",background:"linear-gradient(to top, rgba(5,5,5,0.98) 0%, rgba(5,5,5,0.95) 100%)",borderTop:"1px solid rgba(255,255,255,0.06)"},children:[e.jsx(L,{children:v&&e.jsxs(h.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"px-3 py-2 flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 min-w-0 flex items-center gap-3 px-3 py-2 rounded-xl",style:{background:"rgba(59, 130, 246, 0.15)",borderLeft:"3px solid #3B82F6"},children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold text-blue-400 mb-0.5",children:i("messages.replyingTo",{name:v.sender_id===d.telegram_id?i("messages.replySelf"):c?.other_user?.first_name||i("messages.userFallback")})}),e.jsx("p",{className:"text-sm text-white/60 truncate",children:v.content?v.content.slice(0,60)+(v.content.length>60?"...":""):v.message_type==="image"?i("messages.typePhoto"):v.message_type==="video"?i("messages.typeVideo"):v.message_type==="voice"?i("messages.typeVoice"):v.message_type==="gift"?i("messages.typeGift"):i("messages.typeMedia")})]})}),e.jsx("button",{onClick:()=>le(null),className:"w-8 h-8 flex items-center justify-center rounded-full transition-all active:scale-90",style:{background:"rgba(255, 255, 255, 0.1)"},children:e.jsx(se,{className:"w-4 h-4 text-white/60"})})]})}),e.jsx("div",{style:{paddingTop:"10px",paddingLeft:"12px",paddingRight:"12px"},children:e.jsxs("div",{className:"flex items-end gap-2",style:{background:"rgba(28, 28, 30, 0.95)",borderRadius:"22px",padding:"5px",border:"1px solid rgba(255, 255, 255, 0.1)",minHeight:"52px"},children:[e.jsxs("button",{onClick:()=>p(!O),className:"relative w-10 h-10 rounded-full flex items-center justify-center transition-all shrink-0 active:scale-90",style:{background:O?"#fff":"rgba(255, 255, 255, 0.1)",transform:O?"rotate(45deg)":"rotate(0deg)",transition:"all 0.2s ease"},children:[e.jsx(Et,{className:`w-5 h-5 ${O?"text-black":"text-white"}`}),Xe>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-3 h-3 rounded-full bg-blue-500 border-2 border-[#1e1e1e] animate-pulse"})]}),e.jsx("div",{className:"flex-1 flex items-center",children:e.jsx("textarea",{value:_,onChange:t=>H(t.target.value),onKeyPress:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),be())},ref:pe,placeholder:i("messages.placeholder"),rows:1,className:"w-full px-2 py-2 bg-transparent text-[16px] focus:outline-none text-white placeholder:text-white/40 resize-none overflow-y-auto",style:{minHeight:"40px",maxHeight:"100px",lineHeight:"1.4"},onInput:t=>{const s=t.target;s.style.height="40px",s.style.height=Math.min(s.scrollHeight,100)+"px"}})}),e.jsx("div",{className:"shrink-0 flex items-center justify-center",children:_.trim()?e.jsx(h.button,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},onTouchStart:t=>{t.preventDefault(),t.stopPropagation(),be()},onMouseDown:t=>{t.preventDefault(),be()},disabled:k||Z.current,className:"w-10 h-10 rounded-full text-white flex items-center justify-center disabled:opacity-50 active:scale-90 transition-transform touch-none",style:{background:"linear-gradient(135deg, #0A84FF 0%, #0066CC 100%)",boxShadow:"0 2px 12px rgba(10, 132, 255, 0.4)"},children:k?e.jsx(U,{className:"w-5 h-5 animate-spin"}):e.jsx(Be,{className:"w-5 h-5"})}):e.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:e.jsx(fs,{onSend:mt,disabled:k})})})]})})]})]}):e.jsxs("div",{className:"min-h-screen text-white relative pb-20",onClick:()=>ue&&D(null),children:[e.jsx(We,{}),e.jsxs("div",{className:"relative",style:{zIndex:1},children:[e.jsxs("div",{className:"sticky top-0 z-40 px-4 pt-4 pb-4",style:{background:"linear-gradient(to bottom, rgba(10, 10, 10, 0.98) 0%, rgba(10, 10, 10, 0.95) 100%)",backdropFilter:"blur(20px)"},children:[e.jsx("div",{className:"flex items-start justify-between gap-3 mb-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:i("messages.title")}),e.jsx("p",{className:"text-xs text-white/50",children:i("messages.subtitle")})]})}),e.jsx("div",{className:"flex gap-2 mb-4",children:yt.map(t=>e.jsx("button",{onClick:()=>Ye(t.id),className:"px-4 py-2 rounded-full text-sm font-semibold transition-all active:scale-95",style:{background:Y===t.id?"linear-gradient(135deg, #fff 0%, #f0f0f0 100%)":"rgba(255, 255, 255, 0.08)",color:Y===t.id?"#000":"rgba(255, 255, 255, 0.7)",boxShadow:Y===t.id?"0 2px 8px rgba(255, 255, 255, 0.1)":"none"},children:t.label},t.id))}),e.jsxs("div",{className:"relative",children:[e.jsx(Ut,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-white/40"}),e.jsx("input",{type:"text",value:ne,onChange:t=>Qe(t.target.value),placeholder:i("messages.search"),className:"w-full pl-12 pr-4 py-3.5 rounded-2xl text-[15px] text-white focus:outline-none transition-all placeholder:text-white/40",style:{background:"rgba(255, 255, 255, 0.06)",border:"1px solid rgba(255, 255, 255, 0.08)"}})]})]}),e.jsx("div",{className:"px-4 py-2 pb-24",children:ae?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"w-16 h-16 mx-auto rounded-full flex items-center justify-center mb-4",style:{background:"rgba(59, 130, 246, 0.15)"},children:e.jsx(U,{className:"w-8 h-8 animate-spin text-blue-400"})}),e.jsx("p",{className:"text-white/40 text-sm font-medium",children:i("messages.loading")})]}):Ue.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-full flex items-center justify-center mb-5",style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%)",border:"1px solid rgba(255, 255, 255, 0.08)"},children:e.jsx($t,{className:"w-10 h-10 text-white/30"})}),e.jsx("p",{className:"font-semibold text-white text-lg mb-2",children:i("messages.emptyTitle")}),e.jsx("p",{className:"text-sm text-white/40",children:i("messages.emptySubtitle")})]}):e.jsx("div",{className:"space-y-2",children:Ue.map(t=>Nt(t))})})]})]})}export{As as default};
