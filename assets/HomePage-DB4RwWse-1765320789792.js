import{c as Z,j as e,A as $,m as N,X as me,C as B,s as Oe,r,a as $e,g as Ae,b as He,d as ze,e as Ue,l as Be,u as We,f as Xe,h as qe,i as Ye,v as Qe}from"./index-C4ggKbPK-1765320789792.js";import{C as Ge,P as Je,a as Ke,b as Ze,c as et,d as tt,V as st}from"./CommentsSheet-BHlxhbg4-1765320789792.js";import{P as at,u as lt}from"./PostDetail-E_i52sLE-1765320789792.js";import{s as it,g as rt}from"./livestreamApi-BXhKO-J--1765320789792.js";import{u as nt}from"./useInViewport-Bq3PY-M2-1765320789792.js";import{g as ct,S as ot}from"./storyApi-DRgQSEc_-1765320789792.js";import{u as dt}from"./useTranslation-BTGHT6Fs-1765320789792.js";import{U as mt}from"./users-BJisSbRE-1765320789792.js";import{S as U}from"./star-k5gxYjVb-1765320789792.js";import{E as ut}from"./ellipsis-D_rUKxl0-1765320789792.js";import{P as xt,F as ft}from"./pen-line-CoeLSg6--1765320789792.js";import{T as ht}from"./trash-2-BzSzMYZa-1765320789792.js";import{L as bt}from"./lock-Cz0dMjQv-1765320789792.js";import{E as pt}from"./eye-B6w-xk1l-1765320789792.js";import{C as gt}from"./check-DxO9epBj-1765320789792.js";import{C as wt}from"./chart-column-lZabNSLh-1765320789792.js";import{M as vt}from"./message-circle-question-mark-CZq0jNpE-1765320789792.js";import{H as jt}from"./heart-APT-IL-D-1765320789792.js";import{P as yt}from"./play-C2_EoN6X-1765320789792.js";import{V as Nt}from"./volume-2-f67fxukj-1765320789792.js";import{I as _t}from"./image-C_nc9Wjk-1765320789792.js";import"./loader-circle-8J5sQkuc-1765320789792.js";import"./arrow-left-DpOAHz6N-1765320789792.js";import"./chevron-right-rUAS60Ro-1765320789792.js";const kt=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],St=Z("copy",kt);const Pt=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ct=Z("eye-off",Pt);const Mt=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Et=Z("user-x",Mt);function Lt({isOpen:o,onClose:m,title:h,users:f,loading:g,onUserClick:s}){return e.jsx($,{mode:"sync",children:o&&e.jsxs(e.Fragment,{children:[e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeOut"},className:"fixed inset-0 bg-black/70 z-[9998]",onClick:m}),e.jsx(N.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"tween",duration:.3,ease:[.32,.72,0,1]},className:"fixed bottom-0 left-0 right-0 z-[9999] will-change-transform",style:{height:"55%"},children:e.jsxs("div",{className:"h-full bg-[#262626] rounded-t-[12px] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-9 h-1 bg-[#555] rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-[#363636]",children:[e.jsx("h3",{className:"text-base font-semibold text-white",children:h}),e.jsx("button",{onClick:m,className:"p-1.5 rounded-full bg-[#363636] active:bg-[#444]",children:e.jsx(me,{className:"w-4 h-4 text-gray-400"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-[#262626]",children:g?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx("div",{className:"w-6 h-6 border-2 border-gray-600 border-t-white rounded-full animate-spin"})}):f.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center py-10 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No one yet"})}):e.jsx("div",{className:"py-1",children:f.map(d=>e.jsxs("button",{onClick:()=>s?.(d),className:"w-full flex items-center gap-3 px-4 py-3 active:bg-white/5",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("img",{src:d.avatar_url||`https://i.pravatar.cc/150?u=${d.telegram_id}`,alt:"",className:"w-11 h-11 rounded-full object-cover bg-[#333]"}),d.is_verified&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 bg-[#262626] rounded-full p-0.5",children:e.jsx(B,{className:"w-3.5 h-3.5 text-[#0095f6] fill-[#0095f6]"})})]}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("span",{className:"font-semibold text-[15px] text-white truncate block",children:d.username||d.first_name||"User"}),d.first_name&&d.username&&e.jsxs("p",{className:"text-[13px] text-gray-500 truncate",children:[d.first_name," ",d.last_name||""]})]}),d.is_creator&&e.jsx("span",{className:"text-[11px] font-semibold text-[#0095f6] bg-[#0095f6]/10 px-2.5 py-1 rounded-full",children:"Creator"})]},d.telegram_id))})})]})})]})})}async function It(o){const{reporterId:m,reportedId:h,reportedType:f,reason:g,description:s}=o,{error:d}=await Oe.from("reports").insert({reporter_id:m,reported_id:h,reported_type:f,reason:g,description:s,status:"pending"});return d?(console.error("Failed to submit report:",d),{success:!1,error:d.message}):{success:!0}}async function Tt(o,m,h,f){return It({reporterId:o,reportedId:m.toString(),reportedType:"post",reason:h,description:f})}const ce=o=>o.filter(m=>m.status==="live"&&!!m.started_at&&!!m.agora_channel&&(m.viewer_count||0)>0),oe=5,Rt=3,de={midnight:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",ember:"linear-gradient(135deg, #2d1f1f 0%, #4a2020 50%, #6b2020 100%)",aurora:"linear-gradient(135deg, #1a2f1a 0%, #1a3a2a 50%, #0f4a3a 100%)",twilight:"linear-gradient(135deg, #2d1f3d 0%, #3d2050 50%, #4a1f6a 100%)",ocean:"linear-gradient(135deg, #0d1b2a 0%, #1b263b 50%, #274060 100%)",sunset:"linear-gradient(135deg, #3d2c29 0%, #5c3d31 50%, #7a4a3a 100%)"},K=new Set;function J(o){K.forEach(m=>{m!==o&&!m.paused&&m.pause()})}function Ft({url:o}){const[m,h]=r.useState(!1),[f,g]=r.useState(!1);return m?e.jsx("div",{className:"w-full flex items-center justify-center bg-white/5",style:{aspectRatio:"4/5"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(_t,{className:"w-10 h-10 text-white/30 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-white/40",children:"Failed to load image"})]})}):e.jsxs("div",{className:"relative w-full",style:{aspectRatio:"4/5"},children:[!f&&e.jsx("div",{className:"absolute inset-0 bg-white/5 animate-pulse"}),e.jsx("img",{src:o,alt:"",loading:"lazy",className:`w-full h-full object-contain bg-black select-none transition-opacity duration-200 ${f?"opacity-100":"opacity-0"}`,onLoad:()=>g(!0),onError:()=>h(!0)})]})}function Dt({src:o,muted:m=!0,shouldPlay:h=!1,onMuteChange:f}){const g=r.useRef(null),s=r.useRef(null),d=nt(g,{minimumRatio:.5}),u=r.useRef(null),[v,E]=r.useState(!0),[L,C]=r.useState(!1),[R,I]=r.useState(!1);r.useEffect(()=>{const i=s.current;if(i)return K.add(i),()=>{K.delete(i)}},[]),r.useEffect(()=>{E(m)},[m]),r.useEffect(()=>{const i=s.current;if(!i)return;const x=h&&d;x&&i.paused?(J(i),i.play().catch(()=>{})):!x&&!i.paused&&i.pause()},[h,d]),r.useEffect(()=>{const i=s.current;if(!i)return;const x=()=>{C(!0),J(i)},S=()=>C(!1),M=()=>I(!0),y=()=>I(!1),F=()=>I(!1);return i.addEventListener("play",x),i.addEventListener("pause",S),i.addEventListener("waiting",M),i.addEventListener("playing",y),i.addEventListener("canplay",F),()=>{i.removeEventListener("play",x),i.removeEventListener("pause",S),i.removeEventListener("waiting",M),i.removeEventListener("playing",y),i.removeEventListener("canplay",F)}},[]);const b=()=>{const i=s.current;i&&(i.paused?(J(i),i.play().catch(()=>{})):i.pause())},j=i=>{const x=i.touches[0];u.current={x:x.clientX,y:x.clientY,time:Date.now()}},k=i=>{if(!u.current)return;const x=i.changedTouches[0],S=Math.abs(x.clientX-u.current.x),M=Math.abs(x.clientY-u.current.y),y=Date.now()-u.current.time;S<15&&M<15&&y<300&&(i.preventDefault(),b()),u.current=null},D=i=>{i.stopPropagation(),i.preventDefault();const x=!v;E(x),f?.(x),s.current&&(s.current.muted=x)};return e.jsxs("div",{ref:g,className:"relative w-full bg-gray-900 overflow-hidden",style:{aspectRatio:"4/5"},onTouchStart:j,onTouchEnd:k,onClick:b,children:[e.jsx("video",{ref:s,src:o,className:"w-full h-full object-cover",playsInline:!0,loop:!0,muted:v,preload:"auto",poster:""}),R&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-10",children:e.jsx("div",{className:"w-10 h-10 border-2 border-white/40 border-t-white rounded-full animate-spin"})}),!L&&!R&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-10",children:e.jsx("div",{className:"w-14 h-14 bg-black/50 rounded-full flex items-center justify-center",children:e.jsx(yt,{className:"w-7 h-7 text-white fill-white ml-0.5"})})}),e.jsx("button",{onClick:D,onTouchEnd:i=>{i.stopPropagation(),u.current=null},className:"absolute bottom-4 left-4 w-9 h-9 bg-black/70 rounded-full flex items-center justify-center z-[999] active:scale-90 transition-transform backdrop-blur-sm",style:{touchAction:"manipulation"},children:v?e.jsx(st,{className:"w-4 h-4 text-white"}):e.jsx(Nt,{className:"w-4 h-4 text-white"})})]})}function Vt({urls:o,canView:m,muted:h,onMuteChange:f,shouldPlay:g,onDoubleTap:s}){const[d,u]=r.useState(0),v=r.useRef(null),[E,L]=r.useState(!1),C=r.useRef(0),R=()=>{if(!v.current)return;const b=v.current.scrollLeft,j=v.current.offsetWidth,k=Math.round(b/j);k!==d&&u(k)},I=()=>{const b=Date.now();b-C.current<300&&(s?.(),L(!0),setTimeout(()=>L(!1),650)),C.current=b};return!m||o.length===0?null:e.jsxs("div",{className:"relative w-full bg-black rounded-2xl overflow-hidden",children:[e.jsx("div",{ref:v,className:"flex w-full h-full overflow-x-auto snap-x snap-mandatory scrollbar-hide",onScroll:R,style:{scrollbarWidth:"none",msOverflowStyle:"none"},onClick:I,children:o.map((b,j)=>e.jsx("div",{className:"flex-none w-full snap-center",children:b.match(/\.(mp4|webm|mov|m4v)(\?|$)/i)?e.jsx(Dt,{src:b,muted:h,onMuteChange:f,shouldPlay:g&&d===j}):e.jsx(Ft,{url:b})},j))}),e.jsx($,{children:E&&e.jsx(N.div,{className:"absolute inset-0 flex items-center justify-center pointer-events-none",initial:{scale:.6,opacity:0},animate:{scale:1.1,opacity:.9},exit:{scale:.8,opacity:0},transition:{duration:.4},children:e.jsx(jt,{className:"w-24 h-24 text-white fill-white drop-shadow-[0_8px_24px_rgba(0,0,0,0.35)]"})})}),o.length>1&&e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5 z-10",children:o.map((b,j)=>e.jsx("div",{className:`w-1.5 h-1.5 rounded-full transition-all ${j===d?"bg-white w-2.5":"bg-white/50"}`},j))}),o.length>1&&e.jsxs("div",{className:"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full z-10",children:[d+1,"/",o.length]})]})}function os({user:o,onCreatorClick:m,onLivestreamClick:h,onGoLive:f,onSheetStateChange:g}){const{t:s}=dt(),[d,u]=r.useState([]),[v,E]=r.useState([]),[L,C]=r.useState([]),[R,I]=r.useState(!0),[b,j]=r.useState(!0),[k,D]=r.useState(null),[i,x]=r.useState(null),[S,M]=r.useState(!1),[y,F]=r.useState(null),[A,P]=r.useState(null),[V,W]=r.useState(oe),ee=r.useRef(null),H=r.useRef(new Map),X=r.useRef(null),[q,Y]=r.useState(!1),[ue,xe]=r.useState([]),[fe,te]=r.useState(!1),[se,ae]=r.useState(null),[Q,le]=r.useState(!1),[he,be]=r.useState(null),[z,pe]=r.useState([]),[ge,ie]=r.useState(!1),[we,ve]=r.useState(0);r.useEffect(()=>{g?.(Q||q||!!i||A!==null||!!y)},[Q,q,i,A,y,g]),r.useEffect(()=>{je(),ye()},[]),r.useEffect(()=>{const t=$e({onNewPost:a=>{u(l=>[{...a,liked:!1,saved:!1,can_view:!0},...l]),W(l=>l+1)},onPostUpdated:a=>{u(l=>l.map(c=>c.id===a.id?{...c,...a}:c))},onPostDeleted:a=>{u(l=>l.filter(c=>c.id!==a))},onLikeAdded:(a,l)=>{l!==o.telegram_id&&u(c=>c.map(n=>n.id===a?{...n,likes_count:(n.likes_count||0)+1}:n))},onLikeRemoved:(a,l)=>{l!==o.telegram_id&&u(c=>c.map(n=>n.id===a?{...n,likes_count:Math.max(0,(n.likes_count||0)-1)}:n))},onCommentAdded:(a,l)=>{u(c=>c.map(n=>n.id===a?{...n,comments_count:l}:n))}});return()=>t()},[o.telegram_id]),r.useEffect(()=>{const t=it(a=>C(ce(a)));return()=>{t()}},[]);const je=async()=>{try{const[t,a,l]=await Promise.all([Ae(o.telegram_id),He(6,o.telegram_id),rt()]);u(t),W(Math.min(t.length,oe)),E(a),C(ce(l))}catch(t){console.error("[Home] loadData failed",t)}finally{I(!1)}},ye=async()=>{try{const{stories:t}=await ct();pe(t||[])}catch(t){console.error("[Home] loadStories failed",t)}},Ne=async(t,a)=>{if(se!==t.id&&t.poll_user_vote===void 0){ae(t.id);try{const l=await Qe(t.id,a,o.telegram_id);l.data&&!l.error&&u(c=>c.map(n=>n.id===t.id?{...n,poll_votes:l.data.poll_votes,poll_total_votes:l.data.poll_total_votes,poll_user_vote:l.data.poll_user_vote}:n))}catch(l){console.error("Poll vote failed:",l)}finally{ae(null)}}},re=async t=>{if(!t.can_view)return;const a=!t.liked,l=a?1:-1;u(c=>c.map(n=>n.id===t.id?{...n,liked:a,likes_count:Math.max(0,(n.likes_count||0)+l)}:n));try{a?await Be(o.telegram_id,t.id):await We(o.telegram_id,t.id)}catch(c){u(n=>n.map(p=>p.id===t.id?{...p,liked:!a,likes_count:Math.max(0,(p.likes_count||0)-l)}:p)),console.warn("Like action failed",c)}},_e=async t=>{const a=!t.saved;u(l=>l.map(c=>c.id===t.id?{...c,saved:a}:c));try{a?await Xe(o.telegram_id,t.id):await qe(o.telegram_id,t.id)}catch(l){u(c=>c.map(n=>n.id===t.id?{...n,saved:!a}:n)),console.warn("Save action failed",l)}},ke=async t=>{if((t.likes_count||0)===0)return;Y(!0),te(!0);const a=await Ye(t.id);xe(a),te(!1)},G=async t=>{be(t.id),le(!0)},Se=async t=>{M(!0),await lt(o.telegram_id,t.id,()=>{u(d.map(a=>a.id===t.id?{...a,can_view:!0,is_purchased:!0}:a)),x(null),M(!1)},a=>{console.error("Payment failed:",a),M(!1)})},Pe=()=>{y&&(u(d.filter(t=>t.id!==y.id)),F(null))},Ce=t=>{u(d.map(a=>a.id===t.id?t:a))},Me=async t=>{if(!window.confirm(s("feed.confirm.deletePost")))return;(await ze(t.id,t.creator_id)).success?u(d.filter(l=>l.id!==t.id)):alert(s("feed.errors.deleteFailed")),P(null)},Ee=t=>{u(d.filter(a=>a.id!==t.id)),P(null)},Le=async t=>{const l=window.prompt(s("feed.report.promptReason"),s("feed.report.defaultReason"))?.trim();if(!l){P(null);return}const c=window.prompt(s("feed.report.promptDescription"))?.trim(),n=await Tt(o.telegram_id,t.id,l,c||void 0);n.success?alert(s("feed.report.success")):alert(s("feed.report.error",{error:n.error||s("feed.errors.tryAgain")})),P(null)},Ie=t=>{const a=`${window.location.origin}/post/${t.id}`;navigator.clipboard.writeText(a),alert(s("feed.linkCopied")),P(null)},Te=async t=>{if(!window.confirm(s("feed.confirm.blockUser",{user:t.creator?.username||s("feed.userFallback")})))return;await Ue(o.telegram_id,t.creator_id)?(u(l=>l.filter(c=>c.creator_id!==t.creator_id)),E(l=>l.filter(c=>c.telegram_id!==t.creator_id)),alert(s("feed.blockedSuccess"))):alert(s("feed.errors.blockFailed")),P(null)};r.useEffect(()=>{const t=ee.current;if(!t||V>=d.length)return;const a=new IntersectionObserver(l=>{l[0]?.isIntersecting&&W(c=>c>=d.length?c:Math.min(d.length,c+Rt))},{rootMargin:"240px 0px"});return a.observe(t),()=>a.disconnect()},[V,d.length]);const O=r.useMemo(()=>d.slice(0,V),[d,V]);r.useEffect(()=>{if(X.current&&X.current.disconnect(),k===null&&O.length>0){const c=O.find(n=>n.media_url?.match(/\.(mp4|webm|mov|m4v)(\?|$)/i)||n.media_urls?.some(p=>p.match(/\.(mp4|webm|mov|m4v)(\?|$)/i)));D(c?c.id:O[0].id)}const t=document.querySelector("main"),a=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],l=new IntersectionObserver(c=>{let n=null,p=0;H.current.forEach((w,T)=>{const _=w.getBoundingClientRect(),Ve=window.innerHeight,ne=Math.max(0,Math.min(_.bottom,Ve)-Math.max(_.top,0))/_.height;ne>p&&(p=ne,n=T)});for(const w of c){const T=w.target.dataset.postId,_=T?Number(T):null;_&&w.isIntersecting&&w.intersectionRatio>p&&(p=w.intersectionRatio,n=_)}n!==null&&n!==k&&D(n)},{root:t||void 0,threshold:a,rootMargin:"-10% 0px -10% 0px"});return H.current.forEach(c=>l.observe(c)),X.current=l,()=>{l.disconnect()}},[O,k]);const Re=t=>{const a=Date.now()-new Date(t).getTime(),l=Math.floor(a/36e5);return l<1?s("feed.time.justNow"):l<24?s("feed.time.hours",{count:l}):s("feed.time.days",{count:Math.floor(l/24)})},Fe=t=>e.jsxs("div",{className:"bg-black pb-4 mb-2 border-b-4 border-gray-800/80",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsxs("button",{className:"flex items-center gap-3",onClick:()=>t.creator&&m(t.creator),children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden border border-gray-700",children:e.jsx("img",{src:t.creator?.avatar_url||"https://i.pravatar.cc/150?u="+t.creator_id,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold text-sm text-white",children:t.creator?.username||s("feed.userFallback")}),t.creator?.is_verified&&e.jsx(B,{className:"w-3.5 h-3.5 text-blue-500 fill-blue-500"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),P(A===t.id?null:t.id)},className:"p-2 text-white",children:e.jsx(ut,{className:"w-5 h-5"})}),e.jsx($,{children:A===t.id&&e.jsxs(e.Fragment,{children:[e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40",onClick:()=>P(null)}),e.jsxs(N.div,{initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},className:"absolute right-0 top-full mt-1 bg-[#262626] rounded-lg py-1 z-50 min-w-[160px] shadow-xl",onClick:a=>a.stopPropagation(),children:[Number(t.creator_id)===Number(o.telegram_id)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{F(t),P(null)},className:"w-full px-4 py-2.5 text-left text-sm text-white hover:bg-white/10 flex items-center gap-2",children:[e.jsx(xt,{className:"w-4 h-4"})," ",s("feed.actions.edit")]}),e.jsxs("button",{onClick:()=>Me(t),className:"w-full px-4 py-2.5 text-left text-sm text-red-500 hover:bg-white/10 flex items-center gap-2",children:[e.jsx(ht,{className:"w-4 h-4"})," ",s("feed.actions.delete")]}),e.jsx("div",{className:"h-px bg-gray-100 mx-4 my-1"})]}),e.jsxs("button",{onClick:()=>Ie(t),className:"w-full px-5 py-3 text-left text-[14px] font-semibold text-gray-700 hover:bg-gray-900 flex items-center gap-3",children:[e.jsx(St,{className:"w-4 h-4"})," ",s("feed.actions.copyLink")]}),e.jsxs("button",{onClick:()=>Ee(t),className:"w-full px-5 py-3 text-left text-[14px] font-semibold text-gray-700 hover:bg-gray-900 flex items-center gap-3",children:[e.jsx(Ct,{className:"w-4 h-4"})," ",s("feed.actions.notInterested")]}),Number(t.creator_id)!==Number(o.telegram_id)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-px bg-gray-100 mx-4 my-1"}),e.jsxs("button",{onClick:()=>Te(t),className:"w-full px-4 py-2.5 text-left text-sm text-white hover:bg-white/10 flex items-center gap-2",children:[e.jsx(Et,{className:"w-4 h-4"})," ",s("feed.actions.block")]}),e.jsxs("button",{onClick:()=>Le(t),className:"w-full px-4 py-2.5 text-left text-sm text-red-500 hover:bg-white/10 flex items-center gap-2",children:[e.jsx(ft,{className:"w-4 h-4"})," ",s("feed.actions.report")]})]})]})]})})]})]}),t.media_url&&t.can_view?e.jsx("div",{className:"w-full bg-black rounded-2xl overflow-hidden border border-white/5","data-post-id":t.id,ref:a=>{a?H.current.set(t.id,a):H.current.delete(t.id)},children:e.jsx(Vt,{urls:t.media_urls&&t.media_urls.length>0?t.media_urls:[t.media_url],canView:t.can_view,muted:b,onMuteChange:j,shouldPlay:k===t.id,onDoubleTap:()=>re(t)})}):t.media_url?e.jsxs("div",{className:"relative bg-gray-900 text-white aspect-[4/5] flex flex-col items-center justify-center text-center overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-900/40 via-gray-900 to-gray-900"}),e.jsxs("div",{className:"relative z-10 p-8 w-full max-w-md mx-auto",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-3xl bg-white/5 border border-white/10 flex items-center justify-center mb-6 backdrop-blur-xl shadow-2xl shadow-purple-500/10 rotate-3 hover:rotate-0 transition-transform duration-500",children:e.jsx(bt,{className:"w-8 h-8 text-white/90 drop-shadow-lg"})}),e.jsx("h3",{className:"text-2xl font-bold mb-3 tracking-tight",children:De(t)}),e.jsx("p",{className:"text-white/60 mb-8 leading-relaxed",children:s("feed.lock.subtitle",{name:t.creator?.first_name})}),t.unlock_price>0?e.jsxs(N.button,{className:"w-full py-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-black rounded-2xl font-bold text-[15px] shadow-[0_0_30px_-5px_rgba(251,191,36,0.4)] flex items-center justify-center gap-2 hover:opacity-90 transition-opacity relative overflow-hidden group",whileTap:{scale:.98},onClick:()=>x(t),children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000"}),e.jsx(U,{className:"w-5 h-5 fill-current"}),s("feed.lock.unlockFor",{amount:Math.ceil(t.unlock_price)})]}):e.jsx(N.button,{className:"w-full py-4 bg-white text-white rounded-2xl font-bold text-[15px] shadow-[0_0_30px_-5px_rgba(255,255,255,0.3)] flex items-center justify-center gap-2 hover:bg-gray-900 transition-colors",whileTap:{scale:.98},onClick:()=>t.creator&&m(t.creator),children:t.visibility==="followers"?e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-5 h-5"})," ",s("feed.lock.followToView")]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-5 h-5"})," ",s("feed.lock.subscribeToView")]})})]})]}):null,e.jsxs("div",{className:"px-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("button",{className:"active:scale-90 transition-transform",onClick:()=>re(t),children:e.jsx(Je,{className:`w-7 h-7 ${t.liked?"text-red-500":"text-white"}`,filled:t.liked})}),e.jsx("button",{className:"active:scale-90 transition-transform",onClick:()=>G(t),children:e.jsx(Ke,{className:"w-7 h-7 text-white"})}),e.jsx("button",{className:"active:scale-90 transition-transform",children:e.jsx(Ze,{className:"w-7 h-7 text-white"})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>_e(t),className:"active:scale-90 transition-transform",children:e.jsx(et,{className:"w-7 h-7 text-white",filled:t.saved})}),e.jsxs("button",{className:"flex flex-col items-center active:scale-90 transition-transform",onClick:()=>{},children:[e.jsx(tt,{className:`w-7 h-7 ${(t.gifts_count||0)>0?"text-sky-400":"text-yellow-400"}`,filled:(t.gifts_count||0)>0}),(t.gifts_count||0)>0&&e.jsx("span",{className:"text-[10px] font-bold text-sky-400 -mt-0.5",children:t.gifts_count})]})]})]}),(t.likes_count||0)>0&&e.jsx("button",{className:"block mt-2",onClick:()=>ke(t),children:e.jsx("span",{className:"text-sm font-semibold text-white",children:s("feed.likesCount",{count:t.likes_count||0})})}),t.post_type==="poll"&&t.poll_options?e.jsxs("div",{className:"mt-3",children:[t.content&&e.jsx("div",{className:"mb-3",children:e.jsxs("span",{className:"text-sm text-white",children:[e.jsx("span",{className:"font-semibold mr-1",children:t.creator?.username||s("feed.userFallback")}),t.content]})}),e.jsx("div",{className:"space-y-2",children:t.poll_options.map((a,l)=>{const c=t.poll_votes?.[l]||0,n=t.poll_total_votes||0,p=n>0?Math.round(c/n*100):0,w=t.poll_user_vote!==void 0,T=t.poll_user_vote===l,_=t.poll_ends_at&&new Date(t.poll_ends_at)<new Date;return e.jsxs("button",{onClick:()=>!w&&!_&&Ne(t,l),disabled:w||_||se===t.id,className:`w-full relative overflow-hidden rounded-xl transition-all ${w||_?"cursor-default":"hover:bg-white/10 active:scale-[0.98]"}`,style:{background:"rgba(255, 255, 255, 0.05)",border:T?"2px solid rgba(255, 255, 255, 0.3)":"1px solid rgba(255, 255, 255, 0.1)"},children:[w&&e.jsx(N.div,{initial:{width:0},animate:{width:`${p}%`},transition:{duration:.5,ease:"easeOut"},className:"absolute inset-y-0 left-0 bg-white/10"}),e.jsxs("div",{className:"relative px-4 py-3 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-white flex items-center gap-2",children:[T&&e.jsx(gt,{className:"w-4 h-4 text-green-400"}),a]}),w&&e.jsxs("span",{className:"text-sm font-semibold text-white/70",children:[p,"%"]})]})]},l)})}),e.jsxs("div",{className:"mt-2 flex items-center gap-3 text-xs text-white/40",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(wt,{className:"w-3 h-3"}),t.poll_total_votes||0," votes"]}),t.poll_ends_at&&e.jsx("span",{children:new Date(t.poll_ends_at)<new Date?"Poll ended":`Ends ${new Date(t.poll_ends_at).toLocaleDateString()}`})]})]}):t.background_gradient&&de[t.background_gradient]?e.jsx("div",{className:"mt-3 rounded-2xl p-6 min-h-[120px] flex items-center justify-center",style:{background:de[t.background_gradient]},children:e.jsxs("div",{className:"text-center",children:[t.post_type==="question"&&e.jsx(vt,{className:"w-6 h-6 text-white/60 mx-auto mb-2"}),e.jsx("p",{className:"text-white text-lg font-medium leading-relaxed",children:t.content}),e.jsxs("p",{className:"text-white/50 text-xs mt-3",children:["â€” ",t.creator?.username||s("feed.userFallback")]})]})}):t.content&&e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"text-sm text-white",children:[e.jsx("span",{className:"font-semibold mr-1",children:t.creator?.username||s("feed.userFallback")}),t.content]})}),t.comments_count>0&&e.jsx("button",{className:"block mt-2",onClick:()=>G(t),children:e.jsx("span",{className:"text-sm text-gray-400",children:s("feed.viewComments",{count:t.comments_count})})}),e.jsxs("button",{className:"flex items-center gap-2 mt-2 w-full",onClick:()=>G(t),children:[e.jsx("img",{src:o.avatar_url||"https://i.pravatar.cc/150?u="+o.telegram_id,className:"w-6 h-6 rounded-full object-cover",alt:""}),e.jsx("span",{className:"text-sm text-gray-500",children:s("feed.addComment")})]}),e.jsx("div",{className:"mt-1 mb-2",children:e.jsx("span",{className:"text-[11px] text-gray-500 uppercase",children:Re(t.created_at)})})]})]},t.id),De=t=>t.unlock_price>0&&!t.is_purchased?s("feed.lock.unlockFor",{amount:Math.ceil(t.unlock_price)}):t.is_nsfw&&!t.is_subscribed?s("feed.lock.nsfw"):t.visibility==="subscribers"&&!t.is_subscribed?s("feed.lock.subscribers"):t.visibility==="followers"&&!t.is_following&&!t.is_subscribed?s("feed.lock.followers"):s("feed.lock.default");return R?e.jsx("div",{className:"bg-black min-h-screen p-4 space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"rounded-2xl border border-white/5 bg-[#0a0b0f] p-4 animate-pulse shadow-[0_14px_40px_rgba(0,0,0,0.35)]",children:[e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/10 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-24 mb-2"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-16"})]})]}),e.jsx("div",{className:"h-48 bg-white/10 rounded-xl"})]},t))}):e.jsxs("div",{className:"bg-black max-w-lg mx-auto relative pb-20",children:[L.length>0&&e.jsxs("div",{className:"border-b border-gray-800 py-3 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-[13px] font-semibold text-white",children:s("feed.live.title")})]}),f&&e.jsx("button",{onClick:f,className:"text-[13px] font-semibold text-blue-500",children:s("feed.live.goLive")})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto no-scrollbar",children:L.map(t=>e.jsxs("button",{className:"flex flex-col items-center min-w-[66px]",onClick:()=>h?.(t.id),children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-[62px] h-[62px] rounded-full p-[3px] bg-gradient-to-tr from-red-500 via-pink-500 to-orange-500",children:e.jsx("div",{className:"w-full h-full rounded-full p-[2px] bg-white",children:e.jsx("img",{src:t.creator?.avatar_url||`https://i.pravatar.cc/150?u=${t.creator_id}`,alt:"",className:"w-full h-full rounded-full object-cover"})})}),e.jsx("div",{className:"absolute -bottom-0.5 left-1/2 -translate-x-1/2 bg-red-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded border-2 border-white",children:s("feed.live.badge")})]}),e.jsx("span",{className:"text-[11px] text-white mt-1.5 truncate w-full text-center",children:t.creator?.first_name})]},t.id))})]}),z.length>0&&e.jsxs("div",{className:"border-b border-gray-800 py-3 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-[13px] font-semibold text-white",children:s("feed.stories.title")}),e.jsx("span",{className:"text-[12px] text-white/60",children:z.length})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-1",children:z.map((t,a)=>e.jsxs("button",{onClick:()=>{ve(a),ie(!0)},className:"flex flex-col items-center min-w-[64px] gap-1 focus:outline-none",children:[e.jsx("div",{className:"w-[62px] h-[62px] rounded-full p-[2px] bg-gradient-to-tr from-blue-500 via-purple-500 to-pink-500",children:e.jsx("div",{className:"w-full h-full rounded-full p-[2px] bg-black",children:e.jsx("img",{src:t.user?.avatar_url||`https://i.pravatar.cc/150?u=${t.user_id}`,alt:"",className:"w-full h-full rounded-full object-cover"})})}),e.jsx("span",{className:"text-[11px] text-white/80 truncate max-w-[68px]",children:t.user?.first_name||t.user?.username||`@user${t.user_id}`})]},t.id))})]}),v.length>0&&e.jsxs("div",{className:"border-b border-gray-800 py-4 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-[14px] font-semibold text-gray-500",children:s("feed.suggested.title")}),e.jsx("button",{className:"text-[13px] font-semibold text-white",children:s("feed.suggested.seeAll")})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto no-scrollbar pb-1",children:v.map(t=>e.jsxs("div",{className:"min-w-[100px] flex flex-col items-center",children:[e.jsxs("button",{onClick:()=>m(t),className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("img",{src:t.avatar_url||`https://i.pravatar.cc/150?u=${t.telegram_id}`,className:"w-16 h-16 rounded-full object-cover border-2 border-white/10",alt:t.first_name}),t.is_verified&&e.jsx("div",{className:"absolute bottom-0 right-0 bg-black rounded-full p-[2px]",children:e.jsx(B,{className:"w-3.5 h-3.5 text-blue-500 fill-blue-500"})})]}),e.jsx("span",{className:"text-[12px] font-medium text-white truncate w-full text-center max-w-[90px]",children:t.username||t.first_name})]}),e.jsx("button",{onClick:()=>m(t),className:"mt-2 px-4 py-1 bg-blue-500 text-white text-[11px] font-semibold rounded-md",children:s("feed.actions.follow")})]},t.telegram_id))})]}),e.jsx("div",{className:"bg-black",children:d.length===0?e.jsxs("div",{className:"px-4 py-16 text-center",children:[e.jsx("div",{className:"w-16 h-16 border-2 border-white rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(mt,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:s("feed.empty.title")}),e.jsx("p",{className:"text-sm text-gray-400",children:s("feed.empty.subtitle")})]}):e.jsxs("div",{children:[O.map(t=>Fe(t)),V<d.length&&e.jsx("div",{ref:ee,className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})})]})}),e.jsx($,{children:i&&e.jsx(N.div,{className:"fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center z-[60] p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>!S&&x(null),children:e.jsxs(N.div,{className:"bg-[#1c1c1e] rounded-[2rem] p-6 max-w-sm w-full shadow-2xl border border-white/10",initial:{scale:.9,y:30,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:30,opacity:0},transition:{type:"spring",duration:.5},onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:s("feed.purchase.title")}),e.jsx("button",{onClick:()=>!S&&x(null),className:"p-1 rounded-full hover:bg-white/10 transition-colors",children:e.jsx(me,{className:"w-6 h-6 text-gray-400"})})]}),e.jsxs("div",{className:"text-center mb-8 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-yellow-500/20 blur-3xl rounded-full"}),e.jsx("div",{className:"relative w-20 h-20 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx(U,{className:"w-10 h-10 text-white fill-white"})}),e.jsx("p",{className:"text-gray-400 text-sm font-medium mb-2",children:s("feed.purchase.payWithStars")}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(U,{className:"w-6 h-6 text-yellow-400 fill-yellow-400"}),e.jsx("span",{className:"text-4xl font-bold text-white tracking-tight",children:Math.ceil(i.unlock_price)})]})]}),e.jsx("div",{className:"bg-white/5 rounded-2xl p-4 mb-6 border border-white/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:i.creator?.avatar_url||`https://i.pravatar.cc/150?u=${i.creator_id}`,className:"w-10 h-10 rounded-full object-cover",alt:""}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-medium",children:i.creator?.first_name||i.creator?.username}),e.jsx("p",{className:"text-gray-500 text-sm",children:s("feed.purchase.creatorShare")})]})]})}),e.jsx(N.button,{className:"w-full py-4 rounded-2xl font-bold text-[15px] flex items-center justify-center gap-2 shadow-lg transition-all bg-gradient-to-r from-yellow-400 to-orange-500 text-black",whileHover:{scale:1.02,y:-1},whileTap:{scale:.98},onClick:()=>Se(i),disabled:S,children:S?e.jsx("div",{className:"w-5 h-5 border-2 border-black/30 border-t-black rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-5 h-5 fill-current"}),s("feed.purchase.payAmount",{amount:Math.ceil(i.unlock_price)})]})}),e.jsx("p",{className:"text-center text-gray-500 text-xs mt-4",children:s("feed.purchase.poweredBy")})]})})}),e.jsx($,{children:y&&e.jsx(at,{post:y,user:o,onBack:()=>F(null),onDeleted:Pe,onUpdated:Ce})}),ge&&e.jsx(ot,{stories:z,startIndex:we,onClose:()=>ie(!1)}),e.jsx(Lt,{isOpen:q,onClose:()=>Y(!1),title:s("feed.likesTitle"),users:ue,loading:fe,onUserClick:t=>{Y(!1),m(t)}}),e.jsx(Ge,{isOpen:Q,onClose:()=>le(!1),postId:he,user:o})]})}export{os as default};
