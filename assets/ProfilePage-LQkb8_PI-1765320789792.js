import{c as $,r as a,W as he,Y as pe,Z as fe,$ as ue,j as e,m as P,A as we,a0 as ge,a1 as be,a2 as je}from"./index-C4ggKbPK-1765320789792.js";import{g as ve,P as Ne}from"./PostDetail-E_i52sLE-1765320789792.js";import{G as ye,B as q,F as ke}from"./FollowersSheet-CPf1VqVB-1765320789792.js";import{u as Se}from"./useInViewport-Bq3PY-M2-1765320789792.js";import{g as _e,S as Ce,c as Pe}from"./storyApi-DRgQSEc_-1765320789792.js";import{u as Te}from"./useTranslation-BTGHT6Fs-1765320789792.js";import{U as $e}from"./user-plus-sRg5oZEg-1765320789792.js";import{S as Fe}from"./star-k5gxYjVb-1765320789792.js";import{C as B}from"./chevron-down-a8h5885s-1765320789792.js";import{L as v}from"./lock-Cz0dMjQv-1765320789792.js";import{H as De}from"./heart-APT-IL-D-1765320789792.js";import{V as Ie}from"./video-Bo5ills9-1765320789792.js";import{I as Ee}from"./image-C_nc9Wjk-1765320789792.js";import{P as Le}from"./play-C2_EoN6X-1765320789792.js";import"./CommentsSheet-BHlxhbg4-1765320789792.js";import"./loader-circle-8J5sQkuc-1765320789792.js";import"./arrow-left-DpOAHz6N-1765320789792.js";import"./ellipsis-D_rUKxl0-1765320789792.js";import"./trash-2-BzSzMYZa-1765320789792.js";import"./volume-2-f67fxukj-1765320789792.js";import"./chevron-right-rUAS60Ro-1765320789792.js";const Me=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],Re=$("menu",Me);const Ue=[["path",{d:"m2 9 3-3 3 3",key:"1ltn5i"}],["path",{d:"M13 18H7a2 2 0 0 1-2-2V6",key:"1r6tfw"}],["path",{d:"m22 15-3 3-3-3",key:"4rnwn2"}],["path",{d:"M11 6h6a2 2 0 0 1 2 2v10",key:"2f72bc"}]],H=$("repeat-2",Ue);const Ve=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Ae=$("share-2",Ve);function We(t){a.useEffect(()=>{if(typeof window>"u"||!t)return;const n=typeof window.requestIdleCallback=="function"?window.requestIdleCallback.bind(window):void 0,c=typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback.bind(window):void 0;let d=!1,i=null,r=null;const l=()=>{if(d)return;const m=new Image;m.src=t};return n?i=n(()=>l()):r=window.setTimeout(l,250),()=>{d=!0,i!==null&&c&&c(i),r!==null&&window.clearTimeout(r)}},[t])}const w={effectiveType:"4g",saveData:!1,downlink:10};function qe(){const[t,n]=a.useState(()=>{if(typeof navigator>"u")return w;const i=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return i?{effectiveType:i.effectiveType||w.effectiveType,saveData:i.saveData||!1,downlink:i.downlink||w.downlink}:w});a.useEffect(()=>{const i=navigator?.connection||navigator?.mozConnection||navigator?.webkitConnection;if(!i)return;const r=()=>{n({effectiveType:i.effectiveType||w.effectiveType,saveData:!!i.saveData,downlink:i.downlink||w.downlink})};return i.addEventListener?.("change",r),()=>i.removeEventListener?.("change",r)},[]);const c=t.effectiveType==="slow-2g"||t.effectiveType==="2g",d=t.saveData;return{...t,isSlow:c,isDataSaver:d}}function N(t){return t>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t.toString()}function dt({user:t,setUser:n,onBecomeCreator:c,onSettingsClick:d,onViewProfile:i}){const{t:r}=Te(),[l,m]=a.useState("posts"),[x,f]=a.useState([]),[u,y]=a.useState([]),[k,F]=a.useState(!0),[g,b]=a.useState(null),[O,z]=a.useState(null),[Y,D]=a.useState(!1),I=a.useRef(null),G=a.useRef(null),[,E]=a.useState(!1),[,L]=a.useState(!1),[K,S]=a.useState(!1),[Q,M]=a.useState("followers"),[X,_]=a.useState(t.followers_count||0),[Z,J]=a.useState(t.following_count||0),[j,ee]=a.useState([]),[te,C]=a.useState(!1),[se,ae]=a.useState(!1);a.useEffect(()=>{re(),le(),U()},[t.telegram_id]);const le=async()=>{const s=await he(t.telegram_id);_(s.followers),J(s.following)};a.useEffect(()=>{const s=pe(t.telegram_id,{onNewFollower:()=>_(o=>o+1),onUnfollow:()=>_(o=>Math.max(0,o-1))});return()=>s()},[t.telegram_id]),a.useEffect(()=>{l==="saved"&&!O&&!Y&&ie()},[l]);const ie=async()=>{D(!0);try{const s=await ve(t.telegram_id);s.wallet&&z(s.wallet)}catch(s){console.error("Failed to load wallet data:",s)}D(!1)},re=async()=>{F(!0);const[s,o]=await Promise.all([fe(t.telegram_id,t.telegram_id),ue(t.telegram_id)]),h=s?.posts??[];f(h),y(o),F(!1)},oe=()=>{g&&(f(x.filter(s=>s.id!==g.id)),y(u.filter(s=>s.id!==g.id)),b(null),t.is_creator&&n({...t,posts_count:Math.max(0,(t.posts_count||1)-1)}))},ne=s=>{f(x.map(o=>o.id===s.id?{...s,can_view:!0}:o)),y(u.map(o=>o.id===s.id?{...s,can_view:!0}:o))},ce=()=>{I.current?.click()},de=async()=>{const s=`${window.location.origin}/profile/${t.username||t.telegram_id}`;try{if(navigator.share){await navigator.share({url:s,title:t.username||r("profile.title")});return}}catch{}try{await navigator.clipboard.writeText(s),alert(r("profile.share.copied"))}catch{alert(r("profile.share.copyError"))}},R=(s,o)=>{const h=s.target.files?.[0];if(!h){s.target.value="";return}if(o==="profile"){(async()=>{L(!0);const p=await ge(h,t.telegram_id);p.error||!p.url?alert(r("profile.upload.error")):await be(t.telegram_id,{avatar_url:p.url})?(n({...t,avatar_url:p.url}),alert(r("profile.upload.avatarSuccess"))):alert(r("profile.upload.error")),L(!1),s.target.value=""})();return}(async()=>{E(!0);const p=await je(h,t.telegram_id);if(p.error||!p.url)alert(r("profile.upload.error"));else{const W=h.type.startsWith("video/")?"video":"image",{error:xe}=await Pe(t.telegram_id,p.url,W);xe?alert(r("profile.upload.error")):(alert(r("profile.upload.storySuccess")),U())}E(!1),s.target.value=""})()},U=async()=>{try{const{stories:s}=await _e(),o=(s||[]).filter(h=>h.user_id===t.telegram_id);ee(o)}catch(s){console.error("[Profile] loadStories failed",s)}},me=t.likes_received||x.reduce((s,o)=>s+(o.likes_count||0),0),V=x.filter(s=>s.visibility==="public"),A=x.filter(s=>s.visibility!=="public");return e.jsxs("div",{className:"bg-black min-h-screen text-white pb-20",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{className:"p-2",children:e.jsx($e,{className:"w-6 h-6 text-white"})}),j.length>0?e.jsxs("button",{onClick:()=>C(!0),className:"absolute left-1/2 -translate-x-1/2 top-20 bg-white text-black text-xs px-3 py-1.5 rounded-full font-medium shadow-lg",style:{transform:"translateX(-50%) translateY(-100%)"},children:["View Stories",e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-full w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-t-[6px] border-t-white"})]}):null,e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{className:"p-2",children:e.jsx(Fe,{className:"w-6 h-6 text-white"})}),e.jsx("button",{className:"p-2",onClick:de,children:e.jsx(Ae,{className:"w-6 h-6 text-white"})}),e.jsx("button",{className:"p-2",onClick:d,children:e.jsx(Re,{className:"w-6 h-6 text-white"})})]})]}),e.jsxs("div",{className:"flex flex-col items-center px-4 pt-2 pb-4",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx("div",{className:`w-24 h-24 rounded-full ${j.length>0?"p-[3px] bg-gradient-to-tr from-pink-500 via-red-500 to-yellow-500":""}`,children:e.jsx("div",{className:`w-full h-full rounded-full ${j.length>0?"p-[2px] bg-black":""}`,children:e.jsx("img",{src:t.avatar_url||`https://i.pravatar.cc/150?u=${t.telegram_id}`,alt:t.first_name,className:"w-full h-full rounded-full object-cover",onClick:()=>j.length>0&&C(!0)})})}),e.jsx("button",{onClick:ce,className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-7 h-7 bg-[#00D4FF] rounded-full flex items-center justify-center border-[3px] border-black",children:e.jsx("span",{className:"text-black text-lg font-bold leading-none",children:"+"})})]}),e.jsx("input",{ref:I,type:"file",accept:"image/*",className:"hidden",onChange:s=>R(s,"profile")}),e.jsx("input",{ref:G,type:"file",accept:"image/*,video/*",className:"hidden",onChange:s=>R(s,"story")}),e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("button",{onClick:()=>ae(!se),className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-lg font-bold tracking-wide",children:t.first_name?.toUpperCase()||"USER"}),e.jsx(B,{className:"w-4 h-4 text-white"})]}),e.jsx("button",{onClick:d,className:"px-4 py-1.5 bg-[#2a2a2a] rounded-md text-sm font-medium",children:"Edit"})]}),e.jsxs("span",{className:"text-[13px] text-white/50 mb-4",children:["@",t.username||`user${t.telegram_id}`]}),e.jsxs("div",{className:"flex items-center justify-center gap-0 mb-4",children:[e.jsxs("button",{onClick:()=>{M("following"),S(!0)},className:"flex flex-col items-center px-5",children:[e.jsx("span",{className:"text-lg font-bold",children:N(Z)}),e.jsx("span",{className:"text-[12px] text-white/50",children:"Following"})]}),e.jsx("div",{className:"w-[1px] h-8 bg-white/10"}),e.jsxs("button",{onClick:()=>{M("followers"),S(!0)},className:"flex flex-col items-center px-5",children:[e.jsx("span",{className:"text-lg font-bold",children:N(X)}),e.jsx("span",{className:"text-[12px] text-white/50",children:"Followers"})]}),e.jsx("div",{className:"w-[1px] h-8 bg-white/10"}),e.jsxs("div",{className:"flex flex-col items-center px-5",children:[e.jsx("span",{className:"text-lg font-bold",children:N(me)}),e.jsx("span",{className:"text-[12px] text-white/50",children:"Likes"})]})]}),e.jsx("div",{className:"text-center px-8 mb-4",children:e.jsx("p",{className:"text-[14px] text-white/90 whitespace-pre-wrap",children:t.bio||"No bio yet"})}),e.jsxs("div",{className:"flex items-center justify-center gap-6",children:[t.is_creator&&e.jsxs("button",{className:"flex items-center gap-2 text-[13px] text-white/70",children:[e.jsx("span",{className:"text-pink-500",children:"ðŸŽ¬"}),e.jsx("span",{children:"Creator Studio"})]}),t.is_creator&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-[1px] h-4 bg-white/10"}),e.jsxs("button",{className:"flex items-center gap-2 text-[13px] text-white/70",children:[e.jsx("span",{className:"text-pink-500",children:"â­"}),e.jsx("span",{children:"Subscription"})]})]}),!t.is_creator&&e.jsx("button",{onClick:c,className:"px-6 py-2 bg-gradient-to-r from-pink-500 to-orange-400 rounded-md text-sm font-semibold",children:"Become a Creator"})]})]}),e.jsxs("div",{className:"flex border-b border-white/10",children:[e.jsxs("button",{className:`flex-1 py-3 flex items-center justify-center gap-1 ${l==="posts"?"border-b-2 border-white":""}`,onClick:()=>m("posts"),children:[e.jsx(ye,{className:`w-5 h-5 ${l==="posts"?"text-white":"text-white/40"}`}),e.jsx(B,{className:`w-3 h-3 ${l==="posts"?"text-white":"text-white/40"}`})]}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${l==="locked"?"border-b-2 border-white":""}`,onClick:()=>m("locked"),children:e.jsx(v,{className:`w-5 h-5 ${l==="locked"?"text-white":"text-white/40"}`})}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${l==="reposts"?"border-b-2 border-white":""}`,onClick:()=>m("reposts"),children:e.jsx(H,{className:`w-5 h-5 ${l==="reposts"?"text-white":"text-white/40"}`})}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${l==="saved"?"border-b-2 border-white":""}`,onClick:()=>m("saved"),children:e.jsx(q,{className:`w-5 h-5 ${l==="saved"?"text-white":"text-white/40"}`})}),e.jsx("button",{className:`flex-1 py-3 flex items-center justify-center ${l==="liked"?"border-b-2 border-white":""}`,onClick:()=>m("liked"),children:e.jsx(De,{className:`w-5 h-5 ${l==="liked"?"text-white":"text-white/40"}`})})]}),e.jsxs("div",{className:"pb-20",children:[l==="posts"&&(k?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},s))}):V.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(Ie,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-sm text-white/50",children:"Your posts will appear here"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:V.map(s=>e.jsx(P.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>b(s),children:e.jsx(T,{post:s})},s.id))})),l==="locked"&&(k?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3].map(s=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},s))}):A.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(v,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No locked content"}),e.jsx("p",{className:"text-sm text-white/50",children:"Private content will appear here"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:A.map(s=>e.jsxs(P.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>b(s),children:[e.jsx(T,{post:s}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(v,{className:"w-4 h-4 text-white drop-shadow"})})]},s.id))})),l==="reposts"&&e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(H,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No reposts yet"}),e.jsx("p",{className:"text-sm text-white/50",children:"Content you repost will appear here"})]}),l==="saved"&&(k?e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:[1,2,3,4,5,6].map(s=>e.jsx("div",{className:"aspect-[3/4] bg-white/5 animate-pulse"},s))}):u.length===0?e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(q,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No saved posts"}),e.jsx("p",{className:"text-sm text-white/50 max-w-xs mx-auto",children:"Save posts to view them later"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-[1px]",children:u.map(s=>e.jsx(P.div,{className:"relative aspect-[3/4] cursor-pointer overflow-hidden bg-[#1a1a1a]",whileTap:{opacity:.9},onClick:()=>b(s),children:e.jsx(T,{post:s})},s.id))})),l==="liked"&&e.jsxs("div",{className:"py-20 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border border-white/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(v,{className:"w-8 h-8 text-white/30"})}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Liked posts are private"}),e.jsx("p",{className:"text-sm text-white/50 max-w-xs mx-auto",children:"Only you can see what you've liked"})]})]}),e.jsx(we,{children:g&&e.jsx(Ne,{post:g,user:t,onBack:()=>b(null),onDeleted:oe,onUpdated:ne})}),te&&e.jsx(Ce,{stories:j,startIndex:0,onClose:()=>C(!1)}),e.jsx(ke,{isOpen:K,onClose:()=>S(!1),userId:t.telegram_id,currentUserId:t.telegram_id,type:Q,onUserClick:i})]})}function T({post:t}){const n=a.useRef(null),[c,d]=a.useState(!1),[i,r]=a.useState(!1),[l,m]=a.useState(!1),x=Se(n,{minimumRatio:.25}),f=t.media_thumbnail||t.media_url,{isDataSaver:u}=qe();return We(u?null:f),a.useEffect(()=>{x&&d(!0)},[x]),t.media_url?i?e.jsx("div",{ref:n,className:"w-full h-full flex items-center justify-center bg-[#1a1a1a]",children:e.jsx(Ee,{className:"w-8 h-8 text-white/20"})}):e.jsxs("div",{ref:n,className:"w-full h-full relative",children:[(!c||!l)&&e.jsx("div",{className:"absolute inset-0 bg-[#1a1a1a] animate-pulse"}),c&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:f||t.media_url,alt:"",className:`w-full h-full object-cover transition-opacity duration-200 ${l?"opacity-100":"opacity-0"}`,loading:"lazy",onLoad:()=>m(!0),onError:()=>r(!0)}),l&&e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-16 bg-gradient-to-t from-black/60 to-transparent"}),l&&e.jsxs("div",{className:"absolute bottom-2 left-2 flex items-center gap-1",children:[e.jsx(Le,{className:"w-4 h-4 text-white fill-white"}),e.jsx("span",{className:"text-white text-[13px] font-medium",children:N(t.likes_count||Math.floor(Math.random()*1e4))})]}),l&&t.media_urls&&t.media_urls.length>1&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"bg-black/50 rounded px-1.5 py-0.5",children:e.jsx("span",{className:"text-[11px] text-white font-medium",children:t.media_urls.length})})})]})]}):e.jsx("div",{ref:n,className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-purple-900/50 to-pink-900/50 p-4",children:e.jsx("p",{className:"text-[13px] text-white text-center line-clamp-5",children:t.content})})}export{dt as default};
