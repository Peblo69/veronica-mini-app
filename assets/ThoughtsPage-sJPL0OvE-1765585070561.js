import{c as B,r as i,d as F,t as d,j as e,P as ne,A as K,m as q,K as ce,u as de,o as me,L as pe,M as xe,k as ue,w as fe,N as he}from"./index-BDTVgPZm-1765585070561.js";import{a as we}from"./moderation-Cyx-wVK9-1765585070561.js";import{C as be,E as ve}from"./CommentsSheet-i-_4ir2v-1765585070561.js";import{A as _e}from"./arrow-left-BzWAUfwR-1765585070561.js";import{L as H}from"./loader-circle-Ddg8qS5S-1765585070561.js";import{C as ge}from"./chart-column-Cet8CbnT-1765585070561.js";import{M as je}from"./message-circle-question-mark-BuuVGkkD-1765585070561.js";import{P as Ne}from"./palette-CcdI36dN-1765585070561.js";import{T as ye}from"./trash-2-D2o2T7Py-1765585070561.js";import{H as ke}from"./heart-BwDTfYCY-1765585070561.js";import{R as Ce}from"./repeat-2-C3NzCEt7-1765585070561.js";import"./x-eK2bUcfn-1765585070561.js";import"./flag-sg7Bm5oD-1765585070561.js";const Pe=[["path",{d:"M5 12h14",key:"1ays0h"}]],$e=B("minus",Pe);const Se=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],Me=B("type",Se),V={none:{name:"None",value:"",preview:"bg-transparent border border-white/10"},midnight:{name:"Midnight",value:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",preview:"bg-gradient-to-br from-[#1a1a2e] via-[#16213e] to-[#0f3460]"},ember:{name:"Ember",value:"linear-gradient(135deg, #2d1f1f 0%, #4a2020 50%, #6b2020 100%)",preview:"bg-gradient-to-br from-[#2d1f1f] via-[#4a2020] to-[#6b2020]"},aurora:{name:"Aurora",value:"linear-gradient(135deg, #1a2f1a 0%, #1a3a2a 50%, #0f4a3a 100%)",preview:"bg-gradient-to-br from-[#1a2f1a] via-[#1a3a2a] to-[#0f4a3a]"},twilight:{name:"Twilight",value:"linear-gradient(135deg, #2d1f3d 0%, #3d2050 50%, #4a1f6a 100%)",preview:"bg-gradient-to-br from-[#2d1f3d] via-[#3d2050] to-[#4a1f6a]"},ocean:{name:"Ocean",value:"linear-gradient(135deg, #0d1b2a 0%, #1b263b 50%, #274060 100%)",preview:"bg-gradient-to-br from-[#0d1b2a] via-[#1b263b] to-[#274060]"}};function W(s){const h=Math.floor((Date.now()-new Date(s).getTime())/1e3);if(h<60)return`${h}s`;const w=Math.floor(h/60);if(w<60)return`${w}m`;const f=Math.floor(w/60);if(f<24)return`${f}h`;const b=Math.floor(f/24);return b<7?`${b}d`:new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"})}function L(s){return s>=1e6?(s/1e6).toFixed(1).replace(/\.0$/,"")+"M":s>=1e3?(s/1e3).toFixed(1).replace(/\.0$/,"")+"K":s.toString()}function He({user:s,onBack:h,onViewProfile:w,onSheetStateChange:f}){const[b,p]=i.useState([]),[T,k]=i.useState(!0),[_,g]=i.useState(!1),[E,O]=i.useState(null),[j,N]=i.useState(void 0),[u,C]=i.useState(null);i.useEffect(()=>{f?.(_||u!==null)},[_,u,f]);const[o,P]=i.useState(""),[c,v]=i.useState("thought"),[m,$]=i.useState(["",""]),[I,Q]=i.useState(24),[S,z]=i.useState("none"),[X,D]=i.useState(!1),[Y]=i.useState("public"),[M,A]=i.useState(!1),y=i.useRef(null),G=500,J=s.is_creator;i.useEffect(()=>{R()},[]);const R=async()=>{k(!0);try{const{data:t,error:a}=await F.from("posts").select(`
          *,
          creator:users!posts_creator_id_fkey(*)
        `).in("post_type",["thought","poll","question"]).is("media_url",null).eq("is_hidden",!1).order("created_at",{ascending:!1}).limit(50);if(a)throw a;const l=(t||[]).map(x=>x.id),[r,n]=await Promise.all([F.from("likes").select("post_id").eq("user_id",s.telegram_id).in("post_id",l),F.from("reposts").select("post_id").eq("user_id",s.telegram_id).in("post_id",l)]),le=new Set((r.data||[]).map(x=>x.post_id)),ie=new Set((n.data||[]).map(x=>x.post_id)),oe=(t||[]).map(x=>({...x,liked:le.has(x.id),reposted:ie.has(x.id),creator:x.creator||{telegram_id:x.creator_id,first_name:"User",username:"user"}}));p(oe)}catch(t){console.error("Failed to load thoughts:",t),d.error("Failed to load")}k(!1)};i.useEffect(()=>{y.current&&(y.current.style.height="auto",y.current.style.height=Math.min(y.current.scrollHeight,120)+"px")},[o]);const Z=async()=>{if(!M){if(c==="poll"){if(m.filter(a=>a.trim().length>0).length<2){d.error("Add at least 2 poll options");return}if(!o.trim()){d.error("Add a question for your poll");return}}else if(!o.trim())return;A(!0);try{if(o.trim()&&(await we(o.trim()))?.flagged){d.error("Content blocked by moderation"),A(!1);return}const t={content:o.trim(),visibility:J?Y:"public",is_nsfw:!1,unlock_price:0,post_type:c,background_gradient:S!=="none"?S:void 0};c==="poll"&&(t.poll_options=m.filter(l=>l.trim().length>0),t.poll_duration_hours=I);const{error:a}=await ce(s.telegram_id,t);a?d.error("Failed to post"):(d.success("Posted!"),P(""),v("thought"),$(["",""]),z("none"),R())}catch(t){console.error("Post error:",t),d.error("Something went wrong")}A(!1)}},ee=async t=>{const a=t.liked;p(l=>l.map(r=>r.id===t.id?{...r,liked:!a,likes_count:(r.likes_count||0)+(a?-1:1)}:r));try{a?await de(s.telegram_id,t.id):await me(s.telegram_id,t.id)}catch{p(l=>l.map(r=>r.id===t.id?{...r,liked:a,likes_count:(r.likes_count||0)+(a?1:-1)}:r))}},te=t=>{O(t.id),N(t.creator_id),g(!0)},se=async t=>{const a=t.reposted;p(l=>l.map(r=>r.id===t.id?{...r,reposted:!a,reposts_count:(r.reposts_count||0)+(a?-1:1)}:r));try{if(a){const l=await pe(s.telegram_id,t.id);if(!l.success)throw new Error(l.error)}else{const l=await xe(s.telegram_id,t.id);if(!l.success)throw new Error(l.error);d.success("Reposted!")}}catch{p(l=>l.map(r=>r.id===t.id?{...r,reposted:a,reposts_count:(r.reposts_count||0)+(a?1:-1)}:r)),d.error("Failed to repost")}},ae=async t=>{if(t.creator_id!==s.telegram_id){d.error("You can only delete your own posts");return}C(null),p(a=>a.filter(l=>l.id!==t.id));try{const a=await ue(t.id,s.telegram_id);if(!a.success)throw new Error(a.error?.message||"Failed to delete");d.success("Deleted")}catch{R(),d.error("Failed to delete")}},re=async(t,a)=>{if(t.poll_user_vote===void 0){p(l=>l.map(r=>{if(r.id!==t.id)return r;const n=[...r.poll_votes||[]];return n[a]=(n[a]||0)+1,{...r,poll_user_vote:a,poll_votes:n,poll_total_votes:(r.poll_total_votes||0)+1}}));try{const l=await fe(t.id,a,s.telegram_id);if(l.error)throw new Error(l.error.message);p(r=>r.map(n=>n.id!==t.id?n:{...n,poll_votes:l.data?.poll_votes||n.poll_votes,poll_total_votes:l.data?.poll_total_votes||n.poll_total_votes,poll_user_vote:l.data?.poll_user_vote??a})),d.success("Vote recorded!")}catch{p(l=>l.map(r=>{if(r.id!==t.id)return r;const n=[...r.poll_votes||[]];return n[a]=Math.max(0,(n[a]||1)-1),{...r,poll_user_vote:void 0,poll_votes:n,poll_total_votes:Math.max(0,(r.poll_total_votes||1)-1)}})),d.error("Failed to vote")}}},U=c==="poll"?o.trim().length>0&&m.filter(t=>t.trim().length>0).length>=2:o.trim().length>0;return e.jsxs("div",{className:"min-h-screen bg-black text-white flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between px-4 py-3 border-b border-white/10",children:[e.jsx("button",{onClick:h,className:"p-1 -ml-1",children:e.jsx(_e,{className:"w-6 h-6"})}),e.jsx("span",{className:"font-semibold",children:"Thoughts"}),e.jsx("button",{onClick:Z,disabled:!U||M,className:`px-4 py-1.5 rounded-full text-sm font-semibold transition-all ${U&&!M?"bg-white text-black":"bg-white/10 text-white/30"}`,children:M?e.jsx(H,{className:"w-4 h-4 animate-spin"}):"Post"})]}),e.jsx("div",{className:"flex-shrink-0 border-b border-white/10",children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:s.avatar_url||`https://i.pravatar.cc/150?u=${s.telegram_id}`,alt:"",className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("textarea",{ref:y,value:o,onChange:t=>P(t.target.value.slice(0,G)),placeholder:c==="poll"?"Ask your question...":c==="question"?"What would you like to ask?":"What's on your mind?",className:"w-full bg-transparent text-white text-[15px] placeholder-white/40 resize-none focus:outline-none leading-relaxed",rows:2})})]}),c==="poll"&&e.jsxs("div",{className:"mt-3 ml-[52px] space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white/40 text-xs",children:"Poll options"}),e.jsxs("select",{value:I,onChange:t=>Q(Number(t.target.value)),className:"bg-white/5 border border-white/10 rounded px-2 py-1 text-xs text-white focus:outline-none",children:[e.jsx("option",{value:1,children:"1 hour"}),e.jsx("option",{value:8,children:"8 hours"}),e.jsx("option",{value:24,children:"24 hours"})]})]}),m.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:t,onChange:l=>{const r=[...m];r[a]=l.target.value.slice(0,50),$(r)},placeholder:`Option ${a+1}`,className:"flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm text-white placeholder-white/30 focus:outline-none"}),m.length>2&&e.jsx("button",{onClick:()=>$(m.filter((l,r)=>r!==a)),className:"w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-white/40",children:e.jsx($e,{className:"w-4 h-4"})})]},a)),m.length<4&&e.jsxs("button",{onClick:()=>$([...m,""]),className:"w-full py-2 rounded-lg border border-dashed border-white/20 text-white/40 text-xs flex items-center justify-center gap-1",children:[e.jsx(ne,{className:"w-3 h-3"}),"Add option"]})]}),e.jsxs("div",{className:"mt-3 ml-[52px] flex items-center gap-1",children:[e.jsxs("button",{onClick:()=>v("thought"),className:`px-2 py-1 rounded-full text-[11px] font-medium flex items-center gap-1 ${c==="thought"?"bg-white text-black":"bg-white/5 text-white/50"}`,children:[e.jsx(Me,{className:"w-3 h-3"}),"Text"]}),e.jsxs("button",{onClick:()=>v("poll"),className:`px-2 py-1 rounded-full text-[11px] font-medium flex items-center gap-1 ${c==="poll"?"bg-white text-black":"bg-white/5 text-white/50"}`,children:[e.jsx(ge,{className:"w-3 h-3"}),"Poll"]}),e.jsxs("button",{onClick:()=>v("question"),className:`px-2 py-1 rounded-full text-[11px] font-medium flex items-center gap-1 ${c==="question"?"bg-white text-black":"bg-white/5 text-white/50"}`,children:[e.jsx(je,{className:"w-3 h-3"}),"Q&A"]}),c!=="poll"&&e.jsxs("button",{onClick:()=>D(!0),className:`px-2 py-1 rounded-full text-[11px] font-medium flex items-center gap-1 ${S!=="none"?"bg-white/20 text-white":"bg-white/5 text-white/50"}`,children:[e.jsx(Ne,{className:"w-3 h-3"}),"Style"]}),e.jsxs("span",{className:`ml-auto text-[10px] ${o.length>450?"text-orange-400":"text-white/30"}`,children:[o.length,"/",G]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:T?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(H,{className:"w-6 h-6 text-white/40 animate-spin"})}):b.length===0?e.jsx("div",{className:"py-20 text-center px-6",children:e.jsx("p",{className:"text-white/40 text-sm",children:"No thoughts yet. Be the first!"})}):e.jsx("div",{className:"divide-y divide-white/5",children:b.map(t=>e.jsx(Te,{thought:t,currentUserId:s.telegram_id,onLike:()=>ee(t),onComment:()=>te(t),onRepost:()=>se(t),onDelete:()=>ae(t),onVote:a=>re(t,a),menuOpen:u===t.id,onMenuToggle:()=>C(u===t.id?null:t.id),onViewProfile:w},t.id))})}),e.jsx(K,{children:X&&e.jsxs(e.Fragment,{children:[e.jsx(q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 z-40",onClick:()=>D(!1)}),e.jsxs(q.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},className:"fixed bottom-0 left-0 right-0 bg-[#1c1c1e] rounded-t-2xl z-50 p-4",children:[e.jsx("div",{className:"w-10 h-1 bg-white/20 rounded-full mx-auto mb-4"}),e.jsx("h3",{className:"text-white text-lg font-semibold text-center mb-4",children:"Background Style"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Object.entries(V).map(([t,a])=>e.jsx("button",{onClick:()=>{z(t),D(!1)},className:`aspect-square rounded-xl ${a.preview} ${S===t?"ring-2 ring-white":""}`,children:e.jsx("span",{className:"text-white/60 text-xs",children:a.name})},t))})]})]})}),e.jsx(be,{isOpen:_,onClose:()=>g(!1),postId:E,postCreatorId:j,user:s})]})}function Te({thought:s,currentUserId:h,onLike:w,onComment:f,onRepost:b,onDelete:p,onVote:T,menuOpen:k,onMenuToggle:_,onViewProfile:g}){const E=s.creator_id===h,O=s.background_gradient&&V[s.background_gradient]?.value?{background:V[s.background_gradient].value}:{};return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>g?.(s.creator),className:"flex-shrink-0",children:e.jsx("img",{src:s.creator.avatar_url||`https://i.pravatar.cc/150?u=${s.creator.telegram_id}`,alt:"",className:"w-10 h-10 rounded-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("button",{onClick:()=>g?.(s.creator),className:"font-semibold text-sm truncate",children:s.creator.first_name||"User"}),e.jsxs("span",{className:"text-white/40 text-xs",children:["@",s.creator.username||`user${s.creator.telegram_id}`]}),e.jsx("span",{className:"text-white/30 text-xs",children:"·"}),e.jsx("span",{className:"text-white/40 text-xs flex-1",children:W(s.created_at)}),E&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:_,className:"p-1 -mr-1 text-white/40 hover:text-white/70 transition-colors",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx(K,{children:k&&e.jsx(q.div,{initial:{opacity:0,scale:.95,y:-5},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-5},transition:{duration:.1},className:"absolute right-0 top-6 z-20 min-w-[140px] rounded-xl overflow-hidden",style:{background:"rgba(40, 40, 40, 0.98)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs("button",{onClick:p,className:"w-full px-4 py-3 flex items-center gap-3 text-red-400 hover:bg-white/5 transition-colors",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Delete"})]})})})]})]}),e.jsx("div",{className:`text-[15px] leading-relaxed ${s.background_gradient?"p-3 rounded-xl":""}`,style:O,children:e.jsx("p",{className:"whitespace-pre-wrap break-words",children:s.content})}),s.post_type==="poll"&&s.poll_options&&e.jsxs("div",{className:"mt-3 space-y-2",children:[(()=>{const j=s.poll_user_vote!==void 0,N=s.poll_ends_at&&new Date(s.poll_ends_at)<new Date,u=!j&&!N;return s.poll_options.map((C,o)=>{const P=s.poll_votes?.[o]||0,c=s.poll_total_votes||0,v=c>0?Math.round(P/c*100):0,m=s.poll_user_vote===o;return e.jsxs("button",{className:`relative w-full text-left transition-all ${u?"active:scale-[0.98]":""}`,onClick:()=>u&&T(o),disabled:!u,children:[e.jsx("div",{className:`absolute inset-0 rounded-lg transition-all ${m?"bg-blue-500/30":"bg-white/10"}`,style:{width:j||N?`${v}%`:"0%"}}),e.jsxs("div",{className:`relative px-3 py-2.5 rounded-lg border text-sm flex justify-between items-center ${m?"border-blue-400/50 font-medium":u?"border-white/20 hover:border-white/40":"border-white/10"}`,children:[e.jsxs("span",{className:"flex items-center gap-2",children:[C,m&&e.jsx("span",{className:"text-blue-400 text-xs",children:"✓"})]}),(j||N)&&e.jsxs("span",{className:"text-white/50",children:[v,"%"]})]})]},o)})})(),e.jsxs("div",{className:"flex items-center justify-between text-white/40 text-xs",children:[e.jsxs("span",{children:[s.poll_total_votes||0," votes"]}),s.poll_ends_at&&e.jsx("span",{children:new Date(s.poll_ends_at)>new Date?`Ends ${W(s.poll_ends_at)}`:"Poll ended"})]})]}),e.jsxs("div",{className:"flex items-center gap-6 mt-3",children:[e.jsxs("button",{onClick:w,className:`flex items-center gap-1.5 text-sm transition-colors active:scale-95 ${s.liked?"text-pink-500":"text-white/50 hover:text-white/70"}`,children:[e.jsx(ke,{className:`w-[18px] h-[18px] ${s.liked?"fill-current":""}`}),e.jsx("span",{children:L(s.likes_count||0)})]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-1.5 text-sm text-white/50 hover:text-white/70 transition-colors active:scale-95",children:[e.jsx(he,{className:"w-[18px] h-[18px]"}),e.jsx("span",{children:L(s.comments_count||0)})]}),e.jsxs("button",{onClick:b,className:`flex items-center gap-1.5 text-sm transition-colors active:scale-95 ${s.reposted?"text-green-500":"text-white/50 hover:text-green-400"}`,children:[e.jsx(Ce,{className:"w-[18px] h-[18px]"}),e.jsx("span",{children:L(s.reposts_count||0)})]})]})]})]})})}export{He as default};
