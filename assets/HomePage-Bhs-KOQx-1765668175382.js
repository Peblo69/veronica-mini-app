import{c as mt,s as F,r as d,a as ht,j as e,M as pe,m as I,A as V,b as ft,g as xt,S as gt,d as pt,e as bt,t as be,f as wt,h as vt,i as yt,k as jt,l as Nt,n as _t,o as kt,p as St,u as Ct,q as Mt,v as Et,w as Pt,x as zt,y as we}from"./index-FuRYyHv5-1765668175382.js";import{P as It,a as Ot,b as Rt,c as Tt,d as Ft,V as Lt}from"./PixelIcons-BiwKw90A-1765668175382.js";import{u as Pe}from"./useTranslation-B8u3GWuu-1765668175382.js";import{L as K}from"./loader-circle-FMmlhrXg-1765668175382.js";import{C as re}from"./check-CtFDB-K_-1765668175382.js";import{B as Q,s as ve,a as X}from"./dialogs-Dx05-XWT-1765668175382.js";import{V as Dt,I as At}from"./video-Ds7Dmx10-1765668175382.js";import{G as Vt}from"./gift-TYn9-NyF-1765668175382.js";import{D as $t}from"./dollar-sign-iC3s44Xz-1765668175382.js";import{S as B}from"./star-CGTvLtRk-1765668175382.js";import{U as Ut}from"./user-plus-DcMRVwbR-1765668175382.js";import{H as ze}from"./heart-BfPcOdQL-1765668175382.js";import{C as H,u as Wt}from"./useInViewport-UJz5kGXt-1765668175382.js";import{T as Ie}from"./trash-2-BPOy-Uc3-1765668175382.js";import{P as Bt,u as Ht}from"./PostDetail-DWk2iCMk-1765668175382.js";import{X as Y}from"./x-Ciy_jLyC-1765668175382.js";import{C as qt,E as Gt}from"./CommentsSheet-B1K7gqWn-1765668175382.js";import{S as Xt}from"./send-CLgx1dMJ-1765668175382.js";import{g as Kt,S as Qt}from"./storyApi-BzRnAjeS-1765668175382.js";import{U as Yt}from"./users-U_E2VvxH-1765668175382.js";import{P as Jt}from"./pen-line-BNmiNmdr-1765668175382.js";import{C as Zt}from"./copy-CDs0IdFY-1765668175382.js";import{U as es}from"./user-x-BaSuRSfJ-1765668175382.js";import{F as ts}from"./flag-DXpO8JjN-1765668175382.js";import{L as ss}from"./lock-Da68t-Jc-1765668175382.js";import{E as is}from"./eye-BXCAOG89-1765668175382.js";import{C as ns}from"./chart-column-D90cjdeL-1765668175382.js";import{M as as}from"./message-circle-question-mark-1XwzCmRh-1765668175382.js";import{P as rs}from"./play-C3hOK71o-1765668175382.js";import{V as ls}from"./volume-2-B2UoV80q-1765668175382.js";import"./arrow-left-BeOJZqwI-1765668175382.js";import"./chevron-left-DaeWP-VT-1765668175382.js";const os=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],cs=mt("eye-off",os);async function ds(a,o=50){const{data:i,error:s}=await F.from("notifications").select("*, from_user:users!from_user_id(*)").eq("user_id",a).order("created_at",{ascending:!1}).limit(o);return s?(console.error("Get notifications error:",s),[]):i||[]}async function ye(a){const{count:o,error:i}=await F.from("notifications").select("*",{count:"exact",head:!0}).eq("user_id",a).eq("is_read",!1);return i?(console.error("Get unread count error:",i),0):o||0}async function us(a){const{error:o}=await F.from("notifications").update({is_read:!0}).eq("id",a);return!o}async function ms(a){const{error:o}=await F.from("notifications").update({is_read:!0}).eq("user_id",a).eq("is_read",!1);return!o}function hs(a){const{type:o,content:i}=a;if(i)return i;switch(o){case"like":return"liked your post";case"comment":return"commented on your post";case"follow":return"started following you";case"subscription":return"subscribed to your content";case"tip":return"sent you a tip";case"gift":return"sent you a gift";case"message":return"sent you a message";case"livestream":return"started a livestream";case"system":return"System notification";default:return"interacted with you"}}function Oe(a,o){const i=F.channel(`notifications:${a}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${a}`},async s=>{const{data:n}=await F.from("notifications").select("*, from_user:users!from_user_id(*)").eq("id",s.new.id).single();n&&o(n)}).subscribe();return()=>{F.removeChannel(i)}}async function fs(a){const{error:o}=await F.from("notifications").delete().eq("id",a);return!o}function A(a,o,i){let s=i.initialDeps??[],n;function r(){var l,c,p,v;let b;i.key&&((l=i.debug)!=null&&l.call(i))&&(b=Date.now());const _=a();if(!(_.length!==s.length||_.some((w,N)=>s[N]!==w)))return n;s=_;let C;if(i.key&&((c=i.debug)!=null&&c.call(i))&&(C=Date.now()),n=o(..._),i.key&&((p=i.debug)!=null&&p.call(i))){const w=Math.round((Date.now()-b)*100)/100,N=Math.round((Date.now()-C)*100)/100,E=N/16,P=(f,h)=>{for(f=String(f);f.length<h;)f=" "+f;return f};console.info(`%câ± ${P(N,5)} /${P(w,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*E,120))}deg 100% 31%);`,i?.key)}return(v=i?.onChange)==null||v.call(i,n),n}return r.updateDeps=l=>{s=l},r}function je(a,o){if(a===void 0)throw new Error("Unexpected undefined");return a}const xs=(a,o)=>Math.abs(a-o)<1.01,gs=(a,o,i)=>{let s;return function(...n){a.clearTimeout(s),s=a.setTimeout(()=>o.apply(this,n),i)}},Ne=a=>{const{offsetWidth:o,offsetHeight:i}=a;return{width:o,height:i}},ps=a=>a,bs=a=>{const o=Math.max(a.startIndex-a.overscan,0),i=Math.min(a.endIndex+a.overscan,a.count-1),s=[];for(let n=o;n<=i;n++)s.push(n);return s},ws=(a,o)=>{const i=a.scrollElement;if(!i)return;const s=a.targetWindow;if(!s)return;const n=l=>{const{width:c,height:p}=l;o({width:Math.round(c),height:Math.round(p)})};if(n(Ne(i)),!s.ResizeObserver)return()=>{};const r=new s.ResizeObserver(l=>{const c=()=>{const p=l[0];if(p?.borderBoxSize){const v=p.borderBoxSize[0];if(v){n({width:v.inlineSize,height:v.blockSize});return}}n(Ne(i))};a.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(c):c()});return r.observe(i,{box:"border-box"}),()=>{r.unobserve(i)}},_e={passive:!0},ke=typeof window>"u"?!0:"onscrollend"in window,vs=(a,o)=>{const i=a.scrollElement;if(!i)return;const s=a.targetWindow;if(!s)return;let n=0;const r=a.options.useScrollendEvent&&ke?()=>{}:gs(s,()=>{o(n,!1)},a.options.isScrollingResetDelay),l=b=>()=>{const{horizontal:_,isRtl:k}=a.options;n=_?i.scrollLeft*(k&&-1||1):i.scrollTop,r(),o(n,b)},c=l(!0),p=l(!1);p(),i.addEventListener("scroll",c,_e);const v=a.options.useScrollendEvent&&ke;return v&&i.addEventListener("scrollend",p,_e),()=>{i.removeEventListener("scroll",c),v&&i.removeEventListener("scrollend",p)}},ys=(a,o,i)=>{if(o?.borderBoxSize){const s=o.borderBoxSize[0];if(s)return Math.round(s[i.options.horizontal?"inlineSize":"blockSize"])}return a[i.options.horizontal?"offsetWidth":"offsetHeight"]},js=(a,{adjustments:o=0,behavior:i},s)=>{var n,r;const l=a+o;(r=(n=s.scrollElement)==null?void 0:n.scrollTo)==null||r.call(n,{[s.options.horizontal?"left":"top"]:l,behavior:i})};class Ns{constructor(o){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let i=null;const s=()=>i||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:i=new this.targetWindow.ResizeObserver(n=>{n.forEach(r=>{const l=()=>{this._measureElement(r.target,r)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()})}));return{disconnect:()=>{var n;(n=s())==null||n.disconnect(),i=null},observe:n=>{var r;return(r=s())==null?void 0:r.observe(n,{box:"border-box"})},unobserve:n=>{var r;return(r=s())==null?void 0:r.unobserve(n)}}})(),this.range=null,this.setOptions=i=>{Object.entries(i).forEach(([s,n])=>{typeof n>"u"&&delete i[s]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:ps,rangeExtractor:bs,onChange:()=>{},measureElement:ys,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...i}},this.notify=i=>{var s,n;(n=(s=this.options).onChange)==null||n.call(s,this,i)},this.maybeNotify=A(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),i=>{this.notify(i)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(i=>i()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var i;const s=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==s){if(this.cleanup(),!s){this.maybeNotify();return}this.scrollElement=s,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((i=this.scrollElement)==null?void 0:i.window)??null,this.elementsCache.forEach(n=>{this.observer.observe(n)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,n=>{this.scrollRect=n,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(n,r)=>{this.scrollAdjustments=0,this.scrollDirection=r?this.getScrollOffset()<n?"forward":"backward":null,this.scrollOffset=n,this.isScrolling=r,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(i,s)=>{const n=new Map,r=new Map;for(let l=s-1;l>=0;l--){const c=i[l];if(n.has(c.lane))continue;const p=r.get(c.lane);if(p==null||c.end>p.end?r.set(c.lane,c):c.end<p.end&&n.set(c.lane,!0),n.size===this.options.lanes)break}return r.size===this.options.lanes?Array.from(r.values()).sort((l,c)=>l.end===c.end?l.index-c.index:l.end-c.end)[0]:void 0},this.getMeasurementOptions=A(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(i,s,n,r,l)=>(this.pendingMeasuredCacheIndexes=[],{count:i,paddingStart:s,scrollMargin:n,getItemKey:r,enabled:l}),{key:!1}),this.getMeasurements=A(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:i,paddingStart:s,scrollMargin:n,getItemKey:r,enabled:l},c)=>{if(!l)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(b=>{this.itemSizeCache.set(b.key,b.size)}));const p=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const v=this.measurementsCache.slice(0,p);for(let b=p;b<i;b++){const _=r(b),k=this.options.lanes===1?v[b-1]:this.getFurthestMeasurement(v,b),C=k?k.end+this.options.gap:s+n,w=c.get(_),N=typeof w=="number"?w:this.options.estimateSize(b),E=C+N,P=k?k.lane:b%this.options.lanes;v[b]={index:b,start:C,size:N,end:E,key:_,lane:P}}return this.measurementsCache=v,v},{key:!1,debug:()=>this.options.debug}),this.calculateRange=A(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(i,s,n,r)=>this.range=i.length>0&&s>0?_s({measurements:i,outerSize:s,scrollOffset:n,lanes:r}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=A(()=>{let i=null,s=null;const n=this.calculateRange();return n&&(i=n.startIndex,s=n.endIndex),this.maybeNotify.updateDeps([this.isScrolling,i,s]),[this.options.rangeExtractor,this.options.overscan,this.options.count,i,s]},(i,s,n,r,l)=>r===null||l===null?[]:i({startIndex:r,endIndex:l,overscan:s,count:n}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=i=>{const s=this.options.indexAttribute,n=i.getAttribute(s);return n?parseInt(n,10):(console.warn(`Missing attribute name '${s}={index}' on measured element.`),-1)},this._measureElement=(i,s)=>{const n=this.indexFromElement(i),r=this.measurementsCache[n];if(!r)return;const l=r.key,c=this.elementsCache.get(l);c!==i&&(c&&this.observer.unobserve(c),this.observer.observe(i),this.elementsCache.set(l,i)),i.isConnected&&this.resizeItem(n,this.options.measureElement(i,s,this))},this.resizeItem=(i,s)=>{const n=this.measurementsCache[i];if(!n)return;const r=this.itemSizeCache.get(n.key)??n.size,l=s-r;l!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(n,l,this):n.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=l,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(n.index),this.itemSizeCache=new Map(this.itemSizeCache.set(n.key,s)),this.notify(!1))},this.measureElement=i=>{if(!i){this.elementsCache.forEach((s,n)=>{s.isConnected||(this.observer.unobserve(s),this.elementsCache.delete(n))});return}this._measureElement(i,void 0)},this.getVirtualItems=A(()=>[this.getVirtualIndexes(),this.getMeasurements()],(i,s)=>{const n=[];for(let r=0,l=i.length;r<l;r++){const c=i[r],p=s[c];n.push(p)}return n},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=i=>{const s=this.getMeasurements();if(s.length!==0)return je(s[Re(0,s.length-1,n=>je(s[n]).start,i)])},this.getOffsetForAlignment=(i,s,n=0)=>{const r=this.getSize(),l=this.getScrollOffset();s==="auto"&&(s=i>=l+r?"end":"start"),s==="center"?i+=(n-r)/2:s==="end"&&(i-=r);const c=this.getTotalSize()+this.options.scrollMargin-r;return Math.max(Math.min(c,i),0)},this.getOffsetForIndex=(i,s="auto")=>{i=Math.max(0,Math.min(i,this.options.count-1));const n=this.measurementsCache[i];if(!n)return;const r=this.getSize(),l=this.getScrollOffset();if(s==="auto")if(n.end>=l+r-this.options.scrollPaddingEnd)s="end";else if(n.start<=l+this.options.scrollPaddingStart)s="start";else return[l,s];const c=s==="end"?n.end+this.options.scrollPaddingEnd:n.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(c,s,n.size),s]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(i,{align:s="start",behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(i,s),{adjustments:void 0,behavior:n})},this.scrollToIndex=(i,{align:s="auto",behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),i=Math.max(0,Math.min(i,this.options.count-1));let r=0;const l=10,c=v=>{if(!this.targetWindow)return;const b=this.getOffsetForIndex(i,v);if(!b){console.warn("Failed to get offset for index:",i);return}const[_,k]=b;this._scrollToOffset(_,{adjustments:void 0,behavior:n}),this.targetWindow.requestAnimationFrame(()=>{const C=this.getScrollOffset(),w=this.getOffsetForIndex(i,k);if(!w){console.warn("Failed to get offset for index:",i);return}xs(w[0],C)||p(k)})},p=v=>{this.targetWindow&&(r++,r<l?this.targetWindow.requestAnimationFrame(()=>c(v)):console.warn(`Failed to scroll to index ${i} after ${l} attempts.`))};c(s)},this.scrollBy=(i,{behavior:s}={})=>{s==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+i,{adjustments:void 0,behavior:s})},this.getTotalSize=()=>{var i;const s=this.getMeasurements();let n;if(s.length===0)n=this.options.paddingStart;else if(this.options.lanes===1)n=((i=s[s.length-1])==null?void 0:i.end)??0;else{const r=Array(this.options.lanes).fill(null);let l=s.length-1;for(;l>=0&&r.some(c=>c===null);){const c=s[l];r[c.lane]===null&&(r[c.lane]=c.end),l--}n=Math.max(...r.filter(c=>c!==null))}return Math.max(n-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(i,{adjustments:s,behavior:n})=>{this.options.scrollToFn(i,{behavior:n,adjustments:s},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(o)}}const Re=(a,o,i,s)=>{for(;a<=o;){const n=(a+o)/2|0,r=i(n);if(r<s)a=n+1;else if(r>s)o=n-1;else return n}return a>0?a-1:0};function _s({measurements:a,outerSize:o,scrollOffset:i,lanes:s}){const n=a.length-1,r=p=>a[p].start;if(a.length<=s)return{startIndex:0,endIndex:n};let l=Re(0,n,r,i),c=l;if(s===1)for(;c<n&&a[c].end<i+o;)c++;else if(s>1){const p=Array(s).fill(0);for(;c<n&&p.some(b=>b<i+o);){const b=a[c];p[b.lane]=b.end,c++}const v=Array(s).fill(i+o);for(;l>=0&&v.some(b=>b>=i);){const b=a[l];v[b.lane]=b.start,l--}l=Math.max(0,l-l%s),c=Math.min(n,c+(s-1-c%s))}return{startIndex:l,endIndex:c}}const Se=typeof document<"u"?d.useLayoutEffect:d.useEffect;function ks(a){const o=d.useReducer(()=>({}),{})[1],i={...a,onChange:(n,r)=>{var l;r?ht.flushSync(o):o(),(l=a.onChange)==null||l.call(a,n,r)}},[s]=d.useState(()=>new Ns(i));return s.setOptions(i),Se(()=>s._didMount(),[]),Se(()=>s._willUpdate()),s}function Ss(a){return ks({observeElementRect:ws,observeElementOffset:vs,scrollToFn:js,...a})}const Cs={like:ze,follow:Ut,comment:pe,subscription:B,message:pe,tip:$t,gift:Vt,livestream:Dt,system:Q},Ms={like:"bg-red-500",follow:"bg-blue-500",comment:"bg-green-500",subscription:"bg-purple-500",message:"bg-of-blue",tip:"bg-yellow-500",gift:"bg-pink-500",livestream:"bg-red-600",system:"bg-gray-500"};function Es({user:a,scrollElement:o}){const{t:i}=Pe(),[s,n]=d.useState([]),[r,l]=d.useState(!0),[c,p]=d.useState(!1),b=(typeof document<"u"?document.querySelector("main")||document.documentElement:null)??(typeof document<"u"?document.documentElement:null),_=Ss({count:s.length,getScrollElement:()=>o??b,estimateSize:()=>96,overscan:6});d.useEffect(()=>{k();const h=Oe(a.telegram_id,S=>{n(j=>[S,...j])});return()=>h()},[a.telegram_id]);const k=async()=>{l(!0);const h=await ds(a.telegram_id);n(h),l(!1)},C=async()=>{p(!0),await ms(a.telegram_id),n(h=>h.map(S=>({...S,is_read:!0}))),p(!1)},w=async h=>{h.is_read||(await us(h.id),n(S=>S.map(j=>j.id===h.id?{...j,is_read:!0}:j)))},N=async h=>{await fs(h),n(S=>S.filter(j=>j.id!==h))},E=h=>{const S=Date.now()-new Date(h).getTime(),j=Math.floor(S/6e4);if(j<1)return i("messages.time.now");if(j<60)return i("messages.time.minutes",{count:j});const M=Math.floor(j/60);if(M<24)return i("feed.time.hours",{count:M});const y=Math.floor(M/24);return y<7?i("feed.time.days",{count:y}):new Date(h).toLocaleDateString()},P=s.filter(h=>!h.is_read).length,f=(h,S)=>{const j=Cs[h.type]||Q,M=Ms[h.type]||"bg-gray-500";return e.jsxs(I.div,{className:`group p-3 flex items-center gap-3 cursor-pointer transition-colors rounded-xl ${h.is_read?"bg-white/5":"bg-white/10"}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:Math.min(S*.02,.2)},onClick:()=>w(h),children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("img",{src:h.from_user?.avatar_url||`https://i.pravatar.cc/150?u=${h.from_user_id||"system"}`,alt:"",loading:"lazy",className:"w-12 h-12 rounded-full object-cover"}),e.jsx("div",{className:`absolute -bottom-1 -right-1 w-6 h-6 rounded-full ${M} flex items-center justify-center border-2 border-black`,children:e.jsx(j,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm text-white",children:[e.jsx("span",{className:"font-semibold",children:h.from_user?.first_name||"System"}),h.from_user?.is_verified&&e.jsx(H,{className:"w-3 h-3 text-blue-400 fill-blue-400 inline ml-1"}),e.jsxs("span",{className:"text-white/70",children:[" ",hs(h)]})]}),e.jsx("span",{className:"text-xs text-white/40",children:E(h.created_at)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!h.is_read&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsx("button",{onClick:y=>{y.stopPropagation(),N(h.id)},className:"p-1 hover:bg-white/10 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Ie,{className:"w-4 h-4 text-white/40"})})]})]},h.id)};return r?e.jsx("div",{className:"p-4 space-y-2",children:[1,2,3].map(h=>e.jsxs("div",{className:"p-3 flex gap-3 animate-pulse rounded-xl bg-white/5",children:[e.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-1/4"})]})]},h))}):e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:P>0&&e.jsxs("span",{className:"bg-blue-500 text-white text-xs px-2 py-0.5 rounded-full",children:[P," new"]})}),P>0&&e.jsxs("button",{onClick:C,disabled:c,className:"text-sm text-blue-400 flex items-center gap-1",children:[c?e.jsx(K,{className:"w-4 h-4 animate-spin"}):e.jsx(re,{className:"w-4 h-4"}),i("notifications.markAllRead")]})]}),s.length===0?e.jsxs("div",{className:"p-8 text-center rounded-xl bg-white/5",children:[e.jsx(Q,{className:"w-12 h-12 mx-auto text-white/30 mb-3"}),e.jsx("p",{className:"text-white/60",children:i("notifications.emptyTitle")}),e.jsx("p",{className:"text-sm text-white/40 mt-1",children:i("notifications.emptySubtitle")})]}):e.jsx("div",{className:"relative",style:{height:_.getTotalSize()||s.length*96},children:_.getVirtualItems().map(h=>e.jsx("div",{className:"absolute left-0 w-full",style:{transform:`translateY(${h.start}px)`},children:f(s[h.index],h.index)},h.key))})]})}function Ps({isOpen:a,onClose:o,title:i,users:s,loading:n,onUserClick:r}){return e.jsx(V,{mode:"sync",children:a&&e.jsxs(e.Fragment,{children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeOut"},className:"fixed inset-0 bg-black/70 z-[9998]",onClick:o}),e.jsx(I.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"tween",duration:.3,ease:[.32,.72,0,1]},className:"fixed bottom-0 left-0 right-0 z-[9999] will-change-transform",style:{height:"55%"},children:e.jsxs("div",{className:"h-full bg-[#262626] rounded-t-[12px] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-9 h-1 bg-[#555] rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-[#363636]",children:[e.jsx("h3",{className:"text-base font-semibold text-white",children:i}),e.jsx("button",{onClick:o,className:"p-1.5 rounded-full bg-[#363636] active:bg-[#444]",children:e.jsx(Y,{className:"w-4 h-4 text-gray-400"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-[#262626]",children:n?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx("div",{className:"w-6 h-6 border-2 border-gray-600 border-t-white rounded-full animate-spin"})}):s.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center py-10 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No one yet"})}):e.jsx("div",{className:"py-1",children:s.map(l=>e.jsxs("button",{onClick:()=>r?.(l),className:"w-full flex items-center gap-3 px-4 py-3 active:bg-white/5",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("img",{src:l.avatar_url||`https://i.pravatar.cc/150?u=${l.telegram_id}`,alt:"",className:"w-11 h-11 rounded-full object-cover bg-[#333]"}),l.is_verified&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 bg-[#262626] rounded-full p-0.5",children:e.jsx(H,{className:"w-3.5 h-3.5 text-[#0095f6] fill-[#0095f6]"})})]}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("span",{className:"font-semibold text-[15px] text-white truncate block",children:l.username||l.first_name||"User"}),l.first_name&&l.username&&e.jsxs("p",{className:"text-[13px] text-gray-500 truncate",children:[l.first_name," ",l.last_name||""]})]}),l.is_creator&&e.jsx("span",{className:"text-[11px] font-semibold text-[#0095f6] bg-[#0095f6]/10 px-2.5 py-1 rounded-full",children:"Creator"})]},l.telegram_id))})})]})})]})})}function zs({isOpen:a,onClose:o,post:i,currentUserId:s}){const[n,r]=d.useState([]),[l,c]=d.useState(""),[p,v]=d.useState([]),[b,_]=d.useState(!1),[k,C]=d.useState(!1),[w,N]=d.useState(null),[E,P]=d.useState(new Set),f=d.useRef(null),h=d.useRef(null);d.useEffect(()=>{a&&s&&S()},[a,s]),d.useEffect(()=>{a||(c(""),v([]),P(new Set))},[a]),d.useEffect(()=>{if(f.current&&clearTimeout(f.current),!l.trim()){v([]),_(!1);return}return _(!0),f.current=setTimeout(async()=>{const y=await ft(l.trim(),20);v(y.filter(L=>L.telegram_id!==s)),_(!1)},300),()=>{f.current&&clearTimeout(f.current)}},[l,s]);const S=async()=>{C(!0);const y=await xt(s);r(y),C(!1)},j=async y=>{if(!i||w!==null)return;const L=y.telegram_id;N(L);try{const T=await pt(s,L,s);if(!T)throw new Error("Could not create conversation");const $=i.media_type==="video"?"video":"image";if(await bt(T.id,s,i.media_url||"",$,i.media_thumbnail||void 0))P(U=>new Set([...U,L])),be.success(`Sent to ${y.first_name||y.username||"User"}`);else throw new Error("Failed to send")}catch(T){console.error("Share error:",T),be.error("Failed to share")}finally{N(null)}};if(!a)return null;const M=l.trim().length>0;return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:o}),e.jsxs("div",{ref:h,className:"relative w-full max-w-lg bg-[#1a1a1a] rounded-t-2xl max-h-[80vh] flex flex-col animate-slide-up",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-10 h-1 bg-white/20 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 pb-3 border-b border-white/10",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Share to"}),e.jsx("button",{onClick:o,className:"p-1.5 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Y,{className:"w-5 h-5 text-white/70"})})]}),e.jsx("div",{className:"px-4 py-3 border-b border-white/10",children:e.jsxs("div",{className:"relative",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/40"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:l,onChange:y=>c(y.target.value),className:"w-full bg-white/10 text-white placeholder-white/40 rounded-full py-2.5 pl-10 pr-4 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500/50"}),b&&e.jsx(K,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/40 animate-spin"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto overscroll-contain",children:k&&!M?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(K,{className:"w-6 h-6 text-white/40 animate-spin"})}):M?e.jsx("div",{className:"py-2",children:p.length===0&&!b?e.jsx("p",{className:"text-center text-white/40 py-8 text-sm",children:"No users found"}):p.map(y=>e.jsx(Ce,{user:y,isSending:w===y.telegram_id,isSent:E.has(y.telegram_id),onShare:()=>j(y)},y.telegram_id))}):e.jsx("div",{className:"py-2",children:n.length===0?e.jsx("p",{className:"text-center text-white/40 py-8 text-sm",children:"No recent chats"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"px-4 py-2 text-xs text-white/40 font-medium uppercase",children:"Recent"}),n.map(y=>y.other_user&&e.jsx(Ce,{user:y.other_user,isSending:w===y.other_user.telegram_id,isSent:E.has(y.other_user.telegram_id),onShare:()=>j(y.other_user)},y.id))]})})}),e.jsx("div",{className:"h-6"})]})]})}function Ce({user:a,isSending:o,isSent:i,onShare:s}){const n=a.first_name||a.username||"User";return e.jsxs("button",{onClick:s,disabled:o||i,className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-white/5 active:bg-white/10 transition-colors disabled:opacity-50",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gradient-to-br from-sky-400 to-purple-500 flex-shrink-0",children:a.avatar_url?e.jsx("img",{src:a.avatar_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white font-semibold text-lg",children:n.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"font-medium text-white truncate",children:n}),a.is_verified&&e.jsx("svg",{className:"w-4 h-4 text-sky-400 flex-shrink-0",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})]}),a.username&&e.jsxs("p",{className:"text-sm text-white/50 truncate",children:["@",a.username]})]}),e.jsx("div",{className:"flex-shrink-0",children:o?e.jsx(K,{className:"w-5 h-5 text-sky-400 animate-spin"}):i?e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(re,{className:"w-4 h-4 text-green-500"})}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-sky-500/20 flex items-center justify-center",children:e.jsx(Xt,{className:"w-4 h-4 text-sky-400"})})})]})}async function Is(a){const{reporterId:o,reportedId:i,reportedType:s,reason:n,description:r}=a,{error:l}=await F.from("reports").insert({reporter_id:o,reported_id:i,reported_type:s,reason:n,description:r,status:"pending"});return l?(console.error("Failed to submit report:",l),{success:!1,error:l.message}):{success:!0}}async function Os(a,o,i,s){return Is({reporterId:a,reportedId:o.toString(),reportedType:"post",reason:i,description:s})}const Me=5,Rs=3,Ee={midnight:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",ember:"linear-gradient(135deg, #2d1f1f 0%, #4a2020 50%, #6b2020 100%)",aurora:"linear-gradient(135deg, #1a2f1a 0%, #1a3a2a 50%, #0f4a3a 100%)",twilight:"linear-gradient(135deg, #2d1f3d 0%, #3d2050 50%, #4a1f6a 100%)",ocean:"linear-gradient(135deg, #0d1b2a 0%, #1b263b 50%, #274060 100%)",sunset:"linear-gradient(135deg, #3d2c29 0%, #5c3d31 50%, #7a4a3a 100%)"},ae=new Set;function ne(a){ae.forEach(o=>{o!==a&&!o.paused&&o.pause()})}function Ts({url:a}){const[o,i]=d.useState(!1),[s,n]=d.useState(!1);return o?e.jsx("div",{className:"w-full flex items-center justify-center bg-white/5",style:{aspectRatio:"4/5"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(At,{className:"w-10 h-10 text-white/30 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-white/40",children:"Failed to load image"})]})}):e.jsxs("div",{className:"relative w-full",style:{aspectRatio:"4/5"},children:[!s&&e.jsx("div",{className:"absolute inset-0 bg-white/5 animate-pulse"}),e.jsx("img",{src:a,alt:"",loading:"lazy",className:`w-full h-full object-contain bg-black select-none transition-opacity duration-200 ${s?"opacity-100":"opacity-0"}`,onLoad:()=>n(!0),onError:()=>i(!0)})]})}function Fs({src:a,muted:o=!0,shouldPlay:i=!1,onMuteChange:s}){const n=d.useRef(null),r=d.useRef(null),l=Wt(n,{minimumRatio:.5}),c=d.useRef(null),[p,v]=d.useState(!0),[b,_]=d.useState(!1),[k,C]=d.useState(!1);d.useEffect(()=>{const f=r.current;if(f)return ae.add(f),()=>{ae.delete(f)}},[]),d.useEffect(()=>{v(o)},[o]),d.useEffect(()=>{const f=r.current;if(!f)return;const h=i&&l;h&&f.paused?(ne(f),f.play().catch(()=>{})):!h&&!f.paused&&f.pause()},[i,l]),d.useEffect(()=>{const f=r.current;if(!f)return;const h=()=>{_(!0),ne(f)},S=()=>_(!1),j=()=>C(!0),M=()=>C(!1),y=()=>C(!1);return f.addEventListener("play",h),f.addEventListener("pause",S),f.addEventListener("waiting",j),f.addEventListener("playing",M),f.addEventListener("canplay",y),()=>{f.removeEventListener("play",h),f.removeEventListener("pause",S),f.removeEventListener("waiting",j),f.removeEventListener("playing",M),f.removeEventListener("canplay",y)}},[]);const w=()=>{const f=r.current;f&&(f.paused?(ne(f),f.play().catch(()=>{})):f.pause())},N=f=>{const h=f.touches[0];c.current={x:h.clientX,y:h.clientY,time:Date.now()}},E=f=>{if(!c.current)return;const h=f.changedTouches[0],S=Math.abs(h.clientX-c.current.x),j=Math.abs(h.clientY-c.current.y),M=Date.now()-c.current.time;S<15&&j<15&&M<300&&(f.preventDefault(),w()),c.current=null},P=f=>{f.stopPropagation(),f.preventDefault();const h=!p;v(h),s?.(h),r.current&&(r.current.muted=h)};return e.jsxs("div",{ref:n,className:"relative w-full bg-gray-900 overflow-hidden",style:{aspectRatio:"4/5"},onTouchStart:N,onTouchEnd:E,onClick:w,children:[e.jsx("video",{ref:r,src:a,className:"w-full h-full object-cover",playsInline:!0,loop:!0,muted:p,preload:"auto",poster:""}),k&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-10",children:e.jsx("div",{className:"w-10 h-10 border-2 border-white/40 border-t-white rounded-full animate-spin"})}),!b&&!k&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-10",children:e.jsx("div",{className:"w-14 h-14 bg-black/50 rounded-full flex items-center justify-center",children:e.jsx(rs,{className:"w-7 h-7 text-white fill-white ml-0.5"})})}),e.jsx("button",{onClick:P,onTouchEnd:f=>{f.stopPropagation(),c.current=null},className:"absolute bottom-4 left-4 w-9 h-9 bg-black/70 rounded-full flex items-center justify-center z-[999] active:scale-90 transition-transform backdrop-blur-sm",style:{touchAction:"manipulation"},children:p?e.jsx(Lt,{className:"w-4 h-4 text-white"}):e.jsx(ls,{className:"w-4 h-4 text-white"})})]})}function Ls({urls:a,canView:o,muted:i,onMuteChange:s,shouldPlay:n,onDoubleTap:r}){const[l,c]=d.useState(0),p=d.useRef(null),[v,b]=d.useState(!1),_=d.useRef(0),k=()=>{if(!p.current)return;const w=p.current.scrollLeft,N=p.current.offsetWidth,E=Math.round(w/N);E!==l&&c(E)},C=()=>{const w=Date.now();w-_.current<300&&(r?.(),b(!0),setTimeout(()=>b(!1),650)),_.current=w};return!o||a.length===0?null:e.jsxs("div",{className:"relative w-full bg-black rounded-2xl overflow-hidden",children:[e.jsx("div",{ref:p,className:"flex w-full h-full overflow-x-auto snap-x snap-mandatory scrollbar-hide",onScroll:k,style:{scrollbarWidth:"none",msOverflowStyle:"none"},onClick:C,children:a.map((w,N)=>e.jsx("div",{className:"flex-none w-full snap-center",children:w.match(/\.(mp4|webm|mov|m4v)(\?|$)/i)?e.jsx(Fs,{src:w,muted:i,onMuteChange:s,shouldPlay:n&&l===N}):e.jsx(Ts,{url:w})},N))}),e.jsx(V,{children:v&&e.jsx(I.div,{className:"absolute inset-0 flex items-center justify-center pointer-events-none",initial:{scale:.6,opacity:0},animate:{scale:1.1,opacity:.9},exit:{scale:.8,opacity:0},transition:{duration:.4},children:e.jsx(ze,{className:"w-24 h-24 text-white fill-white drop-shadow-[0_8px_24px_rgba(0,0,0,0.35)]"})})}),a.length>1&&e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5 z-10",children:a.map((w,N)=>e.jsx("div",{className:`w-1.5 h-1.5 rounded-full transition-all ${N===l?"bg-white w-2.5":"bg-white/50"}`},N))}),a.length>1&&e.jsxs("div",{className:"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full z-10",children:[l+1,"/",a.length]})]})}function pi({user:a,onCreatorClick:o,onSheetStateChange:i}){const{t:s}=Pe(),[n,r]=d.useState([]),[l,c]=d.useState([]),[p,v]=d.useState(!0),[b,_]=d.useState(!0),[k,C]=d.useState(null),[w,N]=d.useState(null),[E,P]=d.useState(!1),[f,h]=d.useState(null),[S,j]=d.useState(null),[M,y]=d.useState(Me),L=d.useRef(null),T=d.useRef(new Map),$=d.useRef(null),[q,U]=d.useState(!1),[Te,Fe]=d.useState([]),[Le,le]=d.useState(!1),[oe,ce]=d.useState(null),[J,de]=d.useState(!1),[De,Ae]=d.useState(null),[Ve,$e]=d.useState(void 0),[G,Ue]=d.useState([]),[We,ue]=d.useState(!1),[Be,He]=d.useState(0),[Z,me]=d.useState(!1),[qe,he]=d.useState(null),[ee,fe]=d.useState(!1),[te,se]=d.useState(0);d.useEffect(()=>{i?.(J||q||Z||ee||!!w||S!==null||!!f)},[J,q,Z,ee,w,S,f,i]),d.useEffect(()=>{Ge(),Xe()},[]),d.useEffect(()=>{const t=wt({onNewPost:m=>{r(u=>[{...m,liked:!1,saved:!1,can_view:!0},...u]),y(u=>u+1)},onPostUpdated:m=>{r(u=>u.map(g=>g.id===m.id?{...g,...m}:g))},onPostDeleted:m=>{r(u=>u.filter(g=>g.id!==m))},onLikeAdded:(m,u)=>{u!==a.telegram_id&&r(g=>g.map(x=>x.id===m?{...x,likes_count:(x.likes_count||0)+1}:x))},onLikeRemoved:(m,u)=>{u!==a.telegram_id&&r(g=>g.map(x=>x.id===m?{...x,likes_count:Math.max(0,(x.likes_count||0)-1)}:x))},onCommentAdded:(m,u)=>{r(g=>g.map(x=>x.id===m?{...x,comments_count:u}:x))}});return()=>t()},[a.telegram_id]),d.useEffect(()=>{(async()=>{const u=await ye(a.telegram_id);se(u)})();const m=Oe(a.telegram_id,()=>{se(u=>u+1)});return()=>m()},[a.telegram_id]);const Ge=async()=>{try{const[t,m,u]=await Promise.all([vt(a.telegram_id),yt(6,a.telegram_id),jt(a.telegram_id)]),g=new Set(u),x=t.filter(z=>!g.has(z.id));r(x),y(Math.min(x.length,Me)),c(m)}catch(t){console.error("[Home] loadData failed",t)}finally{v(!1)}},Xe=async()=>{try{const{stories:t}=await Kt();Ue(t||[])}catch(t){console.error("[Home] loadStories failed",t)}},Ke=async(t,m)=>{if(oe!==t.id&&t.poll_user_vote===void 0){ce(t.id);try{const u=await zt(t.id,m,a.telegram_id);u.data&&!u.error&&r(g=>g.map(x=>x.id===t.id?{...x,poll_votes:u.data.poll_votes,poll_total_votes:u.data.poll_total_votes,poll_user_vote:u.data.poll_user_vote}:x))}catch(u){console.error("Poll vote failed:",u)}finally{ce(null)}}},xe=async t=>{if(!t.can_view)return;const m=!t.liked,u=m?1:-1;r(g=>g.map(x=>x.id===t.id?{...x,liked:m,likes_count:Math.max(0,(x.likes_count||0)+u)}:x));try{m?await St(a.telegram_id,t.id):await Ct(a.telegram_id,t.id)}catch(g){r(x=>x.map(z=>z.id===t.id?{...z,liked:!m,likes_count:Math.max(0,(z.likes_count||0)-u)}:z)),console.warn("Like action failed",g)}},Qe=async t=>{const m=!t.saved;r(u=>u.map(g=>g.id===t.id?{...g,saved:m}:g));try{m?await Mt(a.telegram_id,t.id):await Et(a.telegram_id,t.id)}catch(u){r(g=>g.map(x=>x.id===t.id?{...x,saved:!m}:x)),console.warn("Save action failed",u)}},Ye=async t=>{if((t.likes_count||0)===0)return;U(!0),le(!0);const m=await Pt(t.id);Fe(m),le(!1)},ie=async t=>{Ae(t.id),$e(t.creator_id),de(!0)},Je=async t=>{P(!0),await Ht(a.telegram_id,t.id,async()=>{try{const m={id:t.id,unlock_price:t.unlock_price,is_purchased:!0,creator_id:t.creator_id};let u=t.media_url,g=t.media_urls;t.media_url&&(u=await we(t.media_url,m,a.telegram_id)),t.media_urls&&t.media_urls.length>0&&(g=await Promise.all(t.media_urls.map(x=>we(x,m,a.telegram_id)))),r(n.map(x=>x.id===t.id?{...x,can_view:!0,is_purchased:!0,media_url:u,media_urls:g}:x))}catch(m){console.error("Failed to fetch signed URL after purchase:",m),r(n.map(u=>u.id===t.id?{...u,can_view:!0,is_purchased:!0}:u))}N(null),P(!1)},m=>{console.error("Payment failed:",m),P(!1)})},Ze=()=>{f&&(r(n.filter(t=>t.id!==f.id)),h(null))},et=t=>{r(n.map(m=>m.id===t.id?t:m))},tt=async t=>{if(!await ve(s("feed.confirm.deletePost")))return;(await Nt(t.id,t.creator_id)).success?r(n.filter(g=>g.id!==t.id)):await X(s("feed.errors.deleteFailed")),j(null)},st=async t=>{r(n.filter(u=>u.id!==t.id)),j(null),await _t(a.telegram_id,t.id)||console.error("[HomePage] Failed to persist hidden post to Supabase")},it=async t=>{const u=window.prompt(s("feed.report.promptReason"),s("feed.report.defaultReason"))?.trim();if(!u){j(null);return}const g=window.prompt(s("feed.report.promptDescription"))?.trim(),x=await Os(a.telegram_id,t.id,u,g||void 0);x.success?alert(s("feed.report.success")):alert(s("feed.report.error",{error:x.error||s("feed.errors.tryAgain")})),j(null)},nt=async t=>{const u=`Post by @${t.creator?.username||t.creator?.first_name||"creator"} #${t.id}`;navigator.clipboard.writeText(u),await X(s("feed.linkCopied")),j(null)},at=async t=>{if(!await ve(s("feed.confirm.blockUser",{user:t.creator?.username||s("feed.userFallback")})))return;await kt(a.telegram_id,t.creator_id)?(r(g=>g.filter(x=>x.creator_id!==t.creator_id)),c(g=>g.filter(x=>x.telegram_id!==t.creator_id)),await X(s("feed.blockedSuccess"))):await X(s("feed.errors.blockFailed")),j(null)};d.useEffect(()=>{const t=L.current;if(!t||M>=n.length)return;const m=new IntersectionObserver(u=>{u[0]?.isIntersecting&&y(g=>g>=n.length?g:Math.min(n.length,g+Rs))},{rootMargin:"240px 0px"});return m.observe(t),()=>m.disconnect()},[M,n.length]);const W=d.useMemo(()=>n.slice(0,M),[n,M]);d.useEffect(()=>{if($.current&&$.current.disconnect(),k===null&&W.length>0){const g=W.find(x=>x.media_url?.match(/\.(mp4|webm|mov|m4v)(\?|$)/i)||x.media_urls?.some(z=>z.match(/\.(mp4|webm|mov|m4v)(\?|$)/i)));C(g?g.id:W[0].id)}const t=document.querySelector("main"),m=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],u=new IntersectionObserver(g=>{let x=null,z=0;T.current.forEach((O,D)=>{const R=O.getBoundingClientRect(),ut=window.innerHeight,ge=Math.max(0,Math.min(R.bottom,ut)-Math.max(R.top,0))/R.height;ge>z&&(z=ge,x=D)});for(const O of g){const D=O.target.dataset.postId,R=D?Number(D):null;R&&O.isIntersecting&&O.intersectionRatio>z&&(z=O.intersectionRatio,x=R)}x!==null&&x!==k&&C(x)},{root:t||void 0,threshold:m,rootMargin:"-10% 0px -10% 0px"});return T.current.forEach(g=>u.observe(g)),$.current=u,()=>{u.disconnect()}},[W,k]);const rt=t=>{const m=Date.now()-new Date(t).getTime(),u=Math.floor(m/36e5);return u<1?s("feed.time.justNow"):u<24?s("feed.time.hours",{count:u}):s("feed.time.days",{count:Math.floor(u/24)})},lt=t=>e.jsxs("div",{className:"bg-black pb-2 border-b border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5",children:[e.jsxs("button",{className:"flex items-center gap-3",onClick:()=>t.creator&&o(t.creator),children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden border border-gray-700",children:e.jsx("img",{src:t.creator?.avatar_url||"https://i.pravatar.cc/150?u="+t.creator_id,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold text-sm text-white",children:t.creator?.username||s("feed.userFallback")}),t.creator?.is_verified&&e.jsx(H,{className:"w-3.5 h-3.5 text-blue-500 fill-blue-500"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:m=>{m.stopPropagation(),j(S===t.id?null:t.id)},className:"p-2 text-white",children:e.jsx(Gt,{className:"w-5 h-5"})}),e.jsx(V,{children:S===t.id&&e.jsxs(e.Fragment,{children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40",onClick:()=>j(null)}),e.jsxs(I.div,{initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},className:"absolute right-0 top-full mt-2 z-50 min-w-[180px] rounded-2xl overflow-hidden shadow-2xl py-2",style:{background:"rgba(30, 30, 30, 0.85)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.1)"},onClick:m=>m.stopPropagation(),children:[Number(t.creator_id)===Number(a.telegram_id)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{h(t),j(null)},className:"w-full px-4 py-3 text-left text-sm text-white hover:bg-white/10 flex items-center gap-3 transition-colors",children:[e.jsx(Jt,{className:"w-4 h-4 text-white/70"})," ",s("feed.actions.edit")]}),e.jsxs("button",{onClick:()=>tt(t),className:"w-full px-4 py-3 text-left text-sm text-red-400 hover:bg-white/10 flex items-center gap-3 transition-colors",children:[e.jsx(Ie,{className:"w-4 h-4"})," ",s("feed.actions.delete")]}),e.jsx("div",{className:"h-px bg-white/10 mx-3 my-1"})]}),e.jsxs("button",{onClick:()=>nt(t),className:"w-full px-4 py-3 text-left text-sm text-white hover:bg-white/10 flex items-center gap-3 transition-colors",children:[e.jsx(Zt,{className:"w-4 h-4 text-white/70"})," ",s("feed.actions.copyLink")]}),e.jsxs("button",{onClick:()=>st(t),className:"w-full px-4 py-3 text-left text-sm text-white hover:bg-white/10 flex items-center gap-3 transition-colors",children:[e.jsx(cs,{className:"w-4 h-4 text-white/70"})," ",s("feed.actions.notInterested")]}),Number(t.creator_id)!==Number(a.telegram_id)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-px bg-white/10 mx-3 my-1"}),e.jsxs("button",{onClick:()=>at(t),className:"w-full px-4 py-3 text-left text-sm text-white hover:bg-white/10 flex items-center gap-3 transition-colors",children:[e.jsx(es,{className:"w-4 h-4 text-white/70"})," ",s("feed.actions.block")]}),e.jsxs("button",{onClick:()=>it(t),className:"w-full px-4 py-3 text-left text-sm text-red-400 hover:bg-white/10 flex items-center gap-3 transition-colors",children:[e.jsx(ts,{className:"w-4 h-4"})," ",s("feed.actions.report")]})]})]})]})})]})]}),t.media_url&&t.can_view?e.jsx("div",{className:"w-full bg-black rounded-2xl overflow-hidden border border-white/5","data-post-id":t.id,ref:m=>{m?T.current.set(t.id,m):T.current.delete(t.id)},children:e.jsx(Ls,{urls:t.media_urls&&t.media_urls.length>0?t.media_urls:[t.media_url],canView:t.can_view,muted:b,onMuteChange:_,shouldPlay:k===t.id,onDoubleTap:()=>xe(t)})}):t.media_url?e.jsxs("div",{className:"relative bg-gray-900 text-white aspect-[4/5] flex flex-col items-center justify-center text-center overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-900/40 via-gray-900 to-gray-900"}),e.jsxs("div",{className:"relative z-10 p-8 w-full max-w-md mx-auto",children:[e.jsx("div",{className:"w-20 h-20 mx-auto rounded-3xl bg-white/5 border border-white/10 flex items-center justify-center mb-6 backdrop-blur-xl shadow-2xl shadow-purple-500/10 rotate-3 hover:rotate-0 transition-transform duration-500",children:e.jsx(ss,{className:"w-8 h-8 text-white/90 drop-shadow-lg"})}),e.jsx("h3",{className:"text-2xl font-bold mb-3 tracking-tight",children:ot(t)}),e.jsx("p",{className:"text-white/60 mb-8 leading-relaxed",children:s("feed.lock.subtitle",{name:t.creator?.first_name})}),t.unlock_price>0?e.jsxs(I.button,{className:"w-full py-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-black rounded-2xl font-bold text-[15px] shadow-[0_0_30px_-5px_rgba(251,191,36,0.4)] flex items-center justify-center gap-2 hover:opacity-90 transition-opacity relative overflow-hidden group",whileTap:{scale:.98},onClick:()=>N(t),children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000"}),e.jsx(B,{className:"w-5 h-5 fill-current"}),s("feed.lock.unlockFor",{amount:Math.ceil(t.unlock_price)})]}):e.jsx(I.button,{className:"w-full py-4 bg-white text-white rounded-2xl font-bold text-[15px] shadow-[0_0_30px_-5px_rgba(255,255,255,0.3)] flex items-center justify-center gap-2 hover:bg-gray-900 transition-colors",whileTap:{scale:.98},onClick:()=>t.creator&&o(t.creator),children:t.visibility==="followers"?e.jsxs(e.Fragment,{children:[e.jsx(is,{className:"w-5 h-5"})," ",s("feed.lock.followToView")]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-5 h-5"})," ",s("feed.lock.subscribeToView")]})})]})]}):null,e.jsxs("div",{className:"px-3 py-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{className:"active:scale-90 transition-transform",onClick:()=>xe(t),children:e.jsx(It,{className:`w-6 h-6 ${t.liked?"text-red-500":"text-white"}`,filled:t.liked})}),e.jsx("button",{className:"active:scale-90 transition-transform",onClick:()=>ie(t),children:e.jsx(Ot,{className:"w-6 h-6 text-white"})}),e.jsx("button",{className:"active:scale-90 transition-transform",onClick:()=>{he(t),me(!0)},children:e.jsx(Rt,{className:"w-6 h-6 text-white"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>Qe(t),className:"active:scale-90 transition-transform",children:e.jsx(Tt,{className:"w-6 h-6 text-white",filled:t.saved})}),e.jsxs("button",{className:"flex flex-col items-center active:scale-90 transition-transform",onClick:()=>{},children:[e.jsx(Ft,{className:`w-6 h-6 ${(t.gifts_count||0)>0?"text-sky-400":"text-yellow-400"}`,filled:(t.gifts_count||0)>0}),(t.gifts_count||0)>0&&e.jsx("span",{className:"text-[9px] font-bold text-sky-400 -mt-0.5",children:t.gifts_count})]})]})]}),(t.likes_count||0)>0&&e.jsx("button",{className:"block mt-2",onClick:()=>Ye(t),children:e.jsx("span",{className:"text-sm font-semibold text-white",children:s("feed.likesCount",{count:t.likes_count||0})})}),t.post_type==="poll"&&t.poll_options?e.jsxs("div",{className:"mt-3",children:[t.content&&e.jsx("div",{className:"mb-3",children:e.jsxs("span",{className:"text-sm text-white",children:[e.jsx("span",{className:"font-semibold mr-1",children:t.creator?.username||s("feed.userFallback")}),t.content]})}),e.jsx("div",{className:"space-y-2",children:t.poll_options.map((m,u)=>{const g=t.poll_votes?.[u]||0,x=t.poll_total_votes||0,z=x>0?Math.round(g/x*100):0,O=t.poll_user_vote!==void 0,D=t.poll_user_vote===u,R=t.poll_ends_at&&new Date(t.poll_ends_at)<new Date;return e.jsxs("button",{onClick:()=>!O&&!R&&Ke(t,u),disabled:O||R||oe===t.id,className:`w-full relative overflow-hidden rounded-xl transition-all ${O||R?"cursor-default":"hover:bg-white/10 active:scale-[0.98]"}`,style:{background:"rgba(255, 255, 255, 0.05)",border:D?"2px solid rgba(255, 255, 255, 0.3)":"1px solid rgba(255, 255, 255, 0.1)"},children:[O&&e.jsx(I.div,{initial:{width:0},animate:{width:`${z}%`},transition:{duration:.5,ease:"easeOut"},className:"absolute inset-y-0 left-0 bg-white/10"}),e.jsxs("div",{className:"relative px-4 py-3 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-white flex items-center gap-2",children:[D&&e.jsx(re,{className:"w-4 h-4 text-green-400"}),m]}),O&&e.jsxs("span",{className:"text-sm font-semibold text-white/70",children:[z,"%"]})]})]},u)})}),e.jsxs("div",{className:"mt-2 flex items-center gap-3 text-xs text-white/40",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ns,{className:"w-3 h-3"}),t.poll_total_votes||0," votes"]}),t.poll_ends_at&&e.jsx("span",{children:new Date(t.poll_ends_at)<new Date?"Poll ended":`Ends ${new Date(t.poll_ends_at).toLocaleDateString()}`})]})]}):t.background_gradient&&Ee[t.background_gradient]?e.jsx("div",{className:"mt-3 rounded-2xl p-6 min-h-[120px] flex items-center justify-center",style:{background:Ee[t.background_gradient]},children:e.jsxs("div",{className:"text-center",children:[t.post_type==="question"&&e.jsx(as,{className:"w-6 h-6 text-white/60 mx-auto mb-2"}),e.jsx("p",{className:"text-white text-lg font-medium leading-relaxed",children:t.content}),e.jsxs("p",{className:"text-white/50 text-xs mt-3",children:["â€” ",t.creator?.username||s("feed.userFallback")]})]})}):t.content&&e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"text-sm text-white",children:[e.jsx("span",{className:"font-semibold mr-1",children:t.creator?.username||s("feed.userFallback")}),t.content]})}),t.comments_count>0&&e.jsx("button",{className:"block mt-2",onClick:()=>ie(t),children:e.jsx("span",{className:"text-sm text-gray-400",children:s("feed.viewComments",{count:t.comments_count})})}),e.jsxs("button",{className:"flex items-center gap-2 mt-2 w-full",onClick:()=>ie(t),children:[e.jsx("img",{src:a.avatar_url||"https://i.pravatar.cc/150?u="+a.telegram_id,className:"w-6 h-6 rounded-full object-cover",alt:""}),e.jsx("span",{className:"text-sm text-gray-500",children:s("feed.addComment")})]}),e.jsx("div",{className:"mt-0.5",children:e.jsx("span",{className:"text-[10px] text-gray-500 uppercase",children:rt(t.created_at)})})]})]},t.id),ot=t=>t.unlock_price>0&&!t.is_purchased?s("feed.lock.unlockFor",{amount:Math.ceil(t.unlock_price)}):t.is_nsfw&&!t.is_subscribed?s("feed.lock.nsfw"):t.visibility==="subscribers"&&!t.is_subscribed?s("feed.lock.subscribers"):t.visibility==="followers"&&!t.is_following&&!t.is_subscribed?s("feed.lock.followers"):s("feed.lock.default"),[ct,dt]=d.useState(!0);return d.useEffect(()=>{const t=document.querySelector("main");if(!t)return;const m=()=>{dt(t.scrollTop<100)};return t.addEventListener("scroll",m,{passive:!0}),()=>{t.removeEventListener("scroll",m)}},[]),p?e.jsx("div",{className:"bg-black min-h-screen p-4 space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"rounded-2xl border border-white/5 bg-[#0a0b0f] p-4 animate-pulse shadow-[0_14px_40px_rgba(0,0,0,0.35)]",children:[e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/10 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-white/10 rounded w-24 mb-2"}),e.jsx("div",{className:"h-3 bg-white/10 rounded w-16"})]})]}),e.jsx("div",{className:"h-48 bg-white/10 rounded-xl"})]},t))}):e.jsxs("div",{className:"bg-black max-w-lg mx-auto relative pb-16",children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 z-50 flex items-center justify-center transition-opacity duration-200 ${ct?"opacity-100":"opacity-0 pointer-events-none"}`,style:{height:"44px",marginTop:"calc(env(safe-area-inset-top, 0px) + 6px)"},children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("button",{onClick:()=>fe(!0),className:"relative w-9 h-9 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center active:bg-white/20 transition-colors",children:[e.jsx(Q,{className:"w-5 h-5 text-white"}),te>0&&e.jsx("div",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] bg-red-500 rounded-full flex items-center justify-center px-1",children:e.jsx("span",{className:"text-[10px] font-bold text-white",children:te>99?"99+":te})})]})})}),e.jsx("div",{style:{height:"calc(56px + env(safe-area-inset-top, 0px))"}}),G.length>0&&e.jsxs("div",{className:"border-b border-gray-800 py-3 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-[13px] font-semibold text-white",children:s("feed.stories.title")}),e.jsx("span",{className:"text-[12px] text-white/60",children:G.length})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-1",children:G.map((t,m)=>e.jsxs("button",{onClick:()=>{He(m),ue(!0)},className:"flex flex-col items-center min-w-[64px] gap-1 focus:outline-none",children:[e.jsx("div",{className:"w-[62px] h-[62px] rounded-full p-[2px] bg-gradient-to-tr from-blue-500 via-purple-500 to-pink-500",children:e.jsx("div",{className:"w-full h-full rounded-full p-[2px] bg-black",children:e.jsx("img",{src:t.user?.avatar_url||`https://i.pravatar.cc/150?u=${t.user_id}`,alt:"",className:"w-full h-full rounded-full object-cover"})})}),e.jsx("span",{className:"text-[11px] text-white/80 truncate max-w-[68px]",children:t.user?.first_name||t.user?.username||`@user${t.user_id}`})]},t.id))})]}),l.length>0&&e.jsxs("div",{className:"border-b border-gray-800 py-4 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-[14px] font-semibold text-gray-500",children:s("feed.suggested.title")}),e.jsx("button",{className:"text-[13px] font-semibold text-white",children:s("feed.suggested.seeAll")})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto no-scrollbar pb-1",children:l.map(t=>e.jsxs("div",{className:"min-w-[100px] flex flex-col items-center",children:[e.jsxs("button",{onClick:()=>o(t),className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("img",{src:t.avatar_url||`https://i.pravatar.cc/150?u=${t.telegram_id}`,className:"w-16 h-16 rounded-full object-cover border-2 border-white/10",alt:t.first_name}),t.is_verified&&e.jsx("div",{className:"absolute bottom-0 right-0 bg-black rounded-full p-[2px]",children:e.jsx(H,{className:"w-3.5 h-3.5 text-blue-500 fill-blue-500"})})]}),e.jsx("span",{className:"text-[12px] font-medium text-white truncate w-full text-center max-w-[90px]",children:t.username||t.first_name})]}),e.jsx("button",{onClick:()=>o(t),className:"mt-2 px-4 py-1 bg-blue-500 text-white text-[11px] font-semibold rounded-md",children:s("feed.actions.follow")})]},t.telegram_id))})]}),e.jsx("div",{className:"bg-black",children:n.length===0?e.jsxs("div",{className:"px-4 py-16 text-center",children:[e.jsx("div",{className:"w-16 h-16 border-2 border-white rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Yt,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:s("feed.empty.title")}),e.jsx("p",{className:"text-sm text-gray-400",children:s("feed.empty.subtitle")})]}):e.jsxs("div",{children:[W.map(t=>lt(t)),M<n.length&&e.jsx("div",{ref:L,className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})})]})}),e.jsx(V,{children:w&&e.jsx(I.div,{className:"fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center z-[60] p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>!E&&N(null),children:e.jsxs(I.div,{className:"bg-[#1c1c1e] rounded-[2rem] p-6 max-w-sm w-full shadow-2xl border border-white/10",initial:{scale:.9,y:30,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:30,opacity:0},transition:{type:"spring",duration:.5},onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:s("feed.purchase.title")}),e.jsx("button",{onClick:()=>!E&&N(null),className:"p-1 rounded-full hover:bg-white/10 transition-colors",children:e.jsx(Y,{className:"w-6 h-6 text-gray-400"})})]}),e.jsxs("div",{className:"text-center mb-8 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-yellow-500/20 blur-3xl rounded-full"}),e.jsx("div",{className:"relative w-20 h-20 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx(B,{className:"w-10 h-10 text-white fill-white"})}),e.jsx("p",{className:"text-gray-400 text-sm font-medium mb-2",children:s("feed.purchase.payWithStars")}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(B,{className:"w-6 h-6 text-yellow-400 fill-yellow-400"}),e.jsx("span",{className:"text-4xl font-bold text-white tracking-tight",children:Math.ceil(w.unlock_price)})]})]}),e.jsx("div",{className:"bg-white/5 rounded-2xl p-4 mb-6 border border-white/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:w.creator?.avatar_url||`https://i.pravatar.cc/150?u=${w.creator_id}`,className:"w-10 h-10 rounded-full object-cover",alt:""}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-medium",children:w.creator?.first_name||w.creator?.username}),e.jsx("p",{className:"text-gray-500 text-sm",children:s("feed.purchase.creatorShare")})]})]})}),e.jsx(I.button,{className:"w-full py-4 rounded-2xl font-bold text-[15px] flex items-center justify-center gap-2 shadow-lg transition-all bg-gradient-to-r from-yellow-400 to-orange-500 text-black",whileHover:{scale:1.02,y:-1},whileTap:{scale:.98},onClick:()=>Je(w),disabled:E,children:E?e.jsx("div",{className:"w-5 h-5 border-2 border-black/30 border-t-black rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-5 h-5 fill-current"}),s("feed.purchase.payAmount",{amount:Math.ceil(w.unlock_price)})]})}),e.jsx("p",{className:"text-center text-gray-500 text-xs mt-4",children:s("feed.purchase.poweredBy")})]})})}),e.jsx(V,{children:f&&e.jsx(Bt,{post:f,user:a,onBack:()=>h(null),onDeleted:Ze,onUpdated:et})}),We&&e.jsx(Qt,{stories:G,startIndex:Be,onClose:()=>ue(!1)}),e.jsx(Ps,{isOpen:q,onClose:()=>U(!1),title:s("feed.likesTitle"),users:Te,loading:Le,onUserClick:t=>{U(!1),o(t)}}),e.jsx(qt,{isOpen:J,onClose:()=>de(!1),postId:De,postCreatorId:Ve,user:a}),e.jsx(zs,{isOpen:Z,onClose:()=>{me(!1),he(null)},post:qe,currentUserId:a.telegram_id}),e.jsx(V,{children:ee&&e.jsxs(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 z-[100] bg-black",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-black/80 backdrop-blur-md border-b border-white/10 px-4 py-3 flex items-center",style:{paddingTop:"calc(env(safe-area-inset-top, 0px) + 12px)"},children:[e.jsx("button",{onClick:()=>{fe(!1),ye(a.telegram_id).then(se)},className:"p-2 -ml-2 rounded-full active:bg-white/10",children:e.jsx(Y,{className:"w-5 h-5 text-white"})}),e.jsx("h1",{className:"ml-2 text-lg font-semibold text-white",children:s("notifications.title")})]}),e.jsx("div",{className:"h-full overflow-y-auto pb-20",children:e.jsx(Es,{user:a})})]})})]})}export{pi as default};
