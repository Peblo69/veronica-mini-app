import{c as Q,r as l,s as x,z as j,j as e,S as q,A as W,m as b,X,u as B,l as G,M as Y}from"./index-DkbCUiO5-1765392585133.js";import{a as J}from"./moderation-DkMdF02t-1765392585133.js";import{A as Z}from"./arrow-left-Ip2GFA8f-1765392585133.js";import{S as $}from"./sparkles-F5Uwdw-0-1765392585133.js";import{L as E}from"./loader-circle-CTbgZpW--1765392585133.js";import{S as V}from"./send-CeDBj33V-1765392585133.js";import{U as ee}from"./users-2_1f8_tL-1765392585133.js";import{T as te}from"./trending-up-CgcLmUUh-1765392585133.js";import{C as se}from"./clock-HnjdqURf-1765392585133.js";import{E as re}from"./ellipsis-B6dLowE4-1765392585133.js";import{R as ae}from"./repeat-2-hW9Q7rbZ-1765392585133.js";import{H as ie}from"./heart-VaFyGzMz-1765392585133.js";const le=[["path",{d:"M12 2v13",key:"1km8f5"}],["path",{d:"m16 6-4-4-4 4",key:"13yo43"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}]],oe=Q("share",le);function ne(s){const p=Math.floor((Date.now()-new Date(s).getTime())/1e3);if(p<60)return`${p}s`;const h=Math.floor(p/60);if(h<60)return`${h}m`;const m=Math.floor(h/60);if(m<24)return`${m}h`;const o=Math.floor(m/24);return o<7?`${o}d`:new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"})}function F(s){return s>=1e6?(s/1e6).toFixed(1).replace(/\.0$/,"")+"M":s>=1e3?(s/1e3).toFixed(1).replace(/\.0$/,"")+"K":s.toString()}function _e({user:s,onBack:p,onViewProfile:h}){const[m,o]=l.useState([]),[P,N]=l.useState(!0),[u,R]=l.useState("foryou"),[f,_]=l.useState(""),[w,U]=l.useState(!1),[A,L]=l.useState(!1),[d,M]=l.useState(""),[v,k]=l.useState(!1),g=l.useRef(null),y=500;l.useEffect(()=>{S()},[u,s.telegram_id]);const S=async()=>{N(!0);try{let t=x.from("posts").select(`
          *,
          creator:users!posts_creator_id_fkey(*)
        `).eq("post_type","thought").is("media_url",null).eq("is_hidden",!1).order("created_at",{ascending:!1}).limit(50);if(u==="following"){const{data:i}=await x.from("follows").select("following_id").eq("follower_id",s.telegram_id);if(i&&i.length>0){const K=i.map(O=>O.following_id);t=t.in("creator_id",K)}else{o([]),N(!1);return}}else u==="popular"&&(t=t.order("likes_count",{ascending:!1}));const{data:a,error:n}=await t;if(n)throw n;const r=(a||[]).map(i=>i.id),{data:C}=await x.from("likes").select("post_id").eq("user_id",s.telegram_id).in("post_id",r),T=new Set((C||[]).map(i=>i.post_id)),c=(a||[]).map(i=>({...i,liked:T.has(i.id),creator:i.creator||{telegram_id:i.creator_id,first_name:"User",username:"user"}}));o(c)}catch(t){console.error("Failed to load thoughts:",t),j.error("Failed to load thoughts")}N(!1)},I=async()=>{if(!f.trim()){S();return}L(!0);try{const{data:t,error:a}=await x.from("posts").select(`
          *,
          creator:users!posts_creator_id_fkey(*)
        `).eq("post_type","thought").is("media_url",null).eq("is_hidden",!1).ilike("content",`%${f}%`).order("created_at",{ascending:!1}).limit(50);if(a)throw a;const n=(t||[]).map(c=>c.id),{data:r}=await x.from("likes").select("post_id").eq("user_id",s.telegram_id).in("post_id",n),C=new Set((r||[]).map(c=>c.post_id)),T=(t||[]).map(c=>({...c,liked:C.has(c.id),creator:c.creator||{telegram_id:c.creator_id,first_name:"User",username:"user"}}));o(T)}catch(t){console.error("Search failed:",t)}L(!1)},D=async()=>{if(!(!d.trim()||v)){k(!0);try{if((await J(d))?.flagged){j.error("Content flagged by moderation"),k(!1);return}const{data:a,error:n}=await x.from("posts").insert({creator_id:s.telegram_id,content:d.trim(),post_type:"thought",visibility:"public",is_nsfw:!1,unlock_price:0}).select(`
          *,
          creator:users!posts_creator_id_fkey(*)
        `).single();if(n)throw n;o(r=>[{...a,liked:!1,creator:a.creator||s},...r]),M(""),j.success("Thought posted!")}catch(t){console.error("Failed to post thought:",t),j.error("Failed to post thought")}k(!1)}},H=async t=>{const a=t.liked;o(n=>n.map(r=>r.id===t.id?{...r,liked:!a,likes_count:(r.likes_count||0)+(a?-1:1)}:r));try{a?await B(s.telegram_id,t.id):await G(s.telegram_id,t.id)}catch{o(n=>n.map(r=>r.id===t.id?{...r,liked:a,likes_count:(r.likes_count||0)+(a?1:-1)}:r))}};l.useEffect(()=>{g.current&&(g.current.style.height="auto",g.current.style.height=Math.min(g.current.scrollHeight,150)+"px")},[d]);const z=[{id:"foryou",label:"For You",icon:$},{id:"following",label:"Following",icon:ee},{id:"popular",label:"Popular",icon:te},{id:"recent",label:"Recent",icon:se}];return e.jsxs("div",{className:"min-h-screen bg-black text-white",children:[e.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-black/90 backdrop-blur-xl border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:p,className:"p-2 -ml-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Z,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-purple-400"}),e.jsx("span",{className:"font-bold text-lg",children:"Thoughts"})]}),e.jsx("button",{onClick:()=>U(!w),className:"p-2 -mr-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsx(W,{children:w&&e.jsx(b.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-t border-white/10",children:e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-white/40"}),e.jsx("input",{type:"text",value:f,onChange:t=>_(t.target.value),onKeyDown:t=>t.key==="Enter"&&I(),placeholder:"Search thoughts...",className:"w-full pl-10 pr-10 py-2.5 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/40 focus:outline-none focus:border-purple-500"}),f&&e.jsx("button",{onClick:()=>{_(""),S()},className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(X,{className:"w-5 h-5 text-white/40"})})]})})})})]}),e.jsxs("div",{className:`pt-${w?"28":"16"}`,style:{paddingTop:w?"7rem":"4rem"},children:[e.jsx("div",{className:"bg-black border-b border-white/10 p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:s.avatar_url||`https://i.pravatar.cc/150?u=${s.telegram_id}`,alt:"",className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("textarea",{ref:g,value:d,onChange:t=>M(t.target.value.slice(0,y)),placeholder:"What's on your mind?",className:"w-full bg-transparent text-white placeholder-white/40 resize-none focus:outline-none text-[15px] leading-relaxed",rows:1}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("span",{className:`text-xs ${d.length>y*.9?"text-orange-400":"text-white/30"}`,children:[d.length,"/",y]}),e.jsx(b.button,{whileTap:{scale:.95},onClick:D,disabled:!d.trim()||v,className:`px-4 py-1.5 rounded-full font-semibold text-sm flex items-center gap-2 transition-all ${d.trim()?"bg-purple-500 text-white":"bg-white/10 text-white/30"}`,children:v?e.jsx(E,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4"}),"Post"]})})]})]})]})}),e.jsx("div",{className:"bg-black border-b border-white/10 px-2 py-2 overflow-x-auto scrollbar-hide",children:e.jsx("div",{className:"flex gap-2",children:z.map(t=>e.jsxs(b.button,{whileTap:{scale:.95},onClick:()=>{R(t.id),_("")},className:`flex items-center gap-1.5 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${u===t.id?"bg-purple-500 text-white":"bg-white/5 text-white/60 hover:bg-white/10"}`,children:[e.jsx(t.icon,{className:"w-4 h-4"}),t.label]},t.id))})}),e.jsx("div",{className:"pb-20",children:P||A?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(E,{className:"w-8 h-8 text-purple-400 animate-spin"})}):m.length===0?e.jsxs("div",{className:"py-20 text-center px-6",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-2xl bg-purple-500/20 flex items-center justify-center",children:e.jsx($,{className:"w-10 h-10 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:"No thoughts yet"}),e.jsx("p",{className:"text-white/50 text-sm",children:u==="following"?"Follow people to see their thoughts here":f?"No thoughts match your search":"Be the first to share a thought!"})]}):e.jsx("div",{className:"divide-y divide-white/5",children:m.map(t=>e.jsx(ce,{thought:t,onLike:()=>H(t),onViewProfile:h},t.id))})})]})]})}function ce({thought:s,onLike:p,onViewProfile:h}){const[m,o]=l.useState(!1);return e.jsx(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-4 hover:bg-white/[0.02] transition-colors",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>h?.(s.creator),className:"flex-shrink-0",children:e.jsx("img",{src:s.creator.avatar_url||`https://i.pravatar.cc/150?u=${s.creator.telegram_id}`,alt:"",className:"w-10 h-10 rounded-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("button",{onClick:()=>h?.(s.creator),className:"font-semibold text-white truncate hover:underline",children:s.creator.first_name||"User"}),e.jsxs("span",{className:"text-white/40 text-sm truncate",children:["@",s.creator.username||`user${s.creator.telegram_id}`]}),e.jsx("span",{className:"text-white/30",children:"Â·"}),e.jsx("span",{className:"text-white/40 text-sm flex-shrink-0",children:ne(s.created_at)})]}),e.jsx("button",{onClick:()=>o(!m),className:"p-1 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(re,{className:"w-4 h-4 text-white/40"})})]}),e.jsx("p",{className:"text-[15px] text-white/90 whitespace-pre-wrap break-words leading-relaxed",children:s.content}),e.jsxs("div",{className:"flex items-center gap-6 mt-3",children:[e.jsxs("button",{className:"flex items-center gap-1.5 text-white/40 hover:text-blue-400 transition-colors group",children:[e.jsx("div",{className:"p-1.5 rounded-full group-hover:bg-blue-400/10 transition-colors",children:e.jsx(Y,{className:"w-[18px] h-[18px]"})}),e.jsx("span",{className:"text-sm",children:F(s.comments_count||0)})]}),e.jsxs("button",{className:"flex items-center gap-1.5 text-white/40 hover:text-green-400 transition-colors group",children:[e.jsx("div",{className:"p-1.5 rounded-full group-hover:bg-green-400/10 transition-colors",children:e.jsx(ae,{className:"w-[18px] h-[18px]"})}),e.jsx("span",{className:"text-sm",children:F(s.repost_count||0)})]}),e.jsxs("button",{onClick:p,className:`flex items-center gap-1.5 transition-colors group ${s.liked?"text-pink-500":"text-white/40 hover:text-pink-500"}`,children:[e.jsx("div",{className:`p-1.5 rounded-full transition-colors ${s.liked?"bg-pink-500/10":"group-hover:bg-pink-500/10"}`,children:e.jsx(ie,{className:`w-[18px] h-[18px] ${s.liked?"fill-current":""}`})}),e.jsx("span",{className:"text-sm",children:F(s.likes_count||0)})]}),e.jsx("button",{className:"flex items-center gap-1.5 text-white/40 hover:text-purple-400 transition-colors group",children:e.jsx("div",{className:"p-1.5 rounded-full group-hover:bg-purple-400/10 transition-colors",children:e.jsx(oe,{className:"w-[18px] h-[18px]"})})})]})]})]})})}export{_e as default};
