const i="https://eigfbxjheuwxmtdfnvqc.supabase.co/functions/v1/ai-guardrail",d="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVpZ2ZieGpoZXV3eG10ZGZudnFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NDQ4NjEsImV4cCI6MjA4MDAyMDg2MX0.ilFCYkPxz8qJ3Yaw9Lt14JvdFlUsENKLYWXLYrHO8vA";async function n(e,t=15e3){console.log("[Guardrail] callGuardrail called with payload type:",e?.type),console.log("[Guardrail] URL:",i),console.log("[Guardrail] Starting fetch with timeout:",t,"ms");const o=new AbortController,a=setTimeout(()=>o.abort(),t);try{console.log("[Guardrail] Fetching...");const r=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify(e),signal:o.signal});if(clearTimeout(a),console.log("[Guardrail] Response status:",r.status),!r.ok){const l=await r.text();throw console.error("[Guardrail] Error:",r.status,l),new Error(l)}const s=await r.json();return console.log("[Guardrail] Response data:",JSON.stringify(s).substring(0,200)),s}catch(r){if(clearTimeout(a),r.name==="AbortError")return console.warn("[Guardrail] Request timed out after",t,"ms"),null;throw console.error("[Guardrail] Fetch error:",r.message),r}}async function g(e){try{return(await n({type:"text",content:e}))?.result||null}catch{return null}}async function c(e){return new Promise((t,o)=>{const a=new FileReader;a.onload=()=>t(a.result),a.onerror=o,a.readAsDataURL(e)})}async function u(e){const o=await(await fetch(e)).blob();return c(o)}async function m(e){console.log("[moderateImage] Called with source type:",e instanceof File?"File":e instanceof Blob?"Blob":"string");try{let t;if(e instanceof File||e instanceof Blob){console.log("[moderateImage] Converting File/Blob to base64...");const a=Date.now();t=await c(e),console.log("[moderateImage] Base64 conversion took:",Date.now()-a,"ms, length:",t.length)}else if(e.startsWith("blob:")){console.log("[moderateImage] Converting blob URL to base64...");const a=Date.now();t=await u(e),console.log("[moderateImage] Blob URL conversion took:",Date.now()-a,"ms, length:",t.length)}else console.log("[moderateImage] Using public URL as-is"),t=e;console.log("[moderateImage] Calling guardrail API...");const o=await n({type:"image",imageUrl:t});return console.log("[moderateImage] Guardrail returned:",o?"data":"null"),o?.result||null}catch(t){return console.error("[moderateImage] Error:",t),null}}async function w(e,t){try{console.log("[Translate] Requesting translation to",t,":",e.slice(0,50));const o=await n({type:"translate",content:e,targetLanguage:t});if(console.log("[Translate] API response:",JSON.stringify(o)),o?.translated)return console.log("[Translate] Success:",o.translated.slice(0,50)),o.translated;throw console.warn("[Translate] No translation in response:",o),new Error("Translation service returned empty result")}catch(o){throw console.error("[Translate] Error:",o),o}}export{g as a,m,w as t};
