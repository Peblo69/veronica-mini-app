const i="https://eigfbxjheuwxmtdfnvqc.supabase.co/functions/v1/ai-guardrail",c="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVpZ2ZieGpoZXV3eG10ZGZudnFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NDQ4NjEsImV4cCI6MjA4MDAyMDg2MX0.ilFCYkPxz8qJ3Yaw9Lt14JvdFlUsENKLYWXLYrHO8vA";async function o(t,r=15e3){const e=new AbortController,a=setTimeout(()=>e.abort(),r);try{const n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(t),signal:e.signal});if(clearTimeout(a),!n.ok){const s=await n.text();throw console.error("[Guardrail] Error:",n.status,s),new Error(s)}return n.json()}catch(n){if(clearTimeout(a),n.name==="AbortError")return console.warn("[Guardrail] Request timed out after",r,"ms"),null;throw n}}async function d(t){try{return(await o({type:"text",content:t}))?.result||null}catch{return null}}async function l(t){return new Promise((r,e)=>{const a=new FileReader;a.onload=()=>r(a.result),a.onerror=e,a.readAsDataURL(t)})}async function u(t){const e=await(await fetch(t)).blob();return l(e)}async function w(t){try{let r;return t instanceof File||t instanceof Blob?r=await l(t):t.startsWith("blob:")?r=await u(t):r=t,(await o({type:"image",imageUrl:r}))?.result||null}catch(r){return console.error("[moderateImage] Error:",r),null}}async function f(t,r){try{console.log("[Translate] Requesting translation to",r,":",t.slice(0,50));const e=await o({type:"translate",content:t,targetLanguage:r});if(console.log("[Translate] API response:",JSON.stringify(e)),e?.translated)return console.log("[Translate] Success:",e.translated.slice(0,50)),e.translated;throw console.warn("[Translate] No translation in response:",e),new Error("Translation service returned empty result")}catch(e){throw console.error("[Translate] Error:",e),e}}export{d as a,w as m,f as t};
