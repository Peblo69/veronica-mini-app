(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(5719)}])},5719:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return m}});var i=t(5893),l=t(7294),r=t(1617),a=t(8442);let d=null,n="".split(",").map(e=>e.trim().toLowerCase()).filter(Boolean);function o(e){var s,t;let{children:r}=e,[o,c]=(0,l.useState)(null),[x,m]=(0,l.useState)(""),[h,u]=(0,l.useState)(null),[b,p]=(0,l.useState)(!1),v=function(){if(d)return d;let e="https://eigfbxjheuwxmtdfnvqc.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVpZ2ZieGpoZXV3eG10ZGZudnFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NDQ4NjEsImV4cCI6MjA4MDAyMDg2MX0.ilFCYkPxz8qJ3Yaw9Lt14JvdFlUsENKLYWXLYrHO8vA";return e&&s?d=(0,a.eI)(e,s):null}();(0,l.useEffect)(()=>{if(!v)return;v.auth.getSession().then(e=>{let{data:s}=e;return c(s.session)});let{data:e}=v.auth.onAuthStateChange((e,s)=>{c(s)});return()=>{e.subscription.unsubscribe()}},[v]);let j=(null==o?void 0:null===(s=o.user)||void 0===s?void 0:s.email)&&n.length>0?n.includes(o.user.email.toLowerCase()):!!(null==o?void 0:null===(t=o.user)||void 0===t?void 0:t.email),w=async()=>{if(p(!0),u(null),!v){u("Supabase not configured"),p(!1);return}try{let{error:e}=await v.auth.signInWithOtp({email:x,options:{emailRedirectTo:window.location.href}});if(e)throw e;u("Check your email for the magic link.")}catch(e){u((null==e?void 0:e.message)||"Sign-in failed")}finally{p(!1)}},g=async()=>{await (null==v?void 0:v.auth.signOut()),c(null)};return v?o&&j?(0,i.jsxs)("div",{className:"min-h-screen bg-[#050505] text-white",children:[(0,i.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-3 flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"text-sm text-white/70",children:["Signed in as ",o.user.email]}),(0,i.jsx)("button",{onClick:g,className:"text-xs px-3 py-1.5 rounded-lg bg-red-500/20 border border-red-400/30 text-red-100",children:"Sign out"})]}),r]}):(0,i.jsx)("div",{className:"min-h-screen bg-[#050505] text-white flex items-center justify-center px-4",children:(0,i.jsxs)("div",{className:"w-full max-w-md rounded-2xl bg-white/5 border border-white/10 p-5",children:[(0,i.jsx)("h1",{className:"text-xl font-bold mb-2",children:"Admin Login"}),(0,i.jsxs)("p",{className:"text-xs text-white/60 mb-4",children:["Enter your admin email to receive a magic link. Allowed: ",n.length>0?n.join(", "):"any email"]}),(0,i.jsx)("input",{type:"email",placeholder:"you@example.com",className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-sm mb-3",value:x,onChange:e=>m(e.target.value)}),(0,i.jsx)("button",{onClick:w,disabled:b||!x,className:"w-full bg-white text-black font-semibold rounded-lg py-2 text-sm",children:b?"Sending…":"Send magic link"}),h&&(0,i.jsx)("p",{className:"text-xs text-white/70 mt-3",children:h})]})}):(0,i.jsx)("div",{className:"min-h-screen bg-[#050505] text-white flex items-center justify-center px-4",children:(0,i.jsxs)("div",{className:"w-full max-w-md rounded-2xl bg-white/5 border border-white/10 p-5 text-center space-y-2",children:[(0,i.jsx)("h1",{className:"text-xl font-bold",children:"Admin Login"}),(0,i.jsx)("p",{className:"text-sm text-white/70",children:"Supabase env vars missing. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY."})]})})}let c="https://eigfbxjheuwxmtdfnvqc.functions.supabase.co/admin-gateway";async function x(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,l=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json","x-admin-token":t,"x-admin-actor":i||"admin-ui"},body:JSON.stringify({action:e,...s})});if(!l.ok)throw Error(await l.text()||"Admin request failed");return l.json()}function m(){var e,s,t,a,d,n,m,b,p,v,j,w,g,f;let[N,y]=(0,l.useState)(null),[_,k]=(0,l.useState)(!1),[S,I]=(0,l.useState)(""),[C,P]=(0,l.useState)("");(0,l.useEffect)(()=>{let e=sessionStorage.getItem("admin_token")||"",s=sessionStorage.getItem("admin_actor")||"";e&&I(e),s&&P(s)},[]);let A=!!(S&&c),{data:L,mutate:E}=(0,r.ZP)(A?["stats",S,C]:null,async()=>x("stats",{},S,C),{refreshInterval:15e3}),{data:O}=(0,r.ZP)(A?["stats_overview",S,C]:null,async()=>x("stats_overview",{},S,C),{refreshInterval:2e4}),{data:Z}=(0,r.ZP)(A?["sales_by_day",S,C]:null,async()=>x("sales_by_day",{},S,C),{refreshInterval:2e4}),{data:U}=(0,r.ZP)(A?["top_creators",S,C]:null,async()=>x("top_creators",{},S,C),{refreshInterval:3e4}),{data:J}=(0,r.ZP)(A?["top_buyers",S,C]:null,async()=>x("top_buyers",{},S,C),{refreshInterval:3e4}),{data:D,mutate:T}=(0,r.ZP)(A?["users",S,C]:null,async()=>x("list_users",{limit:20},S,C),{refreshInterval:3e4}),{data:X,mutate:F}=(0,r.ZP)(A?["posts",S,C]:null,async()=>x("list_posts",{limit:20},S,C),{refreshInterval:3e4}),{data:R,mutate:B}=(0,r.ZP)(A?["audit",S,C]:null,async()=>x("list_audit",{limit:30},S,C),{refreshInterval:45e3}),{data:G,mutate:Y}=(0,r.ZP)(A?["orders",S,C]:null,async()=>x("list_orders",{limit:50},S,C),{refreshInterval:2e4}),M=async e=>{k(!0),y(null);try{await e(),y("Action completed"),E(),T(),F(),B(),Y()}catch(e){y((null==e?void 0:e.message)||"Action failed")}finally{k(!1)}};return(0,i.jsx)(o,{children:(0,i.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-6",children:[(0,i.jsxs)("header",{className:"flex items-center justify-between mb-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-white/50",children:"Admin"}),(0,i.jsx)("h1",{className:"text-2xl font-bold",children:"Dashboard"}),(0,i.jsxs)("p",{className:"text-[11px] text-white/50",children:["Actor: ",C||"unset"]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("button",{onClick:()=>{E(),T(),F(),B()},className:"px-3 py-1.5 rounded-lg bg-white/10 border border-white/10 text-sm",disabled:_||!A,children:"Refresh"}),(0,i.jsx)("button",{onClick:()=>{sessionStorage.removeItem("admin_token"),sessionStorage.removeItem("admin_actor"),I(""),P("")},className:"px-3 py-1.5 rounded-lg bg-red-500/20 border border-red-400/30 text-sm text-red-100",children:"Logout"})]})]}),!A&&(0,i.jsxs)("div",{className:"rounded-xl bg-white/5 border border-white/10 p-4 mb-6",children:[(0,i.jsx)("div",{className:"text-sm font-semibold mb-2",children:"Enter admin token"}),(0,i.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,i.jsx)("input",{type:"password",placeholder:"Admin token",className:"bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-sm",value:S,onChange:e=>I(e.target.value)}),(0,i.jsx)("input",{type:"text",placeholder:"Actor (e.g., your email)",className:"bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-sm",value:C,onChange:e=>P(e.target.value)}),(0,i.jsx)("button",{onClick:()=>{S&&(sessionStorage.setItem("admin_token",S),sessionStorage.setItem("admin_actor",C||"admin-ui"),y(null))},className:"px-3 py-2 rounded-lg bg-white text-black text-sm font-semibold",children:"Save & Continue"})]}),(0,i.jsx)("p",{className:"text-[11px] text-white/50 mt-2",children:"Token is stored in sessionStorage only. Keep this URL private."})]}),N&&(0,i.jsx)("div",{className:"mb-4 px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-sm",children:N}),(0,i.jsxs)("div",{className:"grid md:grid-cols-3 gap-3 mb-6",children:[(0,i.jsx)(h,{label:"Users",value:null!==(a=null==L?void 0:null===(e=L.data)||void 0===e?void 0:e.users)&&void 0!==a?a:"—"}),(0,i.jsx)(h,{label:"Posts",value:null!==(d=null==L?void 0:null===(s=L.data)||void 0===s?void 0:s.posts)&&void 0!==d?d:"—"}),(0,i.jsx)(h,{label:"Comments",value:null!==(n=null==L?void 0:null===(t=L.data)||void 0===t?void 0:t.comments)&&void 0!==n?n:"—"})]}),(0,i.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[(0,i.jsx)(u,{title:"Orders (30d)",children:(0,i.jsx)("div",{className:"space-y-2 text-xs",children:(null!==(m=null==O?void 0:O.data)&&void 0!==m?m:[]).map((e,s)=>(0,i.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-white/5 border border-white/10 px-3 py-2",children:[(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsxs)("span",{className:"font-semibold text-white",children:[e.reference_type," • ",e.status]}),(0,i.jsxs)("span",{className:"text-white/60",children:["Gross ",e.gross," | Net ",e.net," | Fee ",e.fees]})]}),(0,i.jsxs)("div",{className:"text-white font-semibold",children:[e.order_count," orders"]})]},s))})}),(0,i.jsx)(u,{title:"Top Creators (30d)",children:(0,i.jsx)("div",{className:"space-y-2 text-xs",children:(null!==(b=null==U?void 0:U.data)&&void 0!==b?b:[]).map((e,s)=>(0,i.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-white/5 border border-white/10 px-3 py-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"font-semibold text-white",children:["Creator ",e.creator_id]}),(0,i.jsxs)("div",{className:"text-white/60",children:["Orders ",e.orders]})]}),(0,i.jsxs)("div",{className:"text-white font-semibold",children:[e.net," net"]})]},s))})})]}),(0,i.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[(0,i.jsx)(u,{title:"Recent Orders",children:(0,i.jsx)("div",{className:"space-y-2 text-xs max-h-80 overflow-auto pr-1",children:(null!==(p=null==G?void 0:G.data)&&void 0!==p?p:[]).map(e=>{var s;return(0,i.jsxs)("div",{className:"rounded-lg bg-white/5 border border-white/10 px-3 py-2",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"font-semibold text-white",children:["Order #",e.id," • ",e.reference_type]}),(0,i.jsx)("span",{className:"text-[11px] text-white/60",children:new Date(e.created_at).toLocaleString()})]}),(0,i.jsxs)("div",{className:"text-white/70",children:["User ",e.user_id," → Creator ",null!==(s=e.creator_id)&&void 0!==s?s:"—"]}),(0,i.jsxs)("div",{className:"flex items-center gap-3 text-[11px] text-white/70 mt-1",children:[(0,i.jsxs)("span",{children:["Status: ",e.status]}),(0,i.jsxs)("span",{children:["Gross: ",e.amount]}),(0,i.jsxs)("span",{children:["Fee: ",e.fee]}),(0,i.jsxs)("span",{children:["Net: ",e.net]})]})]},e.id)})})}),(0,i.jsx)(u,{title:"Top Buyers (30d)",children:(0,i.jsx)("div",{className:"space-y-2 text-xs",children:(null!==(v=null==J?void 0:J.data)&&void 0!==v?v:[]).map((e,s)=>(0,i.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-white/5 border border-white/10 px-3 py-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"font-semibold text-white",children:["User ",e.user_id]}),(0,i.jsxs)("div",{className:"text-white/60",children:["Orders ",e.orders]})]}),(0,i.jsxs)("div",{className:"text-white font-semibold",children:[e.gross," gross"]})]},s))})}),(0,i.jsx)(u,{title:"Sales by Day (30d)",children:(0,i.jsx)("div",{className:"space-y-2 text-xs",children:(null!==(j=null==Z?void 0:Z.data)&&void 0!==j?j:[]).map((e,s)=>(0,i.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-white/5 border border-white/10 px-3 py-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-semibold text-white",children:new Date(e.day).toLocaleDateString()}),(0,i.jsxs)("div",{className:"text-white/60",children:[e.orders," orders"]})]}),(0,i.jsxs)("div",{className:"text-white font-semibold",children:["Gross ",e.gross]})]},s))})})]}),(0,i.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,i.jsx)(u,{title:"Recent Users",children:(0,i.jsx)("div",{className:"space-y-2 max-h-96 overflow-auto pr-1",children:(null!==(w=null==D?void 0:D.data)&&void 0!==w?w:[]).map(e=>(0,i.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-white/5 border border-white/10 px-3 py-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-semibold text-sm",children:e.username||e.telegram_id}),(0,i.jsxs)("div",{className:"text-xs text-white/60",children:[e.first_name," ",e.last_name," • ",e.is_creator?"Creator":"User"]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[e.is_locked&&(0,i.jsx)("span",{className:"text-[10px] px-2 py-1 rounded bg-red-500/20 border border-red-400/30 text-red-200",children:"Locked"}),(0,i.jsx)("button",{disabled:_,onClick:()=>M(()=>x(e.is_locked?"unlock_user":"lock_user",{userId:e.telegram_id},S,C)),className:"text-xs px-2 py-1 rounded bg-white/10 border border-white/15",children:e.is_locked?"Unlock":"Lock"})]})]},e.telegram_id))})}),(0,i.jsx)(u,{title:"Recent Posts",children:(0,i.jsx)("div",{className:"space-y-2 max-h-96 overflow-auto pr-1",children:(null!==(g=null==X?void 0:X.data)&&void 0!==g?g:[]).map(e=>{var s;return(0,i.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-white/5 border border-white/10 px-3 py-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"font-semibold text-sm",children:["Post #",e.id]}),(0,i.jsxs)("div",{className:"text-xs text-white/60",children:["Creator ",e.creator_id," • ",e.visibility," • Likes ",null!==(s=e.likes_count)&&void 0!==s?s:0]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("button",{disabled:_,onClick:()=>M(()=>x("set_post_visibility",{postId:e.id,visibility:"public"},S,C)),className:"text-[11px] px-2 py-1 rounded bg-white/10 border border-white/15",children:"Public"}),(0,i.jsx)("button",{disabled:_,onClick:()=>M(()=>x("set_post_visibility",{postId:e.id,visibility:"followers"},S,C)),className:"text-[11px] px-2 py-1 rounded bg-white/10 border border-white/15",children:"Followers"}),(0,i.jsx)("button",{disabled:_,onClick:()=>M(()=>x("delete_post",{postId:e.id},S,C)),className:"text-[11px] px-2 py-1 rounded bg-red-500/20 border border-red-400/40 text-red-100",children:"Delete"})]})]},e.id)})})}),(0,i.jsx)(u,{title:"Audit (last 30)",children:(0,i.jsx)("div",{className:"space-y-2 max-h-96 overflow-auto pr-1",children:(null!==(f=null==R?void 0:R.data)&&void 0!==f?f:[]).map(e=>(0,i.jsxs)("div",{className:"rounded-lg bg-white/5 border border-white/10 px-3 py-2",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,i.jsx)("span",{className:"font-semibold",children:e.actor}),(0,i.jsx)("span",{className:"text-[11px] text-white/60",children:new Date(e.created_at).toLocaleString()})]}),(0,i.jsx)("div",{className:"text-xs text-white/80",children:e.action}),e.metadata&&Object.keys(e.metadata).length>0&&(0,i.jsx)("pre",{className:"mt-1 text-[11px] text-white/60 whitespace-pre-wrap break-all",children:JSON.stringify(e.metadata)})]},e.id))})})]})]})})}function h(e){let{label:s,value:t}=e;return(0,i.jsxs)("div",{className:"rounded-xl bg-white/5 border border-white/10 px-4 py-3",children:[(0,i.jsx)("div",{className:"text-xs text-white/60",children:s}),(0,i.jsx)("div",{className:"text-2xl font-semibold",children:t})]})}function u(e){let{title:s,children:t}=e;return(0,i.jsxs)("div",{className:"rounded-xl bg-white/5 border border-white/10 p-3",children:[(0,i.jsx)("div",{className:"text-sm font-semibold mb-2",children:s}),t]})}}},function(e){e.O(0,[802,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);